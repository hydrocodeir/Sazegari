/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/gojs@3.1.5/release/go.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/**
 * @license GoJS
 * GoJS v3.1.5 JavaScript Library for Interactive Diagrams, https://gojs.net
 * GoJS and Northwoods Software are registered trademarks of Northwoods Software Corporation, https://nwoods.com.
 * Copyright 1998-2026 by Northwoods Software Corporation.  All Rights Reserved.
 * THIS SOFTWARE IS LICENSED.  THE LICENSE AGREEMENT IS AT: https://gojs.net/3.1.5/license.html.
 * DO NOT MODIFY THIS FILE.  DO NOT DISTRIBUTE A MODIFIED COPY OF THE CONTENTS OF THIS FILE.
 */
!function(){const t="object"==typeof globalThis&&globalThis||"object"==typeof global&&global.global===global&&global||"object"==typeof self&&self.self===self&&self||{};void 0===t.requestAnimationFrame&&(void 0===t.setImmediate?t.requestAnimationFrame=e=>t.setTimeout(e,0):t.requestAnimationFrame=t.setImmediate);class e{static fr=void 0!==t.navigator&&void 0!==t.navigator.platform&&null!==t.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i);static CP(t,i,s){let n=-1;return function(){const o=this,r=arguments;-1!==n&&e.yc(n),n=e.un((()=>{n=-1,s||t.apply(o,r)}),i),s&&!n&&t.apply(o,r)}}static un(e,i){return t.setTimeout(e,i)}static yc(e){t.clearTimeout(e)}static Ni(e){return t.document.createElement(e)}static o(t){throw new Error(t)}static L(t,i){let s="The object is frozen, so its properties cannot be set: "+t.toString();void 0!==i&&(s+="  to value: "+i),e.o(s)}static se(t,e,i,s){}static s(t,e,i,s){}static CU(t,e,i){}static wc(t,i,s){if(null===t||"object"!=typeof t){let n=e.TL(i);void 0!==s&&(n+="."+s),e.si(t,"object",n)}}static S(t,i,s){e.s(t,"function",i,s)}static LU(t,e,i){}static si(t,e,i,s){}static J(t,i,s,n){let o=e.TL(s);void 0!==n&&(o+="."+n),e.o(o+" is not in the range "+i+": "+t)}static Xi(t){}static ur(t,e){}static ne(e){t.console&&t.console.log(e)}static $(t){return null!==t&&"object"==typeof t}static st(t){return"function"==typeof t}static LP=[];static nt(){const t=e.LP.pop();return void 0===t?[]:t}static Z(t){t.length=0,e.LP.push(t)}static AU=Object.freeze([]);static TL(t){return null===t?"*":"string"==typeof t?t:e.st(t)?t.name:""}static Kn(t){return e.st(t)?t.className?t.className:t.name:e.$(t)&&t.constructor?e.Kn(t.constructor):typeof t}static $a(t,i){return null==i||""===i?null:e.$(t)&&i in t||t[i]?t[i]:null}static toString(t){let i=t;return e.$(t)&&(t.text?i=t.text:t.name?i=t.name:void 0!==t.key?i=t.key:void 0!==t.id?i=t.id:t.constructor===Object&&(t.Text?i=t.Text:t.Name?i=t.Name:void 0!==t.Key?i=t.Key:void 0!==t.Id?i=t.Id:void 0!==t.ID&&(i=t.ID))),void 0===i?"undefined":null===i?"null":i.toString()}static qw(t,e){if(t.hasOwnProperty(e))return!0;let i=Object.getPrototypeOf(t);for(;i&&i!==Function;){if(i.hasOwnProperty(e))return!0;const t=i.TU;if(t&&t[e])return!0;i=Object.getPrototypeOf(i)}return!1}static XF(t){const e=[];let i=0;for(i=0;i<256;i++)e[i]=i;let s=0,n=0;for(i=0;i<256;i++)s=(s+e[i]+119)%256,n=e[i],e[i]=e[s],e[s]=n;i=0,s=0;let o="";for(let r=0;r<t.length;r++)i=(i+1)%256,s=(s+e[i])%256,n=e[i],e[i]=e[s],e[s]=n,o+=String.fromCharCode(t.charCodeAt(r)^e[(e[i]+e[s])%256]);return o}static GF(t){const e="0123456789abcdef",i=[];for(let t=0;t<256;t++)i[e.charAt(t>>4)+e.charAt(15&t)]=String.fromCharCode(t);t.length%2&&(t="0"+t);const s=[];let n=0;for(let e=0;e<t.length;e+=2)s[n++]=i[t.substring(e,e+2)];const o=s.join("");return""===o?"0":o}static We(t){return e.XF(e.GF(t))}static color1="@COLOR1";static color2="@COLOR2";static jw="32ab5ff3b26f42dc0ed90f21422913b5"}e.vfo="29e647fdb6";class i{AP;constructor(){this.AP=[]}toString(){return this.AP.join("")}add(t){""!==t&&this.AP.push(t)}}class s{}class n{g;constructor(){this.g=[]}[Symbol.iterator](){return this.g.values()}key;value;get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(t){return this}filter(){return this}get count(){return 0}Ml(){}toString(){return"EmptyIterator"}static instance=new n}class o{constructor(t){this.key=-1,this.value=t}[Symbol.iterator](){return[this.value].values()}key;value;get iterator(){return this}reset(){this.key=-1}next(){return-1===this.key&&(this.key=0,!0)}hasNext(){return this.next()}first(){return this.key=0,this.value}any(t){return this.key=-1,t(this.value)}all(t){return this.key=-1,t(this.value)}each(t){return this.key=-1,t(this.value),this}map(t){return new o(t(this.value))}filter(t){return t(this.value)?new o(this.value):n.instance}get count(){return 1}Ml(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class r{qt;zs;Gt;Tt;constructor(t){this.qt=t,this.zs=null,t.dr=null,this.Gt=t.rt,this.Tt=-1}[Symbol.iterator](){return null===this.zs?this.qt.r.values():this.qt.r.filter(this.zs).values()}key;value;get iterator(){return this}get predicate(){return this.zs}set predicate(t){this.zs=t}reset(){const t=this.qt;t.dr=null,this.Gt=t.rt,this.Tt=-1}next(){const t=this.qt;if(t.rt!==this.Gt){if(this.key<0)return!1;e.Xi(t)}const i=t.r,s=i.length;let n=++this.Tt;const o=this.zs;if(null!==o)for(;n<s;){const t=i[n];if(o(t))return this.Tt=n,this.key=n,this.value=t,!0;n++}else{if(n<s)return this.key=n,this.value=i[n],!0;this.Ml()}return!1}hasNext(){return this.next()}first(){const t=this.qt;this.Gt=t.rt,this.Tt=0;const e=t.r,i=e.length,s=this.zs;if(null!==s){let t=0;for(;t<i;){const i=e[t];if(s(i))return this.Tt=t,this.key=t,this.value=i,i;t++}return null}if(i>0){const t=e[0];return this.key=0,this.value=t,t}return null}any(t){const i=this.qt;i.dr=null;const s=i.rt;this.Tt=-1;const n=i.r,o=n.length,r=this.zs;for(let a=0;a<o;a++){const o=n[a];if(null===r||r(o)){if(t(o))return!0;i.rt!==s&&e.Xi(i)}}return!1}all(t){const i=this.qt;i.dr=null;const s=i.rt;this.Tt=-1;const n=i.r,o=n.length,r=this.zs;for(let a=0;a<o;a++){const o=n[a];if(null===r||r(o)){if(!t(o))return!1;i.rt!==s&&e.Xi(i)}}return!0}each(t){const i=this.qt;i.dr=null;const s=i.rt;this.Tt=-1;const n=i.r,o=n.length,r=this.zs;for(let a=0;a<o;a++){const o=n[a];null!==r&&!r(o)||(t(o),i.rt!==s&&e.Xi(i))}return this}map(t){const i=this.qt;i.dr=null;const s=i.rt;this.Tt=-1;const n=[],o=i.r,r=o.length,a=this.zs;for(let h=0;h<r;h++){const r=o[h];null!==a&&!a(r)||(n.push(t(r)),i.rt!==s&&e.Xi(i))}const l=new h;return l.r=n,l.Gi(),l.iterator}filter(t){const i=this.qt;i.dr=null;const s=i.rt;this.Tt=-1;const n=[],o=i.r,r=o.length,a=this.zs;for(let h=0;h<r;h++){const r=o[h];null!==a&&!a(r)||(t(r)&&n.push(r),i.rt!==s&&e.Xi(i))}const l=new h;return l.r=n,l.Gi(),l.iterator}get count(){const t=this.zs;if(null!==t){let e=0;const i=this.qt.r,s=i.length;for(let n=0;n<s;n++)t(i[n])&&e++;return e}return this.qt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.zs=null,this.qt.dr=this}toString(){return"ListIterator@"+this.Tt+"/"+this.qt.count}}class a{qt;Gt;Tt;constructor(t){this.qt=t,t.gr=null,this.Gt=t.rt,this.Tt=t.r.length}[Symbol.iterator](){return this.qt.r.reverse().values()}key;value;get iterator(){return this}reset(){const t=this.qt;t.gr=null,this.Gt=t.rt,this.Tt=t.r.length}next(){const t=this.qt;if(t.rt!==this.Gt){if(this.key<0)return!1;e.Xi(t)}const i=--this.Tt;return i>=0?(this.key=i,this.value=t.r[i],!0):(this.Ml(),!1)}hasNext(){return this.next()}first(){const t=this.qt;this.Gt=t.rt;const e=t.r,i=e.length-1;if(this.Tt=i,i>=0){const t=e[i];return this.key=i,this.value=t,t}return null}any(t){const i=this.qt;i.gr=null;const s=i.rt,n=i.r,o=n.length;this.Tt=o;for(let r=o-1;r>=0;r--){if(t(n[r]))return!0;i.rt!==s&&e.Xi(i)}return!1}all(t){const i=this.qt;i.gr=null;const s=i.rt,n=i.r,o=n.length;this.Tt=o;for(let r=o-1;r>=0;r--){if(!t(n[r]))return!1;i.rt!==s&&e.Xi(i)}return!0}each(t){const i=this.qt;i.gr=null;const s=i.rt,n=i.r,o=n.length;this.Tt=o;for(let r=o-1;r>=0;r--){t(n[r]),i.rt!==s&&e.Xi(i)}return this}map(t){const i=this.qt;i.gr=null;const s=i.rt,n=[],o=i.r,r=o.length;this.Tt=r;for(let a=r-1;a>=0;a--){const r=o[a];n.push(t(r)),i.rt!==s&&e.Xi(i)}const a=new h;return a.r=n,a.Gi(),a.iterator}filter(t){const i=this.qt;i.gr=null;const s=i.rt,n=[],o=i.r,r=o.length;this.Tt=r;for(let a=r-1;a>=0;a--){const r=o[a];t(r)&&n.push(r),i.rt!==s&&e.Xi(i)}const a=new h;return a.r=n,a.Gi(),a.iterator}get count(){return this.qt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.qt.gr=this}toString(){return"ListIteratorBackwards("+this.Tt+"/"+this.qt.count+")"}}class h{u;r;rt;dr;gr;constructor(t){u.Je(this),this.u=!1,this.r=[],this.rt=0,this.dr=null,this.gr=null,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.r.values()}Gi(){let t=this.rt;t++,t>999999999&&(t=0),this.rt=t}k(){return this.u=!0,this}ce(){return this.u=!1,this}toString(){return"List()#"+u.xs(this)}add(t){return this.u&&e.L(this,t),this.r.push(t),this.Gi(),this}push(t){this.add(t)}addAll(t){if(null===t)return this;this.u&&e.L(this);const i=this.r;if(t.first){const e=t.iterator;for(;e.next();)i.push(e.value)}else for(const e of t)i.push(e);return this.Gi(),this}clear(){this.u&&e.L(this),this.r.length=0,this.Gi()}contains(t){return this.has(t)}has(t){return null!==t&&-1!==this.r.indexOf(t)}indexOf(t){return null===t?-1:this.r.indexOf(t)}elt(t){const i=this.r;return(t<0||t>=i.length)&&e.J(t,"0 <= i < length",h,"elt:i"),i[t]}get(t){return this.elt(t)}setElt(t,i){const s=this.r;(t<0||t>=s.length)&&e.J(t,"0 <= i < length",h,"setElt:i"),this.u&&e.L(this,t),s[t]=i}set(t,e){this.setElt(t,e)}first(){const t=this.r;return 0===t.length?null:t[0]}last(){const t=this.r,e=t.length;return e>0?t[e-1]:null}pop(){this.u&&e.L(this);const t=this.r;if(t.length>0){const e=t.pop();return void 0===e?null:e}return null}any(t){const i=this.r,s=this.rt,n=i.length;for(let o=0;o<n;o++){if(t(i[o]))return!0;this.rt!==s&&e.Xi(this)}return!1}all(t){const i=this.r,s=this.rt,n=i.length;for(let o=0;o<n;o++){if(!t(i[o]))return!1;this.rt!==s&&e.Xi(this)}return!0}each(t){const i=this.r,s=this.rt,n=i.length;for(let o=0;o<n;o++)t(i[o]),this.rt!==s&&e.Xi(this);return this}map(t){const i=new h,s=[],n=this.r,o=this.rt,r=n.length;for(let i=0;i<r;i++)s.push(t(n[i])),this.rt!==o&&e.Xi(this);return i.r=s,i.Gi(),i}filter(t){const i=new h,s=[],n=this.r,o=this.rt,r=n.length;for(let i=0;i<r;i++){const r=n[i];t(r)&&s.push(r),this.rt!==o&&e.Xi(this)}return i.r=s,i.Gi(),i}insertAt(t,i){t<0&&e.J(t,">= 0",h,"insertAt:i"),this.u&&e.L(this,t);const s=this.r;t>=s.length?s.push(i):s.splice(t,0,i),this.Gi()}remove(t){return this.delete(t)}delete(t){if(null===t)return!1;this.u&&e.L(this,t);const i=this.r,s=i.indexOf(t);return-1!==s&&(s===i.length-1?i.pop():i.splice(s,1),this.Gi(),!0)}removeAt(t){const i=this.r;(t<0||t>=i.length)&&e.J(t,"0 <= i < length",h,"removeAt:i"),this.u&&e.L(this,t),t===i.length-1?i.pop():i.splice(t,1),this.Gi()}removeRange(t,i){const s=this.r,n=s.length;if(t<0)t=0;else if(t>=n)return this;if(i<0)return this;if(i>=n&&(i=n-1),t>i)return this;this.u&&e.L(this);let o=t,r=i+1;for(;r<n;)s[o++]=s[r++];return s.length=n-(i-t+1),this.Gi(),this}copy(){const t=new h,e=this.r;return e.length>0&&(t.r=Array.prototype.slice.call(e)),t}toArray(){const t=this.r,e=this.count,i=new Array(e);for(let s=0;s<e;s++)i[s]=t[s];return i}get DL(){return this.r}toSet(){const t=new u,e=this.r,i=this.count;for(let s=0;s<i;s++)t.add(e[s]);return t}sort(t){return this.u&&e.L(this),this.r.sort(t),this.Gi(),this}sortRange(t,i,s){const n=this.r,o=n.length;void 0===i&&(i=0),void 0===s&&(s=o),this.u&&e.L(this);const r=s-i;if(r<=1)return this;if((i<0||i>=o-1)&&e.J(i,"0 <= from < length",h,"sortRange:from"),2===r){const e=n[i],s=n[i+1];return t(e,s)>0&&(n[i]=s,n[i+1]=e,this.Gi()),this}if(0===i)if(s>=o)n.sort(t);else{const e=n.slice(0,s);e.sort(t);for(let t=0;t<s;t++)n[t]=e[t]}else if(s>=o){const e=n.slice(i);e.sort(t);for(let t=i;t<o;t++)n[t]=e[t-i]}else{const e=n.slice(i,s);e.sort(t);for(let t=i;t<s;t++)n[t]=e[t-i]}return this.Gi(),this}reverse(){return this.u&&e.L(this),this.r.reverse(),this.Gi(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return n.instance;const t=this.dr;return null!==t?(t.reset(),t):new r(this)}get iteratorBackwards(){if(this.r.length<=0)return n.instance;const t=this.gr;return null!==t?(t.reset(),t):new a(this)}}class l{To;oe;constructor(t){this.To=t,this.oe=t.g.values()}[Symbol.iterator](){return this.To.g.values()}key;value;get iterator(){return this}reset(){const t=this.To;this.oe=t.g.values()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.To.g.size?null:(this.oe=this.To.g.values(),this.oe.next().value)}any(t){return this.To.any(t)}all(t){return this.To.all(t)}each(t){return this.To.each(t),this}map(t){const e=new h;return this.To.g.forEach((i=>e.add(t(i)))),e.iterator}filter(t){const e=new h;return this.To.g.forEach((i=>{t(i)&&e.add(i)})),e.iterator}get count(){return this.To.count}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"SetIterator"}}class u{u;g;constructor(t){this.u=!1,this.g=new Set,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.g.values()}values(){return this.g.values()}k(){return this.u=!0,this}ce(){return this.u=!1,this}toString(){return"Set()#"+u.xs(this)}add(t){return null===t||this.g.add(t),this}addAll(t){if(null===t)return this;if(this.u&&e.L(this),t.first){const e=t.iterator;for(;e.next();)this.g.add(e.value)}else for(const e of t)this.g.add(e);return this}has(t){return this.g.has(t)}contains(t){return this.has(t)}containsAll(t){if(null===t)return!0;if(t.first){const e=t.iterator;for(;e.next();)if(!this.has(e.value))return!1}else for(const e of t)if(!this.has(e))return!1;return!0}containsAny(t){if(null===t)return!0;if(t.first){const e=t.iterator;for(;e.next();)if(this.has(e.value))return!0}else for(const e of t)if(this.has(e))return!0;return!1}first(){return 0===this.g.size?null:this.g.values().next().value}any(t){for(const e of this.g)if(t(e))return!0;return!1}all(t){for(const e of this.g)if(!t(e))return!1;return!0}each(t){for(const e of this.g)t(e);return this}map(t){const e=new u;for(const i of this.g)e.add(t(i));return e}filter(t){const e=new u;for(const i of this.g)t(i)&&e.add(i);return e}delete(t){return this.u&&e.L(this),this.g.delete(t)}remove(t){return this.delete(t)}removeAll(t){if(null===t)return this;if(this.u&&e.L(this),t.first){const e=t.iterator;for(;e.next();)this.delete(e.value)}else for(const e of t)this.delete(e);return this}retainAll(t){if(null===t)return this;if(0===this.count)return this;this.u&&e.L(this);const i=new u;i.addAll(t);const s=[];if(t.first){const e=t.iterator;for(;e.next();){const t=e.value;i.has(t)||s.push(t)}}else for(const e of t)i.has(e)||s.push(e);return this.removeAll(s),this}clear(){this.u&&e.L(this),this.g.clear()}copy(){const t=new u;return this.g.forEach((e=>t.add(e))),t}toArray(){return Array.from(this.g)}toList(){const t=new h;return this.g.forEach((e=>t.add(e))),t}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?n.instance:new l(this)}entries(){return this.g.entries()}keys(){return this.g.keys()}forEach(t,e){return this.g.forEach(t,e)}static Ww=1;static Je(t){t.__gohashid=u.Ww++}static xs(t){return t.__gohashid}}class c{j;oe;constructor(t){this.j=t,this.oe=t.g.keys()}[Symbol.iterator](){return this.j.g.keys()}key;value;get iterator(){return this}reset(){const t=this.j;this.oe=t.g.keys()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.j.g.size?null:(this.oe=this.j.g.keys(),this.oe.next().value)}any(t){for(const e of this.j.g)if(t(e[0]))return!0;return!1}all(t){for(const e of this.j.g)if(!t(e[0]))return!1;return!0}each(t){for(const e of this.j.g)t(e[0]);return this}map(t){const e=this.j,i=new h;for(const s of e.g)i.add(t(s[0]));return i.iterator}filter(t){const e=this.j,i=new h;for(const s of e.g){const e=s[0];t(e)&&i.add(e)}return i.iterator}get count(){return this.j.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapKeySetIterator"}}class d extends u{j;constructor(t){super(),u.Je(this),this.u=!0,this.j=t}[Symbol.iterator](){return this.g.keys()}values(){return this.g.keys()}k(){return this}ce(){return this}toString(){return"MapKeySet("+this.j.toString()+")"}add(t){e.o("This Set is read-only: "+this.toString())}has(t){return this.j.has(t)}contains(t){return this.has(t)}delete(t){e.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){e.o("This Set is read-only: "+this.toString())}first(){return 0===this.j.g.size?null:this.j.g.keys().next().value}any(t){for(const e of this.j.g)if(t(e[0]))return!0;return!1}all(t){for(const e of this.j.g)if(!t(e[0]))return!1;return!0}each(t){for(const e of this.j.g)t(e[0]);return this}map(t){const e=new u;for(const i of this.j.g)e.add(t(i[0]));return e}filter(t){const e=new u;for(const i of this.j.g){const s=i[0];t(s)&&e.add(s)}return e}copy(){return new d(this.j)}toSet(){const t=new u,e=this.j.g;for(const i of e)t.add(i[0]);return t}toArray(){const t=this.j.g,e=new Array(t.size);let i=0;for(const s of t)e[i]=s[0],i++;return e}toList(){const t=new h,e=this.j.g;for(const i of e)t.add(i[0]);return t}get count(){return this.j.size}get size(){return this.j.size}get iterator(){return this.j.size<=0?n.instance:new c(this.j)}}class g{j;oe;constructor(t){this.j=t,this.oe=t.g.values()}[Symbol.iterator](){return this.j.g.values()}key;value;get iterator(){return this}reset(){const t=this.j;this.oe=t.g.values()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.j.g.size?null:(this.oe=this.j.g.values(),this.oe.next().value)}any(t){for(const e of this.j.g)if(t(e[1]))return!0;return!1}all(t){for(const e of this.j.g)if(!t(e[1]))return!1;return!0}each(t){for(const e of this.j.g)t(e[1]);return this}map(t){const e=this.j,i=new h;for(const s of e.g)i.add(t(s[1]));return i.iterator}filter(t){const e=this.j,i=new h;for(const s of e.g){const e=s[1];t(e)&&i.add(e)}return i.iterator}get count(){return this.j.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapValueSetIterator"}}class f{constructor(t,e){this.key=t,this.value=e}toString(){return"{"+this.key+":"+this.value+"}"}key;value}class m{j;oe;constructor(t){this.j=t,this.oe=t.g.entries()}[Symbol.iterator](){return this.j.g.entries()}key;value;get iterator(){return this}reset(){const t=this.j;this.oe=t.g.entries()}next(){const t=this.oe.next();return t.done?(this.key=null,this.value=null,!1):(this.key=t.value[0],this.value=t.value[1],!0)}hasNext(){return this.next()}first(){if(0===this.j.g.size)return null;this.oe=this.j.g.entries();const t=this.oe.next().value;return this.key=t[0],this.value=t[1],new f(t[0],t[1])}any(t){return this.j.any(t)}all(t){return this.j.all(t)}each(t){return this.j.each(t),this}map(t){const e=new h;let i=null;return this.j.g.forEach(((s,n)=>{null===i?i=new f(n,s):(i.key=n,i.value=s),e.add(t(i))})),e.iterator}filter(t){const e=new h;let i=null;return this.j.g.forEach(((s,n)=>{null===i?i=new f(n,s):(i.key=n,i.value=s),t(i)&&(e.add(i),i=null)})),e.iterator}get count(){return this.j.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapIterator"}}class p{u;g;constructor(t){u.Je(this),this.u=!1,this.g=new Map,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.g.entries()}entries(){return this.g.entries()}k(){return this.u=!0,this}ce(){return this.u=!1,this}toString(){return"Map()#"+u.xs(this)}set(t,i){return this.u&&e.L(this,t),this.g.set(t,i),this}add(t,e){return this.set(t,e)}addAll(t){if(null===t)return this;if(this.u&&e.L(this),t instanceof p){const e=t.iterator;for(;e.next();)this.g.set(e.key,e.value)}else if(t.first){const e=t.iterator;for(;e.next();){const t=e.value;this.g.set(t.key,t.value)}}else for(const e of t){const t=e;Array.isArray(t)?this.g.set(t[0],t[1]):this.g.set(t.key,t.value)}return this}first(){if(0===this.g.size)return null;const t=this.g.entries().next().value;return t?new f(t[0],t[1]):null}any(t){let e=null;for(const[i,s]of this.g)if(null===e?e=new f(i,s):(e.key=i,e.value=s),t(e))return!0;return!1}all(t){let e=null;for(const[i,s]of this.g)if(null===e?e=new f(i,s):(e.key=i,e.value=s),!t(e))return!1;return!0}each(t){let e=null;for(const[i,s]of this.g)null===e?e=new f(i,s):(e.key=i,e.value=s),t(e);return this}map(t){const e=new p;let i=null;for(const[s,n]of this.g)null===i?i=new f(s,n):(i.key=s,i.value=n),e.set(s,t(i));return e}filter(t){const e=new p;let i=null;for(const[s,n]of this.g)null===i?i=new f(s,n):(i.key=s,i.value=n),t(i)&&e.set(s,n);return e}has(t){return this.g.has(t)}contains(t){return this.has(t)}get(t){const e=this.g.get(t);return void 0===e?null:e}getValue(t){return this.get(t)}delete(t){return null!==t&&(this.u&&e.L(this,t),this.g.delete(t))}remove(t){return this.delete(t)}clear(){this.u&&e.L(this),this.g.clear()}copy(){const t=new p;return t.g=new Map(this.g),t}toArray(){const t=this.g,e=new Array(t.size);let i=0;for(const s of t)e[i]=new f(s[0],s[1]),i++;return e}toKeySet(){return new d(this)}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?n.instance:new m(this)}get iteratorKeys(){return this.count<=0?n.instance:new c(this)}keys(){return this.g.keys()}get iteratorValues(){return this.count<=0?n.instance:new g(this)}values(){return this.g.values()}forEach(t,e){return this.g.forEach(t,e)}}class y{px;py;u;constructor(t,i){void 0===t?(this.px=0,this.py=0):"number"==typeof t&&"number"==typeof i?(this.px=t,this.py=i):e.o("Invalid arguments to Point constructor: "+t+", "+i),this.u=!1}h(t){return this.px=t.px,this.py=t.py,this}e(t,e){return this.px=t,this.py=e,this}setTo(t,e){return this.px=t,this.py=e,this}set(t){return this.px=t.px,this.py=t.py,this}copy(){const t=new y;return t.px=this.px,t.py=this.py,t}kt(){return this.u=!0,Object.freeze(this),this}N(){return this.u||Object.isFrozen(this)?this:this.copy().k()}k(){return this.u||(this.u=!0),this}Jw(t){}static parse(t){if("string"==typeof t){const e=t.split(" ");let i=0,s=0;for(;""===e[i];)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;""===e[i];)i++;return n=e[i++],n&&(o=parseFloat(n)),new y(s,o)}return new y}static stringify(t){return t.x.toString()+" "+t.y.toString()}static stringifyFixed(t){return e.s(t,"number",y,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)}toString(){return"Point("+this.x+","+this.y+")"}equals(t){return t instanceof y&&(this.px===t.x&&this.py===t.y)}equalTo(t,e){return this.px===t&&this.py===e}equalsApprox(t){return k.c(this.px,t.x)&&k.c(this.py,t.y)}add(t){return this.px+=t.x,this.py+=t.y,this}subtract(t){return this.px-=t.x,this.py-=t.y,this}offset(t,e){return this.px+=t,this.py+=e,this}rotate(t){if(0===t)return this;const e=this.px,i=this.py;if(0===e&&0===i)return this;let s=0,n=0;if(90===(t=k.Ee(t)))s=0,n=1;else if(180===t)s=-1,n=0;else if(270===t)s=0,n=-1;else{const e=t*Math.PI/180;s=Math.cos(e),n=Math.sin(e)}return this.px=s*e-n*i,this.py=n*e+s*i,this}scale(t,e){return this.px*=t,this.py*=e,this}distanceSquaredPoint(t){const e=t.x-this.px,i=t.y-this.py;return e*e+i*i}distanceSquared(t,e){const i=t-this.px,s=e-this.py;return i*i+s*s}normalize(){const t=this.px,e=this.py,i=Math.sqrt(t*t+e*e);return i>0&&(this.px=t/i,this.py=e/i),this}directionPoint(t){return this.vL(t.x-this.px,t.y-this.py)}direction(t,e){return this.vL(t-this.px,e-this.py)}vL(t,e){if(0===t)return e>0?90:e<0?270:0;if(0===e)return t>0?0:180;{if(isNaN(t)||isNaN(e))return 0;let i=180*Math.atan(Math.abs(e/t))/Math.PI;return t<0?e<0?i+=180:i=180-i:e<0&&(i=360-i),i}}static compareWithLineSegment(t,e,i,s,n,o){return k.bu(t,e,i,s,n,o)}compareWithLineSegmentPoint(t,e){return k.bu(t.x,t.y,e.x,e.y,this.x,this.y)}static intersectingLineSegments(t,e,i,s,n,o,r,a){return k.ku(t,e,i,s,n,o,r,a)}projectOntoLineSegment(t,e,i,s){return k.Nl(t,e,i,s,this.px,this.py,this),this}projectOntoLineSegmentPoint(t,e){return k.Nl(t.x,t.y,e.x,e.y,this.px,this.py,this),this}snapToGrid(t,e,i,s){return k.tm(this.px,this.py,t,e,i,s,this),this}snapToGridPoint(t,e){return k.tm(this.px,this.py,t.x,t.y,e.width,e.height,this),this}setRectSpot(t,e){return this.px=t.x+e.x*t.width+e.offsetX,this.py=t.y+e.y*t.height+e.offsetY,this}setSpot(t,e,i,s,n){return this.px=t+n.x*i+n.offsetX,this.py=e+n.y*s+n.offsetY,this}v(t){return t.gt(this),this}Yi(t){return t.Ci(this),this}static distanceLineSegmentSquared(t,e,i,s,n,o){let r=n-i,a=o-s;const h=r*r+a*a,l=i-t,u=s-e,c=-l*r-u*a;if(c<=0||c>=h)return r=n-t,a=o-e,Math.min(l*l+u*u,r*r+a*a);{const t=r*u-a*l;return t*t/h}}static distanceSquared(t,e,i,s){const n=i-t,o=s-e;return n*n+o*o}static direction(t,e,i,s){const n=i-t,o=s-e;if(0===n)return o>0?90:o<0?270:0;if(0===o)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let t=180*Math.atan(Math.abs(o/n))/Math.PI;return n<0?o<0?t+=180:t=180-t:o<0&&(t=360-t),t}}get x(){return this.px}set x(t){this.px=t}get y(){return this.py}set y(t){this.py=t}isReal(){return isFinite(this.x)&&isFinite(this.y)}static dn=new y(0,0).kt();static FL=new y(-1/0,-1/0).kt();static RL=new y(1/0,1/0).kt();static OL=new y(6,6).kt();static gn=new y(NaN,NaN).kt();static $w=[];static l(){const t=y.$w.pop();return void 0===t?new y:t}static bs(t){const e=y.$w.pop();return void 0===e?t.copy():e.h(t)}static z(t,e){const i=y.$w.pop();return void 0===i?new y(t,e):(i.x=t,i.y=e,i)}static i(t){y.$w.push(t)}}class x{sw;sh;u;constructor(t,i){void 0===t?(this.sw=0,this.sh=0):"number"==typeof t&&(t>=0||isNaN(t))&&"number"==typeof i&&(i>=0||isNaN(i))?(this.sw=t,this.sh=i):e.o("Invalid arguments to Size constructor: "+t+", "+i),this.u=!1}h(t){return this.sw=t.sw,this.sh=t.sh,this}e(t,e){return this.sw=t,this.sh=e,this}setTo(t,e){return this.sw=t,this.sh=e,this}set(t){return this.sw=t.sw,this.sh=t.sh,this}copy(){const t=new x;return t.sw=this.sw,t.sh=this.sh,t}kt(){return this.u=!0,Object.freeze(this),this}N(){return this.u||Object.isFrozen(this)?this:this.copy().k()}k(){return this.u||(this.u=!0),this}Jw(t){}static parse(t){if("string"==typeof t){const e=t.split(" ");let i=0,s=0;for(;""===e[i];)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;""===e[i];)i++;return n=e[i++],n&&(o=parseFloat(n)),new x(s,o)}return new x}static stringify(t){return t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return e.s(t,"number",x,"stringifyFixed:digits"),e=>e.width.toFixed(t)+" "+e.height.toFixed(t)}toString(){return"Size("+this.width+","+this.height+")"}equals(t){return t instanceof x&&(this.sw===t.width&&this.sh===t.height)}equalTo(t,e){return this.sw===t&&this.sh===e}equalsApprox(t){return k.c(this.sw,t.width)&&k.c(this.sh,t.height)}inflate(t,e){const i=this.width+t;this.sw=i>=0?i:0;const s=this.height+e;return this.sh=s>=0?s:0,this}get width(){return this.sw}set width(t){t<0&&e.J(t,">= 0",x,"width"),this.sw=t}get height(){return this.sh}set height(t){t<0&&e.J(t,">= 0",x,"height"),this.sh=t}isReal(){return isFinite(this.width)&&isFinite(this.height)}static xc=new x(0,0).kt();static TP=new x(1,1).kt();static IL=new x(6,6).kt();static Pu=new x(8,8).kt();static EL=new x(10,10).kt();static DP=new x(1/0,1/0).kt();static Zw=new x(NaN,NaN).kt();static UL=[];static l(){const t=x.UL.pop();return void 0===t?new x:t}static i(t){x.UL.push(t)}}class w{rx;ry;rw;rh;u;constructor(t,i,s,n){if(void 0===t)this.rx=0,this.ry=0,this.rw=0,this.rh=0;else if("number"==typeof t&&"number"==typeof i&&"number"==typeof s&&(s>=0||isNaN(s))&&"number"==typeof n&&(n>=0||isNaN(n)))this.rx=t,this.ry=i,this.rw=s,this.rh=n;else if(t instanceof y){const s=t.x,n=t.y;if(i instanceof y){const t=i.x,e=i.y;this.rx=Math.min(s,t),this.ry=Math.min(n,e),this.rw=Math.abs(s-t),this.rh=Math.abs(n-e)}else i instanceof x?(this.rx=s,this.ry=n,this.rw=i.width,this.rh=i.height):e.o("Incorrect second argument supplied to Rect constructor "+i)}else e.o("Invalid arguments to Rect constructor: "+t+", "+i+", "+s+", "+n);this.u=!1}h(t){return this.rx=t.rx,this.ry=t.ry,this.rw=t.rw,this.rh=t.rh,this}e(t,e,i,s){return this.rx=t,this.ry=e,this.rw=i,this.rh=s,this}Hn(t,e){return this.rw=t,this.rh=e,this}setTo(t,e,i,s){return this.rx=t,this.ry=e,this.rw=i,this.rh=s,this}set(t){return this.rx=t.rx,this.ry=t.ry,this.rw=t.rw,this.rh=t.rh,this}setPoint(t){return this.rx=t.x,this.ry=t.y,this}setSize(t){return this.rw=t.width,this.rh=t.height,this}copy(){const t=new w;return t.rx=this.rx,t.ry=this.ry,t.rw=this.rw,t.rh=this.rh,t}kt(){return this.u=!0,Object.freeze(this),this}N(){return this.u||Object.isFrozen(this)?this:this.copy().k()}k(){return this.u||(this.u=!0),this}ce(){return this.u&&(Object.isFrozen(this)&&e.o("cannot thaw constant: "+this),this.u=!1),this}Jw(t){}static parse(t){if("string"==typeof t){const e=t.split(" ");let i=0,s=0;for(;""===e[i];)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;""===e[i];)i++;n=e[i++],n&&(o=parseFloat(n));let r=0;for(;""===e[i];)i++;n=e[i++],n&&(r=parseFloat(n));let a=0;for(;""===e[i];)i++;return n=e[i++],n&&(a=parseFloat(n)),new w(s,o,r,a)}return new w}static stringify(t){return t.x.toString()+" "+t.y.toString()+" "+t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return e.s(t,"number",w,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)+" "+e.width.toFixed(t)+" "+e.height.toFixed(t)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(t){return t instanceof w&&(this.rx===t.x&&this.ry===t.y&&this.rw===t.width&&this.rh===t.height)}equalTo(t,e,i,s){return this.rx===t&&this.ry===e&&this.rw===i&&this.rh===s}equalsApprox(t){return k.c(this.rx,t.x)&&k.c(this.ry,t.y)&&k.c(this.rw,t.width)&&k.c(this.rh,t.height)}equalsApproxTo(t,e,i,s){return k.c(this.rx,t)&&k.c(this.ry,e)&&k.c(this.rw,i)&&k.c(this.rh,s)}equalsApproxClose(t){return k.X(this.rx,t.x)&&k.X(this.ry,t.y)&&k.X(this.rw,t.width)&&k.X(this.rh,t.height)}containsPoint(t){return this.rx<=t.x&&this.rx+this.rw>=t.x&&this.ry<=t.y&&this.ry+this.rh>=t.y}containsRect(t){return this.rx<=t.x&&t.x+t.width<=this.rx+this.rw&&this.ry<=t.y&&t.y+t.height<=this.ry+this.rh}contains(t,e,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),this.rx<=t&&t+i<=this.rx+this.rw&&this.ry<=e&&e+s<=this.ry+this.rh}offset(t,e){return this.rx+=t,this.ry+=e,this}inflate(t,e){return this.Qw(e,t,e,t)}addMargin(t){return this.Qw(t.top,t.right,t.bottom,t.left)}subtractMargin(t){return this.Qw(-t.top,-t.right,-t.bottom,-t.left)}grow(t,e,i,s){return this.Qw(t,e,i,s)}Qw(t,e,i,s){const n=this.rw;e+s<=-n?(this.rx+=n/2,this.rw=0):(this.rx-=s,this.rw+=e+s);const o=this.rh;return t+i<=-o?(this.ry+=o/2,this.rh=0):(this.ry-=t,this.rh+=t+i),this}intersectRect(t){return this.VL(t.x,t.y,t.width,t.height)}intersect(t,e,i,s){return this.VL(t,e,i,s)}VL(t,e,i,s){const n=Math.max(this.rx,t),o=Math.max(this.ry,e),r=Math.min(this.rx+this.rw,t+i),a=Math.min(this.ry+this.rh,e+s);return this.rx=n,this.ry=o,this.rw=Math.max(0,r-n),this.rh=Math.max(0,a-o),this}intersectsRect(t){return this.intersects(t.x,t.y,t.width,t.height)}intersects(t,e,i,s){let n=this.rw;const o=this.rx;if(n!==1/0&&i!==1/0&&(n+=o,i+=t,isNaN(i)||isNaN(n)||o>i||t>n))return!1;let r=this.rh;const a=this.ry;return!(r!==1/0&&s!==1/0&&(r+=a,s+=e,isNaN(s)||isNaN(r)||a>s||e>r))}BL(t,e){let i=this.rw,s=t.width+e+e;const n=this.rx,o=t.x-e;if(i+=n,s+=o,n>s||o>i)return!1;let r=this.rh,a=t.height+e+e;const h=this.ry,l=t.y-e;return r+=h,a+=l,!(h>a||l>r)}unionPoint(t){return this.re(t.x,t.y,0,0)}unionRect(t){return this.re(t.rx,t.ry,t.rw,t.rh)}union(t,e,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),this.re(t,e,i,s)}re(t,e,i,s){const n=Math.min(this.rx,t),o=Math.min(this.ry,e),r=Math.max(this.rx+this.rw,t+i),a=Math.max(this.ry+this.rh,e+s);return this.rx=n,this.ry=o,this.rw=r-n,this.rh=a-o,this}setSpot(t,e,i){return this.rx=t-i.offsetX-i.x*this.rw,this.ry=e-i.offsetY-i.y*this.rh,this}nearestSideDirection(t,e){return k._w(this,t,e,!0)}nearestSideDirectionPoint(t){return k._w(this,t.x,t.y,!0)}static contains(t,e,i,s,n,o,r,a){return void 0===r&&(r=0),void 0===a&&(a=0),t<=n&&n+r<=t+i&&e<=o&&o+a<=e+s}static intersects(t,e,i,s,n,o,r,a){let h=i,l=r;if(h+=t,l+=n,t>l||n>h)return!1;let u=s,c=a;return u+=e,c+=o,!(e>c||o>u)}static intersectsLineSegment(t,e,i,s,n,o,r,a){return k.zL(t,e,i,s,n,o,r,a)}get x(){return this.rx}set x(t){this.rx=t}get y(){return this.ry}set y(t){this.ry=t}get width(){return this.rw}set width(t){t<0&&e.J(t,">= 0",w,"width"),this.rw=t}get height(){return this.rh}set height(t){t<0&&e.J(t,">= 0",w,"height"),this.rh=t}get left(){return this.rx}set left(t){this.rx=t}get top(){return this.ry}set top(t){this.ry=t}get right(){return this.rx+this.rw}set right(t){this.rx+=t-(this.rx+this.rw)}get bottom(){return this.ry+this.rh}set bottom(t){this.ry+=t-(this.ry+this.rh)}get position(){return new y(this.rx,this.ry)}set position(t){this.rx=t.x,this.ry=t.y}get size(){return new x(this.rw,this.rh)}set size(t){this.rw=t.width,this.rh=t.height}get center(){return new y(this.rx+this.rw/2,this.ry+this.rh/2)}set center(t){this.rx=t.x-this.rw/2,this.ry=t.y-this.rh/2}get centerX(){return this.rx+this.rw/2}set centerX(t){this.rx=t-this.rw/2}get centerY(){return this.ry+this.rh/2}set centerY(t){this.ry=t-this.rh/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return 0===this.width&&0===this.height}static em=new w(0,0,0,0).kt();static YF=new w(NaN,NaN,NaN,NaN).kt();static tx=[];static l(){const t=w.tx.pop();return void 0===t?new w:t}static bs(t){const e=w.tx.pop();return void 0===e?t.copy():e.h(t)}static z(t,e,i,s){const n=w.tx.pop();return void 0===n?new w(t,e,i,s):n.e(t,e,i,s)}static i(t){w.tx.push(t)}}class b{mt;mr;mb;ml;constructor(t,i,s,n){void 0===t?(this.mt=0,this.mr=0,this.mb=0,this.ml=0):void 0===i?(i=t,s=t,n=t,this.mt=t,this.mr=i,this.mb=s,this.ml=n):void 0===s?(s=t,n=i,this.mt=t,this.mr=i,this.mb=s,this.ml=n):void 0!==n?(this.mt=t,this.mr=i,this.mb=s,this.ml=n):e.o("Invalid arguments to Margin constructor: "+t+", "+i+", "+s+", "+n)}setTo(t,e,i,s){return this.mt=t,this.mr=e,this.mb=i,this.ml=s,this}set(t){return this.mt=t.mt,this.mr=t.mr,this.mb=t.mb,this.ml=t.ml,this}copy(){const t=new b;return t.mt=this.mt,t.mr=this.mr,t.mb=this.mb,t.ml=this.ml,t}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(t){}static parse(t){if("string"==typeof t){const e=t.split(" ");let i=0,s=NaN;for(;""===e[i];)i++;let n=e[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new b;let o=NaN;for(;""===e[i];)i++;if(n=e[i++],n&&(o=parseFloat(n)),isNaN(o))return new b(s);let r=NaN;for(;""===e[i];)i++;if(n=e[i++],n&&(r=parseFloat(n)),isNaN(r))return new b(s,o);let a=NaN;for(;""===e[i];)i++;return n=e[i++],n&&(a=parseFloat(n)),isNaN(a)?new b(s,o):new b(s,o,r,a)}return new b}static stringify(t){return t.top.toString()+" "+t.right.toString()+" "+t.bottom.toString()+" "+t.left.toString()}static stringifyFixed(t){return e.s(t,"number",b,"stringifyFixed:digits"),e=>e.top.toFixed(t)+" "+e.right.toFixed(t)+" "+e.bottom.toFixed(t)+" "+e.left.toFixed(t)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(t){return t instanceof b&&(this.mt===t.top&&this.mr===t.right&&this.mb===t.bottom&&this.ml===t.left)}equalTo(t,e,i,s){return this.mt===t&&this.mr===e&&this.mb===i&&this.ml===s}equalsApprox(t){return k.c(this.mt,t.top)&&k.c(this.mr,t.right)&&k.c(this.mb,t.bottom)&&k.c(this.ml,t.left)}get top(){return this.mt}set top(t){this.mt=t}get right(){return this.mr}set right(t){this.mr=t}get bottom(){return this.mb}set bottom(t){this.mb=t}get left(){return this.ml}set left(t){this.ml=t}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static im=new b(0,0,0,0).kt();static XL=new b(2,2,2,2).kt()}class v{sx;sy;ox;oy;constructor(t,e,i,s){void 0===t?(this.sx=0,this.sy=0,this.ox=0,this.oy=0):(void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.sx=t,this.sy=e,this.ox=i,this.oy=s)}setTo(t,e,i,s){return this.sx=t,this.sy=e,this.ox=i,this.oy=s,this}set(t){return this.sx=t.sx,this.sy=t.sy,this.ox=t.ox,this.oy=t.oy,this}copy(){const t=new v;return t.sx=this.sx,t.sy=this.sy,t.ox=this.ox,t.oy=this.oy,t}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(t){}Ki(t){return this.sx=NaN,this.sy=NaN,this.ox=t,this.kt()}DU(t,i){(isNaN(t)||t>1||t<0)&&e.J(t,"0 <= "+i+" <= 1",v,i)}vU(t,i){(isNaN(t)||t===1/0||t===-1/0)&&e.J(t,"real number, not NaN or Infinity",v,i)}static parse(t){if("string"==typeof t){if("None"===(t=t.trim()))return v.None;if("TopLeft"===t)return v.TopLeft;if("Top"===t||"TopCenter"===t||"MiddleTop"===t)return v.TopCenter;if("TopRight"===t)return v.TopRight;if("Left"===t||"LeftCenter"===t||"MiddleLeft"===t)return v.LeftCenter;if("Center"===t)return v.Center;if("Right"===t||"RightCenter"===t||"MiddleRight"===t)return v.RightCenter;if("BottomLeft"===t)return v.BottomLeft;if("Bottom"===t||"BottomCenter"===t||"MiddleBottom"===t)return v.BottomCenter;if("BottomRight"===t)return v.BottomRight;if("TopSide"===t)return v.TopSide;if("LeftSide"===t)return v.LeftSide;if("RightSide"===t)return v.RightSide;if("BottomSide"===t)return v.BottomSide;if("TopBottomSides"===t)return v.TopBottomSides;if("LeftRightSides"===t)return v.LeftRightSides;if("TopLeftSides"===t)return v.TopLeftSides;if("TopRightSides"===t)return v.TopRightSides;if("BottomLeftSides"===t)return v.BottomLeftSides;if("BottomRightSides"===t)return v.BottomRightSides;if("NotTopSide"===t)return v.NotTopSide;if("NotLeftSide"===t)return v.NotLeftSide;if("NotRightSide"===t)return v.NotRightSide;if("NotBottomSide"===t)return v.NotBottomSide;if("AllSides"===t)return v.AllSides;if("Default"===t)return v.Default;const e=t.split(" ");let i=0,s=0;for(;""===e[i];)i++;let n=e[i++];void 0!==n&&n.length>0&&(s=parseFloat(n));let o=0;for(;""===e[i];)i++;n=e[i++],void 0!==n&&n.length>0&&(o=parseFloat(n));let r=0;for(;""===e[i];)i++;n=e[i++],void 0!==n&&n.length>0&&(r=parseFloat(n));let a=0;for(;""===e[i];)i++;return n=e[i++],void 0!==n&&n.length>0&&(a=parseFloat(n)),new v(s,o,r,a)}return new v}static stringify(t){return t.isSpot()?t.x.toString()+" "+t.y.toString()+" "+t.offsetX.toString()+" "+t.offsetY.toString():t.toString()}static stringifyFixed(t){return e.s(t,"number",v,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)+" "+e.offsetX.toFixed(t)+" "+e.offsetY.toFixed(t)}toString(){return this.isSpot()?0===this.ox&&0===this.oy?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(v.None)?"None":this.equals(v.TopLeft)?"TopLeft":this.equals(v.TopCenter)?"Top":this.equals(v.TopRight)?"TopRight":this.equals(v.LeftCenter)?"Left":this.equals(v.Center)?"Center":this.equals(v.RightCenter)?"Right":this.equals(v.BottomLeft)?"BottomLeft":this.equals(v.BottomCenter)?"Bottom":this.equals(v.BottomRight)?"BottomRight":this.equals(v.TopSide)?"TopSide":this.equals(v.LeftSide)?"LeftSide":this.equals(v.RightSide)?"RightSide":this.equals(v.BottomSide)?"BottomSide":this.equals(v.TopBottomSides)?"TopBottomSides":this.equals(v.LeftRightSides)?"LeftRightSides":this.equals(v.TopLeftSides)?"TopLeftSides":this.equals(v.TopRightSides)?"TopRightSides":this.equals(v.BottomLeftSides)?"BottomLeftSides":this.equals(v.BottomRightSides)?"BottomRightSides":this.equals(v.NotTopSide)?"NotTopSide":this.equals(v.NotLeftSide)?"NotLeftSide":this.equals(v.NotRightSide)?"NotRightSide":this.equals(v.NotBottomSide)?"NotBottomSide":this.equals(v.AllSides)?"AllSides":this.equals(v.Default)?"Default":"None"}equals(t){return t instanceof v&&((this.sx===t.x||isNaN(this.sx)&&isNaN(t.x))&&(this.sy===t.y||isNaN(this.sy)&&isNaN(t.y))&&this.ox===t.offsetX&&this.oy===t.offsetY)}opposite(){return new v(.5-(this.sx-.5),.5-(this.sy-.5),-this.ox,-this.oy)}includesSide(t){if(!this.isSide())return!1;if(!t.isSide())if(t.equals(v.Left))t=v.LeftSide;else if(t.equals(v.Right))t=v.RightSide;else if(t.equals(v.Top))t=v.TopSide;else{if(!t.equals(v.Bottom))return!1;t=v.BottomSide}const e=this.oy,i=t.offsetY;return(e&i)===i}get x(){return this.sx}set x(t){this.sx=t}get y(){return this.sy}set y(t){this.sy=t}get offsetX(){return this.ox}set offsetX(t){this.ox=t}get offsetY(){return this.oy}set offsetY(t){this.oy=t}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&1===this.offsetX&&0!==this.offsetY}isNone(){return isNaN(this.x)&&isNaN(this.y)&&0===this.offsetX&&0===this.offsetY}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&-1===this.offsetX&&0===this.offsetY}static None=new v(0,0,0,0).Ki(0);static Default=new v(0,0,-1,0).Ki(-1);static TopLeft=new v(0,0,0,0).kt();static TopCenter=new v(.5,0,0,0).kt();static TopRight=new v(1,0,0,0).kt();static LeftCenter=new v(0,.5,0,0).kt();static Center=new v(.5,.5,0,0).kt();static RightCenter=new v(1,.5,0,0).kt();static BottomLeft=new v(0,1,0,0).kt();static BottomCenter=new v(.5,1,0,0).kt();static BottomRight=new v(1,1,0,0).kt();static MiddleTop=v.TopCenter;static MiddleLeft=v.LeftCenter;static MiddleRight=v.RightCenter;static MiddleBottom=v.BottomCenter;static Top=v.TopCenter;static Left=v.LeftCenter;static Right=v.RightCenter;static Bottom=v.BottomCenter;static TopSide=new v(0,0,1,1).Ki(1);static LeftSide=new v(0,0,1,2).Ki(1);static RightSide=new v(0,0,1,4).Ki(1);static BottomSide=new v(0,0,1,8).Ki(1);static TopBottomSides=new v(0,0,1,9).Ki(1);static LeftRightSides=new v(0,0,1,6).Ki(1);static TopLeftSides=new v(0,0,1,3).Ki(1);static TopRightSides=new v(0,0,1,5).Ki(1);static BottomLeftSides=new v(0,0,1,10).Ki(1);static BottomRightSides=new v(0,0,1,12).Ki(1);static NotTopSide=new v(0,0,1,14).Ki(1);static NotLeftSide=new v(0,0,1,13).Ki(1);static NotRightSide=new v(0,0,1,11).Ki(1);static NotBottomSide=new v(0,0,1,7).Ki(1);static AllSides=new v(0,0,1,15).Ki(1);static vP=new v(.156,.156).kt();static FP=new v(.844,.844).kt()}class P{m11;m12;m21;m22;dx;dy;constructor(){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(t){return this.m11=t.m11,this.m12=t.m12,this.m21=t.m21,this.m22=t.m22,this.dx=t.dx,this.dy=t.dy,this}setTo(t,e,i,s,n,o){return this.m11=t,this.m12=e,this.m21=i,this.m22=s,this.dx=n,this.dy=o,this}copy(){const t=new P;return t.m11=this.m11,t.m12=this.m12,t.m21=this.m21,t.m22=this.m22,t.dx=this.dx,t.dy=this.dy,t}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(t){return this.m11===t.m11&&this.m12===t.m12&&this.m21===t.m21&&this.m22===t.m22&&this.dx===t.dx&&this.dy===t.dy}RP(){return 0===this.dx&&0===this.dy&&1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22}Ue(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}bc(t){const e=this.m11*t.m11+this.m21*t.m12,i=this.m12*t.m11+this.m22*t.m12,s=this.m11*t.m21+this.m21*t.m22,n=this.m12*t.m21+this.m22*t.m22;return this.dx=this.m11*t.dx+this.m21*t.dy+this.dx,this.dy=this.m12*t.dx+this.m22*t.dy+this.dy,this.m11=e,this.m12=i,this.m21=s,this.m22=n,this}GL(t){const e=1/(t.m11*t.m22-t.m12*t.m21),i=t.m22*e,s=-t.m12*e,n=-t.m21*e,o=t.m11*e,r=e*(t.m21*t.dy-t.m22*t.dx),a=e*(t.m12*t.dx-t.m11*t.dy),h=this.m11*i+this.m21*s,l=this.m12*i+this.m22*s,u=this.m11*n+this.m21*o,c=this.m12*n+this.m22*o;return this.dx=this.m11*r+this.m21*a+this.dx,this.dy=this.m12*r+this.m22*a+this.dy,this.m11=h,this.m12=l,this.m21=u,this.m22=c,this}ex(){const t=1/(this.m11*this.m22-this.m12*this.m21),e=this.m22*t,i=-this.m12*t,s=-this.m21*t,n=this.m11*t,o=t*(this.m21*this.dy-this.m22*this.dx),r=t*(this.m12*this.dx-this.m11*this.dy);return this.m11=e,this.m12=i,this.m21=s,this.m22=n,this.dx=o,this.dy=r,this}ks(t,e,i){if(0===(t=k.Ee(t)))return this;this.Xs(e,i);let s=0,n=0;if(90===t)s=0,n=1;else if(180===t)s=-1,n=0;else if(270===t)s=0,n=-1;else{const e=t*Math.PI/180;s=Math.cos(e),n=Math.sin(e)}const o=this.m11*s+this.m21*n,r=this.m12*s+this.m22*n,a=this.m11*-n+this.m21*s,h=this.m12*-n+this.m22*s;return this.m11=o,this.m12=r,this.m21=a,this.m22=h,this.Xs(-e,-i),this}Xs(t,e){return this.dx+=this.m11*t+this.m21*e,this.dy+=this.m12*t+this.m22*e,this}it(t,e){return void 0===e&&(e=t),this.m11*=t,this.m12*=t,this.m21*=e,this.m22*=e,this}KF(){if(1===this.m11&&0===this.m12)return 0;let t=180*Math.atan2(this.m12,this.m11)/Math.PI;return t<0&&(t+=360),t}gt(t){const e=t.x,i=t.y;return t.e(e*this.m11+i*this.m21+this.dx,e*this.m12+i*this.m22+this.dy)}Ci(t){const e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,o=this.m11*e,r=t.x-this.dx,a=t.y-this.dy;return t.e(r*i+a*n,r*s+a*o)}Su(t){const e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,o=this.m11*e,r=e*(this.m21*this.dy-this.m22*this.dx),a=e*(this.m12*this.dx-this.m11*this.dy),h=1.25*t.x,l=1.2*t.y;return t.e(h*i+l*n+r,h*s+l*o+a)}sm(t){const e=t.x,i=t.y,s=e+t.width,n=i+t.height,o=this.m11,r=this.m12,a=this.m21,h=this.m22,l=this.dx,u=this.dy,c=e*o+i*a+l,d=e*r+i*h+u,g=s*o+i*a+l,f=s*r+i*h+u,m=e*o+n*a+l,p=e*r+n*h+u,y=s*o+n*a+l,x=s*r+n*h+u;let w=c,b=c,v=d,P=d;return w=Math.min(w,g),b=Math.max(b,g),v=Math.min(v,f),P=Math.max(P,f),w=Math.min(w,m),b=Math.max(b,m),v=Math.min(v,p),P=Math.max(P,p),w=Math.min(w,y),b=Math.max(b,y),v=Math.min(v,x),P=Math.max(P,x),t.e(w,v,b-w,P-v),t}static YL=[];static l(){const t=P.YL.pop();return void 0===t?new P:t}static i(t){P.YL.push(t)}static OP="54a702f3e53909c447824c6706603faf4c"}const k={HF:"7da71ca0ad381e90",qn:(Math.sqrt(2)-1)/3*4,KL:[],ix:t=>{if(t<=0)return 0;let e=k.KL;if(null===e){e=[];for(let t=0;t<=2e3;t++)e[t]=Math.sqrt(t);k.KL=e}if(t<1){const i=1/t;return i<=2e3?1/e[0|i]:Math.sqrt(t)}return t<=2e3?e[0|t]:Math.sqrt(t)},c:(t,e)=>{const i=t-e;return i<.5&&i>-.5},X:(t,e)=>{const i=t-e;return i<5e-8&&i>-5e-8},Ve:(t,e,i,s,n,o,r)=>{n<=0&&(n=1e-6);let a=0,h=0,l=0,u=0;if(t<i?(h=t,a=i):(h=i,a=t),e<s?(u=e,l=s):(u=s,l=e),t===i)return u<=r&&r<=l&&t-n<=o&&o<=t+n;if(e===s)return h<=o&&o<=a&&e-n<=r&&r<=e+n;const c=a+n,d=h-n;if(d<=o&&o<=c){const a=l+n,h=u-n;if(h<=r&&r<=a)if(c-d>a-h){if(!(t-i>n||i-t>n))return!0;{const a=(s-e)/(i-t)*(o-t)+e;if(a-n<=r&&r<=a+n)return!0}}else{if(!(e-s>n||s-e>n))return!0;{const a=(i-t)/(s-e)*(r-e)+t;if(a-n<=o&&o<=a+n)return!0}}}return!1},nx:(t,e,i,s,n,o,r,a,h,l,u,c)=>{if(k.Ve(t,e,r,a,c,i,s)&&k.Ve(t,e,r,a,c,n,o))return k.Ve(t,e,r,a,c,l,u);{const d=(t+i)/2,g=(e+s)/2,f=(i+n)/2,m=(s+o)/2,p=(n+r)/2,y=(o+a)/2,x=(d+f)/2,w=(g+m)/2,b=(f+p)/2,v=(m+y)/2,P=(x+b)/2,S=(w+v)/2;return k.nx(t,e,d,g,x,w,P,S,h,l,u,c)||k.nx(P,S,b,v,p,y,r,a,h,l,u,c)}},HL:(t,e,i,s,n,o,r,a,h)=>{const l=(i+n)/2,u=(s+o)/2,c=((t+i)/2+l)/2,d=((e+s)/2+u)/2,g=(l+(n+r)/2)/2,f=(u+(o+a)/2)/2;return h.e((c+g)/2,(d+f)/2),h},qF:(t,e,i,s,n,o,r,a)=>{const h=(i+n)/2,l=(s+o)/2,u=((t+i)/2+h)/2,c=((e+s)/2+l)/2,d=(h+(n+r)/2)/2,g=(l+(o+a)/2)/2;return y.direction(u,c,d,g)},Mu:(t,e,i,s,n,o,r,a,h,l)=>{if(k.Ve(t,e,r,a,h,i,s)&&k.Ve(t,e,r,a,h,n,o))l.re(t,e,0,0),l.re(r,a,0,0);else{const u=(t+i)/2,c=(e+s)/2,d=(i+n)/2,g=(s+o)/2,f=(n+r)/2,m=(o+a)/2,p=(u+d)/2,y=(c+g)/2,x=(d+f)/2,w=(g+m)/2,b=(p+x)/2,v=(y+w)/2;k.Mu(t,e,u,c,p,y,b,v,h,l),k.Mu(b,v,x,w,f,m,r,a,h,l)}return l},jn:(t,e,i,s,n,o,r,a,h,l)=>{if(k.Ve(t,e,r,a,h,i,s)&&k.Ve(t,e,r,a,h,n,o))0===l.length&&(l.push(t),l.push(e)),l.push(r),l.push(a);else{const u=(t+i)/2,c=(e+s)/2,d=(i+n)/2,g=(s+o)/2,f=(n+r)/2,m=(o+a)/2,p=(u+d)/2,y=(c+g)/2,x=(d+f)/2,w=(g+m)/2,b=(p+x)/2,v=(y+w)/2;k.jn(t,e,u,c,p,y,b,v,h,l),k.jn(b,v,x,w,f,m,r,a,h,l)}return l},IP:(t,e,i,s,n,o,r,a,h,l)=>{if(k.Ve(t,e,n,o,l,i,s))return k.Ve(t,e,n,o,l,a,h);{const u=(t+i)/2,c=(e+s)/2,d=(i+n)/2,g=(s+o)/2,f=(u+d)/2,m=(c+g)/2;return k.IP(t,e,u,c,f,m,r,a,h,l)||k.IP(f,m,d,g,n,o,r,a,h,l)}},EP:(t,e,i,s,n,o,r,a)=>{if(k.Ve(t,e,n,o,r,i,s))a.re(t,e,0,0),a.re(n,o,0,0);else{const h=(t+i)/2,l=(e+s)/2,u=(i+n)/2,c=(s+o)/2,d=(h+u)/2,g=(l+c)/2;k.EP(t,e,h,l,d,g,r,a),k.EP(d,g,u,c,n,o,r,a)}return a},nm:(t,e,i,s,n,o,r,a)=>{if(k.Ve(t,e,n,o,r,i,s))0===a.length&&(a.push(t),a.push(e)),a.push(n),a.push(o);else{const h=(t+i)/2,l=(e+s)/2,u=(i+n)/2,c=(s+o)/2,d=(h+u)/2,g=(l+c)/2;k.nm(t,e,h,l,d,g,r,a),k.nm(d,g,u,c,n,o,r,a)}return a},om:(t,e,i,s,n,o,r,a,h,l,u,c,d,g)=>{if(k.Ve(t,e,r,a,d,i,s)&&k.Ve(t,e,r,a,d,n,o)){if(!k.ku(t,e,r,a,h,l,u,c))return!1;const i=(t-r)*(l-c)-(e-a)*(h-u);if(0===i)return!1;const s=((t*a-e*r)*(h-u)-(t-r)*(h*c-l*u))/i,n=((t*a-e*r)*(l-c)-(e-a)*(h*c-l*u))/i;return g.e(s,n),!0}{const f=(t+i)/2,m=(e+s)/2,p=(i+n)/2,y=(s+o)/2,x=(n+r)/2,w=(o+a)/2,b=(f+p)/2,v=(m+y)/2,P=(p+x)/2,S=(y+w)/2,M=(b+P)/2,C=(v+S)/2;let N=1/0,T=!1,L=0,A=0;if(k.om(t,e,f,m,b,v,M,C,h,l,u,c,d,g)){const t=(g.x-h)**2+(g.y-l)**2;t<N&&(N=t,T=!0,L=g.x,A=g.y)}if(k.om(M,C,P,S,x,w,r,a,h,l,u,c,d,g)){const t=(g.x-h)**2+(g.y-l)**2;t<N&&(N=t,T=!0,L=g.x,A=g.y)}return T&&(g.x=L,g.y=A),T}},rm:(t,e,i,s,n,o,r,a,h,l,u,c,d)=>{let g=0;if(k.Ve(t,e,r,a,d,i,s)&&k.Ve(t,e,r,a,d,n,o)){const i=(t-r)*(l-c)-(e-a)*(h-u);if(0===i)return g;const s=((t*a-e*r)*(h-u)-(t-r)*(h*c-l*u))/i,n=((t*a-e*r)*(l-c)-(e-a)*(h*c-l*u))/i;if(s>=u)return g;let o=0,d=0;if((h>u?h-u:u-h)<(l>c?l-c:c-l)){if(e<a?(o=e,d=a):(o=a,d=e),n<o||n>d)return g}else if(t<r?(o=t,d=r):(o=r,d=t),s<o||s>d)return g;i>0?g++:i<0&&g--}else{const f=(t+i)/2,m=(e+s)/2,p=(i+n)/2,y=(s+o)/2,x=(n+r)/2,w=(o+a)/2,b=(f+p)/2,v=(m+y)/2,P=(p+x)/2,S=(y+w)/2,M=(b+P)/2,C=(v+S)/2;g+=k.rm(t,e,f,m,b,v,M,C,h,l,u,c,d),g+=k.rm(M,C,P,S,x,w,r,a,h,l,u,c,d)}return g},Nl:(t,e,i,s,n,o,r)=>{if(k.X(t,i)){let i=0,n=0;e<s?(i=e,n=s):(i=s,n=e);const a=o;return a<i?(r.e(t,i),!1):a>n?(r.e(t,n),!1):(r.e(t,a),!0)}if(k.X(e,s)){let s=0,o=0;t<i?(s=t,o=i):(s=i,o=t);const a=n;return a<s?(r.e(s,e),!1):a>o?(r.e(o,e),!1):(r.e(a,e),!0)}{const a=((t-n)*(t-i)+(e-o)*(e-s))/((i-t)**2+(s-e)**2);if(a<-5e-6)return r.e(t,e),!1;if(a>1.000005)return r.e(i,s),!1;{const n=t+a*(i-t),o=e+a*(s-e);return r.e(n,o),!0}}},Do:(t,e,i,s,n,o,r,a,h)=>{if(k.c(t,i)&&k.c(e,s))return h.e(t,e),!1;if(k.X(n,r)){if(k.X(t,i))return k.Nl(t,e,i,s,n,o,h),!1;{const o=(s-e)/(i-t)*(n-t)+e;return k.Nl(t,e,i,s,n,o,h)}}{const l=(a-o)/(r-n);if(k.X(t,i)){const i=l*(t-n)+o;let r=0,a=0;return e<s?(r=e,a=s):(r=s,a=e),i<r?(h.e(t,r),!1):i>a?(h.e(t,a),!1):(h.e(t,i),!0)}{const r=(s-e)/(i-t);if(k.X(l,r))return k.Nl(t,e,i,s,n,o,h),!1;{const a=(r*t-l*n+o-e)/(r-l);if(k.X(r,0)){let s=0,n=0;return t<i?(s=t,n=i):(s=i,n=t),a<s?(h.e(s,e),!1):a>n?(h.e(n,e),!1):(h.e(a,e),!0)}{const n=r*(a-t)+e;return k.Nl(t,e,i,s,a,n,h)}}}}},Cl:(t,e,i,s,n,o,r,a,h)=>{let l=1e21,u=t,c=e;if(k.Do(t,e,t,s,n,o,r,a,h)){const t=(h.x-n)**2+(h.y-o)**2;t<l&&(l=t,u=h.x,c=h.y)}if(k.Do(i,e,i,s,n,o,r,a,h)){const t=(h.x-n)**2+(h.y-o)**2;t<l&&(l=t,u=h.x,c=h.y)}if(k.Do(t,e,i,e,n,o,r,a,h)){const t=(h.x-n)**2+(h.y-o)**2;t<l&&(l=t,u=h.x,c=h.y)}if(k.Do(t,s,i,s,n,o,r,a,h)){const t=(h.x-n)**2+(h.y-o)**2;t<l&&(l=t,u=h.x,c=h.y)}return h.e(u,c),l<1e21},lx:(t,e,i)=>k.zL(t.x,t.y,t.width,t.height,e.x,e.y,i.x,i.y),zL:(t,e,i,s,n,o,r,a)=>{const h=t,l=t+i,u=e,c=e+s;if(n===r){let t=0,e=0;return o<a?(t=o,e=a):(t=a,e=o),h<=n&&n<=l&&t<=c&&e>=u}if(o===a){let t=0,e=0;return n<r?(t=n,e=r):(t=r,e=n),u<=o&&o<=c&&t<=l&&e>=h}return!!(w.contains(t,e,i,s,n,o)||w.contains(t,e,i,s,r,a)||k.ku(h,u,l,u,n,o,r,a)||k.ku(l,u,l,c,n,o,r,a)||k.ku(l,c,h,c,n,o,r,a)||k.ku(h,c,h,u,n,o,r,a))},ku:(t,e,i,s,n,o,r,a)=>t===i&&e===s&&n===r&&o===a?t===n&&e===o:k.bu(t,e,i,s,n,o)*k.bu(t,e,i,s,r,a)<=0&&k.bu(n,o,r,a,t,e)*k.bu(n,o,r,a,i,s)<=0,bu:(t,e,i,s,n,o)=>{const r=i-t,a=s-e;let h=n-t,l=o-e,u=h*a-l*r;return 0===u&&(u=h*r+l*a,u>0&&(h-=r,l-=a,u=h*r+l*a,u<0&&(u=0))),u},_w(t,e,i,s){void 0===s&&(s=!1);let n=0;const o=null===t?e:(e-t.x)/(t.width>0?t.width:1),r=null===t?i:(i-t.y)/(t.height>0?t.height:1);return o>r?o>1-r||(n=s||o<1-r?270:315):s||o<r?n=o>1-r?90:s||o<1-r?180:135:o<.5?n=225:o>.5&&(n=45),n},Ee:t=>(t>=360?t-=360:t<0&&(t+=360),t),jF:(t,e)=>t>e?Math.min(t-e,Math.abs(t-360-e)):e>t?Math.min(e-t,Math.abs(t-(e-360))):0,qL:(t,e,i,s,n,o)=>{const r=Math.PI;o||(s*=r/180,n*=r/180);const a=s>n?-1:1,h=1e-5,l=2*r,u=[],c=r/2;let d=s,g=Math.min(l,Math.abs(n-s));if(g<h){const s=d+a*Math.min(g,c),n=t+i*Math.cos(d),o=e+i*Math.sin(d),r=t+i*Math.cos(s),h=e+i*Math.sin(s),l=(n+r)/2,f=(o+h)/2;return u.push([n,o,l,f,l,f,r,h]),u}for(;g>h;){const s=d+a*Math.min(g,c);u.push(k.WF(i,d,s,t,e)),g-=Math.abs(s-d),d=s}return u},WF:(t,e,i,s,n)=>{const o=(i-e)/2,r=t*Math.cos(o),a=t*Math.sin(o),h=r,l=-a,u=h*h+l*l,c=u+h*r+l*a,d=4/3*(Math.sqrt(2*u*c)-c)/(h*a-l*r),g=h-d*l,f=l+d*h,m=g,p=-f,y=o+e,x=Math.cos(y),w=Math.sin(y);return[s+t*Math.cos(e),n+t*Math.sin(e),s+g*x-f*w,n+g*w+f*x,s+m*x-p*w,n+m*w+p*x,s+t*Math.cos(i),n+t*Math.sin(i)]},tm:(t,e,i,s,n,o,r)=>{const a=n,h=o,l=Math.floor((t-i)/a)*a+i,u=Math.floor((e-s)/h)*h+s;let c=l;l+a-t<a/2&&(c=l+a);let d=u;return u+h-e<h/2&&(d=u+h),r.e(c,d),r},jL:(t,e)=>{let i=Math.max(t,e),s=Math.min(t,e),n=1,o=1;do{n=i%s,o=s,i=s,s=n}while(n>0);return o},JF:(t,e,i,s)=>{const n=i<0,o=s<0;let r=0,a=0,h=0;t<e?(a=1,h=0):(a=0,h=1);let l=0,u=0,c=0,d=0;return r=a,l=0===r?t:e,c=0===r?i:s,(0===r?n:o)&&(c=-c),r=h,u=0===r?t:e,d=0===r?i:s,(0===r?n:o)&&(d=-d),k.$F(l,u,c,d,0,0)},$F:(t,e,i,s,n,o)=>{let r=0;if(s>0)if(i>0){const a=t*t,h=e*e,l=t*i,u=e*s;let c=-h+u,d=-h+Math.sqrt(l*l+u*u),g=c;const f=9999999999;for(let t=0;t<f&&(g=.5*(c+d),g!==c&&g!==d);++t){const t=l/(g+a),e=u/(g+h),i=t*t+e*e-1;if(i>0)c=g;else{if(!(i<0))break;d=g}}const m=(n=a*i/(g+a))-i,p=(o=h*s/(g+h))-s;r=Math.sqrt(m*m+p*p)}else n=0,o=e,r=Math.abs(s-e);else{const s=t*t-e*e,a=t*i;if(a<s){const h=a/s,l=h*h;n=t*h,o=e*Math.sqrt(Math.abs(1-l));const u=n-i;r=Math.sqrt(u*u+o*o)}else n=t,o=0,r=Math.abs(i-t)}return r},Wn:{},lm:new s,pr:new s,yr:0,am:100};k.za=k.HF;var S,M=((S=M||{})[S.Line=1]="Line",S[S.Rectangle=2]="Rectangle",S[S.Ellipse=3]="Ellipse",S[S.Path=4]="Path",S),C=(t=>(t[t.None=0]="None",t[t.Default=1]="Default",t[t.Fill=2]="Fill",t[t.Uniform=6]="Uniform",t))(C||{});class N{n;hm;cm;kc;Nu;Cu;Jn;$n;Zn;W;Li;Ai;ni;oi;Gs;Pc;Sc;constructor(t,e){u.Je(this),this.n=2,void 0===t&&(t=4),this.W=t,this.Li=0,this.Ai=0,this.ni=0,this.oi=0,this.Gs=4===t?new h:N.hx,this.hm=this.Gs.rt,this.cm=new w,this.kc=null,this.Nu=null,this.Cu=NaN,this.Jn=v.TopLeft,this.$n=v.BottomRight,this.Pc=NaN,this.Sc=NaN,this.Zn=2,e&&Object.assign(this,e)}copy(){const t=new N;if(t.n=-2&this.n,t.W=this.W,t.Li=this.Li,t.Ai=this.Ai,t.ni=this.ni,t.oi=this.oi,4===this.W){const e=this.Gs.r,i=t.Gs;for(let t=0;t<e.length;t++){const s=e[t];i.add(s.copy())}t.Gs=i}else t.Gs=this.Gs;return t.hm=this.hm,t.cm.h(this.cm),t.kc=this.kc,t.Nu=this.Nu,t.Cu=this.Cu,t.Jn=this.Jn.N(),t.$n=this.$n.N(),t.Pc=this.Pc,t.Sc=this.Sc,t.Zn=this.Zn,t}static Line=1;static Rectangle=2;static Ellipse=3;static Path=4;static hx=(new h).k();get u(){return!!(1&this.n)}set u(t){t?this.n|=1:this.n&=-2}get yt(){return!!(2&this.n)}set yt(t){t?this.n|=2:this.n&=-3}k(){if(this.u=!0,4!==this.type)return this;const t=this.figures;t.k();for(const e of t)e.k();return this}equalsApprox(t){if(!(t instanceof N))return!1;if(this.type!==t.type)return 1===this.type&&4===t.type?this.WL(t):1===t.type&&4===this.type&&t.WL(this);if(4===this.type){const e=this.figures.r,i=t.figures.r,s=e.length;if(s!==i.length)return!1;for(let t=0;t<s;t++){const s=e[t],n=i[t];if(!s.equalsApprox(n))return!1}return!0}return k.c(this.startX,t.startX)&&k.c(this.startY,t.startY)&&k.c(this.endX,t.endX)&&k.c(this.endY,t.endY)}WL(t){if(1!==this.type||4!==t.type)return!1;if(1===t.figures.count){const e=t.figures.elt(0);if(1===e.segments.count&&k.c(this.startX,e.startX)&&k.c(this.startY,e.startY)){const t=e.segments.elt(0);if(2===t.type&&k.c(this.endX,t.endX)&&k.c(this.endY,t.endY))return!0}}return!1}static stringify(t){return t.toString()}static stringifyFixed(t){return e.s(t,"number",N,"stringifyFixed:digits"),e=>e.toString(t)}fe(t){t in M?this.type=t:e.ur(this,t)}toString(t){void 0===t&&(t=-1);const e=e=>0===e?"0":e.toFixed(t);let i;switch(this.type){case 1:return t<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+e(this.startX)+" "+e(this.startY)+"L"+e(this.endX)+" "+e(this.endY);case 2:return i=new w(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),t<0?"M"+i.x.toString()+" "+i.y.toString()+"H"+i.right.toString()+"V"+i.bottom.toString()+"H"+i.left.toString()+"z":"M"+e(i.x)+" "+e(i.y)+"H"+e(i.right)+"V"+e(i.bottom)+"H"+e(i.left)+"z";case 3:if(i=new w(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),t<0){const t=i.left.toString()+" "+(i.y+i.height/2).toString(),e=i.right.toString()+" "+(i.y+i.height/2).toString();return"M"+t+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+e+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+t}{const t=e(i.left)+" "+e(i.y+i.height/2),s=e(i.right)+" "+e(i.y+i.height/2);return"M"+t+"A"+e(i.width/2)+" "+e(i.height/2)+" 0 0 1 "+s+"A"+e(i.width/2)+" "+e(i.height/2)+" 0 0 1 "+t}case 4:let s="";const n=this.figures.r,o=n.length;for(let e=0;e<o;e++){const i=n[e];e>0&&(s+=" x "),i.isFilled&&(s+="F "),s+=i.toString(t)}return s;default:return M[this.type]}}static fillPath(t){"string"!=typeof t&&e.si(t,"string",N,"fillPath:str");const i=t.split(/[Xx]/),s=i.length;let n="";for(let t=0;t<s;t++){const e=i[t];null===e.match(/[Ff]/)?n+=(0===t?"":"X ")+"F"+(" "===e[0]?"":" ")+e:n+=0===t?e:"X"+(" "===e[0]?"":" ")+e}return n}static fm="UuBbMmZzLlHhVvCcSsQqTtAaFfXx";static parse(t,i){void 0===i&&(i=!1),"string"!=typeof t&&e.si(t,"string",N,"parse:str");const s=new RegExp("(["+N.fm+"])(["+N.fm+"])","gm"),n=new RegExp("(["+N.fm+"])([^s])","gm"),o=new RegExp("([^s])(["+N.fm+"])","gm"),r=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/,/gm," ")).replace(s,"$1 $2")).replace(s,"$1 $2")).replace(n,"$1 $2")).replace(o,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2")).replace(/[\s\r\t\n]+/gm," ")).replace(/^\s+|\s+$/g,"")).split(" ");for(let t=0;t<r.length;t++){const i=r[t];if(null!==i.match(/(\.[0-9]*)(\.)/gm)){const s=e.nt();let n="",o=!1;for(let t=0;t<i.length;t++){const e=i[t];"."!==e||o?"."===e?(s.push(n),n="."):n+=e:(o=!0,n+=e)}s.push(n),r.splice(t,1);for(let e=0;e<s.length;e++)r.splice(t+e,0,s[e]);t+=s.length-1,e.Z(s)}}let a=-1,h="",l="";const u=new y(0,0),c=new y(0,0),d=new y(0,0);let g=!0;function f(){return a>=v-1||null!==r[a+1].match(T)||(g=!1,!1)}function m(){return a++,r[a]}function p(t){let e=parseFloat(m()),i=parseFloat(m());h===h.toLowerCase()&&(e=d.x+e,i=d.y+i),t.e(e,i)}function x(){return p(d),d}function w(){return p(c),c}function b(){const t=l.toLowerCase();return"c"===t||"s"===t||"q"===t||"t"===t?new y(2*d.x-c.x,2*d.y-c.y):new y(d.x,d.y)}const v=r.length,P=le.JL(null);let k=!1,S=!1,M=!1,C=!0;const T=new RegExp("["+N.fm+"]");for(;!(a>=v-1);){if(l=h,h=m(),""===h)continue;g=!0;let i=!1;switch(h.toUpperCase()){case"X":C=!0,k=!1,S=!1;break;case"M":const t=x();for(null===P.Ne||!0===C?(P.Lu(t.x,t.y,k,!1,!S,M),C=!1):P.ZF(t.x,t.y),u.h(d);!f();){const t=x();P.Ys(t.x,t.y)}break;case"L":for(;!f();){const t=x();P.Ys(t.x,t.y)}g&&(i=!0);break;case"H":for(;!f();)d.e((h===h.toLowerCase()?d.x:0)+parseFloat(m()),d.y),P.Ys(d.x,d.y);break;case"V":for(;!f();)d.e(d.x,(h===h.toLowerCase()?d.y:0)+parseFloat(m())),P.Ys(d.x,d.y);g&&(i=!0);break;case"C":for(;!f();){const t=new y;p(t);const e=w(),i=x();P.wr(t.x,t.y,e.x,e.y,i.x,i.y)}g&&(i=!0);break;case"S":for(;!f();){const t=b(),e=w(),i=x();P.wr(t.x,t.y,e.x,e.y,i.x,i.y)}g&&(i=!0);break;case"Q":for(;!f();){const t=w(),e=x();P.Au(t.x,t.y,e.x,e.y)}g&&(i=!0);break;case"T":for(;!f();){const t=b();c.h(t);const e=x();P.Au(t.x,t.y,e.x,e.y),c.h(e)}g&&(i=!0);break;case"B":for(;!f();){const t=parseFloat(m()),e=parseFloat(m());let i=parseFloat(m()),s=parseFloat(m());const n=parseFloat(m());let o=n,r=!1;f()||(o=parseFloat(m()),f()||(r=0!==parseFloat(m()))),h===h.toLowerCase()&&(i+=d.x,s+=d.y),P.QF(t,e,i,s,n,o,r)}g&&(i=!0);break;case"A":for(;!f();){const t=Math.abs(parseFloat(m())),e=Math.abs(parseFloat(m())),i=parseFloat(m());let s=!1,n=!1,o=0,r=0;const a=m();1===a.length?(s=!!parseFloat(a),n=!!parseFloat(m()),o=parseFloat(m()),r=parseFloat(m())):2===a.length?(s=!!parseFloat(a[0]),n=!!parseFloat(a[1]),o=parseFloat(m()),r=parseFloat(m())):(s=!!parseFloat(a[0]),n=!!parseFloat(a[1]),o=parseFloat(a.slice(2)),r=parseFloat(m())),h===h.toLowerCase()&&(o=d.x+o,r=d.y+r),d.e(o,r),P._F(t,e,i,s,n,o,r)}g&&(i=!0);break;case"Z":P.tR(),d.h(u);break;case"F":{let t="",e=1;for(;r[a+e];)if("0"!==r[a+e])if(null===r[a+e].match(/[Uu]/)){if(null!==r[a+e].match(T)){t=r[a+e];break}e++}else e++;else M=!0,e++;t.match(/[Mm]/)?k=!0:P.eR();break}case"U":{let t="",e=1;for(;r[a+e];)if(null===r[a+e].match(/[Ff]/)){if(null!==r[a+e].match(T)){t=r[a+e];break}e++}else e++;t.match(/[Mm]/)?S=!0:P.iR(!1);break}default:if("0"===h||"1"===h)break;e.ne("Unknown geometry command: "+h)}if(i){e.ne(`Bad geometry command: ${h}, next token: ${m()},\nstring: ${t}`);break}}const L=P.um;if(le.$L(P),i){const t=L.figures.iterator;for(;t.next();){t.value.isFilled=!0}}return L}static ZL(t,e){const i=t.length,s=y.l();for(let n=0;n<i;n++){const i=t[n];s.x=i[0],s.y=i[1],e.gt(s),i[0]=s.x,i[1]=s.y,s.x=i[2],s.y=i[3],e.gt(s),i[2]=s.x,i[3]=s.y,s.x=i[4],s.y=i[5],e.gt(s),i[4]=s.x,i[5]=s.y,s.x=i[6],s.y=i[7],e.gt(s),i[6]=s.x,i[7]=s.y}y.i(s)}UP(){if(this.yt)return!0;if(4===this.type){const t=this.figures;if(this.hm!==t.rt)return!0;const e=this.figures.r,i=e.length;for(let t=0;t<i;t++)if(e[t].UP())return!0}return!1}cx(){if(this.yt=!1,this.kc=null,this.Nu=null,this.Cu=NaN,4===this.type){const t=this.figures;this.hm=t.rt;const e=this.figures.r,i=e.length;for(let t=0;t<i;t++)e[t].sR()}const t=this.cm;isNaN(this.Pc)||isNaN(this.Sc)?t.e(0,0,0,0):t.e(0,0,this.Pc,this.Sc),this.QL(t,!1),t.re(0,0,0,0)}computeBoundsWithoutOrigin(){const t=new w;return this.QL(t,!0),t}QL(t,i){switch(this.type){case 1:case 2:case 3:i?t.e(this.Li,this.Ai,0,0):t.re(this.Li,this.Ai,0,0),t.re(this.ni,this.oi,0,0);break;case 4:const s=this.figures,n=s.r,o=s.length;for(let s=0;s<o;s++){const o=n[s];i&&0===s?t.e(o.startX,o.startY,0,0):t.re(o.startX,o.startY,0,0);const r=o.segments.r,a=r.length;let h=o.startX,l=o.startY;for(let i=0;i<a;i++){const s=r[i];switch(s.type){case 2:case 1:h=s.endX,l=s.endY,t.re(h,l,0,0);break;case 3:k.Mu(h,l,s.point1X,s.point1Y,s.point2X,s.point2Y,s.endX,s.endY,.5,t),h=s.endX,l=s.endY;break;case 4:k.EP(h,l,s.point1X,s.point1Y,s.endX,s.endY,.5,t),h=s.endX,l=s.endY;break;case 5:case 6:const i=5===s.type?s.vo(o):s.Za(o,h,l),n=i.length;if(0===n){h=5===s.type?s.centerX:s.endX,l=5===s.type?s.centerY:s.endY,t.re(h,l,0,0);break}let r=null;for(let e=0;e<n;e++)r=i[e],k.Mu(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],.5,t);null!==r&&(h=r[6],l=r[7]);break;default:e.o("Unknown Segment type: "+s.type)}}}break;default:e.o("Unknown Geometry type: "+this.type)}}nR(t,e){const i=this.bounds;let s=t/i.width,n=e/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),1===s&&1===n?this:this.copy().scale(s,n)}normalize(){this.u&&e.L(this);const t=this.computeBoundsWithoutOrigin();return this.offset(-t.x,-t.y),new y(-t.x,-t.y)}offset(t,i){return this.u&&e.L(this),this.v(1,0,0,1,t,i),this}scale(t,i){return this.u&&e.L(this),this.v(t,0,0,i,0,0),this}rotate(t,i,s){this.u&&e.L(this),void 0===i&&(i=0),void 0===s&&(s=0);const n=P.l();return n.Ue(),n.ks(t,i,s),this.v(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),P.i(n),this}v(t,i,s,n,o,r){let a=0,h=0;switch(this.type){case 1:case 2:case 3:a=this.Li,h=this.Ai,this.Li=a*t+h*s+o,this.Ai=a*i+h*n+r,a=this.ni,h=this.oi,this.ni=a*t+h*s+o,this.oi=a*i+h*n+r;break;case 4:const l=this.figures.r,u=l.length;for(let c=0;c<u;c++){const u=l[c];a=u.startX,h=u.startY,u.startX=a*t+h*s+o,u.startY=a*i+h*n+r;const d=u.segments.r,g=d.length;for(let l=0;l<g;l++){const u=d[l];switch(u.type){case 2:case 1:a=u.endX,h=u.endY,u.endX=a*t+h*s+o,u.endY=a*i+h*n+r;break;case 3:a=u.point1X,h=u.point1Y,u.point1X=a*t+h*s+o,u.point1Y=a*i+h*n+r,a=u.point2X,h=u.point2Y,u.point2X=a*t+h*s+o,u.point2Y=a*i+h*n+r,a=u.endX,h=u.endY,u.endX=a*t+h*s+o,u.endY=a*i+h*n+r;break;case 4:a=u.point1X,h=u.point1Y,u.point1X=a*t+h*s+o,u.point1Y=a*i+h*n+r,a=u.endX,h=u.endY,u.endX=a*t+h*s+o,u.endY=a*i+h*n+r;break;case 5:if(a=u.centerX,h=u.centerY,u.centerX=a*t+h*s+o,u.centerY=a*i+h*n+r,0!==i){let e=180*Math.atan2(i,t)/Math.PI;e<0&&(e+=360),u.startAngle+=e}t<0&&(u.startAngle=180-u.startAngle,u.sweepAngle=-u.sweepAngle),n<0&&(u.startAngle=-u.startAngle,u.sweepAngle=-u.sweepAngle),u.radiusX*=Math.sqrt(t*t+s*s),void 0!==u.radiusY&&(u.radiusY*=Math.sqrt(i*i+n*n));break;case 6:if(a=u.endX,h=u.endY,u.endX=a*t+h*s+o,u.endY=a*i+h*n+r,0===u.radiusX||0===u.radiusY)break;if(0!==i){let e=180*Math.atan2(i,t)/Math.PI;e<0&&(e+=360),u.xAxisRotation+=e}t<0&&(u.xAxisRotation=180-u.xAxisRotation,u.isClockwiseArc=!u.isClockwiseArc),n<0&&(u.xAxisRotation=-u.xAxisRotation,u.isClockwiseArc=!u.isClockwiseArc),u.radiusX*=Math.sqrt(t*t+s*s),u.radiusY*=Math.sqrt(i*i+n*n);break;default:e.o("Unknown Segment type: "+u.type)}}}}return this.yt=!0,this}containsPoint(t,e){void 0===e&&(e=0);const i=this.Li,s=this.Ai,n=this.ni,o=this.oi;switch(this.type){case 1:return k.Ve(i,s,n,o,e,t.x,t.y);case 2:{const r=Math.min(i,n)-e,a=Math.min(s,o)-e,h=Math.abs(n-i)+2*e,l=Math.abs(o-s)+2*e,u=w.z(r,a,h,l),c=u.containsPoint(t);return w.i(u),c}case 3:{let r=Math.min(i,n)-e,a=Math.min(s,o)-e;const h=(Math.abs(n-i)+2*e)/2,l=(Math.abs(o-s)+2*e)/2;return!(h<=0||l<=0)&&(r=t.x-(r+h),a=t.y-(a+l),r*r/(h*h)+a*a/(l*l)<=1)}case 4:return this.VP(t,e,!0,!1);default:return!1}}VP(t,i,s,n){const o=t.x,r=t.y,a=this.bounds.x-20,h=r;let l=0,u=0,c=0,d=0,g=0,f=0;const m=this.figures.r,p=m.length;for(let t=0;t<p;t++){const p=m[t],y=!p.isEvenOdd;if(!p.isFilled){if(p.BP(o,r,n?i:i+2))return!0;continue}if(s&&p.BP(o,r,i))return!0;const x=p.segments;u=p.startX,c=p.startY;let w=u,b=c;const v=x.r;let P=v[0];for(let t=0;t<=x.length;t++){let i;switch(t!==x.length?(P=v[t],i=P.type,g=P.endX,f=P.endY):(i=2,g=w,f=b),i){case 1:{const t=this.fx(o,r,a,h,u,c,w,b);if(isNaN(t))return!0;l+=t,w=g,b=f;break}case 2:{const t=this.fx(o,r,a,h,u,c,g,f);if(isNaN(t))return!0;l+=t;break}case 3:d=k.rm(u,c,P.point1X,P.point1Y,P.point2X,P.point2Y,g,f,a,h,o,r,.5),l+=d;break;case 4:{const t=(u+2*P.point1X)/3,e=(c+2*P.point1Y)/3,i=(2*P.point1X+g)/3,s=(2*P.point1Y+f)/3;d=k.rm(u,c,t,e,i,s,g,f,a,h,o,r,.5),l+=d;break}case 5:case 6:{const t=5===P.type?P.vo(p):P.Za(p,u,c),e=t.length;if(0===e){const t=this.fx(o,r,a,h,u,c,5===P.type?P.centerX:P.endX,5===P.type?P.centerY:P.endY);if(isNaN(t))return!0;l+=t;break}let i=null;for(let s=0;s<e;s++){if(i=t[s],0===s){const t=this.fx(o,r,a,h,u,c,i[0],i[1]);if(isNaN(t))return!0;l+=t}d=k.rm(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],a,h,o,r,.5),l+=d}null!==i&&(g=i[6],f=i[7]);break}default:e.o("Unknown Segment type: "+P.type)}u=g,c=f}if(y){if(0!==l)return!0}else if(l%2!=0)return!0;l=0}return!1}fx(t,e,i,s,n,o,r,a){if(k.Ve(n,o,r,a,.05,t,e))return NaN;const h=(t-i)*(o-a);if(0===h)return 0;const l=((t*s-e*i)*(n-r)-(t-i)*(n*a-o*r))/h,u=(t*s-e*i)*(o-a)/h;if(l>=t)return 0;if((n>r?n-r:r-n)<(o>a?o-a:a-o)){if(o<a){if(u<o||u>a)return 0}else if(u<a||u>o)return 0}else if(n<r){if(l<n||l>r)return 0}else if(l<r||l>n)return 0;return h>0?1:-1}_L(t,e,i){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].BP(t,e,i))return!0;return!1}getPointAlongPath(t,e){if(t<0?t=0:t>1&&(t=1),void 0===e&&(e=new y),1===this.type)return e.e(this.startX+t*(this.endX-this.startX),this.startY+t*(this.endY-this.startY)),e;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*t;let a=0;for(let t=0;t<o;t++){const n=s[t],o=n.length;for(let s=0;s<o;s++){const o=n[s];if(a+o>=r){const n=0===o?0:(r-a)/o,h=i[t],l=h[2*s],u=h[2*s+1],c=h[2*s+2],d=h[2*s+3];return e.e(l+(c-l)*n,u+(d-u)*n),e}a+=o}}return e}getAngleAlongPath(t){if(t<0?t=0:t>1&&(t=1),1===this.type)return 180*Math.atan2(this.endY-this.startY,this.endX-this.startX)/Math.PI;const e=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=e.length,o=s*t;let r=0;for(let t=0;t<n;t++){const s=i[t],n=s.length;for(let i=0;i<n;i++){const n=s[i];if(r+n>=o){const s=e[t],n=s[2*i],o=s[2*i+1],r=s[2*i+2],a=s[2*i+3];return Math.abs(r-n)<1&&Math.abs(a-o)<1?0:Math.abs(r-n)<1?a-o>=0?90:270:Math.abs(a-o)<1?r-n>=0?0:180:180*Math.atan2(a-o,r-n)/Math.PI}r+=n}}return NaN}getPointAndAngleAlongPath(t,e){if(t<0?t=0:t>1&&(t=1),void 0===e&&(e=[]),e.length=3,1===this.type)return e[0]=this.startX+t*(this.endX-this.startX),e[1]=this.startY+t*(this.endY-this.startY),e[2]=180*Math.atan2(this.endY-this.startY,this.endX-this.startX)/Math.PI,e;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*t;let a=0;for(let t=0;t<o;t++){const n=s[t],o=n.length;for(let s=0;s<o;s++){const o=n[s];if(a+o>=r){const n=0===o?0:(r-a)/o,h=i[t],l=h[2*s],u=h[2*s+1],c=h[2*s+2],d=h[2*s+3];let g;return e[0]=l+(c-l)*n,e[1]=u+(d-u)*n,g=Math.abs(c-l)<1&&Math.abs(d-u)<1?0:Math.abs(c-l)<1?d-u>=0?90:270:Math.abs(d-u)<1?c-l>=0?0:180:180*Math.atan2(d-u,c-l)/Math.PI,e[2]=g,e}a+=o}}return e}getFractionForPoint(t){if(1===this.type){const e=this.startX,i=this.startY,s=this.endX,n=this.endY;if(e===s&&i===n)return 0;{const o=t.x,r=t.y;let a=0,h=0;if(e===s)return i<n?(a=i,h=n):(a=n,h=i),r<=a?a===i?0:1:r>=h?h===i?0:1:Math.abs(r-i)/(h-a);if(i===n)return e<s?(a=e,h=s):(a=s,h=e),o<=a?a===e?0:1:o>=h?h===e?0:1:Math.abs(o-e)/(h-a);{const t=(s-e)**2+(n-i)**2,a=y.l();k.Nl(e,i,s,n,o,r,a);const h=a.x,l=a.y;return y.i(a),Math.sqrt(((h-e)**2+(l-i)**2)/t)}}}if(2!==this.type){const e=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=y.l();let o=1/0,r=0,a=0;const h=e.length;let l=0,u=0;for(let s=0;s<h;s++){const h=e[s],c=i[s],d=h.length;for(let e=0;e<d;e+=2){const i=h[e],s=h[e+1];if(0===e){l=i,u=s;continue}k.Nl(l,u,i,s,t.x,t.y,n);const d=(n.x-t.x)**2+(n.y-t.y)**2;d<o&&(o=d,r=a,r+=Math.sqrt((n.x-l)**2+(n.y-u)**2)),a+=c[(e-2)/2],l=i,u=s}}y.i(n);const c=r/s;return c<0?0:c>1?1:c}{const e=this.startX,i=this.startY,s=this.endX,n=this.endY;if(e===s&&i===n)return 0;{const o=s-e,r=n-i,a=2*o+2*r;let h=t.x,l=t.y;h=Math.min(Math.max(h,e),s),l=Math.min(Math.max(l,i),n);const u=Math.abs(h-e),c=Math.abs(h-s),d=Math.abs(l-i),g=Math.abs(l-n),f=Math.min(u,c,d,g);if(f===d)return h/a;if(f===c)return(o+l)/a;if(f===g)return(2*o+r-h)/a;if(f===u)return(2*o+2*r-l)/a}}return 0}get flattenedSegments(){return this.tA(),this.kc}tA(){if(null===this.kc){const t=this.kc=[],e=this.Nu=[];this.oR(t,e)}}get flattenedLengths(){return this.tA(),this.Nu}get flattenedTotalLength(){let t=this.Cu;if(isNaN(t)){if(1===this.type){const e=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);t=Math.sqrt(e*e+i*i)}else if(2===this.type){t=2*Math.abs(this.endX-this.startX)+2*Math.abs(this.endY-this.startY)}else{const e=this.flattenedLengths,i=e.length;t=0;for(let s=0;s<i;s++){const i=e[s],n=i.length;for(let e=0;e<n;e++)t+=i[e]}}this.Cu=t}return t}zP(t){const e=[];let i=0,s=0;const n=t.length;for(let o=0;o<n;o+=2){const n=t[o],r=t[o+1];if(0===o){i=n,s=r;continue}const a=Math.sqrt(y.distanceSquared(i,s,n,r));e.push(a),i=n,s=r}return e}oR(t,i){let s=[];const n=[];if(1===this.type)s.push(this.startX),s.push(this.startY),s.push(this.endX),s.push(this.endY),t.push(s),n.push(Math.sqrt((this.startX-this.endX)**2+(this.startY-this.endY)**2)),i.push(n);else if(2===this.type)s.push(this.startX),s.push(this.startY),s.push(this.endX),s.push(this.startY),s.push(this.endX),s.push(this.endY),s.push(this.startX),s.push(this.endY),s.push(this.startX),s.push(this.startY),t.push(s),n.push(Math.abs(this.startX-this.endX)),n.push(Math.abs(this.startY-this.endY)),n.push(Math.abs(this.startX-this.endX)),n.push(Math.abs(this.startY-this.endY)),i.push(n);else if(3===this.type){const e=new T;e.startX=this.endX,e.startY=(this.startY+this.endY)/2;const n=new A(5);n.startAngle=0,n.sweepAngle=360,n.centerX=(this.startX+this.endX)/2,n.centerY=(this.startY+this.endY)/2,n.radiusX=Math.abs(this.startX-this.endX)/2,n.radiusY=Math.abs(this.startY-this.endY)/2,e.add(n);const o=n.vo(e),r=o.length;if(0===r)s.push(n.centerX),s.push(n.centerY);else{let t=e.startX,i=e.startY;for(let e=0;e<r;e++){const n=o[e];k.jn(t,i,n[2],n[3],n[4],n[5],n[6],n[7],.5,s),t=n[6],i=n[7]}}t.push(s),i.push(this.zP(s))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;s=[],s.push(o.startX),s.push(o.startY);let r=o.startX,a=o.startY,h=r,l=a;const u=o.segments.r,c=u.length;for(let n=0;n<c;n++){const c=u[n];switch(c.type){case 1:s.length>=4&&(t.push(s),i.push(this.zP(s))),s=[],s.push(c.endX),s.push(c.endY),r=c.endX,a=c.endY,h=r,l=a;break;case 2:s.push(c.endX),s.push(c.endY),r=c.endX,a=c.endY;break;case 3:k.jn(r,a,c.point1X,c.point1Y,c.point2X,c.point2Y,c.endX,c.endY,.5,s),r=c.endX,a=c.endY;break;case 4:k.nm(r,a,c.point1X,c.point1Y,c.endX,c.endY,.5,s),r=c.endX,a=c.endY;break;case 5:{const t=c.vo(o),e=t.length;if(0===e){s.push(c.centerX),s.push(c.centerY),r=c.centerX,a=c.centerY;break}for(let i=0;i<e;i++){const e=t[i];k.jn(r,a,e[2],e[3],e[4],e[5],e[6],e[7],.5,s),r=e[6],a=e[7]}break}case 6:{const t=c.Za(o,r,a),e=t.length,i=c.endX,n=c.endY;if(0===e){s.push(i),s.push(n),r=i,a=n;break}for(let i=0;i<e;i++){const e=t[i];k.jn(r,a,e[2],e[3],e[4],e[5],e[6],e[7],.5,s),r=e[6],a=e[7]}break}default:e.o("Segment not of valid type: "+c.type)}c.isClosed&&(s.push(h),s.push(l))}s.length>=4&&(t.push(s),i.push(this.zP(s)))}}}get type(){return this.W}set type(t){this.W!==t&&(this.u&&e.L(this,t),this.W=t,4===t?this.Gs=new h:(null===N.hx&&(N.hx=(new h).k()),this.Gs=N.hx),this.yt=!0)}get startX(){return this.Li}set startX(t){this.Li!==t&&(this.u&&e.L(this,t),this.Li=t,this.yt=!0)}get startY(){return this.Ai}set startY(t){this.Ai!==t&&(this.u&&e.L(this,t),this.Ai=t,this.yt=!0)}get endX(){return this.ni}set endX(t){this.ni!==t&&(this.u&&e.L(this,t),this.ni=t,this.yt=!0)}get endY(){return this.oi}set endY(t){this.oi!==t&&(this.u&&e.L(this,t),this.oi=t,this.yt=!0)}get figures(){return this.Gs}set figures(t){this.Gs!==t&&(this.u&&e.L(this,t),this.Gs=t,this.yt=!0)}add(t){return this.Gs.add(t),this}setSpots(t,i,s,n,o,r,a,h){return this.u&&e.L(this),this.Jn=new v(t,i,o,r),this.$n=new v(s,n,a,h),this}get spot1(){return this.Jn}set spot1(t){this.u&&e.L(this,t),this.Jn=t.N()}get spot2(){return this.$n}set spot2(t){this.u&&e.L(this,t),this.$n=t.N()}get defaultStretch(){return this.Zn}set defaultStretch(t){this.Zn=t}get bounds(){return this.UP()&&this.cx(),this.cm}polygonClosestSegment(t,e){if(void 0===e&&(e=10),4!==this.type)return null;const i=t.x,s=t.y;let n=1/0,o=0,r=0,a=0,h=0,l=0,u=0,c=0,d=0;return this.figures.each((t=>{let e=t.startX,g=t.startY;t.segments.each((f=>{let m=f.endX,p=f.endY,x=0;if(2!==f.type)return e=f.endX,void(g=f.endY);x=y.distanceLineSegmentSquared(i,s,e,g,m,p),x<n&&(n=x,o=a,r=h,l=e,u=g,c=m,d=p),e=m,g=p,h++,f.isClosed&&(m=t.startX,p=t.startY,x=y.distanceLineSegmentSquared(i,s,e,g,m,p),x<n&&(n=x,o=a,r=h,l=e,u=g,c=m,d=p),h++)})),a++,h=0})),n<e*e?{figi:o,segi:r,ax:l,ay:u,bx:c,by:d}:null}get polygonArea(){if(4===this.type){const t=this.figures.iterator;let e=0,i=0,s=0,n=0,o=0;for(;t.next();){const r=t.value;if(!r.isFilled)continue;e=r.startX,i=r.startY;const a=r.segments.iterator;for(;a.next();){const t=a.value;s=t.endX,n=t.endY,1===t.type||5!==t.type&&(o+=e*n-i*s),e=s,i=n}o+=e*r.startY-i*r.startX}return Math.abs(o)/2}if(2===this.type){return Math.abs(this.startX-this.endX)*Math.abs(this.startY-this.endY)}if(3===this.type){const t=Math.abs(this.startX-this.endX),e=Math.abs(this.startY-this.endY);return Math.PI*t/2*e/2}return 0}get polygonLength(){if(4===this.type){const t=this.figures.iterator;let e=0,i=0,s=0,n=0,o=0;for(;t.next();){const r=t.value;e=r.startX,i=r.startY;const a=r.segments.iterator;for(;a.next();){const t=a.value;s=t.endX,n=t.endY,1===t.type||5!==t.type&&(o+=Math.sqrt((s-e)*(s-e)+(n-i)*(n-i))),e=s,i=n}const h=r.segments.last();h&&h.isClosed&&(s=r.startX,n=r.startY,o+=Math.sqrt((s-e)*(s-e)+(n-i)*(n-i)))}return o}if(2===this.type){return 2*Math.abs(this.startX-this.endX)+2*Math.abs(this.startY-this.endY)}if(3===this.type){const t=Math.abs(this.startX-this.endX)/2,e=Math.abs(this.startY-this.endY)/2;if(t+e===0)return 0;const i=(t-e)*(t-e)/((t+e)*(t+e));let s=i,n=1+s/4;return s*=i,n+=s/64,s*=i,n+=s/256,s*=i,n+=25*s/16384,s*=i,n+=49*s/65536,s*=i,n+=441*s/1048576,Math.PI*(t+e)*n}{const t=this.startX,e=this.startY,i=this.endX,s=this.endY;return Math.sqrt((i-t)*(i-t)+(s-e)*(s-e))}}static computeConvexHull(t){t.sort(((t,e)=>t.x===e.x?e.y-t.y:e.x-t.x));const e=[];for(let i=0;i<t.length;i++){for(;e.length>=2&&t[i].compareWithLineSegmentPoint(e[e.length-2],e[e.length-1])>=0;)e.pop();e.push(t[i])}e.pop();const i=[];for(let e=t.length-1;e>=0;e--){for(;i.length>=2&&t[e].compareWithLineSegmentPoint(i[i.length-2],i[i.length-1])>=0;)i.pop();i.push(t[e])}return i.pop(),e.concat(i)}static generatePolygon(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0);const s=new N;if(t.length>1)if(e>0)if(i){t.push(t[0]),t.push(t[1]);let n=!0;const o=new T(0,0,i,!1);for(let i=1;i<t.length;i++){const s=(t[i-1].x+t[i].x)/2,r=(t[i-1].y+t[i].y)/2,a=t[i-1].distanceSquaredPoint(t[i]),h=.5*e/Math.sqrt(a);if(h<.5){const e=t[i-1].x+(t[i].x-t[i-1].x)*h,s=t[i-1].y+(t[i].y-t[i-1].y)*h;if(n?(n=!1,o.startX=e,o.startY=s):o.add(new A(3,e,s,t[i-1].x,t[i-1].y,t[i-1].x,t[i-1].y)),i<t.length-1){const e=t[i].x+(t[i-1].x-t[i].x)*h,s=t[i].y+(t[i-1].y-t[i].y)*h;o.add(new A(2,e,s))}}else n?(n=!1,o.startX=s,o.startY=r):o.add(new A(3,s,r,t[i-1].x,t[i-1].y,t[i-1].x,t[i-1].y))}const r=o.segments.last();r&&r.close(),s.add(o)}else{const i=new T(t[0].x,t[0].y,!1,!1);for(let s=1;s<t.length;s++){const n=(t[s-1].x+t[s].x)/2,o=(t[s-1].y+t[s].y)/2,r=t[s-1].distanceSquaredPoint(t[s]),a=.5*e/Math.sqrt(r);if(a<.5){if(s>1){const e=t[s-1].x+(t[s].x-t[s-1].x)*a,n=t[s-1].y+(t[s].y-t[s-1].y)*a;i.add(new A(3,e,n,t[s-1].x,t[s-1].y,t[s-1].x,t[s-1].y))}const e=t[s].x+(t[s-1].x-t[s].x)*a,n=t[s].y+(t[s-1].y-t[s].y)*a;i.add(new A(2,e,n))}else s>1&&i.add(new A(3,n,o,t[s-1].x,t[s-1].y,t[s-1].x,t[s-1].y));s===t.length-1&&i.add(new A(2,t[s].x,t[s].y))}s.add(i)}else{const e=new T(t[0].x,t[0].y,i,!1);for(let i=1;i<t.length;i++)e.add(new A(2,t[i].x,t[i].y));if(i){const t=e.segments.last();t&&t.close()}s.add(e)}return s}}N.stringify=N.stringify,N.stringifyFixed=N.stringifyFixed,N.fillPath=N.fillPath,N.parse=N.parse;class T{n;Li;Ai;Mc;dm;Hi;constructor(t,e,i,s,n){void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===n&&(n=!1),this.n=2|(i?4:0)|(s?8:0)|(n?16:0),this.Li=void 0!==t?t:0,this.Ai=void 0!==e?e:0,this.Mc=new h,this.dm=this.Mc.rt,this.Hi=null}copy(){const t=new T;t.n=-2&this.n,t.Li=this.Li,t.Ai=this.Ai;const e=this.Mc.r,i=e.length,s=t.Mc;for(let t=0;t<i;t++){const i=e[t].copy();s.add(i)}return t.dm=this.dm,t.Hi=this.Hi,t}equalsApprox(t){if(!(t instanceof T&&k.c(this.startX,t.startX)&&k.c(this.startY,t.startY)))return!1;const e=this.segments.r,i=t.segments.r,s=e.length;if(s!==i.length)return!1;for(let t=0;t<s;t++){const s=e[t],n=i[t];if(!s.equalsApprox(n))return!1}return!0}toString(t){void 0===t&&(t=-1);let e="";if(t<0)e="M"+this.startX.toString()+" "+this.startY.toString();else{const i=e=>0===e?"0":e.toFixed(t);e="M"+i(this.startX)+" "+i(this.startY)}const i=this.segments.r,s=i.length;for(let n=0;n<s;n++){e+=" "+i[n].toString(t)}return e}get u(){return!!(1&this.n)}set u(t){t?this.n|=1:this.n&=-2}get yt(){return!!(2&this.n)}set yt(t){t?this.n|=2:this.n&=-3}k(){this.u=!0;const t=this.segments;t.k();const e=t.r,i=t.length;for(let t=0;t<i;t++)e[t].k();return this}UP(){if(this.yt)return!0;const t=this.segments;if(this.dm!==t.rt)return!0;for(const e of t)if(e.yt)return!0;return!1}sR(){this.yt=!1,this.Hi=null;const t=this.segments;this.dm=t.rt;for(const e of t)e.yt=!1,e.Ks=null}get isFilled(){return!!(4&this.n)}set isFilled(t){this.u&&e.L(this,t),t?this.n|=4:this.n&=-5}get isShadowed(){return!!(8&this.n)}set isShadowed(t){this.u&&e.L(this,t),t?this.n|=8:this.n&=-9}get isEvenOdd(){return!!(16&this.n)}set isEvenOdd(t){this.u&&e.L(this,t),t?this.n|=16:this.n&=-17}get startX(){return this.Li}set startX(t){this.u&&e.L(this,t),this.Li=t,this.Hi=null,this.yt=!0}get startY(){return this.Ai}set startY(t){this.u&&e.L(this,t),this.Ai=t,this.Hi=null,this.yt=!0}get segments(){return this.Mc}set segments(t){this.u&&e.L(this,t),this.Mc=t,this.Hi=null,this.yt=!0}add(t){return this.Mc.add(t),this.Hi=null,this}BP(t,i,s){const n=this;let o=n.startX,r=n.startY,a=o,h=r;const l=n.segments.r,u=l.length;for(let c=0;c<u;c++){const u=l[c];switch(u.type){case 1:a=u.endX,h=u.endY,o=u.endX,r=u.endY;break;case 2:if(k.Ve(o,r,u.endX,u.endY,s,t,i))return!0;o=u.endX,r=u.endY;break;case 3:if(k.nx(o,r,u.point1X,u.point1Y,u.point2X,u.point2Y,u.endX,u.endY,.5,t,i,s))return!0;o=u.endX,r=u.endY;break;case 4:if(k.IP(o,r,u.point1X,u.point1Y,u.endX,u.endY,.5,t,i,s))return!0;o=u.endX,r=u.endY;break;case 5:case 6:const l=5===u.type?u.vo(n):u.Za(n,o,r),c=l.length,d=5===u.type?u.centerX:u.endX,g=5===u.type?u.centerY:u.endY;if(0===c){if(k.Ve(o,r,d,g,s,t,i))return!0;o=d,r=g;break}let f=null;for(let e=0;e<c;e++)if(f=l[e],0===e&&k.Ve(o,r,f[0],f[1],s,t,i)||k.nx(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],.5,t,i,s))return!0;null!==f&&(o=f[6],r=f[7]);break;default:e.o("Unknown Segment type: "+u.type)}if(u.isClosed&&(o!==a||r!==h)&&k.Ve(o,r,a,h,s,t,i))return!0}return!1}}var L=(t=>(t[t.Move=1]="Move",t[t.Line=2]="Line",t[t.Bezier=3]="Bezier",t[t.QuadraticBezier=4]="QuadraticBezier",t[t.Arc=5]="Arc",t[t.SvgArc=6]="SvgArc",t))(L||{});class A{W;n;ni;oi;mn;Ll;Al;xr;Ks;constructor(t,e,i,s,n,o,r,a){if(u.Je(this),void 0===t&&(t=2),this.W=t,this.n=2,this.ni=void 0!==e?e:0,this.oi=void 0!==i?i:0,void 0===s&&(s=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=0),6===t){let t=o;t%=360,t<0&&(t+=360),this.mn=t,this.Ll=0,this.Al=Math.max(s,0),this.xr=Math.max(n,0),"boolean"==typeof r?r&&(this.isLargeArc=!0):"number"==typeof r&&r&&(this.isLargeArc=!0),a&&(this.isClockwiseArc=!0)}else this.mn=s,this.Ll=n,5===t&&(o=Math.max(o,0)),this.Al=o,"number"==typeof r?(5===t&&(r=Math.max(r,0)),this.xr=r):this.xr=0;this.Ks=null}copy(){const t=new A;return t.W=this.W,t.n=-2&this.n,t.ni=this.ni,t.oi=this.oi,t.mn=this.mn,t.Ll=this.Ll,t.Al=this.Al,t.xr=this.xr,t}equalsApprox(t){if(!(t instanceof A)||this.type!==t.type||this.isClosed!==t.isClosed)return!1;switch(this.type){case 1:case 2:return k.c(this.endX,t.endX)&&k.c(this.endY,t.endY);case 3:return k.c(this.endX,t.endX)&&k.c(this.endY,t.endY)&&k.c(this.point1X,t.point1X)&&k.c(this.point1Y,t.point1Y)&&k.c(this.point2X,t.point2X)&&k.c(this.point2Y,t.point2Y);case 4:return k.c(this.endX,t.endX)&&k.c(this.endY,t.endY)&&k.c(this.point1X,t.point1X)&&k.c(this.point1Y,t.point1Y);case 5:return k.c(this.startAngle,t.startAngle)&&k.c(this.sweepAngle,t.sweepAngle)&&k.c(this.centerX,t.centerX)&&k.c(this.centerY,t.centerY)&&k.c(this.radiusX,t.radiusX)&&k.c(this.radiusY,t.radiusY);case 6:return this.isClockwiseArc===t.isClockwiseArc&&this.isLargeArc===t.isLargeArc&&k.c(this.xAxisRotation,t.xAxisRotation)&&k.c(this.endX,t.endX)&&k.c(this.endY,t.endY)&&k.c(this.radiusX,t.radiusX)&&k.c(this.radiusY,t.radiusY);default:return!1}}fe(t){t in L?this.type=t:e.ur(this,t)}toString(t){void 0===t&&(t=-1);const e=e=>0===e?"0":e.toFixed(t);let i="";switch(this.type){case 1:i=t<0?"M"+this.endX.toString()+" "+this.endY.toString():"M"+e(this.endX)+" "+e(this.endY);break;case 2:i=t<0?"L"+this.endX.toString()+" "+this.endY.toString():"L"+e(this.endX)+" "+e(this.endY);break;case 3:i=t<0?"C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():"C"+e(this.point1X)+" "+e(this.point1Y)+" "+e(this.point2X)+" "+e(this.point2Y)+" "+e(this.endX)+" "+e(this.endY);break;case 4:i=t<0?"Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():"Q"+e(this.point1X)+" "+e(this.point1Y)+" "+e(this.endX)+" "+e(this.endY);break;case 5:i=t<0?"B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():"B"+e(this.startAngle)+" "+e(this.sweepAngle)+" "+e(this.centerX)+" "+e(this.centerY)+" "+e(this.radiusX)+" "+e(this.radiusY);break;case 6:i=t<0?"A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():"A"+e(this.radiusX)+" "+e(this.radiusY)+" "+e(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+e(this.endX)+" "+e(this.endY);break;default:i=L[this.type]}return i+(this.isClosed?"z":"")}static Move=1;static Line=2;static Bezier=3;static QuadraticBezier=4;static Arc=5;static SvgArc=6;get u(){return!!(1&this.n)}set u(t){t?this.n|=1:this.n&=-2}get yt(){return!!(2&this.n)}set yt(t){t?this.n|=2:this.n&=-3}k(){return this.u=!0,this}close(){return this.isClosed=!0,this}vo(t){if(null!==this.Ks&&!1===t.yt)return this.Ks;const e=this.radiusX;let i=this.radiusY;if(void 0===i&&(i=e),0===e||0===i)return this.Ks=[],this.Ks;const s=this.mn,n=this.Ll,o=k.qL(0,0,e<i?e:i,this.startAngle,this.startAngle+this.sweepAngle,!1);if(e!==i){const t=P.l();t.Ue(),e<i?t.it(1,i/e):t.it(e/i,1),N.ZL(o,t),P.i(t)}const r=o.length;for(let t=0;t<r;t++){const e=o[t];e[0]+=s,e[1]+=n,e[2]+=s,e[3]+=n,e[4]+=s,e[5]+=n,e[6]+=s,e[7]+=n}return this.Ks=o,this.Ks}Za(t,e,i){if(null!==this.Ks&&!1===t.yt)return this.Ks;if(0===this.radiusX||0===this.radiusY)return this.Ks=[],this.Ks;const s=e,n=i;let o=this.Al,r=this.xr;0===o&&(o=1e-4),0===r&&(r=1e-4);const a=this.mn*(Math.PI/180),h=this.isLargeArc,l=this.isClockwiseArc,u=this.ni,c=this.oi,d=Math.cos(a),g=Math.sin(a),f=d*(s-u)/2+g*(n-c)/2,m=-g*(s-u)/2+d*(n-c)/2,p=f*f/(o*o)+m*m/(r*r);p>1&&(o*=Math.sqrt(p),r*=Math.sqrt(p));let y=(h===l?-1:1)*Math.sqrt((o*o*r*r-o*o*m*m-r*r*f*f)/(o*o*m*m+r*r*f*f));isNaN(y)&&(y=0);let x=y*o*m/r,w=y*-r*f/o;isNaN(x)&&(x=0),isNaN(w)&&(w=0);const b=(s+u)/2+d*x-g*w,v=(n+c)/2+g*x+d*w,S=(t,e)=>Math.sqrt(t*t+e*e),M=(t,e,i,s)=>(t*i+e*s)/(S(t,e)*S(i,s)),C=(t,e,i,s)=>(t*s<e*i?-1:1)*Math.acos(M(t,e,i,s)),T=C(1,0,(f-x)/o,(m-w)/r),L=(f-x)/o,A=(m-w)/r,D=(-f-x)/o,F=(-m-w)/r;let O=C(L,A,D,F);const R=M(L,A,D,F);R<=-1?O=Math.PI:R>=1&&(O=0),!l&&O>0&&(O-=2*Math.PI),l&&O<0&&(O+=2*Math.PI);const B=o>r?o:r,E=o>r?1:o/r,I=o>r?r/o:1,V=k.qL(0,0,B,T,T+O,!0),z=P.l();return z.Ue(),z.Xs(b,v),z.ks(this.mn,0,0),z.it(E,I),N.ZL(V,z),P.i(z),this.Ks=V,this.Ks}get isClosed(){return!!(8&this.n)}set isClosed(t){this.isClosed!==t&&(t?this.n|=8:this.n&=-9,this.yt=!0)}get type(){return this.W}set type(t){this.u&&e.L(this,t),this.W=t,this.yt=!0}get endX(){return this.ni}set endX(t){this.u&&e.L(this,t),this.ni=t,this.yt=!0}get endY(){return this.oi}set endY(t){this.u&&e.L(this,t),this.oi=t,this.yt=!0}get point1X(){return this.mn}set point1X(t){this.u&&e.L(this,t),this.mn=t,this.yt=!0}get point1Y(){return this.Ll}set point1Y(t){this.u&&e.L(this,t),this.Ll=t,this.yt=!0}get point2X(){return this.Al}set point2X(t){this.u&&e.L(this,t),this.Al=t,this.yt=!0}get point2Y(){return this.xr}set point2Y(t){this.u&&e.L(this,t),this.xr=t,this.yt=!0}get centerX(){return this.mn}set centerX(t){this.u&&e.L(this,t),this.mn=t,this.yt=!0}get centerY(){return this.Ll}set centerY(t){this.u&&e.L(this,t),this.Ll=t,this.yt=!0}get radiusX(){return this.Al}set radiusX(t){t<0&&e.J(t,">= zero",A,"radiusX"),this.u&&e.L(this,t),this.Al=t,this.yt=!0}get radiusY(){return this.xr}set radiusY(t){t<0&&e.J(t,">= zero",A,"radiusY"),this.u&&e.L(this,t),this.xr=t,this.yt=!0}get startAngle(){return this.ni}set startAngle(t){this.u&&e.L(this,t),(t%=360)<0&&(t+=360),this.ni=t,this.yt=!0}get sweepAngle(){return this.oi}set sweepAngle(t){this.u&&e.L(this,t),t>360&&(t=360),t<-360&&(t=-360),this.oi=t,this.yt=!0}get isClockwiseArc(){return!!(4&this.n)}set isClockwiseArc(t){this.u&&e.L(this,t),t?this.n|=4:this.n&=-5,this.yt=!0}get isLargeArc(){return!!(16&this.n)}set isLargeArc(t){this.u&&e.L(this,t),t?this.n|=16:this.n&=-17,this.yt=!0}get xAxisRotation(){return this.mn}set xAxisRotation(t){this.u&&e.L(this,t),(t%=360)<0&&(t+=360),this.mn=t,this.yt=!0}}class D{a;ux;gx;gm;mm;pm;ym;wm;xm;bm;km;Pm;Sm;Mm;Fo;Nm;Cm;Ps;Ti;constructor(){this.a=null,this.ux=new y(0,0).k(),this.gx=new y(0,0).k(),this.gm=0,this.mm=0,this.pm=1,this.ym="",this.wm="",this.xm=!1,this.bm=!1,this.km=0,this.Pm=0,this.Sm=!1,this.Mm=!1,this.Fo=!1,this.Nm=null,this.Cm=0,this.Ps=null,this.Ti=null}copy(){const t=new D;return this.clone(t)}clone(t){return t.a=this.a,t.ux.h(this.viewPoint),t.gx.h(this.documentPoint),t.gm=this.gm,t.mm=this.mm,t.pm=this.pm,t.ym=this.ym,t.wm=this.wm,t.xm=this.xm,t.bm=this.bm,t.km=this.km,t.Pm=this.Pm,t.Sm=this.Sm,t.Mm=this.Mm,t.Fo=this.Fo,t.Nm=this.Nm,t.Cm=this.Cm,t.Ps=this.Ps,t.Ti=this.Ti,t}toString(){let t="^";return 0!==this.modifiers&&(t+="M:"+this.modifiers),0!==this.button&&(t+="B:"+this.button),""!==this.key&&(t+="K:"+this.key),0!==this.clickCount&&(t+="C:"+this.clickCount),0!==this.delta&&(t+="D:"+this.delta),this.handled&&(t+="h"),this.bubbles&&(t+="b"),null!==this.documentPoint&&(t+="@"+this.documentPoint.toString()),t}get diagram(){return this.a}set diagram(t){this.a=t}get viewPoint(){return this.ux}set viewPoint(t){this.ux.h(t)}get documentPoint(){return this.gx}set documentPoint(t){this.gx.h(t)}getMultiTouchViewPoint(t,e){const i=this.diagram;return null===i||i.eA(this.event,t,e),e}getMultiTouchDocumentPoint(t,e){const i=this.diagram;return null===i||(i.eA(this.event,t,e),e.h(i.transformViewToDoc(e))),e}get modifiers(){return this.gm}set modifiers(t){this.gm=t}get button(){return this.mm}set button(t){if(this.mm=t,null===this.event)switch(t){case 0:return void(this.buttons=1);case 1:return void(this.buttons=4);case 2:return void(this.buttons=2)}}get buttons(){return this.pm}set buttons(t){this.pm=t}get key(){return this.ym}set key(t){this.ym=t}get code(){return this.wm}set code(t){this.wm=t}get down(){return this.xm}set down(t){this.xm=t}get up(){return this.bm}set up(t){this.bm=t}get clickCount(){return this.km}set clickCount(t){this.km=t}get delta(){return this.Pm}set delta(t){this.Pm=t}get isMultiTouch(){return this.Sm}set isMultiTouch(t){this.Sm=t}get handled(){return this.Mm}set handled(t){this.Mm=t}get bubbles(){return this.Fo}set bubbles(t){this.Fo=t}get event(){return this.Nm}set event(t){this.Nm=t}get isTouchEvent(){const t=this.event;return null!==t&&("touch"===t.pointerType||"pen"===t.pointerType)}get timestamp(){return this.Cm}set timestamp(t){this.Cm=t}get targetDiagram(){return this.Ps}set targetDiagram(t){this.Ps=t}get targetObject(){return this.Ti}set targetObject(t){this.Ti=t}get control(){return!!(1&this.modifiers)}set control(t){this.modifiers=t?1|this.modifiers:-2&this.modifiers}get shift(){return!!(4&this.modifiers)}set shift(t){this.modifiers=t?4|this.modifiers:-5&this.modifiers}get alt(){return!!(2&this.modifiers)}set alt(t){this.modifiers=t?2|this.modifiers:-3&this.modifiers}get meta(){return!!(8&this.modifiers)}set meta(t){this.modifiers=t?8|this.modifiers:-9&this.modifiers}get left(){const t=this.event;return null===t||"mousedown"!==t.type&&"mouseup"!==t.type&&"pointerdown"!==t.type&&"pointerup"!==t.type?!!(1&this.buttons):0===this.button}set left(t){t?this.buttons|=1:this.buttons&=-2}get right(){const t=this.event;return null===t||"mousedown"!==t.type&&"mouseup"!==t.type&&"pointerdown"!==t.type&&"pointerup"!==t.type?!!(2&this.buttons):2===this.button}set right(t){t?this.buttons|=2:this.buttons&=-3}get middle(){const t=this.event;return null===t||"mousedown"!==t.type&&"mouseup"!==t.type&&"pointerdown"!==t.type&&"pointerup"!==t.type?!!(4&this.buttons):1===this.button}set middle(t){t?this.buttons|=4:this.buttons&=-5}get commandKey(){const t=this.code,e=this.key;return"cxvyzagCXVYZAG".includes(e)?e.toLowerCase():"KeyC"===t?"c":"KeyX"===t?"x":"KeyV"===t?"v":"KeyY"===t?"y":"KeyZ"===t?"z":"KeyA"===t?"a":"KeyG"===t?"g":""!==t?t:e}}class F{a;Pt;Lm;Am;constructor(){this.a=null,this.Pt="",this.Lm=null,this.Am=null}copy(){const t=new F;return t.a=this.a,t.Pt=this.Pt,t.Lm=this.Lm,t.Am=this.Am,t}toString(){let t="*"+this.name;return null!==this.subject&&(t+=":"+this.subject.toString()),null!==this.parameter&&(t+="("+this.parameter.toString()+")"),t}get diagram(){return this.a}set diagram(t){this.a=t}get name(){return this.Pt}set name(t){this.Pt=t}get subject(){return this.Lm}set subject(t){this.Lm=t}get parameter(){return this.Am}set parameter(t){this.Am=t}}var O=(t=>(t[t.Transaction=1]="Transaction",t[t.Property=2]="Property",t[t.Insert=3]="Insert",t[t.Remove=4]="Remove",t))(O||{});class R{Tu;Tm;pn;Ce;a;Du;Nc;Cc;Lc;Ac;constructor(){this.Tu=2,this.Tm="",this.pn="",this.Ce=null,this.a=null,this.Du=null,this.Nc=null,this.Cc=null,this.Lc=null,this.Ac=null}static Transaction=1;static Property=2;static Insert=3;static Remove=4;clear(){this.Ce=null,this.a=null,this.Du=null,this.Nc=null,this.Cc=null,this.Lc=null,this.Ac=null}copy(){const t=new R;t.Tu=this.Tu,t.Tm=this.Tm,t.pn=this.pn,t.Ce=this.Ce,t.a=this.a,t.Du=this.Du;let i=this.Nc;return e.$(i)&&e.st(i.copyFrozen)?t.Nc=i.copyFrozen():t.Nc=i,i=this.Cc,e.$(i)&&e.st(i.copyFrozen)?t.Cc=i.copyFrozen():t.Cc=i,i=this.Lc,e.$(i)&&e.st(i.copyFrozen)?t.Lc=i.copyFrozen():t.Lc=i,i=this.Ac,e.$(i)&&e.st(i.copyFrozen)?t.Ac=i.copyFrozen():t.Ac=i,t}fe(t){t in O?this.change=t:e.ur(this,t)}toString(){let t="";return 1===this.change?t+="* ":2===this.change?t+=null!==this.model?"!m":"!d":t+=(null!==this.model?"!m":"!d")+this.change,this.propertyName&&"string"==typeof this.propertyName&&(t+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(t+=" "+this.modelChange),t+=": ",1===this.change?null!==this.oldValue&&(t+=" "+this.oldValue):(null!==this.object&&(t+=e.toString(this.object)),null!==this.oldValue&&(t+="  old: "+e.toString(this.oldValue)),null!==this.oldParam&&(t+=" "+this.oldParam),null!==this.newValue&&(t+="  new: "+e.toString(this.newValue)),null!==this.newParam&&(t+=" "+this.newParam)),t}getValue(t){return t?this.oldValue:this.newValue}getParam(t){return t?this.oldParam:this.newParam}canUndo(){return null!==this.model||null!==this.diagram}undo(){this.canUndo()&&(null!==this.model?this.model.changeState(this,!0):null!==this.diagram&&this.diagram.iA(this,!0))}canRedo(){return null!==this.model||null!==this.diagram}redo(){this.canRedo()&&(null!==this.model?this.model.changeState(this,!1):null!==this.diagram&&this.diagram.iA(this,!1))}get model(){return this.Ce}set model(t){this.Ce=t}get diagram(){return this.a}set diagram(t){this.a=t}get change(){return this.Tu}set change(t){this.Tu=t}get modelChange(){return this.Tm}set modelChange(t){this.Tm=t}get propertyName(){return this.pn}set propertyName(t){this.pn=t}get isTransactionFinished(){return 1===this.Tu&&("CommittedTransaction"===this.pn||"FinishedUndo"===this.pn||"FinishedRedo"===this.pn)}get object(){return this.Du}set object(t){this.Du=t}get oldValue(){return this.Nc}set oldValue(t){this.Nc=t}get oldParam(){return this.Cc}set oldParam(t){this.Cc=t}get newValue(){return this.Lc}set newValue(t){this.Lc=t}get newParam(){return this.Ac}set newParam(t){this.Ac=t}}class B{sA;Pt;XP;constructor(){this.sA=(new h).k(),this.Pt="",this.XP=!1}toString(t){let e="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(void 0!==t&&t>0){const t=this.changes.count;for(let i=0;i<t;i++){const t=this.changes.elt(i);null!==t&&(e+="\n  "+t.toString())}}return e}clear(){const t=this.changes;t.ce();for(let e=t.count-1;e>=0;e--){const i=t.elt(e);null!==i&&i.clear()}t.clear(),t.k()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let t=this.changes.count-1;t>=0;t--){const e=this.changes.elt(t);null!==e&&e.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const t=this.changes.count;for(let e=0;e<t;e++){const t=this.changes.elt(e);null!==t&&t.redo()}}rR(t){const e=this.changes;for(let i=e.count-1;i>=t;i--){const t=e.elt(i);null!==t&&t.undo(),e.ce(),e.removeAt(i)}e.k()}thaw(){this.changes.ce()}optimize(){if(!this.isComplete)return;const t=this.changes;t.ce();const e=new Map;for(let i=0;i<t.count;i++){const s=t.elt(i);if(null===s||2!==s.change||!s.object)continue;let n=e.get(s.object);n||(n=new Map,e.set(s.object,n));const o=n.get(s.propertyName);void 0===o?n.set(s.propertyName,-1):(o>0&&t.setElt(o,null),n.set(s.propertyName,i))}let i=0;for(let e=0;e<t.count;e++){const s=t.elt(e);null!==s&&(e>i&&t.setElt(i,s),i++)}for(;t.length>i;)t.pop();t.k()}get changes(){return this.sA}get name(){return this.Pt}set name(t){this.Pt=t}get isComplete(){return this.XP}set isComplete(t){this.XP=t}}class E{mx;Be;nA;Hs;GP;Dm;Tl;YP;KP;yn;Tc;yx;qs;wx;xx;vm;kx;constructor(t){this.mx=new u,this.Be=!1,this.nA=(new h).k(),this.Hs=-1,this.GP=999,this.qs=!1,this.Dm=null,this.Tl=0,this.YP=!1,this.KP=23,this.yn=(new h).k(),this.Tc=new h,this.yx=!0,this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1,t&&Object.assign(this,t)}toString(t){let e="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;e+="[";let i=this.nestedTransactionNames.count;for(let t=0;t<i;t++)t>0&&(e+=" "),e+=this.nestedTransactionNames.elt(t);if(e+="]",void 0!==t&&t>0){i=this.history.count;for(let s=0;s<i;s++)e+="\n "+this.history.elt(s).toString(t-1)}return e}clear(){const t=this.history;t.ce();for(let e=t.count-1;e>=0;e--){const i=t.elt(e);null!==i&&i.clear()}t.clear(),this.Hs=-1,t.k(),this.qs=!1,this.Dm=null,this.Tl=0,this.yn.ce(),this.yn.clear(),this.yn.k(),this.Tc.clear(),this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1}copyProperties(t){this.isEnabled=t.isEnabled,this.maxHistoryLength=t.maxHistoryLength,this.Fm=t.Fm}addModel(t){this.mx.add(t)}removeModel(t){this.mx.delete(t)}startTransaction(t){if(void 0===t&&(t=""),null===t&&(t=""),this.isUndoingRedoing)return!1;!0===this.yx&&(this.yx=!1,this.Tl++,this.Dl||this.vl("StartingFirstTransaction",t,this.currentTransaction),this.Tl>0&&this.Tl--),this.isEnabled&&(this.yn.ce(),this.yn.add(t),this.yn.k(),null===this.currentTransaction?this.Tc.add(0):this.Tc.add(this.currentTransaction.changes.count)),this.Tl++;const e=1===this.transactionLevel;return e&&(this.Dl||this.vl("StartedTransaction",t,this.currentTransaction)),e}commitTransaction(t){return void 0===t&&(t=""),this.oA(!0,t)}rollbackTransaction(){return this.oA(!1,"")}oA(t,i){if(this.isUndoingRedoing)return!1;this.Fm&&this.transactionLevel<1&&e.ne("Ending transaction without having started a transaction: "+i);const s=1===this.transactionLevel;let n=this.currentTransaction;s&&t&&(this.Dl||this.vl("CommittingTransaction",i,n));let o=0;if(this.transactionLevel>0&&(this.Tl--,this.isEnabled)){const t=this.yn.count;t>0&&(""===i&&(i=this.yn.elt(0)),this.yn.ce(),this.yn.removeAt(t-1),this.yn.k());const e=this.Tc.count;e>0&&(o=this.Tc.elt(e-1),this.Tc.removeAt(e-1))}if(s){if(t){if(this.vm=!1,null===n&&""!==i&&(n=this.currentTransaction),this.isEnabled&&null!==n){const t=n;t.isComplete||(t.isComplete=!0,t.name=i),this.discardHistoryAfterIndex();const e=this.history;e.ce();const s=this.maxHistoryLength;if(s>=0)if(0===s)e.clear();else if(e.count>=s){const t=e.elt(0);null!==t&&t.clear(),e.removeAt(0),this.Hs--}0!==s&&(0===e.count||e.get(e.count-1)!==t)&&(e.add(t),this.Hs++),e.k(),n=t}this.Dl||this.vl("CommittedTransaction",i,n)}else{this.qs=!0;try{this.isEnabled&&null!==n&&(n.isComplete=!0,n.undo())}finally{this.Dl||this.vl("RolledBackTransaction",i,n),this.qs=!1}null!==n&&n.clear()}return this.Dm=null,this.Px&&this.clear(),this.Px=!1,this.Sx=!1,!0}return this.isEnabled&&!t&&null!==n&&n.rR(o),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const t=this.history;t.ce();for(let e=t.count-1;e>this.historyIndex;e--){const i=t.elt(e);null!==i&&i.clear(),t.removeAt(e),this.vm=!0}t.k()}thaw(){this.history.ce()}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const t=this.transactionToUndo;return!(null===t||!t.canUndo())}undo(){if(!this.canUndo())return;const t=this.transactionToUndo;if(null!==t)try{this.qs=!0,this.vl("StartingUndo","Undo",t),this.Hs--,t.undo()}catch(t){e.ne("undo error: "+t.toString())}finally{this.vl("FinishedUndo","Undo",t),this.qs=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const t=this.transactionToRedo;return!(null===t||!t.canRedo())}redo(){if(!this.canRedo())return;const t=this.transactionToRedo;if(null!==t)try{this.qs=!0,this.vl("StartingRedo","Redo",t),this.Hs++,t.redo()}catch(t){e.ne("redo error: "+t.toString())}finally{this.vl("FinishedRedo","Redo",t),this.qs=!1}}vl(t,e,i){const s=new R;s.change=1,s.propertyName=t,s.object=i,s.oldValue=e;const n=this.models;for(;n.next();){const t=n.value;s.model=t,t.lR(s)}}handleChanged(t){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(t)){let i=this.currentTransaction;null===i&&(i=new B,this.Dm=i);const s=t.copy(),n=i.changes;if(n.ce(),n.add(s),n.k(),this.Fm&&this.KP>0&&this.transactionLevel<=0&&!this.yx){const i=t.diagram;if(null!==i&&!1===i.Qa)return;e.ne("Change not within a transaction: "+s.toString()),this.KP--}}}skipsEvent(t){if(null===t||1===t.change)return!0;const e=t.object;if(null===e)return!1;if(void 0!==e.layer){const t=e.layer;if(null!==t&&t.isTemporary)return!0}else if(e.isTemporary)return!0;return!1}get models(){return this.mx.iterator}get isEnabled(){return this.Be}set isEnabled(t){this.Be=t}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.qs}get history(){return this.nA}get maxHistoryLength(){return this.GP}set maxHistoryLength(t){this.GP=t}get historyIndex(){return this.Hs}get currentTransaction(){return this.Dm}get transactionLevel(){return this.Tl}get isInTransaction(){return this.Tl>0}get Fm(){return this.YP}set Fm(t){this.YP=t}get nestedTransactionNames(){return this.yn}get Px(){return this.wx}set Px(t){this.wx=t}get Sx(){return this.xx}set Sx(t){this.xx=t}get Dl(){return this.kx}set Dl(t){this.kx=t}get isJustDiscarded(){return this.vm}}class I{a;Pt;Be;HP;qP;Rm;rA;constructor(){u.Je(this),this.a=wt.Om(),this.Pt="",this.Be=!0,this.HP=!1,this.qP=null,this.rA=new D,this.Rm=-1}get diagram(){return this.a}set diagram(t){t instanceof wt&&(this.a=t)}toString(){return""!==this.name?this.name+" Tool":e.Kn(this.constructor)}updateAdornments(t){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const t=this.diagram;t.currentTool===this&&(t.currentTool=null,t.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const t=this.diagram,e=t.lastInput,i=e.getMultiTouchViewPoint(0,y.z(NaN,NaN)),s=e.getMultiTouchViewPoint(1,y.z(NaN,NaN));if(!i.isReal()||!s.isReal())return y.i(i),void y.i(s);if(this.doCancel(),t.getInputOption("hasGestureZoom")){t.jP=t.scale;const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o);t.WP=r,e.bubbles=!1}y.i(i),y.i(s)}standardPinchZoomMove(){const t=this.diagram,e=t.lastInput,i=e.getMultiTouchViewPoint(0,y.z(NaN,NaN)),s=e.getMultiTouchViewPoint(1,y.z(NaN,NaN));if(!i.isReal()||!s.isReal())return y.i(i),void y.i(s);if(this.doCancel(),t.getInputOption("hasGestureZoom")){const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o)/t.WP,a=new y((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),h=t.jP*r,l=t.commandHandler;if(h!==t.scale&&l.canResetZoom(h)){const e=t.zoomPoint;t.zoomPoint=a,l.resetZoom(h),t.zoomPoint=e}e.bubbles=!1}y.i(i),y.i(s)}doKeyDown(){"Escape"===this.diagram.lastInput.code&&this.doCancel()}doKeyUp(){}startTransaction(t){return void 0===t&&(t=this.name),this.transactionResult=null,this.diagram.startTransaction(t)}stopTransaction(){const t=this.diagram;return null===this.transactionResult?t.rollbackTransaction():t.commitTransaction(this.transactionResult)}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;const i=t.lastInput,s=t.findPartAt(i.documentPoint,!1);if(null!==s){if(e.fr?i.meta:i.control){t.T("ChangingSelection",t.selection);let e=s;for(;null!==e&&!e.canSelect();)e=e.containingGroup;null!==e&&(e.isSelected=!e.isSelected),t.T("ChangedSelection",t.selection)}else if(i.shift){if(!s.isSelected){t.T("ChangingSelection",t.selection);let e=s;for(;null!==e&&!e.canSelect();)e=e.containingGroup;null!==e&&(e.isSelected=!0),t.T("ChangedSelection",t.selection)}}else if(!s.isSelected){let e=s;for(;null!==e&&!e.canSelect();)e=e.containingGroup;null!==e&&t.select(e)}}else i.left&&!(e.fr?i.meta:i.control)&&!i.shift&&t.clearSelection()}standardMouseClick(t,e){void 0===t&&(t=null),void 0===e&&(e=t=>!t.layer?.isTemporary);const i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,t,e);return s.targetObject=n,this.lA(n,s,i)}lA(t,e,i){if(e.handled=!1,null!==t&&!t.isEnabledObject())return!1;let s=0;e.left?s=1===e.clickCount?1:2===e.clickCount?2:1:e.right&&1===e.clickCount&&(s=3);let n="ObjectSingleClicked";if(null!==t){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked"}0!==s&&i.T(n,t)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked"}0!==s&&i.T(n)}if(null!==t)for(;null!==t;){let i=null;switch(s){case 1:i=t.click;break;case 2:i=t.doubleClick?t.doubleClick:t.click;break;case 3:i=t.contextClick}if(null!==i&&(i(e,t),e.handled))break;t=t.panel}else{let t=null;switch(s){case 1:t=i.click;break;case 2:t=i.doubleClick?i.doubleClick:i.click;break;case 3:t=i.contextClick}null!==t&&t(e)}return e.handled}standardMouseOver(){const t=this.diagram,e=t.lastInput;if(!0===t.animationManager.ke)return;const i=t.skipsUndoManager;t.skipsUndoManager=!0;let s=t.viewportBounds.containsPoint(e.documentPoint)?t.findObjectAt(e.documentPoint,null,null):null;e.event&&("pointercancel"===e.event.type||"pointerout"===e.event.type)&&(s=null),e.targetObject=s;let n=!1;if(s!==t.Dc){let i=t.Dc;const o=i;for(t.Dc=s,this.aA(i,s),e.handled=!1;null!==i;){const t=i.mouseLeave;if(null!==t&&(s===i||null!==s&&s.isContainedBy(i)||(t(e,i,s),n=!0,e.handled)))break;i=i.panel}for(i=o,e.handled=!1;null!==s;){const t=s.mouseEnter;if(null!==t&&(i===s||null!==i&&i.isContainedBy(s)||(t(e,s,i),n=!0,e.handled)))break;s=s.panel}s=t.Dc}if(null!==s){let i=s,o="";for(;null!==i&&(o=i.cursor,""===o);)i=i.panel;for(t.currentCursor=o,e.handled=!1,i=s;null!==i;){const t=i.mouseOver;if(null!==t&&(t(e,i),n=!0,e.handled))break;i=i.panel}}else{this.doUpdateCursor(null);const i=t.mouseOver;null!==i&&(i(e),n=!0)}n&&t.requestUpdate(),t.skipsUndoManager=i}doUpdateCursor(t){const e=this.diagram;e&&(e.currentCursor="")}aA(t,e){}standardMouseWheel(){const t=this.diagram,e=t.lastInput;let i=e.delta;if(0===i||!t.documentBounds.isReal())return;const s=t.commandHandler,n=t.toolManager.mouseWheelBehavior;if(null!==s&&(2===n&&!e.shift||1===n&&e.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){const n=t.zoomPoint;t.zoomPoint=e.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),t.zoomPoint=n}e.bubbles=!1}else if(2===n&&e.shift||1===n&&!e.control){const s=t.position.copy(),n=e.event,o=n.deltaMode;let r=n.deltaX,a=n.deltaY,h="pixel";if(0===r&&0===a||e.shift)!e.shift&&t.allowVerticalScroll?(i=3*i*t.scrollVerticalLineChange,t.scroll(h,i>0?"up":"down",Math.abs(i))):e.shift&&t.allowHorizontalScroll&&(i=3*i*t.scrollHorizontalLineChange,t.scroll(h,i>0?"left":"right",Math.abs(i)));else{switch(o){case 0:h="pixel";break;case 1:h="line";break;case 2:h="page"}if(0!==r&&t.allowHorizontalScroll){r*=t.scrollHorizontalLineChange/16,t.scroll(h,r>0?"right":"left",Math.abs(r))}if(0!==a&&t.allowVerticalScroll){a*=t.scrollVerticalLineChange/16,t.scroll(h,a>0?"down":"up",Math.abs(a))}}this.doWheelChange(t,s,e)}}doWheelChange(t,e,i){(!t.position.equals(e)||0!==i.event.wheelDeltaX)&&(i.bubbles=!1)}standardWaitAfter(t,i){void 0===i&&(i=this.diagram.lastInput),this.cancelWaitAfter();const s=this,n=i.clone(this.rA);this.Rm=e.un((()=>s.doWaitAfter(n)),t)}cancelWaitAfter(){-1!==this.Rm&&e.yc(this.Rm),this.Rm=-1}doWaitAfter(t){}findToolHandleAt(t,e){const i=this.diagram.findObjectAt(t,(t=>{for(;null!==t&&!(t.panel instanceof ge);)t=t.panel;return t}));return null===i?null:i.part.category===e?i:null}isBeyondDragSize(t,e){const i=this.diagram;void 0===t&&(t=i.firstInput.viewPoint),void 0===e&&(e=i.lastInput.viewPoint);const s=i.toolManager.dragSize;let n=s.width,o=s.height;return i.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(e.x-t.x)>n||Math.abs(e.y-t.y)>o}get name(){return this.Pt}set name(t){e.s(t,"string",I,"name"),this.Pt=t}get isEnabled(){return this.Be}set isEnabled(t){e.s(t,"boolean",I,"isEnabled"),this.Be=t}get isActive(){return this.HP}set isActive(t){e.s(t,"boolean",I,"isActive"),this.HP=t}get transactionResult(){return this.qP}set transactionResult(t){null!==t&&e.s(t,"string",I,"transactionResult"),this.qP=t}}var V=(t=>(t[t.Scroll=1]="Scroll",t[t.Zoom=2]="Zoom",t[t.None=3]="None",t))(V||{}),z=(t=>(t[t.Zoom=1]="Zoom",t[t.Cancel=2]="Cancel",t[t.None=3]="None",t))(z||{});class X extends I{hA;cA;fA;JP;$P;ZP;QP;_P;tS;eS;Im;_a;constructor(t){super(),this.name="ToolManager",this.hA=new h,this.cA=new h,this.fA=new h,this.JP=850,this.$P=850,this.ZP=new x(2,2).kt(),this.QP=5e3,this._P=1,this.tS=1,this.eS=null,this.Im=null,this._a=-1,t&&Object.assign(this,t)}static WheelScroll=1;static WheelZoom=2;static WheelNone=3;static GestureZoom=1;static GestureCancel=2;static GestureNone=3;get mouseWheelBehavior(){return this._P}set mouseWheelBehavior(t){this._P=t}get gestureBehavior(){return this.tS}set gestureBehavior(t){this.tS=t}initializeStandardTools(){return this}updateAdornments(t){const e=this.currentToolTip;if(e instanceof ge&&this.Im===t){const i=e.adornedObject;(null!==t?null!==i&&i.part===t:null===i)?this.showToolTip(e,i):this.hideToolTip()}}doMouseDown(){const t=this.diagram,e=t.lastInput;if(e.isTouchEvent&&2===this.gestureBehavior&&(e.bubbles=!1),e.isMultiTouch){if(this.cancelWaitAfter(),3===this.gestureBehavior)return void(e.bubbles=!0);if(2===this.gestureBehavior)return;if(t.currentTool.canStartMultiTouch())return void t.currentTool.standardPinchZoomStart()}t.undoManager;const i=this.mouseDownTools.length;for(let e=0;e<i;e++){const i=this.mouseDownTools.elt(e);if(i.diagram=this.diagram,i.canStart())return t.doFocus(),t.currentTool=i,void(t.currentTool===i&&(i.isActive||i.doActivate(),i.doMouseDown()))}1===t.lastInput.button&&(1===this.mouseWheelBehavior?this.mouseWheelBehavior=2:2===this.mouseWheelBehavior&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,e)}doMouseMove(){const t=this.diagram,e=t.lastInput;if(e.isMultiTouch){if(3===this.gestureBehavior)return void(e.bubbles=!0);if(2===this.gestureBehavior)return;if(t.currentTool.canStartMultiTouch())return void t.currentTool.standardPinchZoomMove()}if(this.isActive){const e=this.mouseMoveTools.length;for(let i=0;i<e;i++){const e=this.mouseMoveTools.elt(i);if(e.diagram=this.diagram,e.canStart())return t.doFocus(),t.currentTool=e,void(t.currentTool===e&&(e.isActive||e.doActivate(),e.doMouseMove()))}}this.uA(t);const i=e.event;null!==i&&("pointermove"===i.type||!i.cancelable)&&(e.bubbles=!0)}uA(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}aA(t,e){const i=this.currentToolTip;null!==i&&(null!==e&&i instanceof ge&&(e===i||e.isContainedBy(i))||this.hideToolTip())}doWaitAfter(t){const e=this.diagram;if(!e.aR())return;const i=e.lastInput;if(e.lastInput=t,this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!e.lastInput.handled){const i=t.copy();i.button=2,e.lastInput=i,e.Mx=!0,e.doMouseUp()}e.lastInput=i}doMouseHover(){const t=this.diagram,e=t.lastInput;null===e.targetObject&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(null!==i)for(e.handled=!1;null!==i;){const t=this.isActive?i.mouseHold:i.mouseHover;if(null!==t&&(t(e,i),e.handled))break;i=i.panel}else{const i=this.isActive?t.mouseHold:t.mouseHover;null!==i&&i(e)}}doToolTip(){const t=this.diagram,e=t.lastInput;null===e.targetObject&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(null!==i){const t=this.currentToolTip;if(t instanceof ge&&(i===t||i.isContainedBy(t)))return;for(;null!==i;){const t=i.toolTip;if(null!==t)return void this.showToolTip(t,i);i=i.panel}this.hideToolTip()}else{const e=t.toolTip;null!==e?this.showToolTip(e,null):this.hideToolTip()}}showToolTip(t,i){null!==i&&e.se(i,At,X,"showToolTip:obj");const s=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof ge){t.layerName="Tool",t.selectable=!1,t.scale=1/s.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=s.scale);const e=t.diagram;null!==e&&e!==s&&e.remove(t),s.add(t),null!==i?t.adornedObject=i:t.data=s.model,t.ensureBounds(),this.positionToolTip(t,i)}else t instanceof et&&t!==this.currentToolTip&&null!==t.show&&t.show(i,s,this);this.currentToolTip=t,this.extendToolTip(this.toolTipDuration)}positionToolTip(t,e){if(t.hasPlaceholder())return;const i=t,s=this.diagram,n=s.lastInput.documentPoint.copy(),o=i.measuredBounds,r=s.viewportBounds;s.lastInput.isTouchEvent&&(n.x-=o.width),n.x+o.width>r.right&&(n.x-=o.width+5/s.scale),n.x<r.x&&(n.x=r.x),n.y+20/s.scale+o.height>r.bottom?n.y-=o.height+5/s.scale:n.y+=20/s.scale,n.y<r.y&&(n.y=r.y),i.position=n}extendToolTip(t){void 0===t&&(t=3e3),null!==this.currentToolTip&&(-1!==this._a&&(e.yc(this._a),this._a=-1),t>0&&t!==1/0&&(this._a=e.un((()=>this.hideToolTip()),t)))}hideToolTip(){-1!==this._a&&(e.yc(this._a),this._a=-1);const t=this.diagram,i=this.currentToolTip;null!==i&&(i instanceof ge?(t.remove(i),null!==this.Im&&this.Im.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof et&&null!==i.hide&&i.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.eS}set currentToolTip(t){this.eS=t,this.Im=null!==t&&t instanceof ge?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const e=this.mouseUpTools.length;for(let i=0;i<e;i++){const e=this.mouseUpTools.elt(i);if(e.diagram=this.diagram,e.canStart())return t.doFocus(),t.currentTool=e,void(t.currentTool===e&&(e.isActive||e.doActivate(),e.doMouseUp()))}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;null!==t.commandHandler&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;null!==t.commandHandler&&t.commandHandler.doKeyUp()}findTool(t){e.s(t,"string",X,"findTool:name");let i=this.mouseDownTools.length;for(let e=0;e<i;e++){const i=this.mouseDownTools.elt(e);if(i.name===t)return i}i=this.mouseMoveTools.length;for(let e=0;e<i;e++){const i=this.mouseMoveTools.elt(e);if(i.name===t)return i}i=this.mouseUpTools.length;for(let e=0;e<i;e++){const i=this.mouseUpTools.elt(e);if(i.name===t)return i}return null}replaceTool(t,i){e.s(t,"string",X,"replaceTool:name"),null!==i&&(i.diagram=this.diagram);let s=this.mouseDownTools.length;for(let e=0;e<s;e++){const s=this.mouseDownTools.elt(e);if(s.name===t)return null!==i?this.mouseDownTools.setElt(e,i):this.mouseDownTools.removeAt(e),s}s=this.mouseMoveTools.length;for(let e=0;e<s;e++){const s=this.mouseMoveTools.elt(e);if(s.name===t)return null!==i?this.mouseMoveTools.setElt(e,i):this.mouseMoveTools.removeAt(e),s}s=this.mouseUpTools.length;for(let e=0;e<s;e++){const s=this.mouseUpTools.elt(e);if(s.name===t)return null!==i?this.mouseUpTools.setElt(e,i):this.mouseUpTools.removeAt(e),s}return null}replaceStandardTool(t,e,i){this.Jt(t,e,i)}Jt(t,i,s){e.s(t,"string",X,"replaceStandardTool:name"),null!==i&&(i.name=t,i.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,i):null!==i&&s.add(i)}get mouseDownTools(){return this.hA}get mouseMoveTools(){return this.cA}get mouseUpTools(){return this.fA}get hoverDelay(){return this.JP}set hoverDelay(t){e.s(t,"number",X,"hoverDelay"),this.JP=t}get holdDelay(){return this.$P}set holdDelay(t){e.s(t,"number",X,"holdDelay"),this.$P=t}get dragSize(){return this.ZP}set dragSize(t){this.ZP=t.N()}get toolTipDuration(){return this.QP}set toolTipDuration(t){e.s(t,"number",X,"toolTipDuration"),this.QP=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Jt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Jt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Jt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Jt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Jt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Jt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Jt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Jt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Jt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Jt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Jt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Jt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Jt("ClickSelecting",t,this.mouseUpTools)}}class U extends I{iS;sS;wn;nS;oS;rS;lS;vc;Em;aS;th;br;dA;hS;vu;Fu;cS;fS;uS;dS;static Nx=new h;static le=null;static eh=null;constructor(t){super(),this.name="Dragging",this.iS=!0,this.dS=!0,this.sS=!0,this.wn=null,this.nS=null,this.oS=null,this.rS=null,this.lS=!1,this.vu=!1,this.vc=new y(NaN,NaN),this.Em=new y,this.aS=!0,this.th=100,this.br=[],this.dA=(new u).k(),this.hS=new kt,this.Fu=null,this.cS="copy",this.fS="",this.uS="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.iS}set isCopyEnabled(t){e.s(t,"boolean",U,"isCopyEnabled"),this.iS=t}get copiesEffectiveCollection(){return this.sS}set copiesEffectiveCollection(t){e.s(t,"boolean",U,"copiesEffectiveCollection"),this.sS=t}get dragOptions(){return this.hS}set dragOptions(t){this.hS=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){e.s(t,"boolean",U,"isGridSnapEnabled"),this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.aS}set isComplexRoutingRealtime(t){this.aS=t;const e=this.diagram.findRouter("AvoidsLinks");null!==e&&(e.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){e.s(t,"boolean",U,"isGridSnapRealtime"),this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.N(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){e.s(t,"boolean",U,"dragsLink"),this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){e.s(t,"boolean",U,"dragsTree"),this.dragOptions.dragsTree=t}get copyCursor(){return this.cS}set copyCursor(t){this.cS=t}get moveCursor(){return this.fS}set moveCursor(t){this.fS=t}get nodropCursor(){return this.uS}set nodropCursor(t){this.uS=t}get currentPart(){return this.nS}set currentPart(t){null!==t&&e.se(t,ce,U,"currentPart"),this.nS=t}get copiedParts(){return this.rS}set copiedParts(t){this.rS=t}get draggedParts(){return this.oS}set draggedParts(t){this.oS=t}get draggingParts(){return null!==this.copiedParts?this.copiedParts.toKeySet():null!==this.draggedParts?this.draggedParts.toKeySet():this.dA}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){null!==t&&e.se(t,be,U,"draggedLink"),this.diagram.draggedLink=t}get isDragOutStarted(){return this.lS}set isDragOutStarted(t){this.lS=t}get startPoint(){return this.Em}set startPoint(t){this.Em.equals(t)||this.Em.h(t)}get delay(){return this.th}set delay(t){e.s(t,"number",U,"delay"),this.th=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(null===t||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;const e=t.lastInput;return!(!e.left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.isTouchEvent&&e.timestamp-t.firstInput.timestamp<this.th))&&null!==this.findDraggablePart()}findDraggablePart(){const t=this.diagram;let e=t.findPartAt(t.firstInput.documentPoint,!1);if(null===e)return null;for(;null!==e&&!e.canSelect();)e=e.containingGroup;return null!==e&&(e.canMove()||e.canCopy())?e:null}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(null!==i){for(;null!==i&&!i.canSelect();)i=i.containingGroup;if(this.currentPart=i,null!==this.currentPart&&!this.currentPart.isSelected){t.T("ChangingSelection",t.selection);const i=t.lastInput;!(e.fr?i.meta:i.control)&&!i.shift&&t.clearSelection(!0),this.currentPart.isSelected=!0,t.T("ChangedSelection",t.selection)}}}doActivate(){const t=this.diagram;this.Fu=null,null===this.currentPart&&this.standardMouseSelect();const e=this.currentPart;if(null===e||!e.canMove()&&!e.canCopy())return;t.cacheGroupExternalLinks(!0),U.le=null,this.isActive=!0,this.vc.set(t.position),this.gS(t.selection),this.br.length=0,t.animationManager.stopAnimation();const i=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=i,this.dS=!!this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.Ru=!0,!0===t.getRenderingHint("temporaryPixelRatio")&&t.avgSpf>30&&t.Cx(),t.gA(this.draggedParts),t.Ou=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.hR()}gS(t){if(!this.dragsLink)return;const e=this.diagram,i=e.model.Um(),s=t.first();i&&1===t.count&&s instanceof be&&this.mayDragLink(s)?(this.draggedLink=s,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.wn=e.toolManager.findTool("Relinking"),null===this.wn&&(this.wn=new Y,this.wn.diagram=e),this.wn.originalLink=this.draggedLink):(this.draggedLink=null,this.wn=null)}mayDragLink(t){const e=this.diagram;return null!==e&&e.allowRelink}computeEffectiveCollection(t,e){return this.diagram.commandHandler.computeEffectiveCollection(t,e)}js(t){return void 0===t?new vt(y.dn):this.isGridSnapEnabled?new vt(new y(Math.round(1e3*t.x)/1e3,Math.round(1e3*t.y)/1e3)):new vt(t.copy())}doDeactivate(){this.isActive=!1;const t=this.diagram;this.diagram.layout.isRealtime=this.dS,t.Ou=!1,t.Fl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.mS(),t.pS(this.draggedParts),this.Fu=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.vu=!1,U.cR(),this.mA(),this.vc.e(NaN,NaN),null!==U.eh&&(U.eh.currentCursor=""),U.eh=null,U.le=null,this.Rl(),t.isMouseCaptured=!1,t.currentCursor="",t.Ru=!1,this.stopTransaction(),t.yS(!0)}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}mS(){const t=this.diagram,e=t.skipsUndoManager;t.skipsUndoManager=!0;const i=t.lastInput;this.pA(i,null),t.skipsUndoManager=e,this.br.length=0}yA(){this.Rl(),this.wS();const t=this.diagram;this.vc.isReal()&&(t.position=this.vc),t.stopAutoScroll()}doCancel(){this.Rl(),this.wS();const t=this.diagram;this.vc.isReal()&&(t.position=this.vc),this.stopTool()}doKeyDown(){const t=this.diagram;if(!this.isActive)return;const e=t.lastInput,i=t.previousInput;"Escape"===e.code?this.doCancel():(e.code!==i.code||e.modifiers!==i.modifiers)&&this.doMouseMove()}doKeyUp(){this.isActive&&this.doMouseMove()}fR(t,e){let i=1/0,s=1/0,n=-1/0,o=-1/0;const r=t.iterator;for(;r.next();){const t=r.value;if(!t.isVisible())continue;const e=t.location,a=e.x,h=e.y;isNaN(a)||isNaN(h)||(a<i&&(i=a),h<s&&(s=h),a>n&&(n=a),h>o&&(o=h))}return i===1/0?e.e(0,0,0,0):e.e(i,s,n-i,o-s),e}xS(t){if(null!==this.copiedParts)return;const e=this.diagram;if(t&&(e.isReadOnly||e.isModelReadOnly)||null===this.draggedParts)return;const i=e.undoManager;i.isEnabled&&i.isInTransaction?null!==i.currentTransaction&&i.currentTransaction.changes.count>0&&(e.undoManager.rollbackTransaction(),e.startTransaction("Drag")):this.wS(),e.skipsUndoManager=!t,e.partManager.addsToTemporaryLayer=!t,this.startPoint=e.firstInput.documentPoint;const s=this.copiesEffectiveCollection?this.draggedParts.toKeySet():e.selection,n=e.copyParts(s,e,!0),o=new p,r=this.draggedParts.iterator;for(;r.next();){const t=r.key;if(t.Di()&&t.canCopy()){const e=n.get(t);if(null===e)continue;e.location=t.location,e.ensureBounds(),o.set(e,this.js(e.location))}}const a=n.iterator;for(;a.next();){const t=a.value;t instanceof be&&t.canCopy()&&o.set(t,this.js())}if(this.copiedParts=o,this.gS(o.toKeySet()),null!==this.draggedLink){const t=this.draggedLink,e=t.routeBounds;t.kr(this.startPoint.x-(e.x+e.width/2),this.startPoint.y-(e.y+e.height/2))}this.doUpdateCursor(null)}Rl(){const t=this.diagram;if(null!==this.copiedParts){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,null!==this.draggedParts){const t=this.draggedParts.iterator;for(;t.next();)if(t.key instanceof be){t.value.point=new y(0,0)}}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}mA(){null!==this.draggedLink&&(this.dragsLink&&null!==this.wn&&(this.wn.stopDraggingMouseMove(),this.wn.originalLink=null),this.draggedLink=null,this.wn=null)}Fc(t,e){if(null===t)return;const i=this.diagram,s=this.startPoint,n=y.l();n.h(i.lastInput.documentPoint),this.moveParts(t,n.subtract(s),e),y.i(n),!0===i.getRenderingHint("temporaryPixelRatio")&&null===i.Ol&&i.avgSpf>30&&(i.Cx(),i.Iu())}moveParts(t,e,i){void 0===i&&(i=!1);const s=this.diagram;null!==s&&s.Lx(t,e,this.dragOptions,i)}wS(){if(null===this.draggedParts)return;const t=this.diagram;let e=this.draggedParts.iterator;for(;e.next();){const t=e.key;t.Di()&&(t.location=e.value.point)}for(e=this.draggedParts.iterator;e.next();){const t=e.key;if(t instanceof be&&t.suspendsRouting){const i=e.value.point;this.draggedParts.set(t,this.js()),t.kr(-i.x,-i.y)}}t.maybeUpdate()}uR(t){if(null===t)return!0;const e=t.part;return!!(null===e||e instanceof ge||e.layer?.isTemporary||this.draggedParts&&this.draggedParts.has(e)||this.copiedParts&&this.copiedParts.has(e))}bS(t){const e=this.diagram;this.dragsLink&&(null!==this.draggedLink&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.wA(!1));const i=this.findDragOverObject(t),s=e.lastInput;s.targetObject=i,this.doUpdateCursor(i);const n=e.skipsUndoManager;let o=!1;try{if(e.skipsUndoManager=!0,o=this.pA(s,i),!this.isActive&&null===U.le)return;const n=null!==i?i.part:null;if(null===n||e.handlesDragDropForTopLevelParts&&n.isTopLevel&&!(n instanceof Ne)){const t=e.mouseDragOver;null!==t&&(t(s),o=!0)}if(!this.isActive&&null===U.le||(this.doDragOver(t,i),!this.isActive&&null===U.le))return}finally{e.skipsUndoManager=n,o&&e.maybeUpdate()}this.Fu=i,!e.isReadOnly&&(e.allowMove||e.allowCopy)&&(e.allowHorizontalScroll||e.allowVerticalScroll)&&e.doAutoScroll(s.viewPoint)}findDragOverObject(t){return this.diagram.kS(t,null,(t=>!this.uR(t)))}doUpdateCursor(t){const e=this.diagram;(null===t||this.Fu!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?e.currentCursor=this.copyCursor:this.mayMove()?e.currentCursor=this.moveCursor:this.mayDragOut()&&(e.currentCursor=this.nodropCursor))}pA(t,e){let i=!1,s=this.br.length;const n=s>0?this.br[0]:null;if(e===n)return!1;t.handled=!1;for(let n=0;n<s;n++){const s=this.br[n],o=s.mouseDragLeave;if(null!==o&&(o(t,s,e),i=!0,t.handled))break}if(this.br.length=0,!this.isActive&&null===U.le||null===e)return i;t.handled=!1;let o=e;for(;null!==o;)this.br.push(o),o=this.xA(o);s=this.br.length;for(let e=0;e<s;e++){const s=this.br[e],o=s.mouseDragEnter;if(null!==o&&(o(t,s,n),i=!0,t.handled))break}return i}FU(t,e){return null!==t&&!!(t===e||t.isContainedBy(e)||e instanceof Ne&&!(t instanceof Ne)&&e.handlesDragDropForMembers&&t.part?.isMemberOf(e))}xA(t){const e=t.panel;if(null!==e)return e;if(t instanceof ce&&!(t instanceof Ne)){const e=t.containingGroup;if(null!==e&&e.handlesDragDropForMembers)return e}return null}bA(t,e){const i=this.diagram,s=this.wn;if(null===s)return null;const n=s.portGravity,o=i.findObjectsNear(t,n,(t=>s.findValidLinkablePort(t,e))),r=y.l();let a=1/0,h=null;for(const e=o.iterator;e.next();){const i=e.value;if(null===i.part)continue;const s=i.getDocumentPoint(v.Center,r),n=t.distanceSquaredPoint(s);n<a&&(h=i,a=n)}return y.i(r),h}wA(t){const e=this.draggedLink;if(null!==e){if(e.pointsCount<2)return;const i=this.diagram;if(i.isReadOnly)return;const s=this.wn;if(null===s)return;let n=null,o=null;null===e.fromNode&&(n=this.bA(e.getPoint(0),!1),null!==n&&(o=n.part));let r=null,a=null;null===e.toNode&&(r=this.bA(e.getPoint(e.pointsCount-1),!0),null!==r&&(a=r.part)),s.isValidLink(o,n,a,r)?t?(e.defaultFromPoint=e.getPoint(0),e.defaultToPoint=e.getPoint(e.pointsCount-1),e.suspendsRouting=!1,e.fromNode=o,null!==n&&(e.fromPortId=n.portId),e.toNode=a,null!==r&&(e.toPortId=r.portId),e.fromPort!==i.PS&&i.T("LinkRelinked",e,i.PS),e.toPort!==i.SS&&i.T("LinkRelinked",e,i.SS)):s.doDraggingMouseMove(o,n,a,r):s.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,e){}kA(t){const e=this.diagram;this.dragsLink&&this.wA(!0),this.mS();const i=this.findDragOverObject(t),s=e.lastInput;if(s.targetObject=i,null!==i){s.handled=!1;let t=i;for(;null!==t;){const e=t.mouseDrop;if(null!==e&&(e(s,t),s.handled))break;this.dR(s,t),t=this.xA(t)}}else{const t=e.mouseDrop;null!==t&&t(s)}if(!this.isActive&&null===U.le)return;const n=this.copiedParts||this.draggedParts;if(null!==n){const t=n.iterator;for(;t.next();){const e=t.key;e instanceof me&&e.linksConnected.each((t=>t.suspendsRouting=!1))}}if(this.doDropOnto(t,i),!this.isActive&&null===U.le)return;const o=w.l(),r=e.selection.iterator;for(;r.next();){const t=r.value;t instanceof me&&this.gR(e,t,o)}w.i(o)}dR(t,e){const i=this.diagram,s=e.part;if(i.handlesDragDropForTopLevelParts&&null!==s&&s.isTopLevel&&!(s instanceof Ne)){const e=i.mouseDrop;null!==e&&e(t)}}gR(t,e,i){if(!e.canAvoid())return;let s=!1;i=e.getAvoidableRect(i),t.viewportBounds.containsRect(i)&&(s=!0);const n=this.copiedParts||this.draggedParts;if(null===n)return;const o=t.MS(i,(t=>t.part),(t=>t instanceof be),!0,(t=>t instanceof be),s);if(0===o.count)return;const r=o.iterator;for(;r.next();){const t=r.value;n.has(t)&&n.has(e)||!t.isMemberOf(e)&&t.isAvoiding&&t.$t()}}doDropOnto(t,e){}doMouseMove(){if(!this.isActive)return;const t=this.diagram,e=t.lastInput;this.simulatedMouseMove(e.event,e.documentPoint,e.targetDiagram)||null!==this.currentPart&&null!==this.draggedParts&&(this.mayCopy()?(this.xS(!1),this.Fc(this.copiedParts,!1)):this.mayMove()?(this.Rl(),this.Fc(this.draggedParts,!0)):this.mayDragOut()?(this.xS(!1),this.Fc(this.copiedParts,!1)):this.Rl(),this.bS(t.lastInput.documentPoint))}doMouseUp(){if(!this.isActive)return;const t=this.diagram,e=t.lastInput;if(this.simulatedMouseUp(e.event,e.documentPoint,e.targetDiagram))return;let i=!1;const s=this.mayCopy();if(s&&null!==this.copiedParts?(this.Rl(),this.xS(!0),this.Fc(this.copiedParts,!1),null!==this.copiedParts&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each((t=>{t.isSelected=!0})))):(i=!0,this.Rl(),this.mayMove()&&(this.Fc(this.draggedParts,!0),this.bS(t.lastInput.documentPoint))),this.vu=!0,this.kA(t.lastInput.documentPoint),this.isActive){const e=s&&this.copiedParts,n=e?this.copiedParts?.toKeySet():this.draggedParts?this.draggedParts.toKeySet():null;this.copiedParts=null,i&&this.mR(),t.invalidateDocumentBounds(),t.pS(this.draggedParts),this.transactionResult=e?"Copy":"Move",t.T(e?"SelectionCopied":"SelectionMoved",n)}this.stopTool(),s&&t.T("ChangedSelection",t.selection)}simulatedMouseMove(t,e,i){if(null===U.le)return!1;const s=U.le.diagram;i instanceof wt||(i=null);const n=U.eh;if(i!==n){if(null!==n&&n!==s){n.stopAutoScroll(),U.le.isDragOutStarted=!1;const t=n.toolManager.findTool("Dragging");null!==t&&t.doSimulatedDragLeave()}if(U.eh=i,null!==i&&i!==s){U.le.yA();const t=i.toolManager.findTool("Dragging");null!==t&&(t.PA(),t.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(null===i||i===s||!i.allowDrop||i.isReadOnly||!i.allowInsert)return!1;const o=i.toolManager.findTool("Dragging");if(null!==o){let s=e;null!==t&&(void 0!==t.targetTouches&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),s=i.getMouse(t)),i.lastInput.documentPoint=s,i.lastInput.viewPoint=i.transformDocToView(s),i.lastInput.down=!1,i.lastInput.up=!1,o.doSimulatedDragOver()}return!0}simulatedMouseUp(t,e,i){if(null===U.le)return!1;const s=U.eh,n=U.le.diagram;if(null===i)return U.le.doCancel(),!0;if(i!==s){if(null!==s){const t=s.toolManager.findTool("Dragging");if(null!==s&&s!==n&&null!==t)return s.stopAutoScroll(),U.le.isDragOutStarted=!1,t.doSimulatedDragLeave(),!1}U.eh=i;const t=i.toolManager.findTool("Dragging");null!==t&&(U.le.yA(),t.PA(),t.doSimulatedDragEnter())}if(i!==this.diagram){let s=e;null!==t?(void 0!==t.targetTouches&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),s=i.getMouse(t)):null===s&&(s=new y),i.lastInput.documentPoint=s,i.lastInput.viewPoint=i.transformDocToView(s),i.lastInput.down=!1,i.lastInput.up=!0;const n=i.toolManager.findTool("Dragging");null!==n&&n.doSimulatedDrop();const o=U.le;if(null!==o){const t=o.mayCopy();o.transactionResult=t?"Copy":"Move",o.stopTool()}return!0}return!1}mR(){if(null===this.draggedParts)return;const t=this.draggedParts.iterator;for(;t.next();){const e=t.key;if(e instanceof me){const t=e.containingGroup;null!==t&&t.hasPlaceholder()&&!this.draggedParts.has(t)&&t.placeholder.f()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(e.fr?t.lastInput.alt:t.lastInput.control))return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;const e=t.selection.iterator;for(;e.next();)if(e.value.canCopy())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canCopy())}mayMove(){const t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;const e=t.selection.iterator;for(;e.next();)if(e.value.canMove())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canMove())}PA(){U.Nx.has(this)||U.Nx.add(this)}static cR(){if(U.Nx.count>0){const t=U.Nx,e=t.length;for(let i=0;i<e;i++){const e=t.elt(i);e.mA(),e.Rl(),e.mS(),e.diagram.stopAutoScroll()}t.clear()}}pR(t,e,i){return!this.vu&&null!==this.draggedParts&&!this.draggedParts.has(t)&&(i.h(e),!0)}get draggingSource(){return U.le}mayDragIn(){const t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;const e=U.le;return!(null===e||e.diagram.model.dataFormat!==t.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const t=this.diagram;t.animationManager.stopAnimation(),t.Pr(),t.animationManager.stopAnimation();const e=U.le;null!==e&&(this.diagram.Ru=!0,null===t.lastInput.event&&(t.lastInput.event=e.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const t=U.le;null!==t&&t.doSimulatedDragOut(),this.diagram.Ru=!1,this.doCancel()}doSimulatedDragOver(){const t=this.diagram;t.animationManager.Eu=!0;const e=U.le;if(null!==e&&null!==e.draggedParts){if(!this.mayDragIn())return;this.SA(e.draggedParts.toKeySet(),!1,t.firstInput),this.Fc(this.copiedParts,!1),this.bS(t.lastInput.documentPoint)}t.animationManager.Eu=!1}doSimulatedDrop(){const t=this.diagram,e=U.le;if(null!==e){const i=e.diagram;if(e.vu=!0,this.Rl(),null===e.draggedParts||!this.mayDragIn())return;t.animationManager.Eu=!0,t.T("ChangingSelection",t.selection),this.startTransaction("Drop"),this.SA(e.draggedParts.toKeySet(),!0,t.lastInput),this.Fc(this.copiedParts,!1);const s=new u;null!==this.copiedParts&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each((t=>{t.isSelected=!0,s.add(t)}))),this.kA(t.lastInput.documentPoint),t.invalidateDocumentBounds(),null!==this.copiedParts&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.Ru=!1,t.T("ExternalObjectsDropped",s,i),this.stopTransaction(),t.T("ChangedSelection",t.selection)}t.animationManager.Eu=!1}SA(t,e,i){if(null!==this.copiedParts)return;const s=this.diagram;if(s.isReadOnly||s.isModelReadOnly)return;s.skipsUndoManager=!e,s.partManager.addsToTemporaryLayer=!e,this.startPoint=i.documentPoint;const n=s.copyParts(t,s,!0),o=w.l();this.fR(t,o);const r=o.x+o.width/2,a=o.y+o.height/2;w.i(o);const h=this.Em,l=new p,u=y.l(),c=t.iterator;for(;c.next();){const t=c.value;if(t instanceof be&&t.canCopy()){const e=n.get(t);if(null===e)continue;e.points=t.points,e.kr(h.x-r,h.y-a),e.suspendsRouting=!0,l.set(e,this.js())}}const d=t.iterator;for(;d.next();){const t=d.value;if(t.Di()&&t.canCopy()){const e=n.get(t);if(null===e)continue;const i=t.location;u.e(h.x-(r-i.x),h.y-(a-i.y)),e.location=u,e.ensureBounds(),l.set(e,this.js(u))}}if(y.i(u),this.copiedParts=l,this.gS(l.toKeySet()),null!==this.draggedLink){const t=this.draggedLink,e=t.routeBounds;t.kr(this.startPoint.x-(e.x+e.width/2),this.startPoint.y-(e.y+e.height/2))}this.doUpdateCursor(null)}hR(){this.isDragOutStarted=!0,this.vu=!1,U.le=this,U.eh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){const t=this.diagram;this.mayCopy()||this.mayMove()?t.currentCursor="":t.currentCursor=this.nodropCursor,this.Fu=null}computeMove(t,e,i,s){const n=this.diagram;return null!==n?n.computeMove(t,e,this.dragOptions,s):new y}}X.prototype.doCancel=function(){null!==U.le&&U.le.doCancel(),I.prototype.doCancel.call(this)};class j extends I{NS;CS;Il;LS;AS;ih;TS;nh;DS;vS;FS;RS;OS;IS;MA;ES;El;US;constructor(){super(),this.NS=100,this.CS=!1,this.Il="pointer",this.LS=new be({layerName:"Tool"}).add(new $t({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new $t({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).It(),this.ih=new $t("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:x.TP}).theme("stroke","tempPort"),this.AS=new me({selectable:!1,layerName:"Tool"}).add(this.ih).It(),this.nh=new $t("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:x.TP}).theme("stroke","tempPort"),this.TS=new me({selectable:!1,layerName:"Tool"}).add(this.nh).It(),this.DS=null,this.vS=null,this.FS=null,this.RS=null,this.OS=null,this.IS=!0,this.MA=new p,this.ES=null,this.El=null,this.US=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.NS}set portGravity(t){e.s(t,"number",j,"portGravity"),t>=0&&(this.NS=t)}get isUnconnectedLinkValid(){return this.CS}set isUnconnectedLinkValid(t){e.s(t,"boolean",j,"isUnconnectedLinkValid"),this.CS=t}get linkingCursor(){return this.Il}set linkingCursor(t){this.Il=t}get temporaryLink(){return this.LS}set temporaryLink(t){t.It(),this.LS=t}get temporaryFromNode(){return this.AS}set temporaryFromNode(t){t.It(),this.AS=t,t&&(this.ih=t.port)}get temporaryFromPort(){return this.ih}set temporaryFromPort(t){if(null!==this.ih){const e=this.ih.panel;if(null!==e){const i=e.D.indexOf(this.ih);e.removeAt(i),e.insertAt(i,t)}}this.ih=t}get temporaryToNode(){return this.TS}set temporaryToNode(t){t.It(),this.TS=t,t&&(this.nh=t.port)}get temporaryToPort(){return this.nh}set temporaryToPort(t){if(null!==this.nh){const e=this.nh.panel;if(null!==e){const i=e.D.indexOf(this.nh);e.removeAt(i),e.insertAt(i,t)}}this.nh=t}get originalLink(){return this.DS}set originalLink(t){null!==t&&e.se(t,be,j,"originalLink"),this.DS=t}get originalFromNode(){return this.vS}set originalFromNode(t){null!==t&&e.se(t,me,j,"originalFromNode"),this.vS=t}get originalFromPort(){return this.FS}set originalFromPort(t){null!==t&&e.se(t,At,j,"originalFromPort"),this.FS=t}get originalToNode(){return this.RS}set originalToNode(t){null!==t&&e.se(t,me,j,"originalToNode"),this.RS=t}get originalToPort(){return this.OS}set originalToPort(t){null!==t&&e.se(t,At,j,"originalToPort"),this.OS=t}get isForwards(){return this.IS}set isForwards(t){this.IS=t}get validPortsCache(){return this.MA}get targetPort(){return this.ES}set targetPort(t){null!==t&&e.se(t,At,j,"targetPort"),this.ES=t}copyPortProperties(t,e,i,s,n){if(null===t||null===e||null===i||null===s)return;const o=e.getDocumentScale(),r=x.l();r.width=e.naturalBounds.width*o,r.height=e.naturalBounds.height*o,s.desiredSize=r,x.i(r),n?(s.toSpot=e.toSpot,s.toEndSegmentLength=e.toEndSegmentLength):(s.fromSpot=e.fromSpot,s.fromEndSegmentLength=e.fromEndSegmentLength),i.locationSpot=v.Center;const a=y.l();i.location=e.getDocumentPoint(v.Center,a),y.i(a),s.angle=e.getDocumentAngle(),null!==this.portTargeted&&this.portTargeted(t,e,i,s,n)}setNoTargetPortProperties(t,e,i){null!==e&&(e.desiredSize=x.TP,e.fromSpot=v.None,e.toSpot=v.None),null!==t&&(t.location=this.diagram.lastInput.documentPoint),null!==this.portTargeted&&this.portTargeted(null,null,t,e,i)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),null!==this.targetPort&&this.targetPort.part instanceof me){const t=this.targetPort.part;this.isForwards?this.copyPortProperties(t,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(t,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,e){if(null===t)return null;const i=t.part;if(!(i instanceof me))return null;for(;null!==t;){const s=e?t.toLinkable:t.fromLinkable;if(!0===s&&(null!==t.portId||t instanceof me)&&(e?this.isValidTo(i,t):this.isValidFrom(i,t)))return t;if(!1===s)return null;t=t.panel}return null}findTargetPort(t){const e=this.diagram,i=e.lastInput.documentPoint;let s=this.portGravity;let n=1/0,o=null;const r=e.findObjectsNear(i,s,(e=>this.findValidLinkablePort(e,t)),null,!0).iterator;for(;r.next();){const e=r.value,s=e.part;if(!(s instanceof me))continue;const a=e.getDocumentPoint(v.Center,y.l()),h=i.x-a.x,l=i.y-a.y;y.i(a);const u=h*h+l*l;if(u<n){const i=this.validPortsCache.get(e);null!==i?i&&(o=e,n=u):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,s,e)||!t&&this.isValidLink(s,e,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(e,!0),o=e,n=u):this.validPortsCache.set(e,!1)}}if(null!==o){const t=o.part;if(t instanceof me&&(null===t.layer||t.layer.allowLink))return o}return null}isValidFrom(t,e){if(null===t||null===e)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(null!==t.layer&&!t.layer.allowLink||!0!==e.fromLinkable))return!1;const i=e.fromMaxLinks;if(i<1/0){if(null!==this.originalLink&&t===this.originalFromNode&&e===this.originalFromPort)return!0;let s=e.portId;if(null===s&&(s=""),t.findLinksOutOf(s).count>=i)return!1}return!0}isValidTo(t,e){if(null===t||null===e)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(null!==t.layer&&!t.layer.allowLink||!0!==e.toLinkable))return!1;const i=e.toMaxLinks;if(i<1/0){if(null!==this.originalLink&&t===this.originalToNode&&e===this.originalToPort)return!0;let s=e.portId;if(null===s&&(s=""),t.findLinksInto(s).count>=i)return!1}return!0}isInSameNode(t,e){if(null===t||null===e)return!1;if(t===e)return!0;const i=t.part,s=e.part;return null!==i&&i===s}isLinked(t,e){if(null===t||null===e)return!1;const i=t.part;if(!(i instanceof me))return!1;let s=t.portId;null===s&&(s="");const n=e.part;if(!(n instanceof me))return!1;let o=e.portId;null===o&&(o="");const r=n.findLinksInto(o);for(;r.next();){const t=r.value;if(t.fromNode===i&&t.fromPortId===s)return!0}return!1}isValidLink(t,e,i,s){if(!this.isValidFrom(t,e)||!this.isValidTo(i,s)||null!==e&&null!==s&&((!e.fromLinkableSelfNode||!s.toLinkableSelfNode)&&this.isInSameNode(e,s)||(!e.fromLinkableDuplicates||!s.toLinkableDuplicates)&&this.isLinked(e,s))||null!==this.originalLink&&(null!==t&&this.isLabelDependentOnLink(t,this.originalLink)||null!==i&&this.isLabelDependentOnLink(i,this.originalLink))||null!==t&&null!==i&&(null===t.data&&null!==i.data||null!==t.data&&null===i.data)||!this.isValidCycle(t,i,this.originalLink))return!1;let n;return!(null!==t&&null!==e&&(n=t.linkValidation,null!==n&&!n(t,e,i,s,this.originalLink))||null!==i&&null!==s&&(n=i.linkValidation,null!==n&&!n(t,e,i,s,this.originalLink)))&&(n=this.linkValidation,null===n||n(t,e,i,s,this.originalLink))}isLabelDependentOnLink(t,e){if(null===t)return!1;const i=t.labeledLink;if(null===i)return!1;if(i===e)return!0;const s=new u;return s.add(t),this.VS(i,e,s)}VS(t,e,i){if(t===e)return!0;const s=t.fromNode;if(null!==s&&s.labeledLink&&(i.add(s),this.VS(s.labeledLink,e,i)))return!0;const n=t.toNode;return!(null===n||!n.labeledLink||(i.add(n),!this.VS(n.labeledLink,e,i)))}isValidCycle(t,e,i){if(void 0===i&&(i=null),null===t||null===e)return this.isUnconnectedLinkValid;const s=this.diagram;let n=1;if(s&&(n=s.model.Vm()?s.isTreePathToChildren?5:6:s.validCycle),1===n)return!0;if(5===n){const s=i||this.temporaryLink;if(null!==s&&!s.isTreeLink)return!0;const n=e.linksConnected;for(;n.next();){const t=n.value;if(t!==i&&t.isTreeLink&&t.toNode===e)return!1}return!this.Uu(t,e,i,!0)}if(6===n){const s=i||this.temporaryLink;if(null!==s&&!s.isTreeLink)return!0;const n=t.linksConnected;for(;n.next();){const e=n.value;if(e!==i&&e.isTreeLink&&e.fromNode===t)return!1}return!this.Uu(t,e,i,!0)}return 2===n?!this.yR(t,e,i):3===n?!this.Uu(t,e,i,!1):4!==n||!this.wR(t,e,i)}Uu(t,e,i,s){if(t===e)return!0;if(null===t||null===e)return!1;const n=t.linksConnected;for(;n.next();){const o=n.value;if(o===i||s&&!o.isTreeLink||o.toNode!==t)continue;const r=o.fromNode;if(r!==t&&null!==r&&this.Uu(r,e,i,s))return!0}return!1}yR(t,e,i){if(t===e)return!0;const s=new Set;return s.add(e),this.NA(s,t,e,i)}NA(t,e,i,s){if(e===i)return!0;if(null===e||null===i||t.has(e))return!1;t.add(e);const n=e.linksConnected;for(;n.next();){const o=n.value;if(o===s||o.toNode!==e)continue;const r=o.fromNode;if(r!==e&&null!==r&&this.NA(t,r,i,s))return!0}return!1}wR(t,e,i){if(t===e)return!0;const s=new Set;return s.add(e),this.CA(s,t,e,i)}CA(t,e,i,s){if(e===i)return!0;if(null===e||null===i||t.has(e))return!1;t.add(e);const n=e.linksConnected;for(;n.next();){const o=n.value;if(o===s)continue;const r=o.fromNode,a=o.toNode,h=r===e?a:r;if(h!==e&&null!==h&&this.CA(t,h,i,s))return!0}return!1}get linkValidation(){return this.El}set linkValidation(t){null!==t&&e.S(t,j,"linkValidation"),this.El=t}get portTargeted(){return this.US}set portTargeted(t){null!==t&&e.S(t,j,"portTargeted"),this.US=t}}var G=(t=>(t[t.Either=1]="Either",t[t.ForwardsOnly=2]="ForwardsOnly",t[t.BackwardsOnly=3]="BackwardsOnly",t))(G||{});class K extends j{BS;zS;P;XS;constructor(t){super(),this.name="Linking",this.BS={},this.zS=null,this.P=1,this.XS=null,t&&Object.assign(this,t)}static Either=1;static ForwardsOnly=2;static BackwardsOnly=3;get archetypeLinkData(){return this.BS}set archetypeLinkData(t){null!==t&&e.wc(t,K,"archetypeLinkData"),t instanceof At&&e.se(t,be,K,"archetypeLinkData"),this.BS=t}get archetypeLabelNodeData(){return this.zS}set archetypeLabelNodeData(t){null!==t&&e.wc(t,K,"archetypeLabelNodeData"),t instanceof At&&e.se(t,me,K,"archetypeLabelNodeData"),this.zS=t}get direction(){return this.P}set direction(t){this.P=t}get startObject(){return this.XS}set startObject(t){null!==t&&e.se(t,At,K,"startObject"),this.XS=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.Ax()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())&&null!==this.findLinkablePort()}findLinkablePort(){const t=this.diagram;let e=this.startObject;if(null===e&&(e=t.findObjectAt(t.firstInput.documentPoint,null,null)),null===e)return null;const i=e.part;if(!(i instanceof me))return null;const s=this.direction;if(1===s||2===s){const t=this.findValidLinkablePort(e,!1);if(null!==t)return this.isForwards=!0,t;if(this.startObject===i){const t=i.port;if(this.findValidLinkablePort(t,!1))return this.isForwards=!0,t}}if(1===s||3===s){const t=this.findValidLinkablePort(e,!0);if(null!==t)return this.isForwards=!1,t;if(this.startObject===i){const t=i.port;if(this.findValidLinkablePort(t,!0))return this.isForwards=!1,t}}return null}doActivate(){const t=this.diagram,e=this.findLinkablePort();if(null!==e){if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){null!==this.temporaryToNode&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=e;const i=this.originalFromPort.part;i instanceof me&&(this.originalFromNode=i),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{null!==this.temporaryFromNode&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=e;const i=this.originalToPort.part;i instanceof me&&(this.originalToNode=i),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),null!==this.temporaryLink&&(null!==this.temporaryFromNode&&(this.temporaryLink.fromNode=this.temporaryFromNode),null!==this.temporaryToNode&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0}else this.stopTool()}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let e=null,i=null,s=null,n=null,o=null;try{this.targetPort=this.findTargetPort(this.isForwards);const r=this.targetPort;if(null!==r){const t=r.part;t instanceof me&&(this.isForwards?(null!==this.originalFromNode&&(e=this.originalFromNode,i=this.originalFromPort),s=t,n=r):(e=t,i=r,null!==this.originalToNode&&(s=this.originalToNode,n=this.originalToPort)))}else this.isForwards?null!==this.originalFromNode&&this.isUnconnectedLinkValid&&(e=this.originalFromNode,i=this.originalFromPort):null!==this.originalToNode&&this.isUnconnectedLinkValid&&(s=this.originalToNode,n=this.originalToPort);null!==e||null!==s?(o=this.insertLink(e,i,s,n),null!==o?(null===r&&(this.isForwards?o.defaultToPoint=t.lastInput.documentPoint:o.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),o.isSelected=!0),this.transactionResult=this.name,t.T("LinkDrawn",o)):this.doNoLink(e,i,s,n)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),o&&t.allowSelect&&t.T("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(null===t)return!0;if(t instanceof be)return t.isTreeLink;const e=this.diagram;if(null===e)return!0;const i=e.partManager.getLinkCategoryForData(t),s=e.partManager.findLinkTemplateForCategory(i);return null===s||s.isTreeLink}insertLink(t,e,i,s){return this.diagram.partManager.insertLink(t,e,i,s)}doNoLink(t,e,i,s){}}class Y extends j{LA=null;AA=null;GS=null;YS=null;Ss;KS;constructor(t){super(),this.name="Relinking",this.fromHandleArchetype=new $t("Diamond",{desiredSize:x.Pu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new $t("Diamond",{desiredSize:x.Pu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.KS=new w,t&&Object.assign(this,t)}updateAdornments(t){if(null===t||!(t instanceof be))return;let e="RelinkFrom",i=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.selectionObject;null!==s&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(e),null===i&&(i=this.makeAdornment(s,!1),t.addAdornment(e,i)))}if(null===i&&t.removeAdornment(e),e="RelinkTo",i=null,t.isSelected&&!this.diagram.isReadOnly){const s=t.selectionObject;null!==s&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(e),null===i?(i=this.makeAdornment(s,!0),t.addAdornment(e,i)):i.f())}null===i&&t.removeAdornment(e)}makeAdornment(t,e){let i=e?this.YS:this.GS;return i&&(i=i.copy(),i.adornedObject=t),i}get fromHandleArchetype(){return this.LA}set fromHandleArchetype(t){null!==t&&e.se(t,At,Y,"fromHandleArchetype"),this.LA=t,this.GS=null!==t?new ge(Yt.Link).add(t).It():null}get toHandleArchetype(){return this.AA}set toHandleArchetype(t){null!==t&&e.se(t,At,Y,"toHandleArchetype"),this.AA=t,this.YS=null!==t?new ge(Yt.Link).add(t).It():null}get handle(){return this.Ss}set handle(t){null!==t&&(t.part instanceof ge||e.o("new handle is not in an Adornment: "+t)),this.Ss=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.Ax()||!t.lastInput.left)return!1;let e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return null===e&&(e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),null!==e}doActivate(){const t=this.diagram;if(null===this.originalLink){let e=this.handle;if(null===e&&(e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"),null===e&&(e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"))),null===e)return;const i=e.part;if(!(i instanceof ge&&i.adornedPart instanceof be))return;this.handle=e,this.isForwards=null===i||"RelinkTo"===i.category,this.originalLink=i.adornedPart}const e=this.originalLink;null!==e&&(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=e.fromPort,this.originalFromNode=e.fromNode,this.originalToPort=e.toPort,this.originalToNode=e.toNode,this.KS.set(e.actualBounds),e.pointsCount>0&&(null===e.fromNode&&(null!==this.temporaryFromPort&&(this.temporaryFromPort.desiredSize=x.xc),null!==this.temporaryFromNode&&(this.temporaryFromNode.location=e.getPoint(0))),null===e.toNode&&(null!==this.temporaryToPort&&(this.temporaryToPort.desiredSize=x.xc),null!==this.temporaryToNode&&(this.temporaryToNode.location=e.getPoint(e.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),null!==this.temporaryLink&&(null!==this.temporaryFromNode&&(this.temporaryLink.fromNode=this.temporaryFromNode),null!==this.temporaryToNode&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(e,this.temporaryLink),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0)}copyLinkProperties(t,e){if(null===t||null===e)return;e.adjusting=t.adjusting,e.corner=t.corner;let i=t.curve;(11===i||10===i)&&(i=0),e.curve=i,e.curviness=t.curviness,e.isTreeLink=t.isTreeLink,e.points=t.points,e.routing=t.routing,e.smoothness=t.smoothness,e.fromSpot=t.fromSpot,e.fromEndSegmentLength=t.fromEndSegmentLength,e.fromShortLength=t.fromShortLength,e.toSpot=t.toSpot,e.toEndSegmentLength=t.toEndSegmentLength,e.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let e=this.originalFromNode,i=this.originalFromPort,s=this.originalToNode,n=this.originalToPort,o=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),null!==this.targetPort){const t=this.targetPort.part;t instanceof me&&(this.isForwards?(s=t,n=this.targetPort):(e=t,i=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(s=null,n=null):(e=null,i=null):o=null;null!==o?(this.reconnectLink(o,this.isForwards?s:e,this.isForwards?n:i,this.isForwards),null===this.targetPort&&(this.isForwards?o.defaultToPoint=t.lastInput.documentPoint:o.defaultFromPoint=t.lastInput.documentPoint,o.$t()),this.transactionResult=this.name,t.T("LinkRelinked",o,this.isForwards?this.originalToPort:this.originalFromPort)):null!==this.originalLink&&this.doNoRelink(this.originalLink,this.isForwards),null!==this.originalLink&&this.originalLink.invalidateOtherJumpOvers(this.KS)}finally{this.stopTool()}}}reconnectLink(t,e,i,s){const n=null!==i&&null!==i.portId?i.portId:"";return s?(t.toNode=e,t.toPortId=n):(t.fromNode=e,t.fromPortId=n),!0}doNoRelink(t,e){}doDraggingMouseMove(t,e,i,s){null!==t?(this.copyPortProperties(t,e,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),null!==i?(this.copyPortProperties(i,s,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var q=(t=>(t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.All=3]="All",t))(q||{});class H extends I{Sr;HS;qS;Ss;Tx;jS;Bm;constructor(t){super(),this.name="LinkReshaping",this.Sr=new $t("Rectangle",{desiredSize:x.IL,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.HS=new $t("Diamond",{desiredSize:x.Pu,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.qS=3,this.Ss=null,this.Tx=null,this.jS=new y,this.Bm=new h,t&&Object.assign(this,t)}static None=0;static Horizontal=1;static Vertical=2;static All=3;getReshapingBehavior(t){return t?t.Mr:0}setReshapingBehavior(t,e){t.Mr=e}updateAdornments(t){if(null===t||!(t instanceof be))return;let e=null;if(t.isSelected&&!this.diagram.isReadOnly){const i=t.path;null!==i&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&(e=t.findAdornment(this.name),(null===e||e.WS!==t.pointsCount||e.JS!==t.resegmentable)&&(e=this.makeAdornment(i),null!==e&&(e.WS=t.pointsCount,e.JS=t.resegmentable,t.addAdornment(this.name,e))))}null===e&&t.removeAdornment(this.name)}makeAdornment(t){const e=t.part,i=e.points,s=e.pointsCount,n=e.isOrthogonal;let o=null;if(null!==i&&s>1){o=new ge,o.type=Yt.Link;const i=e.firstPickIndex,s=e.lastPickIndex,r=n?1:0;if(e.resegmentable&&(9!==e.computeCurve()||e.isOrthogonal))for(let e=i+r;e<s-r;e++){const i=this.makeResegmentHandle(t,e);null!==i&&(i.segmentIndex=e,i.segmentFraction=.5,i.fromMaxLinks=999,o.add(i))}let a=i+1,h=s-1;for(;a<=h;)if(a<h)this.$S(t,o,i,s,a),this.$S(t,o,i,s,h),a++,h--;else if(a===h){this.$S(t,o,i,s,a);break}o.adornedObject=t}return o}$S(t,e,i,s,n){const o=t.part,r=o.isOrthogonal,a=this.makeHandle(t,n);if(null!==a){if(a.segmentIndex=n,n!==i)if(n===i+1&&r){const t=o.getPoint(i);let e=o.getPoint(i+1);k.c(t.x,e.x)&&k.c(t.y,e.y)?(e=o.getPoint(i-1),k.c(t.x,e.x)?(this.setReshapingBehavior(a,2),a.cursor="n-resize"):k.c(t.y,e.y)&&(this.setReshapingBehavior(a,1),a.cursor="w-resize")):k.c(t.x,e.x)?(this.setReshapingBehavior(a,2),a.cursor="n-resize"):k.c(t.y,e.y)&&(this.setReshapingBehavior(a,1),a.cursor="w-resize")}else if(n===s-1&&r){let t=o.getPoint(s-1);const e=o.getPoint(s);k.c(t.x,e.x)&&k.c(t.y,e.y)?(t=o.getPoint(s+1),k.c(t.x,e.x)?(this.setReshapingBehavior(a,2),a.cursor="n-resize"):k.c(t.y,e.y)&&(this.setReshapingBehavior(a,1),a.cursor="w-resize")):k.c(t.x,e.x)?(this.setReshapingBehavior(a,2),a.cursor="n-resize"):k.c(t.y,e.y)&&(this.setReshapingBehavior(a,1),a.cursor="w-resize")}else n===s||(this.setReshapingBehavior(a,3),a.cursor="move");e.add(a)}}makeHandle(t,e){const i=this.handleArchetype;return null===i?null:i.copy().ZS()}get handleArchetype(){return this.Sr}set handleArchetype(t){null!==t&&e.se(t,At,H,"handleArchetype"),this.Sr=t}makeResegmentHandle(t,e){const i=this.midHandleArchetype;return null===i?null:i.copy().ZS()}get midHandleArchetype(){return this.HS}set midHandleArchetype(t){null!==t&&e.se(t,At,H,"midHandleArchetype"),this.HS=t}get handle(){return this.Ss}set handle(t){null!==t&&(t.part instanceof ge||e.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedLink(){return this.Tx}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(t.isReadOnly||!t.allowReshape||!t.lastInput.left)&&null!==this.findToolHandleAt(t.firstInput.documentPoint,this.name)}doActivate(){const t=this.diagram;if(null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null===this.handle)return;const e=this.handle.part.adornedPart;if(e instanceof be){if(this.Tx=e,t.isMouseCaptured=!0,this.startTransaction(this.name),e.resegmentable&&999===this.handle.fromMaxLinks){const i=e.points.copy(),s=this.getResegmentingPoint();if(i.insertAt(this.handle.segmentIndex+1,s),e.isOrthogonal&&i.insertAt(this.handle.segmentIndex+1,s),e.points=i,e.invalidateAdornments(),e.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),null===this.handle)return void this.doDeactivate()}this.jS=e.getPoint(this.handle.segmentIndex),this.Bm=e.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Tx=null;this.diagram.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){const t=this.adornedLink;null!==t&&(t.points=this.Bm),this.stopTool()}getResegmentingPoint(){return null===this.handle?this.diagram.lastInput.documentPoint:this.handle.getDocumentPoint(v.Center)}doMouseMove(){const t=this.diagram;if(this.isActive){const e=this.computeReshape(t.lastInput.documentPoint);this.reshape(e)}}doMouseUp(){const t=this.diagram;if(this.isActive){const e=this.computeReshape(t.lastInput.documentPoint);this.reshape(e);const i=this.adornedLink;if(null!==i&&i.resegmentable&&null!==this.handle&&(9!==i.computeCurve()||i.isOrthogonal)){const t=this.handle.segmentIndex,e=i.getPoint(t-1),s=i.getPoint(t),n=i.getPoint(t+1);if(i.isOrthogonal){if(t>i.firstPickIndex+1&&t<i.lastPickIndex-1){let o=i.getPoint(t-2);if(this.isWithinResegmentingDistance(e,s)&&(this.isInLineOrtho(o,e,s,n,!0)||this.isInLineOrtho(o,e,s,n,!1))){const r=i.points.copy();this.isInLineOrtho(o,e,s,n,!0)?(r.setElt(t-2,new y(o.x,(n.y+o.y)/2)),r.setElt(t+1,new y(n.x,(n.y+o.y)/2))):(r.setElt(t-2,new y((n.x+o.x)/2,o.y)),r.setElt(t+1,new y((n.x+o.x)/2,n.y))),r.removeAt(t),r.removeAt(t-1),i.points=r,i.invalidateAdornments()}else if(o=i.getPoint(t+2),this.isWithinResegmentingDistance(s,n)&&(this.isInLineOrtho(e,s,n,o,!0)||this.isInLineOrtho(e,s,n,o,!1))){const r=i.points.copy();this.isInLineOrtho(e,s,n,o,!0)?(r.setElt(t-1,new y(e.x,(e.y+o.y)/2)),r.setElt(t+2,new y(o.x,(e.y+o.y)/2))):(r.setElt(t-1,new y((e.x+o.x)/2,e.y)),r.setElt(t+2,new y((e.x+o.x)/2,o.y))),r.removeAt(t+1),r.removeAt(t),i.points=r,i.invalidateAdornments()}}}else{const o=y.l();if(k.Nl(e.x,e.y,n.x,n.y,s.x,s.y,o)&&o.distanceSquaredPoint(s)<this.resegmentingDistance*this.resegmentingDistance){const e=i.points.copy();e.removeAt(t),i.points=e,i.invalidateAdornments()}y.i(o)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("LinkReshaped",this.adornedLink,this.Bm)}this.stopTool()}isWithinResegmentingDistance(t,e){return Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(t.y-e.y)<this.resegmentingDistance}isInLineOrtho(t,e,i,s,n){return n?Math.abs(t.y-e.y)<this.resegmentingDistance&&Math.abs(e.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance:Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(e.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance}get resegmentingDistance(){return this.qS}set resegmentingDistance(t){e.s(t,"number",H,"resegmentingDistance"),this.qS=t}reshape(t){const e=this.adornedLink;if(null===e)return;const i=this.handle;if(null===i)return;e.startRoute();let s=i.segmentIndex;const n=this.getReshapingBehavior(i);if(e.isOrthogonal)if(s===e.firstPickIndex+1){const i=e.firstPickIndex+1;2===n?(e.setPointAt(i,e.getPoint(i-1).x,t.y),e.setPointAt(i+1,e.getPoint(i+2).x,t.y)):1===n&&(e.setPointAt(i,t.x,e.getPoint(i-1).y),e.setPointAt(i+1,t.x,e.getPoint(i+2).y))}else if(s===e.lastPickIndex-1){const i=e.lastPickIndex-1;2===n?(e.setPointAt(i-1,e.getPoint(i-2).x,t.y),e.setPointAt(i,e.getPoint(i+1).x,t.y)):1===n&&(e.setPointAt(i-1,t.x,e.getPoint(i-2).y),e.setPointAt(i,t.x,e.getPoint(i+1).y))}else{let i=s;const n=e.getPoint(i);if(!t.equalsApprox(n)){const o=e.getPoint(i-2),r=e.getPoint(i-1),a=e.getPoint(i+1),h=e.getPoint(i+2);k.c(r.x,n.x)&&k.c(n.y,a.y)?(!k.c(r.x,o.x)||k.c(r.y,o.y)||k.c(t.x,n.x)?e.setPointAt(i-1,t.x,r.y):(e.insertPointAt(i,t.x,r.y),s++,i++),!k.c(a.y,h.y)||k.c(a.x,h.x)||k.c(t.y,n.y)?e.setPointAt(i+1,a.x,t.y):e.insertPointAt(i+1,a.x,t.y)):k.c(r.y,n.y)&&k.c(n.x,a.x)?(!k.c(r.y,o.y)||k.c(r.x,o.x)||k.c(t.y,n.y)?e.setPointAt(i-1,r.x,t.y):(e.insertPointAt(i,r.x,t.y),s++,i++),!k.c(a.x,h.x)||k.c(a.y,h.y)||k.c(t.x,n.x)?e.setPointAt(i+1,t.x,a.y):e.insertPointAt(i+1,t.x,a.y)):k.c(r.x,n.x)&&k.c(n.x,a.x)?(!k.c(r.x,o.x)||k.c(r.y,o.y)||k.c(t.x,n.x)?e.setPointAt(i-1,t.x,r.y):(e.insertPointAt(i,t.x,r.y),s++,i++),!k.c(a.x,h.x)||k.c(a.y,h.y)||k.c(t.x,n.x)?e.setPointAt(i+1,t.x,a.y):e.insertPointAt(i+1,t.x,a.y)):k.c(r.y,n.y)&&k.c(n.y,a.y)&&(!k.c(r.y,o.y)||k.c(r.x,o.x)||k.c(t.y,n.y)?e.setPointAt(i-1,r.x,t.y):(e.insertPointAt(i,r.x,t.y),s++,i++),!k.c(a.y,h.y)||k.c(a.x,h.x)||k.c(t.y,n.y)?e.setPointAt(i+1,a.x,t.y):e.insertPointAt(i+1,a.x,t.y)),e.setPointAt(s,t.x,t.y)}}else{e.setPointAt(s,t.x,t.y);let i=e.fromNode,n=e.fromPort;if(null!==i){const t=i.findVisibleNode();null!==t&&t!==i&&(i=t,n=i.port)}if(1===s&&null!==n&&e.computeSpot(!0,n).isNoSpot()){const s=n.getDocumentPoint(v.Center,y.l()),o=e.getLinkPointFromPoint(i,n,s,t,!0,y.l());e.setPointAt(0,o.x,o.y),y.i(s),y.i(o)}let o=e.toNode,r=e.toPort;if(null!==o){const t=o.findVisibleNode();null!==t&&t!==o&&(o=t,r=o.port)}if(s===e.pointsCount-2&&null!==r&&e.computeSpot(!1,r).isNoSpot()){const i=r.getDocumentPoint(v.Center,y.l()),s=e.getLinkPointFromPoint(o,r,i,t,!1,y.l());e.setPointAt(e.pointsCount-1,s.x,s.y),y.i(i),y.i(s)}}e.commitRoute()}computeReshape(t){const e=this.adornedLink;if(null===e)return t;const i=this.handle;if(null===i)return t;const s=i.segmentIndex;switch(this.getReshapingBehavior(i)){case 3:return t;case 2:{const i=e.getPoint(s);return new y(i.x,t.y)}case 1:{const i=e.getPoint(s);return new y(t.x,i.y)}default:return e.getPoint(s)}}get originalPoint(){return this.jS}get originalPoints(){return this.Bm}}class W extends I{Nr;Cr;Ro;Rc;QS;Ms;Sr;Ss;zm;_S;Oc;Dx;vx;Fx;constructor(t){super(),this.name="Resizing",this.Nr=new x(1,1).k(),this.Cr=new x(9999,9999).k(),this.Ro=new x(NaN,NaN).k(),this.Rc=!1,this.QS=!0,this.Ms=null,this.Sr=new $t("Rectangle",{alignmentFocus:v.Center,desiredSize:x.IL,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.zm=new y,this._S=new x,this.Oc=new y,this.Dx=new x(0,0),this.vx=new x(1/0,1/0),this.Fx=new x(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(null!==t){if(t.Lr()){const e=t.rotateObject;if(e===t||e===t.path||e.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const e=t.resizeObject;let i=t.findAdornment(this.name);if(null!==e&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()&&((null===i||i.adornedObject!==e)&&(i=this.makeAdornment(e)),null!==i)){const s=e.getDocumentAngle();return t.Ul()&&this.updateResizeHandles(i,s),void t.addAdornment(this.name,i)}}t.removeAdornment(this.name)}}makeAdornment(t){let e=null;const i=t.part?.resizeAdornmentTemplate;if(i){if(e=i.copy(),null===e)return null}else{e=new ge,e.type=Yt.Spot,e.locationSpot=v.Center;const i=new Te;i.isPanelMain=!0,e.add(i);let s=this.makeHandle(t,v.TopLeft);null!==s&&e.add(s),s=this.makeHandle(t,v.TopRight),null!==s&&e.add(s),s=this.makeHandle(t,v.BottomRight),null!==s&&e.add(s),s=this.makeHandle(t,v.BottomLeft),null!==s&&e.add(s),s=this.makeHandle(t,v.MiddleTop),null!==s&&e.add(s),s=this.makeHandle(t,v.MiddleRight),null!==s&&e.add(s),s=this.makeHandle(t,v.MiddleBottom),null!==s&&e.add(s),s=this.makeHandle(t,v.MiddleLeft),null!==s&&e.add(s)}return e.adornedObject=t,e}makeHandle(t,e){const i=this.handleArchetype;if(null===i)return null;const s=i.copy().ZS();return s.alignment=e,s}updateResizeHandles(t,e){if(null!==t)if(!t.alignment.isDefault()&&("pointer"===t.cursor||t.cursor.indexOf("resize")>0))this.xR(t,e);else if(t instanceof Yt){const i=t.elements;for(;i.next();){const t=i.value;this.updateResizeHandles(t,e)}}}xR(t,e){let i=t.alignment;i.isNoSpot()&&(i=v.Center);let s=e;if(i.x<=0)i.y<=0?s+=225:i.y>=1?s+=135:s+=180;else if(i.x>=1)i.y<=0?s+=315:i.y>=1&&(s+=45);else if(i.y<=0)s+=270;else{if(!(i.y>=1))return;s+=90}s=k.Ee(s),t.cursor=s<22.5?"e-resize":s<67.5?"se-resize":s<112.5?"s-resize":s<157.5?"sw-resize":s<202.5?"w-resize":s<247.5?"nw-resize":s<292.5?"n-resize":s<337.5?"ne-resize":"e-resize"}get handleArchetype(){return this.Sr}set handleArchetype(t){null!==t&&e.se(t,At,W,"handleArchetype"),this.Sr=t}get handle(){return this.Ss}set handle(t){null!==t&&(t.part instanceof ge||e.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedObject(){return this.Ms}set adornedObject(t){null!==t&&t.part instanceof ge&&e.o("new handle must not be in an Adornment: "+t),this.Ms=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(t.isReadOnly||!t.allowResize||!t.lastInput.left)&&null!==this.findToolHandleAt(t.firstInput.documentPoint,this.name)}doActivate(){const t=this.diagram;null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null!==this.handle&&(this.adornedObject=this.handle.part.adornedObject,null!==this.adornedObject&&null!==this.adornedObject.part&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.Ou=!0,this.startTransaction(this.name),this.zm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.Oc.set(this.adornedObject.part.location),this._S.set(this.adornedObject.desiredSize),this.Fx=this.computeCellSize(),this.Dx=this.computeMinSize(),this.vx=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const t=this.diagram;t.Ou=!1,t.Fl=!0,this.stopTransaction(),this.handle=null,this.Ms=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){null!==this.adornedObject&&null!==this.adornedObject.part&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const t=this.diagram;if(!this.isActive||null===this.adornedObject||null===this.handle)return;const e=this.Dx,i=this.vx,s=this.Fx,n=t.lastInput.documentPoint,o=this.adornedObject.getLocalPoint(n,y.l()),r=this.computeReshape(),a=this.computeResize(o,this.handle.alignment,e,i,s,r);this.resize(a),t.maybeUpdate(),y.i(o)}doMouseUp(){const t=this.diagram;if(this.isActive&&null!==this.adornedObject&&null!==this.handle){const e=this.Dx,i=this.vx,s=this.Fx,n=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,y.l()),o=this.computeReshape(),r=this.computeResize(n,this.handle.alignment,e,i,s,o);this.resize(r),y.i(n),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){const e=this.diagram,i=this.adornedObject;if(null===i)return;i.desiredSize=t.size;const s=i.part;if(null===s||null===this.handle)return;s.ensureBounds();const n=i.getDocumentPoint(this.handle.alignment.opposite());if(s instanceof Ne){const t=new h;let i;t.add(s),!this.dragsMembers&&!s.hasPlaceholder()&&(i=new kt,i.dragsMembers=!1),e.moveParts(t,this.oppositePoint.copy().subtract(n),!0,i)}else s.location=s.location.copy().subtract(n).add(this.oppositePoint);e.maybeUpdate()}computeResize(t,e,i,s,n,o){if(null===this.adornedObject)return w.em;e.isNoSpot()&&(e=v.Center);const r=this.adornedObject.naturalBounds,a=r.x,h=r.y,l=r.x+r.width,u=r.y+r.height;let c=1;if(!o){let t=r.width,e=r.height;t<=0&&(t=1),e<=0&&(e=1),c=e/t}const d=y.l();k.tm(t.x,t.y,a,h,n.width,n.height,d);const g=r.copy();return e.x<=0?e.y<=0?(g.x=Math.max(d.x,l-s.width),g.x=Math.min(g.x,l-i.width),g.width=Math.max(l-g.x,i.width),g.y=Math.max(d.y,u-s.height),g.y=Math.min(g.y,u-i.height),g.height=Math.max(u-g.y,i.height),o||(g.height/g.width>=1?(g.height=Math.max(Math.min(c*g.width,s.height),i.height),g.width=g.height/c):(g.width=Math.max(Math.min(g.height/c,s.width),i.width),g.height=c*g.width),g.x=l-g.width,g.y=u-g.height)):e.y>=1?(g.x=Math.max(d.x,l-s.width),g.x=Math.min(g.x,l-i.width),g.width=Math.max(l-g.x,i.width),g.height=Math.max(Math.min(d.y-h,s.height),i.height),o||(g.height/g.width>=1?(g.height=Math.max(Math.min(c*g.width,s.height),i.height),g.width=g.height/c):(g.width=Math.max(Math.min(g.height/c,s.width),i.width),g.height=c*g.width),g.x=l-g.width)):(g.x=Math.max(d.x,l-s.width),g.x=Math.min(g.x,l-i.width),g.width=l-g.x,o||(g.height=Math.max(Math.min(c*g.width,s.height),i.height),g.width=g.height/c,g.y=h+.5*(u-h-g.height))):e.x>=1?e.y<=0?(g.width=Math.max(Math.min(d.x-a,s.width),i.width),g.y=Math.max(d.y,u-s.height),g.y=Math.min(g.y,u-i.height),g.height=Math.max(u-g.y,i.height),o||(g.height/g.width>=1?(g.height=Math.max(Math.min(c*g.width,s.height),i.height),g.width=g.height/c):(g.width=Math.max(Math.min(g.height/c,s.width),i.width),g.height=c*g.width),g.y=u-g.height)):e.y>=1?(g.width=Math.max(Math.min(d.x-a,s.width),i.width),g.height=Math.max(Math.min(d.y-h,s.height),i.height),o||(g.height/g.width>=1?(g.height=Math.max(Math.min(c*g.width,s.height),i.height),g.width=g.height/c):(g.width=Math.max(Math.min(g.height/c,s.width),i.width),g.height=c*g.width))):(g.width=Math.max(Math.min(d.x-a,s.width),i.width),o||(g.height=Math.max(Math.min(c*g.width,s.height),i.height),g.width=g.height/c,g.y=h+.5*(u-h-g.height))):e.y<=0?(g.y=Math.max(d.y,u-s.height),g.y=Math.min(g.y,u-i.height),g.height=u-g.y,o||(g.width=Math.max(Math.min(g.height/c,s.width),i.width),g.height=c*g.width,g.x=a+.5*(l-a-g.width))):e.y>=1&&(g.height=Math.max(Math.min(d.y-h,s.height),i.height),o||(g.width=Math.max(Math.min(g.height/c,s.width),i.width),g.height=c*g.width,g.x=a+.5*(l-a-g.width))),y.i(d),g}computeReshape(){let t=0;return this.adornedObject instanceof $t&&(t=this.adornedObject.tM()),!(6===t||this.diagram.lastInput.shift)}computeMinSize(){if(null===this.adornedObject)return x.xc;const t=this.adornedObject.minSize.copy(),e=this.minSize;return!isNaN(e.width)&&e.width>t.width&&(t.width=e.width),!isNaN(e.height)&&e.height>t.height&&(t.height=e.height),t}computeMaxSize(){if(null===this.adornedObject)return x.DP;const t=this.adornedObject.maxSize.copy(),e=this.maxSize;return!isNaN(e.width)&&e.width<t.width&&(t.width=e.width),!isNaN(e.height)&&e.height<t.height&&(t.height=e.height),t}computeCellSize(){const t=new x(NaN,NaN),e=this.adornedObject?.part;if(e){const i=e.resizeCellSize;!isNaN(i.width)&&i.width>0&&(t.width=i.width),!isNaN(i.height)&&i.height>0&&(t.height=i.height)}let i=this.cellSize;isNaN(t.width)&&!isNaN(i.width)&&i.width>0&&(t.width=i.width),isNaN(t.height)&&!isNaN(i.height)&&i.height>0&&(t.height=i.height);const s=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&s){const e=s.grid;null!==e&&e.visible&&this.isGridSnapEnabled&&(i=e.gridCellSize,isNaN(t.width)&&!isNaN(i.width)&&i.width>0&&(t.width=i.width),isNaN(t.height)&&!isNaN(i.height)&&i.height>0&&(t.height=i.height))}return(isNaN(t.width)||0===t.width||t.width===1/0)&&(t.width=1),(isNaN(t.height)||0===t.height||t.height===1/0)&&(t.height=1),t}get minSize(){return this.Nr}set minSize(t){if(!this.Nr.equals(t)){let e=t.width;isNaN(e)&&(e=0);let i=t.height;isNaN(i)&&(i=0),this.Nr.e(e,i)}}get maxSize(){return this.Cr}set maxSize(t){if(!this.Cr.equals(t)){let e=t.width;isNaN(e)&&(e=1/0);let i=t.height;isNaN(i)&&(i=1/0),this.Cr.e(e,i)}}get cellSize(){return this.Ro}set cellSize(t){this.Ro.equals(t)||this.Ro.h(t)}get isGridSnapEnabled(){return this.Rc}set isGridSnapEnabled(t){e.s(t,"boolean",W,"isGridSnapEnabled"),this.Rc=t}get dragsMembers(){return this.QS}set dragsMembers(t){e.s(t,"boolean",W,"dragsMembers"),this.QS=t}get oppositePoint(){return this.zm}set oppositePoint(t){this.zm.equals(t)||this.zm.h(t)}get originalDesiredSize(){return this._S}get originalLocation(){return this.Oc}}class _ extends I{eM;iM;Ms=null;Sr=null;Rx=null;Ss=null;sM;Xm;Oc;nM;oM;constructor(t){super(),this.name="Rotating",this.eM=45,this.iM=2,this.Oc=new y,this.Ms=null,this.handleArchetype=new $t("Ellipse",{desiredSize:x.Pu,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.sM=0,this.Xm=new y(NaN,NaN),this.nM=0,this.oM=50,t&&Object.assign(this,t)}updateAdornments(t){if(null!==t){if(t.Lr()){const e=t.rotateObject;if(e===t||e===t.path||e.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const e=t.rotateObject;if(null!==e&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()){let i=t.findAdornment(this.name);if((null===i||i.adornedObject!==e)&&(i=this.makeAdornment(e)),null!==i)return i.angle=e.getDocumentAngle(),i.hasPlaceholder()||(i.location=this.computeAdornmentLocation(e)),void t.addAdornment(this.name,i)}}t.removeAdornment(this.name)}}makeAdornment(t){let e=null;const i=t.part?.rotateAdornmentTemplate;return i?e=i.copy():null!==this.Rx&&(e=this.Rx.copy()),null===e?null:(e.adornedObject=t,e)}get handleArchetype(){return this.Sr}set handleArchetype(t){null!==t&&e.se(t,At,_,"handleArchetype"),this.Sr=t,this.Rx=null!==t?new ge(Yt.Position,{locationSpot:v.Center}).add(t).It():null}get handle(){return this.Ss}set handle(t){null!==t&&(t.part instanceof ge||e.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedObject(){return this.Ms}set adornedObject(t){null!==t&&t.part instanceof ge&&e.o("new handle must not be in an Adornment: "+t),this.Ms=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(t.isReadOnly||!t.allowRotate||!t.lastInput.left)&&null!==this.findToolHandleAt(t.firstInput.documentPoint,this.name)}doActivate(){const t=this.diagram;if(null===this.adornedObject){if(null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null===this.handle)return;this.adornedObject=this.handle.part.adornedObject}null===this.adornedObject||null===this.adornedObject.part||(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.sM=this.adornedObject.angle,this.Xm=this.computeRotationPoint(this.adornedObject),this.Oc=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){const e=t.part;if(null!==e){const i=e.locationObject;if(e.rotationSpot.isSpot())return t.getDocumentPoint(e.rotationSpot);if(t===e||t===i)return i.getDocumentPoint(e.locationSpot)}return t.getDocumentPoint(v.Center)}computeAdornmentLocation(t){let e=this.rotationPoint;e.isReal()||(e=this.computeRotationPoint(t));const i=t.getLocalPoint(e);let s=this.handleAngle;s=k.Ee(s),s=Math.round(45*Math.round(s/45));const n=this.handleDistance;return 0===s?i.x=t.naturalBounds.width+n:45===s?(i.x=t.naturalBounds.width+n,i.y=t.naturalBounds.height+n):90===s?i.y=t.naturalBounds.height+n:135===s?(i.x=-n,i.y=t.naturalBounds.height+n):180===s?i.x=-n:225===s?(i.x=-n,i.y=-n):270===s?i.y=-n:315===s&&(i.x=t.naturalBounds.width+n,i.y=-n),t.getDocumentPoint(i)}doDeactivate(){const t=this.diagram;this.stopTransaction(),this.handle=null,this.Ms=null,this.Xm=new y(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){this.diagram.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){const t=this.diagram;if(this.isActive){const e=this.computeRotate(t.lastInput.documentPoint);this.rotate(e)}}doMouseUp(){const t=this.diagram;if(this.isActive){t.delaysLayout=!1;const e=this.computeRotate(t.lastInput.documentPoint);this.rotate(e),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){const e=this.adornedObject;if(null===e||null===e.part)return;e.angle=t;const i=e.part;i.ensureBounds();const s=i.locationObject,n=i.rotateObject;if(s===n||s.isContainedBy(n)){const e=this.Oc.copy();i.location=e.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(t){let e=this.rotationPoint.directionPoint(t)-this.handleAngle;const i=this.adornedObject?.panel;i&&(e-=i.getDocumentAngle()),e=k.Ee(e);const s=Math.min(Math.abs(this.snapAngleMultiple),180),n=Math.min(Math.abs(this.snapAngleEpsilon),s/2);return!this.diagram.lastInput.shift&&s>0&&n>0&&(e%s<n?e=Math.floor(e/s)*s:e%s>s-n&&(e=(Math.floor(e/s)+1)*s)),k.Ee(e)}get snapAngleMultiple(){return this.eM}set snapAngleMultiple(t){e.s(t,"number",_,"snapAngleMultiple"),this.eM=t}get snapAngleEpsilon(){return this.iM}set snapAngleEpsilon(t){e.s(t,"number",_,"snapAngleEpsilon"),this.iM=t}get originalAngle(){return this.sM}get rotationPoint(){return this.Xm}set rotationPoint(t){this.Xm=t.copy()}get handleAngle(){return this.nM}set handleAngle(t){e.s(t,"number",_,"handleAngle"),this.nM=t}get handleDistance(){return this.oM}set handleDistance(t){e.s(t,"number",_,"handleDistance"),this.oM=t}}class J extends I{constructor(t){super(),this.name="ClickSelecting",t&&Object.assign(this,t)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class $ extends I{Ic;constructor(t){super(),this.name="Action",this.Ic=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram,e=t.lastInput,i=t.findObjectAt(e.documentPoint,(t=>{for(;null!==t.panel;){if(t.isActionable)return t;t=t.panel}return t}));return!(null===i||!i.isActionable)&&(this.Ic=i,t.Dc=t.findObjectAt(e.documentPoint,null,null),!0)}doMouseDown(){if(this.isActive){const t=this.diagram.lastInput,e=this.Ic;if(null===e)return;t.targetObject=e,null!==e.actionDown&&e.actionDown(t,e)}else this.canStart()&&this.doActivate()}doMouseMove(){if(this.isActive){const t=this.diagram.lastInput,e=this.Ic;if(null===e)return;t.targetObject=e,null!==e.actionMove&&e.actionMove(t,e)}}doMouseUp(){if(this.isActive){const t=this.diagram.lastInput,e=this.Ic;if(null===e)return;t.targetObject=e,null!==e.actionUp&&e.actionUp(t,e),this.standardMouseClick((t=>{for(;null!==t.panel;){if(t.isActionable&&t===e)return t;t=t.panel}return t}),(t=>t===e))}this.stopTool()}doCancel(){const t=this.diagram.lastInput,e=this.Ic;null!==e&&(t.targetObject=e,null!==e.actionCancel&&e.actionCancel(t,e),this.stopTool())}doStop(){this.Ic=null}}class Z extends I{Vl;rM;Rc;lM;constructor(t){super(),this.name="ClickCreating",this.Vl=null,this.rM=!0,this.Rc=!1,this.lM=new y(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||null===this.archetypeNodeData)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(1===t.lastInput.clickCount&&(this.lM=t.lastInput.viewPoint.copy()),2!==t.lastInput.clickCount||this.isBeyondDragSize(this.lM))return!1}else if(1!==t.lastInput.clickCount)return!1;return!(t.currentTool!==this&&null!==t.findPartAt(t.lastInput.documentPoint,!0))}doMouseUp(){const t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){const e=this.diagram,i=this.archetypeNodeData;if(null===i)return null;let s=null;try{if(e.T("ChangingSelection",e.selection),this.startTransaction(this.name),i instanceof ce)i.Di()&&(i.It(),s=i.copy(),null!==s&&e.add(s));else if(null!==i){const t=e.model.copyNodeData(i);e.model.addNodeData(t),s=e.findPartForData(t)}if(null!==s){const i=y.z(t.x,t.y);this.isGridSnapEnabled&&this.diagram.aM(s,t,i),s.location=i,e.allowSelect&&(e.clearSelection(!0),s.isSelected=!0),y.i(i)}e.invalidateDocumentBounds(),this.transactionResult=this.name,e.T("PartCreated",s)}finally{this.stopTransaction(),e.T("ChangedSelection",e.selection)}return s}get archetypeNodeData(){return this.Vl}set archetypeNodeData(t){null!==t&&e.wc(t,Z,"archetypeNodeData"),this.Vl=t}get isDoubleClick(){return this.rM}set isDoubleClick(t){e.s(t,"boolean",Z,"isDoubleClick"),this.rM=t}get isGridSnapEnabled(){return this.Rc}set isGridSnapEnabled(t){e.s(t,"boolean",Z,"isGridSnapEnabled"),this.Rc=t}}class Q extends I{th;hM;Bl;constructor(t){super(),this.name="DragSelecting",this.th=175,this.hM=!1,this.Bl=new ce({layerName:"Tool",selectable:!1}).add(new $t("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).It(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(!t.allowSelect)return!1;const e=t.lastInput;return!(!e.left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.timestamp-t.firstInput.timestamp<this.delay||null!==t.findPartAt(e.documentPoint,!0)))}doActivate(){const t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,this.box&&t.add(this.box),this.doMouseMove()}doDeactivate(){const t=this.diagram;t.stopAutoScroll(),this.box&&t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const t=this.diagram;if(this.isActive&&null!==this.box){const e=this.computeBoxBounds();let i=this.box.findObject("SHAPE");null===i&&(i=this.box.findMainElement());const s=x.l().e(e.width,e.height);null!==i&&(i.desiredSize=s),this.box.Ec(e.x,e.y,!1),x.i(s),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const t=this.diagram;this.box&&t.remove(this.box);try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.T("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){const t=this.diagram;return new w(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){const i=this.diagram,s=i.lastInput,n=i.findPartsIn(t,this.isPartialInclusion);if(e.fr?s.meta:s.control)if(s.shift){const t=n.iterator;for(;t.next();){const e=t.value;e.isSelected&&(e.isSelected=!1)}}else{const t=n.iterator;for(;t.next();){const e=t.value;e.isSelected=!e.isSelected}}else if(s.shift){const t=n.iterator;for(;t.next();){const e=t.value;e.isSelected||(e.isSelected=!0)}}else{const t=new h,e=i.selection.iterator;for(;e.next();){const i=e.value;n.has(i)||t.add(i)}const s=t.iterator;for(;s.next();){s.value.isSelected=!1}const o=n.iterator;for(;o.next();){const t=o.value;t.isSelected||(t.isSelected=!0)}}}get delay(){return this.th}set delay(t){e.s(t,"number",Q,"delay"),this.th=t}get isPartialInclusion(){return this.hM}set isPartialInclusion(t){e.s(t,"boolean",Q,"isPartialInclusion"),this.hM=t}get box(){return this.Bl}set box(t){null!==t&&t.It(),this.Bl=t}}class tt extends I{Ox;TA;Fo;cM;constructor(e){super(),this.name="Panning",this.Ox=new y,this.TA=new y,this.Fo=!1;const i=this;this.cM=()=>{const e=i.diagram;null!==e&&e.Le(t.document,"scroll",i.cM,!1),i.stopTool()},e&&Object.assign(this,e)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const e=this.diagram;this.Fo?(e.lastInput.bubbles=!0,e.Et(t.document,"scroll",this.cM,!1)):(e.currentCursor="move",e.isMouseCaptured=!0,this.Ox.h(e.position)),this.isActive=!0}doDeactivate(){const t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){const t=this.diagram;t.position=this.Ox,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.DA()}doMouseUp(){this.DA(),this.stopTool()}DA(){const t=this.diagram;if(this.isActive&&t){if(this.Fo)return void(t.lastInput.bubbles=!0);const e=t.position,i=t.firstInput.documentPoint,s=t.lastInput.documentPoint;let n=e.x+i.x-s.x,o=e.y+i.y-s.y;t.allowHorizontalScroll||(n=e.x),t.allowVerticalScroll||(o=e.y),t.position=this.TA.e(n,o)}}get bubbles(){return this.Fo}set bubbles(t){e.s(t,"boolean",tt,"bubbles"),this.Fo=t}get originalPosition(){return this.Ox}}class et{Ix;Ex;fM;uM;constructor(t){this.Ix=null,this.Ex=null,this.fM=null,this.uM=null,t&&Object.assign(this,t)}get mainElement(){return this.fM}set mainElement(t){null!==t&&e.se(t,HTMLElement,et,"mainElement"),this.fM=t}get show(){return this.Ix}set show(t){this.Ix!==t&&(null!==t&&e.S(t,et,"show"),this.Ix=t)}get hide(){return this.Ex}set hide(t){this.Ex!==t&&(null!==t&&e.S(t,et,"hide"),this.Ex=t)}get valueFunction(){return this.uM}set valueFunction(t){this.uM=t}}class it{ue;Ux;Uc;constructor(t,e,i){this.ue=t,this.Ux=e,this.Uc=i}}class st extends I{dM;Vx;gM;mM;Bx;zx;Gm;constructor(t){super(),this.name="ContextMenu",this.dM=null,this.Vx=null,this.gM=null,this.mM=new y,this.Bx=null,this.Gm=!1;const e=this;this.zx=()=>e.stopTool(),t&&Object.assign(this,t)}bR(){const i=new et;i.show=(t,e,i)=>i.showDefaultContextMenu(),i.hide=(t,e)=>e.hideDefaultContextMenu(),st.Vu=i;const s=this;this.zx=()=>s.stopTool();const n=e.Ni("div"),o=e.Ni("div");n.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",o.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const r=e.Ni("style");t.document.getElementsByTagName("head")[0].appendChild(r),r.sheet.insertRule(".goCXul { list-style: none; }",0),r.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),r.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const a=this.diagram;null!==a&&(a.Et(n,"contextmenu",st.oh,!1),a.Et(n,"selectstart",st.oh,!1),a.Et(o,"contextmenu",st.oh,!1)),n.className="goCXforeground",o.className="goCXbackground",t.document.body&&(t.document.body.appendChild(n),t.document.body.appendChild(o)),st.Ym=n,st.Km=o,st.pM=!0}static Vu=null;static pM=!1;static Km;static Ym;static oh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1)&&!!(t.lastInput.isTouchEvent&&null!==this.defaultTouchContextMenu||null!==this.findObjectWithContextMenu())}doStart(){const t=this.diagram;this.mM.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.Gm=!1}findObjectWithContextMenu(t){void 0===t&&(t=null);const e=this.diagram,i=e.lastInput;let s=null;if(t instanceof wt||(s=t instanceof At?t:e.findObjectAt(i.documentPoint,null,(t=>!t.layer?.isTemporary))),null!==s){let t=s;for(;null!==t;){if(null!==t.contextMenu)return t;t=t.panel}if(e.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return s.part}else if(null!==e.contextMenu)return e;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof ge){const t=this.diagram.toolManager.findTool("Action");null!==t&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof ge){const t=this.diagram.toolManager.findTool("Action");null!==t&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(this.isActive){const e=this.currentContextMenu;if(null===e)return;let i=null;e instanceof et||(i=t.findObjectAt(t.lastInput.documentPoint,null,null),null!==i&&i.isContainedBy(e)&&this.standardMouseClick(null,null)),this.maybeStopTool(i)}else this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool())}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,e){if(void 0===e&&(e=null),this.Gm)return;this.Gm=!0;let i=!1;if(e instanceof wt){const t=this.diagram.lastInput;t.targetObject=null,i=this.lA(null,t,this.diagram)}else t&&this.standardMouseSelect(),i=this.standardMouseClick();if(this.Gm=!1,!i){this.isActive=!0;const t=st.Vu;if(null===e&&(e=this.findObjectWithContextMenu()),null!==e){const i=e.contextMenu;null!==i?(this.currentObject=e instanceof At?e:null,this.showContextMenu(i,this.currentObject)):null!==t&&this.showContextMenu(t,this.currentObject)}else null!==t&&this.showContextMenu(t,null);this.currentContextMenu instanceof ge&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");null!==t&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,i){null!==i&&e.se(i,At,st,"showContextMenu:obj");const s=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof ge){const e=t;e.layerName="Tool",e.selectable=!1,e.scale=1/s.scale,e.category=this.name,e.hasPlaceholder()&&(e.placeholder.scale=s.scale);const n=e.diagram;null!==n&&n!==s&&n.remove(e),s.add(e),null!==i?e.adornedObject=i:e.data=s.model,e.ensureBounds(),this.positionContextMenu(e,i)}else t instanceof et&&null!==t.show&&t.show(i,s,this);this.currentContextMenu=t}positionContextMenu(t,e){if(t.hasPlaceholder())return;const i=t,s=this.diagram,n=s.lastInput.documentPoint.copy(),o=i.measuredBounds,r=s.viewportBounds;s.lastInput.isTouchEvent&&(n.x-=o.width),n.x+o.width>r.right&&(n.x-=o.width+5/s.scale),n.x<r.x&&(n.x=r.x),n.y+o.height>r.bottom&&(n.y-=o.height+5/s.scale),n.y<r.y&&(n.y=r.y),i.position=n}hideContextMenu(){const t=this.diagram,e=this.currentContextMenu;null!==e&&(e instanceof ge?(t.remove(e),null!==this.Vx&&this.Vx.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof et&&(null!==e.hide?e.hide(t,this):null!==e.mainElement&&(e.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}kR(){const t=this,e=new h;return e.add(new it("Copy",(t=>t.commandHandler.copySelection()),(t=>t.commandHandler.canCopySelection()))),e.add(new it("Cut",(t=>t.commandHandler.cutSelection()),(t=>t.commandHandler.canCutSelection()))),e.add(new it("Delete",(t=>t.commandHandler.deleteSelection()),(t=>t.commandHandler.canDeleteSelection()))),e.add(new it("Paste",(e=>e.commandHandler.pasteSelection(t.mouseDownPoint)),(e=>e.commandHandler.canPasteSelection(t.mouseDownPoint)))),e.add(new it("Select All",(t=>t.commandHandler.selectAll()),(t=>t.commandHandler.canSelectAll()))),e.add(new it("Undo",(t=>t.commandHandler.undo()),(t=>t.commandHandler.canUndo()))),e.add(new it("Redo",(t=>t.commandHandler.redo()),(t=>t.commandHandler.canRedo()))),e.add(new it("Scroll To Part",(t=>t.commandHandler.scrollToPart()),(t=>t.commandHandler.canScrollToPart()))),e.add(new it("Zoom To Fit",(t=>t.commandHandler.zoomToFit()),(t=>t.commandHandler.canZoomToFit()))),e.add(new it("Reset Zoom",(t=>t.commandHandler.resetZoom()),(t=>t.commandHandler.canResetZoom()))),e.add(new it("Group Selection",(t=>t.commandHandler.groupSelection()),(t=>t.commandHandler.canGroupSelection()))),e.add(new it("Ungroup Selection",(t=>t.commandHandler.ungroupSelection()),(t=>t.commandHandler.canUngroupSelection()))),e.add(new it("Edit Text",(t=>t.commandHandler.editTextBlock()),(t=>t.commandHandler.canEditTextBlock()))),e}showDefaultContextMenu(){const t=this.diagram;null===this.Bx&&(this.Bx=this.kR()),st.Ym.innerHTML="",st.Km.addEventListener("pointerdown",this.zx,!1);const i=this,s=e.Ni("ul");s.className="goCXul",st.Ym.appendChild(s),s.innerHTML="";const n=this.Bx.iterator;for(;n.next();){const o=n.value,r=o.Ux,a=o.Uc;if(!e.st(r)||e.st(a)&&!a(t))continue;const h=e.Ni("li");h.className="goCXli";const l=e.Ni("a");l.className="goCXa",l.href="#",l.Ux=r,l.addEventListener("pointerdown",(function(e){return this.Ux(t),i.stopTool(),e.preventDefault(),!1}),!1),l.textContent=o.ue,h.appendChild(l),s.appendChild(h)}st.Ym.style.display="block",st.Km.style.display="block"}hideDefaultContextMenu(){if(null===this.currentContextMenu||this.currentContextMenu!==st.Vu)return;st.Ym.style.display="none",st.Km.style.display="none";const t=this.diagram;null!==t&&t.Le(st.Km,"pointerdown",this.zx,!1),this.currentContextMenu=null}doMouseWheel(){this.standardMouseWheel()}get currentContextMenu(){return this.dM}set currentContextMenu(t){this.dM=t,this.Vx=t instanceof ge?t.adornedPart:null}get defaultTouchContextMenu(){return!1===st.pM&&null===st.Vu&&wt.isUsingDOM()&&this.bR(),st.Vu}set defaultTouchContextMenu(t){null===t&&(st.pM=!0),st.Vu=t}get currentObject(){return this.gM}set currentObject(t){null!==t&&e.se(t,At,st,"currentObject"),this.gM=t}get mouseDownPoint(){return this.mM}}var nt=(t=>(t[t.LostFocus=1]="LostFocus",t[t.MouseDown=2]="MouseDown",t[t.Tab=3]="Tab",t[t.Enter=4]="Enter",t))(nt||{}),ot=(t=>(t[t.SingleClick=1]="SingleClick",t[t.SingleClickSelected=2]="SingleClickSelected",t[t.DoubleClick=3]="DoubleClick",t))(ot||{}),rt=(t=>(t[t.None=1]="None",t[t.Active=2]="Active",t[t.Editing=3]="Editing",t[t.Validating=4]="Validating",t[t.Invalid=5]="Invalid",t[t.Validated=6]="Validated",t))(rt||{});class at extends I{vi;yM;wM;zl;Gt;xM;bM;kM;Xx;Gx;constructor(t){super(),this.name="TextEditing",this.vi=new ie,this.yM=null,this.wM=2,this.zl=null,this.Gt=1,this.xM=1,this.bM=!0,this.kM=null,this.Xx=new et,this.Gx=null,this.PR(this.Xx),t&&Object.assign(this,t)}static LostFocus=1;static MouseDown=2;static Tab=3;static Enter=4;static SingleClick=1;static SingleClickSelected=2;static DoubleClick=3;static StateNone=1;static StateActive=2;static StateEditing=3;static StateValidating=4;static StateInvalid=5;static StateValidated=6;PR(t){if(!wt.isUsingDOM())return;const i=e.Ni("textarea");this.Gx=i;const s=this;i.addEventListener("input",(function(t){if(null===s.textBlock)return;const e=s.measureTemporaryTextBlock(this.value),i=this.textScale;this.style.width=20+Math.max(s.textBlock.measuredBounds.width,e.measuredBounds.width)*i+"px",this.rows=Math.max(s.textBlock.lineCount,e.lineCount)}),!1),i.addEventListener("keydown",(function(t){if(t.isComposing||null===s.textBlock)return;const e=t.key;return"Enter"===e?(!1===s.textBlock.isMultiline&&t.preventDefault(),void s.acceptText(4)):"Tab"===e?(s.acceptText(3),void t.preventDefault()):void("Escape"===e&&(s.doCancel(),null!==s.diagram&&s.diagram.doFocus()))}),!1),i.addEventListener("focus",(function(t){s.SR(t)}),!1),i.addEventListener("blur",(function(t){s.MR(t)}),!1),t.valueFunction=()=>i.value,t.mainElement=i,t.show=(t,e,s)=>{if(!(t instanceof ie&&e&&e.div&&s instanceof at))return;if(5===s.state)return i.style.border="3px solid red",void i.focus();const n=t.getDocumentPoint(v.Center),o=e.position,r=e.scale;let a=t.getDocumentScale()*r;a<s.minimumEditorScale&&(a=s.minimumEditorScale);const h=t.naturalBounds.width*a+6,l=t.naturalBounds.height*a+2,u=(n.x-o.x)*r,c=(n.y-o.y)*r,d=t.verticalAlignment,g=(t.lineHeight+t.spacingAbove+t.spacingBelow)*t.lineCount*a,f=.5*l-.5*g,m=d.y*l-d.y*g+d.offsetY-f-g/2;i.value=t.text,e.div.style.font=t.font;i.style.position="absolute",i.style.zIndex="100",i.style.font="inherit",i.style.fontSize=100*a+"%",i.style.lineHeight="normal",i.style.width=h+"px",i.style.left=(u-h/2|0)-1+"px",i.style.top=(c+m|0)-1+"px",i.style.textAlign=t.textAlign,i.style.margin="0",i.style.padding="1px",i.style.border="0",i.style.outline="none",i.style.whiteSpace="pre-wrap",i.style.overflow="hidden",i.rows=t.lineCount,i.textScale=a,i.className="goTXarea",e.div.appendChild(i),i.focus(),s.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))},t.hide=(t,e)=>{t.div&&t.div.removeChild(i)}}get textBlock(){return this.yM}set textBlock(t){null!==t&&e.se(t,ie,at,"textBlock"),this.yM=t}get currentTextEditor(){return this.kM}set currentTextEditor(t){this.kM=t}get defaultTextEditor(){return this.Xx}set defaultTextEditor(t){this.Xx=t}get starting(){return this.wM}set starting(t){this.wM=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(null===t||t.isReadOnly||at.Vc&&at.Vc!==this&&(at.Vc.acceptText(2),at.Vc&&at.Vc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const e=t.lastInput.documentPoint,i=t.findObjectAt(e);if(!(null!==i&&i instanceof ie&&i.editable&&null!==i.part&&i.part.canEdit()))return!1;const s=i.part;return!(null===s||2===this.starting&&!s.isSelected||3===this.starting&&t.lastInput.clickCount<2)}doStart(){at.Vc=this,null!==this.textBlock&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(null===t)return;let e=this.textBlock;if(null===e&&(e=t.findObjectAt(t.lastInput.documentPoint)),null===e||!(e instanceof ie)||(this.textBlock=e,null===e.part))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Gt=2;let i=this.defaultTextEditor;null!==e.textEditor&&(i=e.textEditor),this.vi=this.textBlock.copy();const s=new w(this.textBlock.getDocumentPoint(v.TopLeft),this.textBlock.getDocumentPoint(v.BottomRight));t.scrollToRect(s),null!==i&&null!==i.show&&i.show(e,t,this),this.currentTextEditor=i}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:6===this.Gt?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(2===this.Gt||5===this.Gt||3===this.Gt)&&(this.Gt=4,this.vA());break;case 1:case 4:case 3:if(4===t&&null!==this.textBlock&&!0===this.textBlock.isMultiline)return;(2===this.Gt||5===this.Gt||3===this.Gt)&&(this.Gt=4,this.vA())}}vA(){const t=this.textBlock,e=this.diagram,i=this.currentTextEditor;if(null!==t&&null!==i){const s=t.text;let n="";if(null!==i.valueFunction&&(n=i.valueFunction()),!this.isValidText(t,s,n))return this.Gt=5,void this.doError(s,n);this.startTransaction(this.name),this.Gt=6,this.transactionResult=this.name,t.text=n,this.doSuccess(s,n),null!==e&&e.T("TextEdited",t,s),this.stopTransaction(),this.stopTool(),null!==e&&e.doFocus()}}doError(t,e){const i=this.textBlock;if(null===i)return;null!==i.errorFunction&&i.errorFunction(this,t,e);const s=this.currentTextEditor;null!==s&&null!==s.show&&s.show(i,this.diagram,this)}doSuccess(t,e){const i=this.textBlock;null!==i&&null!==i.textEdited&&i.textEdited(i,t,e)}doDeactivate(){const t=this.diagram;if(null!==t){if(this.Gt=1,null!==this.currentTextEditor){const e=this.currentTextEditor;null!==e&&null!==e.hide&&e.hide(t,this)}this.textBlock=null,this.isActive=!1}}doStop(){at.Vc=null}SR(t){if(null===this.currentTextEditor||1===this.state)return;const i=this.Gx;2===this.Gt&&(this.Gt=3),e.st(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}MR(t){if(null===this.currentTextEditor||1===this.state)return;const i=this.Gx;e.st(i.focus)&&i.focus(),e.st(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}isValidText(t,e,i){const s=this.textValidation;if(null!==s&&!s(t,e,i))return!1;const n=t.textValidation;return!(null!==n&&!n(t,e,i))}get textValidation(){return this.zl}set textValidation(t){null!==t&&e.S(t,at,"textValidation"),this.zl=t}get minimumEditorScale(){return this.xM}set minimumEditorScale(t){null!==t&&e.s(t,"number",at,"minimumEditorScale"),this.xM=t}get selectsTextOnActivate(){return this.bM}set selectsTextOnActivate(t){null!==t&&e.s(t,"boolean",at,"selectsTextOnActivate"),this.bM=t}get state(){return this.Gt}set state(t){this.Gt!==t&&(this.Gt=t)}measureTemporaryTextBlock(t){const e=this.vi;return e.text=t,null!==this.textBlock&&e.ht(this.textBlock.Xl,1/0),e}static Vc=null}var ht=(t=>(t[t.Default=1]="Default",t[t.AnimateLocations=2]="AnimateLocations",t[t.None=3]="None",t))(ht||{});class lt{a;Ae;Be;Ar;Qn;Oo;PM;SM;Hm;Yx;ke;Bc;xn;qm;lh;Kx;jm;Hx;zc;Eu;Wm;constructor(t){this.a=wt.Om(),this.Ae=!1,this.Hm=!1,this.Yx=!1,this.ke=!1,this.Bc=!1,this.Hx=!0,this.zc=1,this.Eu=!1,this.Be=!0,this.Ar=!0,this.Oo=600,this.PM=!1,this.SM=!1,this.Qn=new u,this.xn=new ut,this.qm=new ut,this.xn.Ns=this,this.lh=new u,this.Kx=new u,this.jm=new u,this.Wm=new u,t&&Object.assign(this,t)}Io(t){this.a=t}RU(){return this.a}canStart(t){return!0}Gl(t){return!(!this.Be||!this.canStart(t))&&(this.Qn.add(t),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.a.Te(),this.ke=!0,!0)}getBundleAnimation(){return this.qm}MM(){if(!this.Be||(this.qm.yi.count>0&&this.qm.start(),!this.ke))return;const e=this.xn,i=this.a,s=this.Qn.has("Model");if(s&&(this.Bc=!0,1===this.zc?(e.isViewportUnconstrained=!0,e.yi.clear(),e.add(i,"position",i.position.copy().offset(0,-200),i.position),e.add(i,"opacity",0,1)):3===this.zc&&e.yi.clear(),2===this.zc&&i.qx.equals(i.ct)?this.Hx=!0:this.Hx=!1,i.T("InitialAnimationStarting",this)),s&&!this.Ar||0===e.yi.count)return this.Qn.clear(),this.ke=!1,e.yi.clear(),e.jx(i),this.Bc=!1,void i.C();this.Qn.clear(),i.Tr=!1;const n=e.yi.get(i);1!==i.autoScale&&null!==n&&(delete n.ae.scale,delete n.Cs.scale);const o=this;t.requestAnimationFrame((()=>{!1===o.ke||e.Ae||(i.getRenderingHint("temporaryPixelRatio")&&i.Cx(),i.NM(),o.ke=!1,e.start(),e.Ae&&(o.Bu(),i.invalidateDocumentBounds(),e.FA(0),i.Pr(!0),o.zu(),i.T("AnimationStarting",o)))}))}CM(){return this.Qn.has("Trigger")&&1===this.Qn.count}RA(t,e,i,s){this.isTicking||this.CM()||t instanceof be&&(null!==t.fromNode||null!==t.toNode)||this.xn.add(t,"position",e,i,s)}Wx(t){return this.xn.Wx(t)}LM(t){return this.xn.LM(t)}NR(e){const i=this.lh,s=this;function n(){if(s.jm.count>0&&(i.addAll(s.jm),s.jm.clear(),s.Ae=!0),!1===s.Ae||0===i.count)return void(s.Yx=!1);s.Kx.addAll(i);const e=s.Kx.iterator;for(;e.next();){const t=e.value;!1!==t.Ae&&(t.CR()?t.OA(!1):t.Xc=!0)}s.Kx.clear(),!1!==s.Ae?(s.Bu(),s.a.Pr(),s.zu(),t.requestAnimationFrame(n)):t.requestAnimationFrame(n)}this.Ae?this.IA(e):(this.Ae=!0,this.Yx?this.IA(e):(this.Yx=!0,i.add(e),t.requestAnimationFrame((()=>n()))))}IA(t){this.jm.add(t)}LR(){const t=this.lh.iterator;for(;t.next();)t.value.Xc=!1}Bu(){if(this.Hm)return;const t=this.a;this.PM=t.skipsUndoManager,this.SM=t.wi,t.skipsUndoManager=!0,t.wi=!0,this.Hm=!0}zu(){const t=this.a;t.skipsUndoManager=this.PM,t.wi=this.SM,this.Hm=!1}stopAnimation(t){const e=this.xn;if(!0===this.ke&&(this.ke=!1,this.Bc=!1,this.Qn.clear(),e.AR()&&this.a.requestUpdate()),!this.Ae)return e.yi.clear(),void e.jx(this.a);if(e.Xu(!0),e.jx(null),!0===t){const t=this.lh.toArray();for(let e=0;e<t.length;e++)t[e].Xu(!0)}}Xu(t){this.lh.delete(t),0===this.lh.count&&(this.Ae=!1,this.a.requestUpdate()),t===this.defaultAnimation&&this.a.T("AnimationFinished",this)}Gc(t,e){this.ke&&(!this.Qn.has("Expand Tree")&&!this.Qn.has("Expand SubGraph")||(this.xn.Gc(t,e),this.EA(t)))}Yc(t,e){this.ke&&(!this.Qn.has("Collapse Tree")&&!this.Qn.has("Collapse SubGraph")||(this.xn.Yc(t,e),this.xn.AM(e,"position",e.position,e.position),this.EA(t)))}UA(t,e){!this.ke||t.equals(e)||this.CM()||(this.a.Qa||(t=e.copy()),this.xn.AM(this.a,"position",t,e))}VA(t,e){this.ke&&(this.CM()||this.xn.add(this.a,"scale",t,e))}TM(t,e){t.Fi&&(t.Dr=e,this.Wm.add(t))}EA(t){const e=t.findLinksConnected();for(;e.next();){const t=e.value;t.Fi&&(t.Dr=t.points.copy(),this.Wm.add(t))}}get isEnabled(){return this.Be}set isEnabled(t){e.s(t,"boolean",lt,"isEnabled"),this.Be=t,t&&this.lh.each((t=>{!t.isAnimating&&t.runCount===1/0&&t.start()}))}get duration(){return this.Oo}set duration(t){e.s(t,"number",lt,"duration"),t<1&&e.J(t,">= 1",lt,"duration"),this.Oo=t}get isAnimating(){return this.Ae}get isTicking(){return this.Hm}get isInitial(){return this.Ar}set isInitial(t){e.s(t,"boolean",lt,"isInitial"),this.Ar=t}get defaultAnimation(){return this.xn}get activeAnimations(){return this.lh}get initialAnimationStyle(){return this.zc}set initialAnimationStyle(t){this.zc=t}static Jx=new p;static defineAnimationEffect(t,e){lt.Jx.set(t,e)}static DM(t,e,i,s,n){null===t&&(t=[0,0,0,0]),null===e&&(e=[0,0,0,0]);let o=t[0],r=t[1];const a=t[2],h=t[3];let l=e[0],u=e[1];const c=e[2],d=e[3];0===a||100===a?(o=l,r=u):(0===c||100===c)&&(l=o,u=r),Math.abs(l-o)>180&&(l>o?o+=360:l+=360);return"hsla("+n(i,o,l-o,s)%360+", "+n(i,r,u-r,s)+"%, "+n(i,a,c-a,s)+"%, "+n(i,h,d-h,s)+")"}static Default=1;static AnimateLocations=2;static None=3}{const t=lt.Jx,e=(t,e,i,s,n,o)=>{t.position=new y(s(n,e.x,i.x-e.x,o),s(n,e.y,i.y-e.y,o))};t.set("position:diagram",e),t.set("position",e),t.set("position:part",((t,e,i,s,n,o)=>{n<o?t.Ec(s(n,e.x,i.x-e.x,o),s(n,e.y,i.y-e.y,o),!1):t.position=new y(s(n,e.x,i.x-e.x,o),s(n,e.y,i.y-e.y,o))})),t.set("location",((t,e,i,s,n,o)=>{n<o?t.Ec(s(n,e.x,i.x-e.x,o),s(n,e.y,i.y-e.y,o),!0):t.location=new y(s(n,e.x,i.x-e.x,o),s(n,e.y,i.y-e.y,o))})),t.set("position:placeholder",((t,e,i,s,n,o)=>{n<o?t.Ec(s(n,e.x,i.x-e.x,o),s(n,e.y,i.y-e.y,o),!1):t.position=new y(s(n,e.x,i.x-e.x,o),s(n,e.y,i.y-e.y,o))})),t.set("position:nodeCollapse",((t,e,i,s,n,o)=>{const r=t.actualBounds,a=i.actualBounds,h=a.x+a.width/2-r.width/2,l=a.y+a.height/2-r.height/2;n<o?t.Ec(s(n,e.x,h-e.x,o),s(n,e.y,l-e.y,o),!1):t.position=new y(s(n,e.x,h-e.x,o),s(n,e.y,l-e.y,o))})),t.set("desiredSize",((t,e,i,s,n,o)=>{t.desiredSize=new x(s(n,e.width,i.width-e.width,o),s(n,e.height,i.height-e.height,o))})),t.set("width",((t,e,i,s,n,o)=>{t.width=s(n,e,i-e,o)})),t.set("height",((t,e,i,s,n,o)=>{t.height=s(n,e,i-e,o)})),t.set("fill",((t,e,i,s,n,o)=>{t.fill=lt.DM(e,i,n,o,s)})),t.set("stroke",((t,e,i,s,n,o)=>{t.stroke=lt.DM(e,i,n,o,s)})),t.set("strokeWidth",((t,e,i,s,n,o)=>{t.strokeWidth=s(n,e,i-e,o)})),t.set("strokeDashOffset",((t,e,i,s,n,o)=>{t.strokeDashOffset=s(n,e,i-e,o)})),t.set("background",((t,e,i,s,n,o)=>{t.background=lt.DM(e,i,n,o,s)})),t.set("opacity",((t,e,i,s,n,o)=>{t.opacity=s(n,e,i-e,o)})),t.set("scale",((t,e,i,s,n,o)=>{t.scale=s(n,e,i-e,o)})),t.set("angle",((t,e,i,s,n,o)=>{t.angle=s(n,e,i-e,o)}))}class ut{$x;Jm;Ae;Gu;Oo;Ls;BA;Kc;yi;Zx;ae;_n;Yu;Hc;Qx;_x;Xc;vM;tb;Ns;a;FM;RM;OM;constructor(t){this.a=null,this.Ns=null,this.vM=null,this.tb=null,this.FM=!1,this.Ae=!1,this.Xc=!1,this.ae=0,this._n=0,this.$x=ut.EaseInOutQuad,this.Jm=ut.EaseInOutQuad,this.Yu=!1,this.Hc=!1,this.Qx=1,this._x=0,this.Oo=NaN,this.Ls=NaN,this.RM=0,this.Gu=null,this.BA=y.dn,this.yi=new p,this.Zx=new p,this.Kc=new u,this.OM=1,t&&Object.assign(this,t)}suspend(){this.Xc=!0}advanceTo(t,e){e&&(this.Xc=!1),this.Yu&&t>=this.Ls&&(this.Hc=!0,t-=this.Ls),this.RM=t,this.OA(!0),this.Ns.Bu(),this.a.Pr(),this.Ns.zu(),this.a.redraw()}jx(t){if(this.Zx.clear(),this.Hc=!1,this._x=0,this.Ls=NaN,this.Kc.count>0&&this.Kc.clear(),null!==t){const e=t.links;for(;e.next();)e.value.Dr=null}}AR(){return this.yi.count>0}start(){if(0===this.yi.count)return this;if(this.Ae)return this;let t=this.a;const e=this.yi.iterator;for(;e.next();){const i=e.key;null===t&&(i instanceof wt?t=i:i instanceof At&&(t=i.diagram))}if(null===t)return this;this.a=t,this.Ns=t.animationManager;const i=this.Ns;return!1===i.isEnabled||(this.Ls=isNaN(this.Oo)?i.duration:this.Oo,this.Jm=this.$x,i.Bc&&1===i.zc&&this===i.defaultAnimation&&(this.Jm=ut.EaseOutExpo,this.Ls=isNaN(this.Oo)?600===i.duration?900:i.duration:this.Oo),this.OM=t.scrollMode,this.isViewportUnconstrained&&(t.ah=2),i.Bu(),this.Kc.each((e=>{e.data=null,t.add(e)})),i.zu(),this.Ae=!0,this.ae=+new Date,this._n=this.ae+this.Ls,i.NR(this)),this}addTemporaryPart(t,e){return t.Di()?(this.Kc.add(t),this.a=e,this):this}add(t,e,i,s,n){if(null===this.a&&(t instanceof wt?this.a=t:t instanceof At&&null!==t.diagram&&(this.a=t.diagram)),t instanceof ce){if(!t.isAnimated)return this;"position"===e&&(e="position:part")}return this.AM(t,e,i,s,n),this}AM(t,e,i,s,n){const o=this.yi;let r,a,h;if(t instanceof wt&&"position"===e&&(e="position:diagram"),("fill"===e||"stroke"===e||"background"===e)&&(Ut.Eo(i),Ut.IM(),i=[Ut.ze.n0,Ut.ze.n1,Ut.ze.n2,Ut.ze.n3],Ut.Eo(s),Ut.IM(),s=[Ut.ze.n0,Ut.ze.n1,Ut.ze.n2,Ut.ze.n3]),o.has(t))r=o.get(t),a=r.ae,h=r.Cs,void 0===a[e]&&(a[e]=this.Ku(i)),h[e]=this.Ku(s);else{if("position"===e&&i.equalsApprox(s))return;a={},h={},a[e]=this.Ku(i),h[e]=this.Ku(s),r=new ct(a,h,n),o.set(t,r)}const l=a[e];l instanceof y&&!l.isReal()&&l.h(this.BA),n&&0===e.indexOf("position:")&&t instanceof ce?r.eb.location=this.Ku(t.location):n&&(r.eb[e]=this.Ku(i))}Ku(t){return t instanceof y||t instanceof x?t.copy():t}TR(t){const e=this.yi;if(e.has(t)){e.get(t).ib=!0}}Wx(t){if(!this.Ae)return!1;const e=this.yi.get(t);return null!==e&&e.ib}LM(t){if(!this.Ae)return!1;const e=this.yi.get(t);return null!==e&&!!(e.ae.position||e.ae["position:part"]||e.ae.location)}CR(){if(this.Kc.count>0)return!0;const t=this.yi.iterator;for(;t.next();){const e=t.key;if(e instanceof At&&null!==e.diagram||e instanceof wt)return!0}return!1}OA(t){if(this.Xc&&!t)return;const e=this.Ns;if(!1===this.Ae)return;const i=+new Date;let s=i>this._n?this.Ls:i-this.ae;t&&(s=this.RM,s<this.Ls?(this.ae=+new Date-s,this._n=this.ae+this.Ls):s=this.Ls),e.Bu(),this.FA(s),this.a.Pr(!0),e.zu(),i>this._n&&(this.Yu&&!this.Hc?(this.ae=+new Date,this._n=this.ae+this.Ls,this.Hc=!0):this.Xu(!1))}FA(t){const e=this.Ls,i=this.yi.iterator,s=this.Hc;for(;i.next();){const n=i.key;if(n instanceof At&&null===n.diagram)continue;const o=i.value,r=s?o.Cs:o.ae,a=s?o.ae:o.Cs,h=lt.Jx;for(const i in a)"position"===i&&(a["position:placeholder"]||a["position:nodeCollapse"])||null!==h.get(i)&&h.get(i)(n,r[i],a[i],this.Jm,t,e,this)}}stop(){return this.Ae?(this.Xu(!0),this):this}Xu(t){if(null!==this.tb&&this.tb.DR(this.vM),!this.Ae)return;const e=this.a,i=this.Ns;i.Bc=!1,this.Ae=!1,this.Xc=!1,i.Bu();const s=this.yi,n=this.Kc.iterator;for(;n.next();)e.remove(n.value);const o=this.Yu,r=s.iterator,a=lt.Jx;for(;r.next();){const t=r.key,e=r.value,i=o?e.Cs:e.ae,s=o?e.ae:e.Cs,n=e.eb;for(const o in s)if(null!==a.get(o)){let r=o;e.sb&&("position:nodeCollapse"===r||"position:placeholder"===r)&&(r="position"),a.get(r)(t,i[o],void 0!==n[o]?n[o]:e.sb?i[o]:s[o],this.Jm,this.Ls,this.Ls,this)}e.sb&&void 0!==n.location&&t instanceof ce&&(t.location=n.location),e.ib&&t instanceof ce&&t.Xe(!1)}this._x++;const h=!t&&this.Qx>this._x;if(!h&&(this===i.qm||this===i.defaultAnimation)&&this.yi.clear(),e.nb.clear(),e.yS(!1),e.invalidateDocumentBounds(),e.C(),e.Pr(!0),i.defaultAnimation===this){const t=i.Wm.iterator;for(;t.next();)t.value.vR();i.Wm.clear()}if(e.Pr(!0),this.isViewportUnconstrained&&(e.scrollMode=this.OM),i.zu(),h)return this.Hc=!1,void this.start();this.jx(null),e.zA(),i.Xu(this),this.Gu&&this.Gu(this),e.requestUpdate()}Gc(t,e){const i=e.actualBounds;let s=null;if(e instanceof Ne&&(s=e.placeholder),null!==s&&s.visible){const e=s.getDocumentPoint(v.TopLeft),i=s.padding;e.x+=i.left,e.y+=i.top,this.add(t,"position",e,t.position,!1)}else this.add(t,"position",new y(i.x+i.width/2,i.y+i.height/2),t.position,!1);this.add(t,"scale",.01,t.scale,!1),t instanceof Ne&&this.FR(t,e)}FR(t,e){const i=t.memberParts;for(;i.next();){const t=i.value;t instanceof me&&this.Gc(t,e)}}Yc(t,e){if(!t.isVisible())return;let i=null;if(e instanceof Ne&&(i=e.placeholder),null!==i&&i.visible){const e=i.getDocumentPoint(v.TopLeft),s=i.padding;e.x+=s.left,e.y+=s.top,this.add(t,"position:placeholder",t.position,e,!0)}else this.add(t,"position:nodeCollapse",t.position,e,!0);this.add(t,"scale",t.scale,.01,!0),this.TR(t),t instanceof Ne&&this.RR(t,e)}RR(t,e){const i=t.memberParts;for(;i.next();){const t=i.value;t instanceof me&&this.Yc(t,e)}}get duration(){return this.Oo}set duration(t){e.s(t,"number",ut,"duration"),t<1&&e.J(t,">= 1",ut,"duration"),this.Oo=t}get reversible(){return this.Yu}set reversible(t){this.Yu=t}get runCount(){return this.Qx}set runCount(t){t>0?this.Qx=t:e.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Gu}set finished(t){this.Gu!==t&&(null!==t&&e.S(t,ut,"finished"),this.Gu=t)}get easing(){return this.$x}set easing(t){this.$x=t}get isViewportUnconstrained(){return this.FM}set isViewportUnconstrained(t){this.FM=t}get isAnimating(){return this.Ae}getTemporaryState(t){let e=this.Zx.get(t);return null===e&&(e={},this.Zx.set(t,e)),e}static EaseLinear=(t,e,i,s)=>i*t/s+e;static EaseInOutQuad=(t,e,i,s)=>(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e;static EaseInQuad=(t,e,i,s)=>i*(t/=s)*t+e;static EaseOutQuad=(t,e,i,s)=>-i*(t/=s)*(t-2)+e;static EaseInExpo=(t,e,i,s)=>0===t?e:i*Math.pow(2,10*(t/s-1))+e;static EaseOutExpo=(t,e,i,s)=>t===s?e+i:i*(1-Math.pow(2,-10*t/s))+e}class ct{ae;Cs;eb;sb;ib;constructor(t,e,i){this.ae=t,this.Cs=e,this.eb={},this.sb=i,this.ib=!1}}var dt=(t=>(t[t.Default=1]="Default",t[t.Immediate=2]="Immediate",t[t.Bundled=3]="Bundled",t))(dt||{});class gt{Ti;pn;Hu;qc;constructor(t,e,i){this.Ti=null,this.pn=t,this.Hu=i||1,this.qc=null,void 0!==e&&(this.qc=e,void 0===i&&(this.Hu=2))}copy(){const t=new gt(this.pn);t.Hu=this.Hu;const e=this.qc;if(null!==e){const i={};void 0!==e.duration&&(i.duration=e.duration),void 0!==e.finished&&(i.finished=e.finished),void 0!==e.easing&&(i.easing=e.easing),t.qc=i}return t}get propertyName(){return this.pn}set propertyName(t){this.pn=t}get animationSettings(){return this.qc}set animationSettings(t){this.qc=t}OR(t){const e=this.qc;null!==e&&(e.duration&&(t.duration=e.duration),e.finished&&(t.finished=e.finished),e.easing&&(t.easing=e.easing))}get startCondition(){return this.Hu}set startCondition(t){this.Hu=t}static Default=1;static Immediate=2;static Bundled=3}class ft{a;Pt;Zt;vr;Yl;Kl;Hl;ql;jl;Wl;Jl;$l;Zl;Ql;_l;ta;Uc;ea;ob;$m;qu;Ct;constructor(t){u.Je(this),this.a=null,this.Ct=new h,this.Pt="",this.Zt=1,this.vr=!1,this.Yl=!0,this.Kl=!0,this.Hl=!0,this.ql=!0,this.jl=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Uc=!0,this.ea=!0,this.ob=!0,this.$m=!1,this.qu=[],t&&Object.assign(this,t)}IR(){const t=this.Ct;for(let e=0;e<t.length;e++)t.r[e].EM(null);t.clear(),this.qu.length=0}Io(t){this.a=t}toString(t){void 0===t&&(t=0);const i='Layer "'+this.name+'"';if(t<=0)return i;let s=0,n=0,o=0,r=0,a=0;const h=this.Ct.iterator;for(;h.next();){const t=h.value;t instanceof Ne?o++:t instanceof me?n++:t instanceof be?r++:t instanceof ge?a++:s++}let l="";if(s>0&&(l+=s+" Parts "),n>0&&(l+=n+" Nodes "),o>0&&(l+=o+" Groups "),r>0&&(l+=r+" Links "),a>0&&(l+=a+" Adornments "),t>1){const t=this.Ct.iterator;for(;t.next();){const i=t.value;l+="\n    "+i.toString();const s=i.data;null!==s&&u.xs(s)&&(l+=" #"+u.xs(s)),i instanceof me?l+=" "+e.toString(s):i instanceof be&&(l+=" "+e.toString(i.fromNode)+" "+e.toString(i.toNode))}}return i+" "+this.Ct.count+": "+l}findObjectAt(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),!1===this.ea)return null;let s=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(t)&&(s=!0);const n=y.l(),o=this.Ct.r;for(let r=o.length;r--;){const a=o[r];if(!0===s&&!1===a.Ul()||!a.isVisible())continue;n.h(t),n.Yi(a.Ws);let h=a.XA(n,e,i);if(null!==h&&(null!==e&&(h=e(h)),null!==h&&(null===i||i(h))))return y.i(n),h}return y.i(n),null}findObjectsAt(t,e,i,s){if(void 0===e&&(e=null),void 0===i&&(i=null),!(s instanceof h)&&!(s instanceof u)&&(s=new u),!1===this.ea)return s;let n=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(t)&&(n=!0);const o=y.l(),r=this.Ct.r;for(let a=r.length;a--;){const h=r[a];if(!0===n&&!1===h.Ul()||!h.isVisible())continue;o.h(t),o.Yi(h.Ws);let l=h;h.GA(o,e,i,s)&&(null!==e&&(l=e(l)),null!==l&&(null===i||i(l))&&s.add(l))}return y.i(o),s}findObjectsIn(t,e,i,s,n){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),!(n instanceof h)&&!(n instanceof u)&&(n=new u),!1===this.ea)return n;let o=!1;null!==this.diagram&&this.diagram.viewportBounds.containsRect(t)&&(o=!0);const r=this.Ct.r;for(let a=r.length;a--;){const h=r[a];if(!0===o&&!1===h.Ul()||!h.isVisible())continue;let l=h;h.Zm(t,e,i,s,n)&&(null!==e&&(l=e(l)),null!==l&&(null===i||i(l))&&n.add(l))}return n}MS(t,e,i,s,n,o,r){if(!1===this.ea)return n;const a=this.Ct.r;for(let h=a.length;h--;){const l=a[h];if(!0===r&&!1===l.Ul()||!o(l)||!l.isVisible())continue;let u=l;l.Zm(t,e,i,s,n)&&(null!==e&&(u=e(u)),null!==u&&(null===i||i(u))&&n.add(u))}return n}findObjectsNear(t,e,i,s,n,o){if(void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof h||n instanceof u)&&(o=n),n=!0),!(o instanceof h)&&!(o instanceof u)&&(o=new u),!1===this.ea)return o;let r=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(t)&&(r=!0);const a=y.l(),l=y.l(),c=this.Ct.r;for(let h=c.length;h--;){const u=c[h];if(!0===r&&!1===u.Ul()||!u.isVisible())continue;a.h(t),a.Yi(u.Ws),l.e(t.x+e,t.y),l.Yi(u.Ws);let d=u;u.YA(a,l,i,s,n,o)&&(null!==i&&(d=i(d)),null!==d&&(null===s||s(d))&&o.add(d))}return y.i(a),y.i(l),o}UM(){return this.Ct.r}rs(t,i){if(!this.visible)return;const s=this.Ct.r,n=s.length;if(0===n)return;const o=e.nt(),r=e.nt();for(let t=0;t<n;t++){const e=s[t];if(e.VM=t,e instanceof be){if(!1===e.Fi)continue}else if(e instanceof ge&&null!==e.adornedPart)continue;const n=e.actualBounds;e.isVisible()&&n.BL(i,10)?(e.rs(!0),o.push(e)):(e.rs(!1),null!==e.adornments&&e.adornments.count>0&&r.push(e))}for(let t=0;t<o.length;t++){const e=o[t];e.BM();const i=e.adornments;for(;i.next();){const t=i.value;t.ht(1/0,1/0),t.Ut(),t.rs(!0)}}for(let t=0;t<r.length;t++)r[t].BM();e.Z(o),e.Z(r)}ju(t){let e=1;return 1!==this.Zt&&(e=t.globalAlpha,t.globalAlpha=e*this.Zt),e}KA(t,e){for(let i=0;i<e;i++)t[i].jc()}Ge(t,e,i){if(!this.visible||0===this.Zt||(void 0===i&&(i=!0),!i&&this.isTemporary))return;const s=this.Ct.r,n=s.length;if(0===n)return;t.vr&&this.KA(s,n);const o=this.ju(t),r=this.qu;r.length=0;const a=e.scale,h=w.l();for(let i=0;i<n;i++){const n=s[i];this.Qm(t,n,e,r,a,h,!0)}w.i(h),t.vr&&this.KA(s,n),t.globalAlpha=o}OU(t,e,i){if(!this.visible||0===this.Zt)return;const s=this.Ct.r,n=s.length;if(0===n)return;const o=this.ju(t),r=this.qu;r.length=0;const a=e.scale,h=w.l();for(let o=0;o<n;o++){const n=s[o];i.has(n)||this.Qm(t,n,e,r,a,h,!0)}w.i(h),t.globalAlpha=o}ER(t,e,i,s){if(!this.visible||0===this.Zt||!s&&this.isTemporary)return;const n=this.Ct.r,o=n.length;if(0===o)return;const r=this.ju(t),a=this.qu;a.length=0;const h=e.scale,l=w.l();for(let s=0;s<o;s++){const o=n[s];i.has(o)&&this.Qm(t,o,e,a,h,l,!1)}w.i(l),t.globalAlpha=r}UR(t,e,i,s,n){if(!this.visible||0===this.opacity)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const e=this.ju(t);o.Ge(t,i),t.globalAlpha=e}}else{const e=this.ju(t),s=i.scale,r=w.l(),a=this.Ct.r,h=a.length;for(let e=0;e<h;e++){const h=a[e];!n&&h===o||this.Qm(t,h,i,null,s,r,!1)}w.i(r),t.globalAlpha=e}}IU(t,e,i){if(!this.visible||0===this.Zt)return;const s=this.ju(t),n=this.qu;n.length=0;const o=e.scale,r=w.l(),a=this.Ct.r,h=a.length,l=i.length;for(let s=0;s<h;s++){const h=a[s],u=h.hh(h.actualBounds);this.VR(u,i,l,o)&&this.Qm(t,h,e,n,o,r,!0)}w.i(r),t.globalAlpha=s}Qm(t,e,i,s,n,o,r){if(r&&!e.Ul())return void t.removePartFromView(e);if(null!==s&&e instanceof be&&(e.isOrthogonal&&s.push(e),!1===e.Fi))return void t.removePartFromView(e);let a=!1,h=e.containingGroup;for(;null!==h;)a?null!==h.he&&o.intersectRect(h.he):null!==h.he&&(a=!0,o.h(h.he)),h=h.containingGroup;const l=e.actualBounds;let u=!1;if(a&&e.isVisible()){if(!o.intersectsRect(l))return void t.removePartFromView(e);u=!o.containsRect(l)}u&&(t.save(),t instanceof Bt?t.partClipRect=o.copy():(t.beginPath(),t.rect(o.x,o.y,o.width,o.height),t.clip())),l.width*n>i._m||l.height*n>i._m?e.Ge(t,i):this.BR(t,e,i),u&&(t.restore(),t.clearContextCache(!0))}BR(t,e,i){if(t instanceof Bt)return void e.Ge(t,i);const s=e.actualBounds,n=e.naturalBounds;if(0===s.width||0===s.height||isNaN(s.x)||isNaN(s.y)||!e.isVisible())return;const o=e.v;if(null===e.background)return e.bn(t,"rgba(0,0,0,0.3)",!0,!1,n,s),void t.fillRect(s.x,s.y,s.width,s.height);if(t.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),e.bn(t,e.background,!0,!1,n,s),t.fillRect(0,0,n.width/2,n.height/2),!o.RP()){const e=1/(o.m11*o.m22-o.m12*o.m21);t.transform(o.m22*e,-o.m12*e,-o.m21*e,o.m11*e,e*(o.m21*o.dy-o.m22*o.dx),e*(o.m12*o.dx-o.m11*o.dy))}}VR(t,e,i,s){const n=2/s,o=4/s;for(let s=0;s<i;s++){const i=e[s];if(0!==i.width&&0!==i.height&&t.intersects(i.x-n,i.y-n,i.width+o,i.height+o))return!0}return!1}t(t,e,i,s,n){const o=this.diagram;null!==o&&o.raiseChangedEvent(2,t,this,e,i,s,n)}ch(t,e,i){const s=this.Ct;if(e.EM(this),t>=s.count)t=s.count;else if(s.elt(t)===e)return-1;s.insertAt(t,e),e.tp(i);const n=this.diagram;return null!==n&&(i?n.C():n.ch(e)),this.rb(t,e),t}ri(t,e,i){if(!i&&e.layer!==this&&null!==e.layer)return e.layer.ri(t,e,i);const s=this.Ct;if(t<0||t>=s.length){if((t=s.indexOf(e))<0)return-1}else if(s.elt(t)!==e&&(t=s.indexOf(e))<0)return-1;e.ep(i),s.removeAt(t);const n=this.diagram;return null!==n&&(i?n.C():n.ri(e)),e.EM(null),t}rb(t,e){t=this.zR(t,e),e instanceof Ne&&this.XR(t,e),null!==e.svg&&e.svg.remove()}zR(t,e){const i=e.zOrder;if(isNaN(i))return t;const s=this.Ct,n=s.count;if(n<=1)return t;if(t<0&&(t=s.indexOf(e)),t<0)return-1;let o=t-1,r=NaN;for(;o>=0&&(r=s.elt(o).zOrder,isNaN(r));)o--;let a=t+1,h=NaN;for(;a<n&&(h=s.elt(a).zOrder,isNaN(h));)a++;if(!isNaN(r)&&r>i)for(;;){if(-1===o||r<=i)return o++,o===t?t:(s.removeAt(t),s.insertAt(o,e),o);for(r=NaN;--o>=0&&(r=s.elt(o).zOrder,isNaN(r)););}else if(!isNaN(h)&&h<i)for(;;){if(a===n||h>=i)return a--,a===t?t:(s.removeAt(t),s.insertAt(a,e),a);for(h=NaN;++a<n&&(h=s.elt(a).zOrder,isNaN(h)););}return t}XR(t,e){if(null===e||!isNaN(e.zOrder))return;this.GR(t,e);const i=e.containingGroup;null!==i&&this.rb(-1,i)}GR(t,e){if(0===e.memberParts.count)return;let i=-1;const s=this.Ct.r,n=s.length;for(let o=0;o<n;o++){const n=s[o];if(n===e&&(t=o,i>=0)||i<0&&n.containingGroup===e&&(i=o,t>=0))break}if(!(i<0)&&i<t){const s=this.Ct;s.removeAt(t),s.insertAt(i,e)}}get parts(){return this.Ct.iterator}get partsBackwards(){return this.Ct.iteratorBackwards}get diagram(){return this.a}get name(){return this.Pt}set name(t){e.s(t,"string",ft,"name");const i=this.Pt;if(i!==t){const s=this.diagram;if(null!==s){""===i&&e.o("Cannot rename default Layer to: "+t);const n=s.layers;for(;n.next();)n.value.name===t&&e.o("Layer.name is already present in this diagram: "+t)}this.Pt=t,this.t("name",i,t);const n=this.Ct.iterator;for(;n.next();){n.value.layerName=this.Pt}}}get opacity(){return this.Zt}set opacity(t){const i=this.Zt;if(i!==t){e.s(t,"number",ft,"opacity"),(t<0||t>1)&&e.J(t,"0 <= value <= 1",ft,"opacity"),this.Zt=t;const s=this.diagram;null!==s&&s.C(),this.t("opacity",i,t)}}get isViewportAligned(){return this.$m}set isViewportAligned(t){const e=this.$m;e!==t&&(this.$m=t,this.diagram&&(this.HA(),this.diagram.C()),this.t("isViewportAligned",e,t),t&&(this.isInDocumentBounds=!1))}HA(){if(!this.$m)return;const t=this.diagram;if(null===t)return;const e=this.Ct.r,i=e.length,s=t.wt,n=t.xt;for(let o=0;o<i;o++){const i=e[o],r=i.naturalBounds.width,a=i.naturalBounds.height;let h=i.alignment;(h.isDefault()||!h.isSpot())&&(h=v.BottomRight);let l=i.alignmentFocus;l.isDefault()&&(l=new v(h.x,h.y));const u=h.x*s+h.offsetX-(l.x*r+l.offsetX),c=h.y*n+h.offsetY-(l.y*a+l.offsetY),d=y.z(u,c);t.YR(d),i.Ec(d.x,d.y,!0),y.i(d),i.it=1/t.scale}}get isTemporary(){return this.vr}set isTemporary(t){const i=this.vr;i!==t&&(e.s(t,"boolean",ft,"isTemporary"),this.vr=t,this.t("isTemporary",i,t))}get visible(){return this.Uc}set visible(t){const i=this.Uc;if(i!==t){e.s(t,"boolean",ft,"visible"),this.Uc=t;const s=this.Ct.iterator;for(;s.next();)s.value.Xe(t);const n=this.diagram;null!==n&&n.C(),this.t("visible",i,t)}}get pickable(){return this.ea}set pickable(t){const i=this.ea;i!==t&&(e.s(t,"boolean",ft,"pickable"),this.ea=t,this.t("pickable",i,t))}get isInDocumentBounds(){return this.ob}set isInDocumentBounds(t){const e=this.ob;e!==t&&(this.ob=t,null!==this.diagram&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",e,t))}get allowCopy(){return this.Yl}set allowCopy(t){const i=this.Yl;i!==t&&(e.s(t,"boolean",ft,"allowCopy"),this.Yl=t,this.t("allowCopy",i,t))}get allowDelete(){return this.Kl}set allowDelete(t){const i=this.Kl;i!==t&&(e.s(t,"boolean",ft,"allowDelete"),this.Kl=t,this.t("allowDelete",i,t))}get allowTextEdit(){return this.Hl}set allowTextEdit(t){const i=this.Hl;i!==t&&(e.s(t,"boolean",ft,"allowTextEdit"),this.Hl=t,this.t("allowTextEdit",i,t))}get allowGroup(){return this.ql}set allowGroup(t){const i=this.ql;i!==t&&(e.s(t,"boolean",ft,"allowGroup"),this.ql=t,this.t("allowGroup",i,t))}get allowUngroup(){return this.jl}set allowUngroup(t){const i=this.jl;i!==t&&(e.s(t,"boolean",ft,"allowUngroup"),this.jl=t,this.t("allowUngroup",i,t))}get allowLink(){return this.Wl}set allowLink(t){const i=this.Wl;i!==t&&(e.s(t,"boolean",ft,"allowLink"),this.Wl=t,this.t("allowLink",i,t))}get allowRelink(){return this.Jl}set allowRelink(t){const i=this.Jl;i!==t&&(e.s(t,"boolean",ft,"allowRelink"),this.Jl=t,this.t("allowRelink",i,t))}get allowMove(){return this.$l}set allowMove(t){const i=this.$l;i!==t&&(e.s(t,"boolean",ft,"allowMove"),this.$l=t,this.t("allowMove",i,t))}get allowReshape(){return this.Zl}set allowReshape(t){const i=this.Zl;i!==t&&(e.s(t,"boolean",ft,"allowReshape"),this.Zl=t,this.t("allowReshape",i,t))}get allowResize(){return this.Ql}set allowResize(t){const i=this.Ql;i!==t&&(e.s(t,"boolean",ft,"allowResize"),this.Ql=t,this.t("allowResize",i,t))}get allowRotate(){return this._l}set allowRotate(t){const i=this._l;i!==t&&(e.s(t,"boolean",ft,"allowRotate"),this._l=t,this.t("allowRotate",i,t))}get allowSelect(){return this.ta}set allowSelect(t){const i=this.ta;i!==t&&(e.s(t,"boolean",ft,"allowSelect"),this.ta=t,this.t("allowSelect",i,t))}}var mt=(t=>(t[t.None=1]="None",t[t.Uniform=2]="Uniform",t[t.UniformToFill=3]="UniformToFill",t))(mt||{}),pt=(t=>(t[t.All=1]="All",t[t.NotDirected=2]="NotDirected",t[t.NotDirectedFast=3]="NotDirectedFast",t[t.NotUndirected=4]="NotUndirected",t[t.DestinationTree=5]="DestinationTree",t[t.SourceTree=6]="SourceTree",t))(pt||{}),yt=(t=>(t[t.Document=1]="Document",t[t.Infinite=2]="Infinite",t))(yt||{}),xt=(t=>(t[t.TreeParent=1]="TreeParent",t[t.AllParents=2]="AllParents",t[t.AnyParents=3]="AnyParents",t))(xt||{});class wt{Ns;jt;zM;lb;Fr;Wu;ab;hb;cb;fb;ub;db;fh;ah;gb;pb;yb;ia;Wc;Rr;ip;wb;xb;Ju;to;Or;uh;Uo;sp;Jc;np;$c;$u;Ir;eo;XM;GM;bb;kb;YM;Pb;KM;HM;qM;Sb;op;Er;Ur;Vr;Br;zr;Xr;Mb;Gr;Nb;Yr;Kr;Hr;qr;Cb;jM;Vo;WM;Lb;Ab;JM;Ce;$M;Zc;ZM;Hs;Bo;Be;Tb;Yl;Kl;Db;vb;Hl;ql;jl;Fb;Wl;Jl;$l;Zl;Ql;_l;ta;Rb;Ob;QM;Zu;Qu;Ib;Eb;Ub;Vb;rp;Bb;zb;Xb;Qt;qA;Gb;jA;_u;kn;io;li;so;WA;sa;_M;t2;lp;Yb;td;ap;Kb;jr;na;dh;e2;i2;hp;Hb;qb;ls;ed;cp;sd;zo;Qc;fp;Wr;gh;s2;dp;Ht;v;qi;Tr;Ye;As;o2;oa;Jr;Fl;$r;mh;_c;l2;nd;ph;od;Vt;ra;ct;it;rd;wt;xt;lt;tf;Mx;jb;yh;ef;Wb;Jb;gp;KR;HR;$e;Ol;_m;mp;a2;h2;JA;pp;qR;jR;WR;$b;JR;$R;ZR;wh;$A;la;xh;bh;kh;Ph;Iu;oh;Wt;Nt;sf;jP;WP;Dc;Zt;static Zb=null;static ZA=new p;static c2;static f2=null;Ou;Qb;_b;ld;t1;e1;yp;u2;wp;xp;bp;qx;d2;g2;nf;kp;Pp;constructor(e,i){if(wt.jw||(wt.OP(),wt.jw=!0),u.Je(this),wt.QA(this),this.Ht=!0,this.Nt=null,this.wt=0,this.xt=0,this.lt=null,wt.isUsingDOM()){const e=this,i=()=>{e.Le(t.document,"DOMContentLoaded",i,!1),e.setRTL()};null!==t.document.body?this.setRTL():e.Et(t.document,"DOMContentLoaded",i,!1)}this.tf=null,wt.m2("Model",Ie);const s=this;return this.$M=t=>s.partManager.doModelDataChanged(t),this.Zc=t=>s.partManager.doModelChanged(t),this.Wb=null,this.Jb=null,this._A(),this.model=Ue.p2(),this.themeManager=new Ci,this.Vo=!0,this.tT(),this.layout=new Le,this.Vo=!1,this.qR=null,this.jR=null,this.WR=null,this.$b=null,this.JR=null,this.$R=null,this.ZR=null,this.wh=null,this.$A=null,this.la=null,this.xh=null,this.bh=null,this.kh=null,this.Ph=null,this.Iu=()=>{},this.oh=null,this.sd=!1,this.sf=new bt(this),void 0!==e&&("string"==typeof e||t.Element&&e instanceof Element?this.w2(e):i=e),i&&this.setProperties(i),this.Ht=!1,this.requestUpdate(),this}aR(){return null!==this.lt}get renderer(){return this.Qc}set renderer(e){if(this instanceof St)return;""===e&&(e="default");const i=e.toLowerCase();if(i===this.Qc)return;this.Qc=i;let s=null;"default"===i||"canvas"===i?(s=this.zo.get("svg"),null!==s&&s.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))):"svg"===i?(this.zo.has("svg")?s=this.zo.get("svg"):(s=new Rt(this,t.document),this.addRenderer("svg",s)),null!==this.div&&(s.bt.role="img",this.div.appendChild(s.bt)),this.lt&&(this.Wt=s._t,this.lt._t.setTransform(this.$e,0,0,this.$e,0,0),this.lt._t.clearRect(0,0,this.wt,this.xt))):"debug"===i&&(this.zo.has("SVG")||(s=new Rt(this,t.document),this.addRenderer("SVG",s),s.bt.style.backgroundColor="whitesmoke",null!==this.div&&this.div.after(s.bt))),this.Ht||this.redraw()}_A(){if(this.nf=new h,this.setupRouters(),this.Ns=new lt,this.Ns.Io(this),this.jt=17,this.zM=!1,this.rd=!1,this.lb="default",this.Vt=new h,this.zo){const t=this.zo.get("svg");null!==t&&t.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))}this.zo=new p,this.Qc="default",this.resetRenderingHints(),this.QR(),this.Zt=1,this.ct=new y(NaN,NaN).k(),this.qx=new y(NaN,NaN),this.it=1,this.dp=1,this.ab=new y(NaN,NaN).k(),this.hb=NaN,this.cb=1e-4,this.fb=100,this.v=new P,this.ub=new y(NaN,NaN).k(),this.db=new w(NaN,NaN,NaN,NaN).k(),this.fh=new b(0,0,0,0).kt(),this.ah=1,this.gb=!1,this.pb=null,this.yb=null,this.ia=1,this.Wc=v.Default,this.Rr=1,this.ip=v.Default,this.wb=v.None,this.xb=v.None,this.qi=!0,this.Ju=!1,this.to=new Set,this.Or=new u,this.uh=new u,this.Uo=!1,this.ra=new p,this.nd=!0,this.sp=250,this.Jc=-1,this.np=new b(16,16,16,16).kt(),this.Tr=!1,this.$c=!1,this.$u=!0,this.fp=new D,this.fp.diagram=this,this.Wr=new D,this.Wr.diagram=this,this.gh=new D,this.gh.diagram=this,this.Ir=null,this.eo=null,this.Mx=!1,this._R(),this.$r=new u,this.bb=!0,this.kb=1,this.YM=!1,this.Pb=1,this.Sb="auto",this.op="auto",this.Er=null,this.Ur=null,this.Vr=null,this.Br=null,this.zr=null,this.Xr=null,this.Mb=null,this.Gr=null,this.Nb=!1,this.Yr=null,this.Kr=null,this.Hr=null,this.qr=null,this.Cb=!1,this.jb={},this.yh=[null,null],this.Vo=!1,this.WM=!1,this.Lb=!1,this.Ab=!1,this.JM=!0,this.As=!1,this.ph=!1,this.ZM=!0,this.Hs=-2,this.oa=new p,this.od=new h,this.Bo=!1,this.Be=!0,this.Tb=!0,this.Yl=!0,this.Kl=!0,this.Db=!1,this.vb=!0,this.Hl=!0,this.ql=!0,this.jl=!0,this.Fb=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Rb=!0,this.Ob=!0,this.QM=!1,this.ef=!1,this.Zu=!0,this.Qu=!0,this.Ib=!0,this.Eb=!0,this.Ub=16,this.Vb=16,this.rp=!1,this.Bb=!1,this.zb=0,this.Xb=0,this.Qt=new b(5).kt(),this.qA=(new u).k(),this.Gb=999999999,this.jA=(new u).k(),this.mh=!0,this._u=!0,this._c=!0,this.kn=!1,this.io=!1,this.Jr=!0,this.Fl=!1,this.so=!1,this.WA=new u,this.l2=new u,this.sa=null,this._M=new x(be.eT,be.iT),this.t2=999,this.lp=!1,this.jP=1,this.WP=0,this.Ye={scale:1,position:new y,bounds:new w,canvasSize:new x,newCanvasSize:new x,isScroll:!1},this.Ye.canvasSize=this.Ye.canvasSize,this.Ye.newCanvasSize=this.Ye.newCanvasSize,this.Ye.isScroll=!1,this.Yb=new w(NaN,NaN,NaN,NaN).k(),this.td=new x(NaN,NaN).k(),this.ap=new w(NaN,NaN,NaN,NaN).k(),this.Kb=!1,this.kp=null,this.Pp=null,this.tO(),this.ls=null,this.ed=!1,this.Dc=null,this.partManager=new Ie,this.toolManager=new X,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this._b=null,this.ld=new kt,this.t1=null,this.e1=null,this.Qb=!1,this.Ou=!1,this.commandHandler=new Ct,this.xp=null,this.bp=y.gn,this.d2=!1,this.$e=1,this.Ol=null,this._m=1,this.yp=0,this.u2=[0,0,0,0,0],this.wp=0,this.mp=1,this.a2=0,this.h2=new y,this.JA=500,this.cp=new y,this.pp=!1}static sT=void 0!==t.document;static isUsingDOM(){return wt.sT}static setDocument(e){t.document=e}static useDOM(e){wt.sT=!!e&&void 0!==t.document}static ji=new WeakMap;clear(){this.animationManager.stopAnimation(),this.model.clear(),wt.nT(),this.oT(!1),this.od.clear(),this.rT(),this.sa=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.C()}oT(t){this.animationManager.stopAnimation(!0),this.clearSelection(),this.clearHighlighteds();const i=this.skipsUndoManager,s=null!==this.Ce&&void 0!==this.Ce;s&&(this.skipsUndoManager=!0);let n=null;null!==this.ls&&(n=this.ls.part,null!==n&&this.remove(n));const o=[],r=this.Vt.length;if(t){for(let t=0;t<r;t++){const e=this.Vt.r[t].parts;for(;e.next();){const t=e.value;t!==n&&null===t.data&&o.push(t)}}for(let t=0;t<o.length;t++){const e=o[t];this.remove(e)}}for(let t=0;t<r;t++)this.Vt.r[t].IR();return this.partManager.clear(),this.to.clear(),this.Or.clear(),this.uh.clear(),this.ra.clear(),this.$r.clear(),this.Dc=null,this.od.clear(),this.rT(),e.LP=[],null!==n&&(this.add(n),this.partManager.parts.delete(n)),s&&(this.skipsUndoManager=i),o}static Sp=null;static i1="";static nT(){wt.Sp=null,wt.i1=""}static EU(){return null}reset(){this.clear(),this.Ht=!0,this._A(),this.themeManager=new Ci,this.aa(),this.Vo=!0,this.tT(),this.layout=new Le,this.Vo=!1,this.model=Ue.p2(),this.model.undoManager=new E,this.sd=!1,this.Ht=!1,this.C()}tO(){this.jr=new p,this.e2=(new me).add(new ie({stroke:"black",font:"10pt sans-serif"}).bind("text","",e.toString).theme("stroke","text").theme("font","normal")),this.jr.set("",this.e2),this.jr.set("Comment",(new me).add(new ie({stroke:"brown",font:"10pt sans-serif"}).bind("text","",e.toString).theme("stroke","comment").theme("font","normal"))),this.jr.set("LinkLabel",new me({selectable:!1,avoidable:!1}).add(new $t("Ellipse",{fill:"black",stroke:null,desiredSize:new x(3,3).kt()}).theme("fill","link"))),this.dh=new p,this.o2=new Ne(Yt.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new ie({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",e.toString).theme("stroke","text").theme("font","bold"),new Yt(Yt.Auto,{name:"GROUPPPANEL"}).add(new $t({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new Te({padding:5}).theme("padding","group"))),this.dh.set("",this.o2),this.na=new p,this.i2=(new be).add(new $t({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new $t({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.na.set("",this.i2),this.na.set("Comment",(new be).add(new $t({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.hp=new ge(Yt.Auto).add(new $t({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new Te({margin:1.5}).theme("margin","selection","numbers",null,(t=>t?new b(t/2):1.5))).freezeBindings(),this.Hb=this.hp,this.qb=new ge(Yt.Link).add(new $t({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection")).freezeBindings()}setRTL(i){let s=void 0===i?this.div:i;null===s&&(s=t.document.body);const n=e.Ni("div");n.dir="rtl",n.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",n.textContent="A",s.appendChild(n);let o="reverse";n.scrollLeft>0?o="default":(n.scrollLeft=1,0===n.scrollLeft&&(o="negative")),s.removeChild(n),this.lb=o}setScrollWidth(i){let s=void 0===i?this.div:i;null===s&&(s=t.document.body);let n=0;if(wt.isUsingDOM()){let t=wt.f2,i=wt.c2;null===t&&(wt.f2=e.Ni("p"),t=wt.f2,t.style.width="100%",t.style.height="200px",t.style.boxSizing="content-box",wt.c2=e.Ni("div"),i=wt.c2,i.style.position="absolute",i.style.visibility="hidden",i.style.width="200px",i.style.height="150px",i.style.boxSizing="content-box",i.appendChild(t)),i.style.overflow="hidden",s.appendChild(i);const o=t.offsetWidth;i.style.overflow="scroll";let r=t.offsetWidth;o===r&&(r=i.clientWidth),s.removeChild(i),n=o-r,0===n&&!e.fr&&(n=11)}this.jt=n,this.zM=!0}fe(t){t in mt?this.autoScale=t:e.ur(this,t)}toString(t){void 0===t&&(t=0);let e="";this.div&&this.div.id&&(e=this.div.id);let i='Diagram "'+e+'"';if(t<=0)return i;const s=this.Vt.iterator;for(;s.next();){i+="\n  "+s.value.toString(t-1)}return i}static QA(t){wt.Zb=t}static Om(){return wt.Zb}static fromDiv(e){let i=e;if("string"==typeof e&&(i=t.document.getElementById(e)),i instanceof HTMLDivElement){const t=wt.ji.get(i);if(t)return t}return null}get div(){return this.Nt}set div(i){if(null!==i&&e.se(i,HTMLDivElement,wt,"div"),this.Nt!==i){const e=this.Nt;if(null!==e){if(wt.ji.delete(e),e.goDiagram=void 0,e.go=void 0,e.innerHTML="",null!==this.lt){const t=this.lt.bt;this.Le(t,"pointermove",this.xh,!1),this.Le(t,"pointerdown",this.la,!1),this.Le(t,"pointerup",this.bh,!1),this.Le(t,"pointerout",this.kh,!1),this.Le(t,"pointercancel",this.Ph,!1),this.lt.dispose()}this.tf&&(this.tf.disconnect(),this.tf=null);const i=this.toolManager;null!==i&&(i.mouseDownTools.each((t=>t.cancelWaitAfter())),i.mouseMoveTools.each((t=>t.cancelWaitAfter())),i.mouseUpTools.each((t=>t.cancelWaitAfter()))),i.cancelWaitAfter(),this.currentTool.doCancel(),this.lt=null,this.Le(t,"resize",this.$b,!1),this.Le(t,"wheel",this.wh,!0),wt.Om()===this&&wt.QA(null)}else null===this.la&&(this.so=!1);if(this.Nt=null,null!==i){const t=wt.ji.get(i);t&&(t.div=null),this.w2(i),this.Iu(),this.themeManager&&this.themeManager.eO()}else this.themeManager&&this.themeManager.iO()}}setupRouters(){this.nf.push(new Ti)}w2(i){const s=this;if(!wt.isUsingDOM())return;null==i&&e.o("Diagram setup requires an argument DIV."),null!==s.Nt&&e.o("Diagram has already completed setup."),"string"==typeof i?s.Nt=t.document.getElementById(i):i instanceof HTMLDivElement?s.Nt=i:e.o("No DIV or DIV id supplied: "+i),null===s.Nt&&e.o("Invalid DIV id; could not get element with id: "+i);const n=wt.ji.get(s.Nt);if(n&&n!==this&&e.o("Invalid div id; div already has a Diagram associated with it."),!s.tf&&t.ResizeObserver){const i=t.ResizeObserver,n=e.CP((()=>s.requestUpdate()),250,!1);s.tf=new i((()=>n())),s.tf.observe(s.Nt)}"static"===t.getComputedStyle(s.Nt,null).position&&(s.Nt.style.position="relative");let o=5;const r="rgba(2"+o+"5, 255, 255, 0)";o--,s.Nt.style["-webkit-tap-highlight-color"]=r,s.Nt.innerHTML="",wt.ji.set(s.Nt,s),s.Nt.goDiagram=s,s.Nt.go=t.go;const a=new Et(s);void 0!==a.style&&(a.style.position="absolute",a.style.top="0px",a.style.left="0px","rtl"===t.getComputedStyle(s.Nt,null).getPropertyValue("direction")&&(s.rd=!0),a.style.zIndex="2",a.style.userSelect="none",a.style.MozUserSelect="none",a.style.touchAction="none",a.style.letterSpacing="normal !important",a.style.wordSpacing="normal !important",a.style.lang="unknown"),a.bt.setAttribute("role","application"),s.lt=a,s.Wt=a._t;const h=s.Wt;s.$e=s.computePixelRatio(),s.viewSize.isReal()||(s.wt=s.Nt.clientWidth||1,s.xt=s.Nt.clientHeight||1),s.lT(s.wt,s.xt);const l=s;s.Nt.insertBefore(a.bt,s.Nt.firstChild);const u=new Et(null);if(u.width=1,u.height=1,s.KR=u,s.HR=u._t,wt.isUsingDOM()){const t=e.Ni("div"),i=e.Ni("div");t.style.position="absolute",t.style.overflow="auto",t.style.width=s.wt+"px",t.style.height=s.xt+"px",t.style.zIndex="1",i.style.position="absolute",i.style.width="1px",i.style.height="1px",s.Nt.appendChild(t),t.appendChild(i),t.onscroll=wt.sO,t.addEventListener("pointerdown",wt.nO),t.a=s,t.oO=!0,t.rO=!0,s.Wb=t,s.Jb=i}s.Iu=e.CP((()=>{s.Ol=null,s.C()}),300,!1),s.$b=e.CP((()=>{s.NM()}),250,!1),s.oh=t=>(t.preventDefault(),!1),s.wh=t=>{if(!l.isEnabled)return;const e=l.of(t,!0);e.bubbles=!0;let i=0,s=0;e.delta=0,void 0!==t.deltaX?(0!==t.deltaX&&(i=t.deltaX>0?1:-1),0!==t.deltaY&&(s=t.deltaY>0?1:-1),e.delta=Math.abs(t.deltaX)>Math.abs(t.deltaY)?-i:-s):void 0!==t.wheelDeltaX?(0!==t.wheelDeltaX&&(i=t.wheelDeltaX>0?-1:1),0!==t.wheelDeltaY&&(s=t.wheelDeltaY>0?-1:1),e.delta=Math.abs(t.wheelDeltaX)>Math.abs(t.wheelDeltaY)?-i:-s):void 0!==t.wheelDelta&&0!==t.wheelDelta&&(e.delta=t.wheelDelta>0?1:-1),l.doMouseWheel(),l.Sh(e,t)},s.$A=t=>{if(!l.isEnabled)return;s.ef=!1,l.of(t,!0);const e=l.currentTool;e.cancelWaitAfter(),e.standardMouseOver()},s.la=t=>{if(!l.isEnabled)return;s.ef=!0;const e=l.jb;void 0===e[t.pointerId]&&(e[t.pointerId]=t);const i=l.yh;let n=!1;if(null===i[0]||i[0].pointerId!==t.pointerId&&i[0].pointerType===t.pointerType)if(null!==i[1]&&i[1].pointerId===t.pointerId)i[1]=t,n=!0;else if(null===i[0])i[0]=t;else{if(null!==i[1])return void t.preventDefault();i[1]=t,n=!0}else i[0]=t;const o="touch"===t.pointerType||"pen"===t.pointerType;o&&(l.Mx=!1,l.pp=!0);const r=l.lO(t,t,n),a=l.h2,h=o?25:10;t.timeStamp-l.a2<l.JA&&!(Math.abs(a.x-t.screenX)>h||Math.abs(a.y-t.screenY)>h)?l.mp++:l.mp=1,r.clickCount=l.mp,l.a2=t.timeStamp,l.h2.setTo(t.screenX,t.screenY),l.doMouseDown(),1!==t.button?l.Sh(r,t):t.preventDefault()},s.xh=t=>{if(!l.isEnabled)return;s.ef=!0;const e=l.yh;if(null===e[0]||e[0].pointerId!==t.pointerId&&e[0].pointerType===t.pointerType){if(null!==e[1]&&e[1].pointerId===t.pointerId)return void(e[1]=t);if(null!==e[0])return;e[0]=t}else e[0]=t;if(e[0].pointerId!==t.pointerId)return;const i=l.aO(t,t,null!==e[1]);l.doMouseMove(),l.Sh(i,t)},s.bh=e=>{if(!l.isEnabled)return;s.ef=!0;const i="touch"===e.pointerType||"pen"===e.pointerType,n=l.jb;if(i&&l.Mx)return delete n[e.pointerId],void e.preventDefault();const o=l.yh;if(null===o[0]||o[0].pointerId!==e.pointerId&&o[0].pointerType===e.pointerType)return null!==o[1]&&o[1].pointerId===e.pointerId?void(o[1]=null):void 0;o[0]=null;const r=l.b2(e,!1,!0,!1,!0,!1);let a=t.document.elementFromPoint(e.clientX,e.clientY)||null;null!==a&&a.shadowRoot&&(a=a.shadowRoot.elementFromPoint(e.clientX,e.clientY)||null),null!==a&&a.a instanceof wt&&a.a!==l&&a.a.Mp(e,r),null===a&&(a=e.target),l.Mp(e,r),r.clickCount=l.mp,r.targetDiagram=l.s1(e,a),r.targetObject=null,l.doMouseUp(),l.Sh(r,e),i&&(l.pp=!1)},s.kh=t=>{if(!l.isEnabled)return;s.ef=!1;const e=l.jb;e[t.pointerId]&&delete e[t.pointerId];const i=l.yh;if(null!==i[0]&&i[0].pointerId===t.pointerId&&(i[0]=null),null!==i[1]&&i[1].pointerId===t.pointerId&&(i[1]=null),"touch"===t.pointerType||"pen"===t.pointerType)return;const n=l.currentTool;n.cancelWaitAfter(),n.standardMouseOver()},s.Ph=t=>{const e=l.yh;null!==e[0]&&e[0].pointerId===t.pointerId?(e[0]=null,l.pp=!1):null!==e[1]&&e[1].pointerId===t.pointerId&&(e[1]=null)};const c=h;if(s.gp=c.F[e.We("7eba17a4ca3b1a8346")][e.We("78a118b7")](c.F,wt.Mh,o,o),h.clearContextCache(!0),s.hO(),"svg"===this.Qc){const t=this.zo.get("svg");this.Nt&&this.Nt.appendChild(t.bt),this.Wt=t._t}}addEventListener(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}Et(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}removeEventListener(t,e,i,s){t.removeEventListener(e,i,{capture:s})}Le(t,e,i,s){t.removeEventListener(e,i,{capture:s})}hO(){const e=this;let i=this.lt.bt;i instanceof HTMLCanvasElement||(i=e.div),this.Et(i,"pointerdown",e.la,!1),this.Et(i,"pointermove",e.xh,!1),this.Et(i,"pointerup",e.bh,!1),this.Et(i,"pointerout",e.kh,!1),this.Et(i,"pointercancel",e.Ph,!1),this.Et(i,"pointerenter",e.cO,!1),this.Et(i,"pointerleave",e.fO,!1),this.Et(i,"wheel",e.wh,!1),this.Et(i,"keydown",e.uO,!1),this.Et(i,"keyup",e.dO,!1),this.Et(i,"blur",e.gO,!1),this.Et(i,"focus",e.mO,!1),this.Et(i,"selectstart",(t=>(t.preventDefault(),!1)),!1),this.Et(i,"contextmenu",(t=>(t.preventDefault(),!1)),!1),this.Et(t,"resize",e.$b,!1)}Cx(){this.yp>30&&(this.Ol=1)}yS(t){null!==this.Ol&&(this.Ol=null,t&&this.Iu(),this.yp=0,this.u2=[0,0,0,0,0],this.wp=0)}computePixelRatio(){return null!==this.Ol?this.Ol:t.devicePixelRatio||1}get avgSpf(){return this.yp}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){const t=this.commandHandler;if(!this.toggleKeyboardControl()){if((t.isFocusEnabled||t.isVirtualPointerEnabled)&&t.doVirtualFocusKeyDown()){const t=this.lastInput;t.bubbles=!1;const e=t.event;return void(e&&(e.stopPropagation&&e.stopPropagation(),!1!==e.cancelable&&e.preventDefault()))}this.currentTool.doKeyDown()}}toggleKeyboardControl(){const t=this.lastInput,e=t.commandKey;if((t.control||t.meta)&&t.alt&&("Enter"===e||"NumpadEnter"===e)){const t=this.commandHandler,e=t.isFocusEnabled||t.isVirtualPointerEnabled;return t.isFocusEnabled=!e,t.isVirtualPointerEnabled=!e,t.focus=t.findFirstFocus(),this.T("FocusOrVirtualPointerEnabledChanged"),!0}return!1}doKeyUp(){const t=this.commandHandler;if((t.isFocusEnabled||t.isVirtualPointerEnabled)&&t.doVirtualFocusKeyUp()){const t=this.lastInput;t.bubbles=!1;const e=t.event;e&&(e.stopPropagation&&e.stopPropagation(),!1!==e.cancelable&&e.preventDefault())}else this.currentTool.doKeyUp()}ad(t,e){if(e)for(const i in e)"sourceDiagram"!==i&&(t[i]=e[i])}emitMouseDown(t,e,i,s){if("number"!=typeof t||"number"!=typeof e)throw new Error("Robot.mouseDown first two args must be X,Y numbers");void 0===i&&(i=0);let n=this;if(s&&s.sourceDiagram&&(n=s.sourceDiagram),!n.isEnabled)return this;const o=new D;return o.diagram=n,o.documentPoint=new y(t,e),o.viewPoint=n.transformDocToView(o.documentPoint),o.timestamp=i,o.down=!0,this.ad(o,s),n.lastInput=o,n.firstInput=o.copy(),n.doMouseDown(),this}emitMouseMove(t,e,i,s){if("number"!=typeof t||"number"!=typeof e)throw new Error("Robot.mouseMove first two args must be X,Y numbers");void 0===i&&(i=0);let n=this;if(s&&s.sourceDiagram&&(n=s.sourceDiagram),!n.isEnabled)return this;const o=new D;return o.diagram=n,o.documentPoint=new y(t,e),o.viewPoint=n.transformDocToView(o.documentPoint),o.timestamp=i,this.ad(o,s),n.lastInput=o,n.doMouseMove(),this}emitMouseUp(t,e,i,s){if("number"!=typeof t||"number"!=typeof e)throw new Error("Robot.mouseUp first two args must be X,Y numbers");void 0===i&&(i=0);let n=this;if(s&&s.sourceDiagram&&(n=s.sourceDiagram),!n.isEnabled)return this;const o=new D;return o.diagram=n,o.documentPoint=new y(t,e),o.viewPoint=n.transformDocToView(o.documentPoint),o.timestamp=i,o.up=!0,n.firstInput.documentPoint.equals(o.documentPoint)&&(o.clickCount=1),this.ad(o,s),n.lastInput=o,n.doMouseUp(),this}emitMouseWheel(t,e,i){if("number"!=typeof t)throw new Error("Robot.mouseWheel first arg must be DELTA number");void 0===e&&(e=0);const s=this;if(!s.isEnabled)return this;const n=new D;return n.diagram=s,n.documentPoint=s.lastInput.documentPoint,n.viewPoint=s.lastInput.viewPoint,n.delta=t,n.timestamp=e,this.ad(n,i),s.lastInput=n,s.doMouseWheel(),this}emitKeyDown(t,e,i){if("string"!=typeof t&&"number"!=typeof t)throw new Error("Robot.keyDown first arg must be a string or a number");void 0===e&&(e=0);const s=this;if(!s.isEnabled)return this;const n=new D;return n.diagram=s,n.documentPoint=s.lastInput.documentPoint,n.viewPoint=s.lastInput.viewPoint,"string"==typeof t?n.key=t:"number"==typeof t&&(n.key=String.fromCharCode(t)),n.timestamp=e,n.down=!0,this.ad(n,i),s.lastInput=n,s.doKeyDown(),this}emitKeyUp(t,e,i){if("string"!=typeof t&&"number"!=typeof t)throw new Error("Robot.keyUp first arg must be a string or a number");void 0===e&&(e=0);const s=this;if(!s.isEnabled)return this;const n=new D;return n.diagram=s,n.documentPoint=s.lastInput.documentPoint,n.viewPoint=s.lastInput.viewPoint,"string"==typeof t?n.key=t:"number"==typeof t&&(n.key=String.fromCharCode(t)),n.timestamp=e,n.up=!0,this.ad(n,i),s.lastInput=n,s.doKeyUp(),this}doFocus(){this.focus()}focus(){if(this.lt)if(this.scrollsPageOnFocus)this.lt.focus();else{const e=t.scrollX,i=t.scrollY;this.lt.focus(),t.scrollTo(e,i)}}mO(t){const e=wt.ji.get(this);e&&e.T("GainedFocus")}gO(t){const e=wt.ji.get(this);e&&e.T("LostFocus")}NM(){if(null===this.lt)return;const t=this.Nt;if(null===t||0===t.clientWidth||0===t.clientHeight)return;this.zM||this.setScrollWidth();const e=this.io?this.jt:0,i=this.kn?this.jt:0,s=this.$e;if(this.$e=this.computePixelRatio(),this.$e!==s&&(this.Ju=!0,this.requestUpdate()),t.clientWidth!==this.wt+e||t.clientHeight!==this.xt+i){this.Nh(),this.qi=!0;const t=this.layout;null!==t&&t.isViewportSized&&1===this.autoScale&&(this.$c=!0,t.p()),this.As||this.requestUpdate()}}tT(){let t=0,e=new ft;e.name="Grid",e.allowSelect=!1,e.pickable=!1,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Zr(e,t++),e=new ft,e.name="ViewportBackground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Zr(e,t++),e=new ft,e.name="Background",this.Zr(e,t++),e=new ft,e.name="",this.Zr(e,t++),e=new ft,e.name="Foreground",this.Zr(e,t++),e=new ft,e.name="ViewportForeground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Zr(e,t++),e=new ft,e.name="Adornment",e.isTemporary=!0,e.isInDocumentBounds=!1,this.Zr(e,t++),e=new ft,e.name="Tool",e.isTemporary=!0,e.isInDocumentBounds=!0,this.Zr(e,t++)}aT(){const t=new Yt(Yt.Grid,{name:"GRID"}).add(new $t("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new $t("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new $t("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new $t("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new $t("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new $t("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),e=new ce({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(t);return this.add(e),this.partManager.parts.delete(e),t.visible=!1,t}static sO(){const t=wt.ji.get(this.parentElement||this);if(t){if(t.Bb)return void(t.Bb=!1);if(!t.isEnabled)return void t.hT();t.diagramScroll(this)}}static nO(t){this.a.isEnabled?(this.a.zb=t.target.scrollTop,this.a.Xb=t.target.scrollLeft):this.a.updateScroll()}diagramScroll(t){if(null===this.lt)return;const e=this.Wb,i=this.Jb;this.rp=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.fh;let r=s.x-o.left,a=s.y-o.top;const h=s.width+o.left+o.right,l=s.height+o.top+o.bottom;let u=s.right+o.right,c=s.bottom+o.bottom,d=n.x,g=n.y;const f=n.width,m=n.height;let p=n.right,x=n.bottom;const w=this.scale;let b,v=t.scrollLeft;if(this.rd)switch(this.lb){case"negative":v=v+t.scrollWidth-t.clientWidth;break;case"reverse":v=t.scrollWidth-v-t.clientWidth}const P=v;if(f<h||m<l)return b=y.z(this.position.x,this.position.y),this.allowHorizontalScroll&&this.Xb!==P&&(b.x=P/w+r,this.Xb=P),this.allowVerticalScroll&&this.zb!==t.scrollTop&&(b.y=t.scrollTop/w+a,this.zb=t.scrollTop),this.position=b,y.i(b),this.rp=!1,void(this._u=!1);if(b=y.l(),t.oO&&this.allowHorizontalScroll&&(r<d&&(this.position=b.e(P+r,this.position.y)),u>p)){const t=e.scrollWidth-this.wt;this.position=b.e(-t+P-this.wt/w+u,this.position.y)}if(t.rO&&this.allowVerticalScroll&&(a<g&&(this.position=b.e(this.position.x,t.scrollTop+a)),c>x)){const i=e.scrollHeight-this.xt;this.position=b.e(this.position.x,-i+t.scrollTop-this.xt/w+c)}y.i(b),this.ha(),this.rp=!1,this._u=!1,s=this.documentBounds,n=this.viewportBounds,u=s.right,p=n.right,c=s.bottom,x=n.bottom,r=s.x,d=n.x,a=s.y,g=n.y,f>=h&&r>=d&&u<=p&&(i.style.width="1px"),m>=l&&a>=g&&c<=x&&(i.style.height="1px")}computeBounds(t){return void 0===t&&(t=new w),this.Te(),this.cT(t)}cT(t){if(this.fixedBounds.isReal())return t.h(this.fixedBounds),t.addMargin(this.Qt),t;let e=!0;const i=this.Vt.r,s=i.length;for(let n=0;n<s;n++){const s=i[n];if(!s.visible||!s.isInDocumentBounds)continue;const o=s.Ct.r,r=o.length;for(let i=0;i<r;i++){const s=o[i];if(!s.isInDocumentBounds||!s.isVisible())continue;const n=s.actualBounds;n.isReal()&&(e?(e=!1,t.h(n)):t.unionRect(n))}}return e&&t.e(0,0,0,0),t.addMargin(this.Qt),t}computePartsBounds(t,e){let i;if(void 0===e&&(e=!1),Array.isArray(t))for(let s=0;s<t.length;s++){const n=t[s];!e&&n instanceof be||(n.ensureBounds(),void 0===i?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{const s=t.iterator;for(;s.next();){const t=s.value;!e&&t instanceof be||(t.ensureBounds(),void 0===i?i=t.actualBounds.copy():i.unionRect(t.actualBounds))}}return void 0===i?new w(NaN,NaN,0,0):i}Js(t){if(!t&&!this.so||this.Ht||null===this.lt||!this.documentBounds.isReal())return;if(this.Ht=!0,t){const t=this.initialPosition;if(t.isReal())return this.Ht=!1,void(this.position=t);let e=this.initialDocumentSpot,i=this.initialViewportSpot;e.isNoSpot()&&(e=v.TopLeft),i.isNoSpot()&&(i=v.TopLeft);const s=y.l();s.setRectSpot(this.documentBounds,e);const n=this.viewportBounds,o=w.z(0,0,n.width,n.height),r=y.l();r.setRectSpot(o,i),r.e(s.x-r.x,s.y-r.y),this.Ht=!1,this.position=r,w.i(o),y.i(r)}let e=this.ia;t&&1!==this.Rr&&(e=this.Rr);const i=1!==e?this.hd(e):this.scale,s=this.ct.x,n=this.ct.y,o=this.wt/i,r=this.xt/i;let a=this.Wc;const h=this.ip;if(t&&!a.isSpot()&&(h.isSpot()||h.isDefault())){const t=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();a=h.isDefault()&&!t?v.Center:h}this.k2(this.documentBounds,o,r,a,t);const l=this.scale;this.scale=i,this.Ht=!1;const u=this.viewportBounds;u.equalsApproxTo(s,n,o,r)||this.onViewportBoundsChanged(new w(s,n,o,r),u,l,!1)}hd(t){const e=this.dp;if(null===this.lt)return e;if(1===t)return this.scale;this.ensureBounds();const i=this.documentBounds;if(!i.isReal())return e;const s=i.width,n=i.height,o=this.wt+(this.io?this.jt:0),r=this.xt+(this.kn?this.jt:0);let a=o/s,h=r/n;const l=this.fh,u=l.left+l.right!==0,c=l.top+l.bottom!==0;(u||c)&&(h===a?(h=(r-this.jt)/n,a=(o-this.jt)/s):h>a?h=(r-this.jt)/n:a=(o-this.jt)/s);let d=0;return 2===t?d=Math.min(h,a):3===t&&(d=h>a?(r-this.jt)/n:(o-this.jt)/s),d>e&&(d=e),d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),d}zoomToFit(){const t=this.ah;this.ah=1,this.scale=this.hd(2),this.alignDocument(v.Center,v.Center),1!==t&&(this.Js(!1),this.k2(this.documentBounds,this.wt/this.it,this.xt/this.it,this.Wc,!1)),this.ah=t}zoomToRect(t,e){void 0===e&&(e=2);const i=t.width,s=t.height;if(0===i||0===s||isNaN(i)&&isNaN(s))return;let n=1;if(2===e||3===e)if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{const t=this.wt,o=this.xt;n=3===e?o/s>t/i?(o-(this.kn?this.jt:0))/s:(t-(this.io?this.jt:0))/i:Math.min(o/s,t/i)}this.scale=n,this.position=new y(t.x,t.y)}get pO(){return this.Ht}set pO(t){this.Ht=t}alignDocument(t,e){this.ensureBounds();const i=this.documentBounds,s=this.viewportBounds;this.position=new y(i.x+(t.x*i.width+t.offsetX)-(e.x*s.width-e.offsetX),i.y+(t.y*i.height+t.offsetY)-(e.y*s.height-e.offsetY))}focusObject(t){if(t instanceof At){this.xp=t;const e=y.l();this.bp=this.transformDocToView(t.getDocumentPoint(v.TopLeft,e)),y.i(e)}else this.xp=null,this.bp=y.gn}k2(t,e,i,s,n){const o=y.z(this.ct.x,this.ct.y);let r=o.x,a=o.y;if(null!==this.xp){let t=y.l();t=this.xp.getDocumentPoint(v.TopLeft,t),r=t.x-this.bp.x/this.scale,a=t.y-this.bp.y/this.scale,s=v.None,y.i(t)}if(n||1===this.scrollMode){s.isSpot()&&(e>t.width&&(r=t.x+(s.x*t.width+s.offsetX)-(s.x*e-s.offsetX)),i>t.height&&(a=t.y+(s.y*t.height+s.offsetY)-(s.y*i-s.offsetY)));const n=this.fh,o=e-t.width;if(e<t.width+n.left+n.right){let i=r+e/2;i=Math.min(i,t.right+Math.max(o,n.right)-e/2),i=Math.max(i,t.left-Math.max(o,n.left)+e/2),r=i-e/2}else r>t.left?r=t.left:r<t.right-e&&(r=t.right-e);const h=i-t.height;if(i<t.height+n.top+n.bottom){let e=a+i/2;e=Math.min(e,t.bottom+Math.max(h,n.bottom)-i/2),e=Math.max(e,t.top-Math.max(h,n.top)+i/2),a=e-i/2}else a>t.top?a=t.top:a<t.bottom-i&&(a=t.bottom-i)}if(o.x=isFinite(r)?r:-this.Qt.left,o.y=isFinite(a)?a:-this.Qt.top,null!==this.positionComputation){const t=this.positionComputation(this,o);o.x=t.x,o.y=t.y}this.Ns.UA(this.ct,o),this.ct.e(o.x,o.y),this.Np(),this.aa(),this.yO(),y.i(o)}findPartAt(t,e){if(void 0===e&&(e=!0),e){const e=this.kS(t,(t=>t.part),(t=>t.canSelect()));if(e instanceof ce)return e}else{const e=this.kS(t,(t=>t.part));if(e instanceof ce)return e}return null}findObjectAt(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.Te();const s=this.Vt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(t,e,i);if(null!==o)return o}return null}kS(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.Te();const s=this.Vt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(t,e,i);if(null!==o)return o}return null}findPartsAt(t,e,i){return void 0===e&&(e=!0),this.wO(t,(t=>t.part),e?t=>t instanceof ce&&t.canSelect():null,i)}wO(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),!(s instanceof h)&&!(s instanceof u)&&(s=new u),this.Te();const n=this.Vt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(t,e,i,s)}return s}findObjectsAt(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),!(s instanceof h)&&!(s instanceof u)&&(s=new u),this.Te();const n=this.Vt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(t,e,i,s)}return s}findPartsIn(t,e,i,s){return void 0===e&&(e=!1),void 0===i&&(i=!0),this.xO(t,null,(t=>t instanceof ce&&(!i||t.canSelect())),e,s)}findObjectsIn(t,e,i,s,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),!(n instanceof h)&&!(n instanceof u)&&(n=new u),this.Te();const o=this.Vt.iteratorBackwards;for(;o.next();){const r=o.value;r.visible&&r.findObjectsIn(t,e,i,s,n)}return n}MS(t,e,i,s,n,o){const r=new u;this.Te();const a=this.Vt.iteratorBackwards;for(;a.next();){const h=a.value;h.visible&&h.MS(t,e,i,s,r,n,o)}return r}xO(t,e,i,s,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),!(n instanceof h)&&!(n instanceof u)&&(n=new u),this.Te();const o=this.Vt.iteratorBackwards;for(;o.next();){const r=o.value;!r.visible||r.isTemporary||r.findObjectsIn(t,e,i,s,n)}return n}findPartsNear(t,e,i,s,n){return void 0===i&&(i=!0),void 0===s&&(s=!0),this.bO(t,e,null,(t=>t instanceof ce&&(!s||t.canSelect())),i,n)}findObjectsNear(t,e,i,s,n,o){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof h||n instanceof u)&&(o=n),n=!0),!(o instanceof h)&&!(o instanceof u)&&(o=new u),this.Te();const r=this.Vt.iteratorBackwards;for(;r.next();){const a=r.value;a.visible&&a.findObjectsNear(t,e,i,s,n,o)}return o}bO(t,e,i,s,n,o){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),!1!==n&&!0!==n&&((n instanceof h||n instanceof u)&&(o=n),n=!0),!(o instanceof h)&&!(o instanceof u)&&(o=new u),this.Te();const r=this.Vt.iteratorBackwards;for(;r.next();){const a=r.value;!a.visible||a.isTemporary||a.findObjectsNear(t,e,i,s,n,o)}return o}acceptEvent(t){return this.of(t,t instanceof MouseEvent)}of(t,i){const s=this.Wr;this.Wr=this.gh,this.gh=s,s.diagram=this,s.event=t,i?this.Mp(t,s):(s.viewPoint=this.Wr.viewPoint,s.documentPoint=this.Wr.documentPoint);let n=0;const o=t;return o.ctrlKey&&(n+=1),o.altKey&&(n+=2),o.shiftKey&&(n+=4),o.metaKey&&(n+=8),s.modifiers=n,s.button=o.button,void 0!==o.buttons&&(s.buttons=o.buttons),e.fr&&0===o.button&&o.ctrlKey&&(s.button=2),s.down=!1,s.up=!1,s.clickCount=1,s.delta=0,s.handled=!1,s.bubbles=!1,s.timestamp=t.timeStamp,s.isMultiTouch=!1,s.targetDiagram=this.s1(t,t.target),s.targetObject=null,s}s1(t,i){if(null===i)return null;const s=wt.ji.get(i);if(s)return s;let n=t.path;if(!n&&e.st(t.composedPath)&&(n=t.composedPath()),n&&n[0]){const t=wt.ji.get(n[0]);if(t)return t}return null}lO(t,e,i){const s=this.b2(t,!0,!1,!1,!0,i);return this.Mp(e,s),s.targetDiagram=this.s1(t,t.target),s.targetObject=null,i||s.clone(this.fp),s}aO(e,i,s){const n=this.b2(e,!1,!1,!1,!1,s);let o=t.document.elementFromPoint(i.clientX,i.clientY)||null;null!==o&&o.shadowRoot&&(o=o.shadowRoot.elementFromPoint(i.clientX,i.clientY)||null);let r=this,a=e;if(o){const t=this.s1(e,o);t&&(a=i,r=t)}return n.targetDiagram=r,this.Mp(a,n),n.targetObject=null,n}b2(t,i,s,n,o,r){const a=this.Wr;this.Wr=this.gh,this.gh=a,a.diagram=this,a.clickCount=1,a.delta=0;let h=0;return t.ctrlKey&&(h+=1),t.altKey&&(h+=2),t.shiftKey&&(h+=4),t.metaKey&&(h+=8),a.modifiers=h,a.event=t,a.timestamp=t.timeStamp,a.button=s?this.firstInput.button:t.button,a.buttons=t.buttons,e.fr&&0===t.button&&t.ctrlKey&&(a.button=2),a.down=i,a.up=s,a.handled=n,a.bubbles=o,a.isMultiTouch=r,a}Sh(t,e){return!!t.bubbles||(void 0!==e.stopPropagation&&e.stopPropagation(),!1!==e.cancelable&&e.preventDefault(),e.cancelBubble=!0,!1)}uO(t){const e=wt.ji.get(this);if(!e||!e.isEnabled)return!1;const i=e.of(t,!1);return i.key=t.key,i.code=t.code,i.down=!0,e.doKeyDown(),e.Sh(i,t)}dO(t){const e=wt.ji.get(this);if(!e||!e.isEnabled)return!1;const i=e.of(t,!1);return i.key=t.key,i.code=t.code,i.up=!0,e.doKeyUp(),e.Sh(i,t)}cO(t){const e=wt.ji.get(this);if(!e||!e.isEnabled)return!1;const i=e.of(t,!0);return null!==e.mouseEnter&&e.mouseEnter(i),e.currentTool.standardMouseOver(),e.Sh(i,t)}fO(t){const e=wt.ji.get(this);if(!e||!e.isEnabled)return!1;const i=e.of(t,!0);return null!==e.mouseLeave&&e.mouseLeave(i),e.Sh(i,t)}getMouse(t){const e=this.lt;if(null===e)return new y(0,0);const i=e.getBoundingClientRect(),s=(t.clientX-i.left)*(this.wt/i.width),n=(t.clientY-i.top)*(this.xt/i.height);return new y(s,n).Yi(this.v)}Mp(t,e){const i=this.lt;let s=0,n=0;if(null!==i){const e=i.getBoundingClientRect();s=(t.clientX-e.left)*(this.wt/e.width),n=(t.clientY-e.top)*(this.xt/e.height)}e.viewPoint.e(s,n);const o=y.z(s,n);this.v.Ci(o),e.documentPoint.h(o),y.i(o)}eA(t,e,i){let s;if(null===this.yh[0])return;s=this.yh[e];const n=this.lt;if(null!==n){const t=n.getBoundingClientRect();i.e((s.clientX-t.left)*(this.wt/t.width),(s.clientY-t.top)*(this.xt/t.height))}}invalidateDocumentBounds(){this.mh||(this.mh=!0,this.requestUpdate(!1))}kO(){this.As||this.Te(),this.ensureBounds()}redraw(){this.Ht||this.As||(this.C(),this.maybeUpdate())}isUpdateRequested(){return this.Tr}delayInitialization(t){void 0===t&&(t=null);const i=this.animationManager,s=i.isEnabled;i.stopAnimation(),i.isEnabled=!1,this.Pr(),this.so=!1,this.qx=new y(NaN,NaN),i.isEnabled=s,this.As=!0;const n=this;null!==t&&e.un((()=>{n.As=!1,i.Gl("Model"),t(n)}),1)}requestUpdate(e){if(void 0===e&&(e=!1),!0===this.Tr||this.Ht||!1===e&&this.As)return;this.Tr=!0;const i=this;t.requestAnimationFrame((()=>{i.Tr&&i.maybeUpdate()}))}maybeUpdate(){this.$u&&!this.Tr||(this.$u&&(this.$u=!1),this.Pr())}P2(t,e){!this._u||this.Ht||this.animationManager.defaultAnimation.isAnimating||this.hT()||(t&&this.Te(),e&&this.Js(!1))}Pr(t){if(this.As||(this.Tr=!1,null===this.Nt&&!this.td.isReal()))return;this.As=!0;const e=this.animationManager,i=this.od;if(!e.isAnimating&&0!==i.length){const t=i.r,e=t.length;for(let i=0;i<e;i++){const e=t[i];e.xi(!1),e.f()}i.clear()}const s=this.l2;s.count>0&&(s.each((t=>t.S2())),s.clear());let n=!1,o=!1;e.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),e.ke||this.NM(),t||this.P2(!1,!0);const r=!this.undoManager.isUndoingRedoing&&(this.Fl||0!==this.nf.count&&0!==this.Or.size),a=!this.so||this.Jr;this.Te(!0);let h=!1;(a||r)&&(this.so?this.M2(!this.$c,r):(this.startTransaction("Initial Layout"),!1===e.isEnabled&&e.stopAnimation(),this.M2(!1,r)),h=a),this.$c=!1,this.Fl=!1,this.Te(),null!==this.ls&&(this.ls.visible&&!this.ed&&(this.ca(),this.ed=!0),!this.ls.visible&&this.ed&&(this.ed=!1)),this.Lb||this.kO(),t||this.P2(!0,!1);let l=!1;if(h){const e=w.l();e.h(this.viewportBounds),this.so||(this.so=!0,l=!0,this.skipsUndoManager||(this.undoManager.Px=!0),this.undoManager.Sx=!0,this.PO()),this.SO(),this.Te(!1),t||this.P2(!0,!0),w.i(e)}else if(e.Bc&&e.Hx){if(1!==this.Rr)this.scale=this.hd(this.Rr);else if(1!==this.ia)this.scale=this.hd(this.ia);else{const t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.Js(!0)}h&&l&&this.commitTransaction("Initial Layout"),t||this.Ge(this.Wt),o&&(this.skipsUndoManager=n),this.As=!1}get Qa(){return this.so}PO(){if(1!==this.Rr)this.scale=this.hd(this.Rr);else if(1!==this.ia)this.scale=this.hd(this.ia);else{const t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.Js(!0);const t=this.Vt.r;this.rs(t,t.length,this,this.viewportBounds),this.T("InitialLayoutCompleted"),this.qx.h(this.ct),this.ca()}SO(){this.T("LayoutCompleted")}Cp(t){this.to.add(t)}addInvalidRoute(t){this.Uo?this.uh.add(t):this.Or.add(t)}Te(t){if(0!==this.to.size&&(this.As||!this.animationManager.isTicking)){if(this.As||(this.Fl=!0),t)return void this.fT(this.to);for(let t=0;t<23&&0!==this.to.size;t++){const t=new Set(this.to);this.to.clear(),this.S2(t,this.to)}this.nodes.each((t=>{t instanceof Ne&&t.uT(!1)}))}}fT(t,e){for(const i of t)!i.Di()||i instanceof Ne||(i.Qr()?(i.ht(1/0,1/0),i.Ut()):e&&e.add(i));for(const e of t)if(e instanceof Ne){if(!e.isVisible())continue;this.o1(e)}}S2(t,e){this.fT(t,e);for(const i of t){if(!(i instanceof be))continue;const t=i;t.isVisible()&&(t.Qr()?(t.ht(1/0,1/0),t.Ut()):e.add(t))}for(const i of t)i instanceof ge&&i.isVisible()&&(i.Qr()?(i.ht(1/0,1/0),i.Ut()):e.add(i))}cd(t){const e=t instanceof wt,i=e?t.links:t.memberParts,s=this.to;if(e)this.Te(!0);else{for(;i.next();){const t=i.value;s.has(t)&&(!t.Di()||t instanceof Ne||t.Qr()&&(t.ht(1/0,1/0),t.Ut()))}for(i.reset();i.next();){const t=i.value;if(s.has(t)&&t instanceof Ne){if(!t.isVisible())continue;this.o1(t)}}i.reset()}for(;i.next();){const t=i.value;t instanceof be&&s.has(t)&&t.isVisible()&&t.Qr()&&(t.ht(1/0,1/0),t.Ut())}}o1(t){const i=e.nt(),s=e.nt(),n=t.memberParts;for(;n.next();){const e=n.value;e.isVisible()&&(e instanceof Ne?(e.Xo()||e.as()||e.fa())&&this.o1(e):e instanceof be?e.fromNode===t||e.toNode===t?s.push(e):i.push(e):(e.ht(1/0,1/0),e.Ut()))}let o=i.length;for(let t=0;t<o;t++){const e=i[t];e.ht(1/0,1/0),e.Ut()}e.Z(i),t.ht(1/0,1/0),t.Ut(),o=s.length;for(let t=0;t<o;t++){const e=s[t];e.ht(1/0,1/0),e.Ut()}e.Z(s)}rs(t,e,i,s){if(this._c||this.animationManager.isAnimating){for(let n=0;n<e;n++)t[n].rs(i,s);this.Te()}}Ge(t){null!==this.Nt&&(null===this.lt&&e.o("No canvas specified"),"svg"===this.Qc?this.MO(t):this.NO(t))}NO(t){const e=this.animationManager;if(e.ke||e.isAnimating&&!e.isTicking)return;const i=new Date;if(this.Lp(),this.Nt&&"0"===this.Nt.style.opacity)return;const s=t!==this.Wt,n=this.Vt.r,o=n.length,r=this;if(this.rs(n,o,r,r.viewportBounds),s)t.clearContextCache(!0),this.ha();else if(!this.qi&&!e.isAnimating)return;const a=this.v,h=this.$e;t.setTransform(h,0,0,h,0,0),t.clearRect(0,0,this.wt,this.xt),1!==this.Zt&&(t.globalAlpha=this.Zt),this.N2(t);for(let e=0;e<o;e++)t.setTransform(h,0,0,h,0,0),t.transform(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),t.commitTransform(),n[e].Ge(t,r);let l=!1;this.sf?this.sf.Mh(this,t)&&(l=this.gp()):l=!0,l&&(P.prototype.Ci=P.prototype.Su),s?(this.Wt.clearContextCache(!0),this.ha()):(this._c=!1,this.qi=!1);const u=+new Date-+i,c=!1,d=this.u2;if(null===this.Ol){d[this.wp]=u,this.wp=(this.wp+1)%d.length;let t=0;for(let e=0;e<d.length;e++)t+=d[e];this.yp=t/d.length}1!==this.Zt&&(t.globalAlpha=1)}MO(t){if(null===this.Nt)return;const e=this.animationManager;if(e.ke||e.isAnimating&&!e.isTicking)return;this.Lp();const i=this.wt,s=this.xt;t.surface.resize(i,s,i,s);const n=this.Vt.r,o=n.length,r=this;if(this.rs(n,o,r,r.viewportBounds),!this.qi&&!e.isAnimating)return;const a=this.v;t.lastDrawnPart=null,t.setDiagramPosScale(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),1!==this.Zt&&(t.globalAlpha=this.Zt),this.N2(t);const h=this.$e,l=this.lt._t;l.setTransform(h,0,0,h,0,0),l.clearRect(0,0,this.wt,this.xt);for(let e=0;e<o;e++)n[e].Ge(t,r);let u=!1;this.sf?this.sf.Mh(this,l)&&(u=this.gp()):u=!0,u&&(P.prototype.Ci=P.prototype.Su),this._c=!1,this.qi=!1}l1(t,e,i,s,n,o,r,a,h){void 0===o&&(o=null),void 0===r&&(r=null),void 0===a&&(a=!1),void 0===h&&(h=!1),this.Lp(),t.clearContextCache(!0),this.ha(),this.ph=!0;const l=this.it;this.it=s;const c=this,d=this.Vt.r,g=d.length;try{const l=new w(n.x,n.y,i.width/s,i.height/s),f=l.copy();f.addMargin(e),this.ca(f),this.Te(),this.rs(d,g,c,l),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,i.width,i.height),null!==r&&""!==r&&(t.fillStyle=r,t.fillBackground(0,0,i.width,i.height));const m=P.l();m.Ue(),m.Xs(e.left,e.top),m.it(s),(0!==n.x||0!==n.y)&&m.Xs(-n.x,-n.y),t.setTransform(m.m11,m.m12,m.m21,m.m22,m.dx,m.dy),t.commitTransform(),t instanceof Bt&&t.setDiagramPosScale(m.m11,m.m12,m.m21,m.m22,m.dx,m.dy),P.i(m),this.N2(t),t.globalAlpha=this.Zt;const p=this.findLayer("Grid");if(o){const e=new u,i=o.iterator;for(i.reset();i.next();){const t=i.value;t instanceof ce&&(!h&&t.layer===p||(t.jc(),e.add(t)))}for(let i=0;i<g;i++)d[i].ER(t,c,e,a);e.each((t=>t.jc()))}else for(let e=0;e<g;e++){const i=d[e];i===p?h&&i.Ge(t,c,!0):i.Ge(t,c,a)}this.ph=!1,this.sf&&this.Wt&&this.sf.Mh(this,this.Wt)&&this.gp()}finally{this.it=l,t.clearContextCache(!0),this.ha(),this.rs(d,g,c,c.viewportBounds),this.ca(),this.Wt instanceof Bt&&(this.Wt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(t){return this.Fr[t]}setRenderingHint(t,e){"minDrawingLength"===t&&(this._m=e),this.Fr[t]=e,this.redraw()}resetRenderingHints(){this.Fr=new s,this.Fr.drawShadows=!0,this.Fr.textGreeking=!0,this.Fr.viewportOptimizations=!e.fr,this.Fr.temporaryPixelRatio=!0,this.Fr.pictureRatioOptimization=!0,this.Fr.minDrawingLength=1,this._m=1}N2(t){const e=this.Fr;if(null===e)return;if(void 0!==e.imageSmoothingEnabled){const i=!!e.imageSmoothingEnabled;t.setImageSmoothingEnabled(i)}const i=e.defaultFont;null!=i&&(t.font=i)}getInputOption(t){return this.Wu[t]}setInputOption(t,e){this.Wu[t]=e}QR(){this.Wu=new s,this.Wu.extraTouchArea=10,this.Wu.extraTouchThreshold=10,this.Wu.hasGestureZoom=!0}set(t){return t?(Object.assign(this,t),this):this}attach(t){return this.setProperties(t)}setProperties(t){return wt.Ap(this,t),this}static Ap(t,i){if(!i)return;const s=t instanceof Yt,n=t instanceof wt;for(const o in i){""===o&&e.o("Setting properties requires non-empty property names");let r=t,a=o;if(s||n){const i=o.indexOf(".");if(i>0){const n=o.substring(0,i);s?r=t.findObject(n):(r=t[n],null==r&&(r=t.toolManager[n])),e.$(r)?a=o.substring(i+1):e.o("Unable to find object named: "+n+" in "+t.toString()+" when trying to set property: "+o)}}if("_"!==a[0]&&!e.qw(r,a)){if(n&&"ModelChanged"===a){t.addModelChangedListener(i[a]);continue}if(n&&"Changed"===a){t.addChangedListener(i[a]);continue}if(n&&e.qw(t.toolManager,a))r=t.toolManager;else{if(n&&t.dT(a)){t.addDiagramListener(a,i[a]);continue}if(t instanceof Ue&&"Changed"===a){t.addChangedListener(i[a]);continue}e.o('Trying to set undefined property "'+a+'" on object: '+r.toString())}}const h=i[o];r[a]=h,"_"===a[0]&&r instanceof At&&r.addCopyProperty(a)}}zA(){if(0!==this.ra.count&&!(this.undoManager.transactionLevel>1)){for(;this.ra.count>0;){const t=this.ra;this.ra=new p;const e=t.iterator;for(;e.next();){const t=e.key;t.invalidateOtherJumpOvers(e.value),t.ai()}}this.C()}}C(t){if(void 0===t)this.qi=!0,this.requestUpdate();else{const e=this.viewportBounds;t.isReal()&&e.intersectsRect(t)&&(this.qi=!0,this.requestUpdate())}this.T("InvalidateDraw")}invalidateViewport(t,e){!0!==this.qi&&(this.qi=!0,"svg"!==this.Qc&&!0===this.getRenderingHint("temporaryPixelRatio")?(this.Cx(),this.maybeUpdate(),this.yS(!0)):this.maybeUpdate())}Nh(){this._u=!0}ha(){this._c=!0}Lp(){!1!==this.Ju&&(this.Ju=!1,this.lT(this.wt,this.xt))}lT(t,e){this.aa();const i=this.$e,s=t*i,n=e*i;this.lt.resize(s,n,t,e)&&(this.qi=!0,this.Wt.clearContextCache(!0))}hT(){const t=this.lt;if(null===t||this.td.isReal())return!0;const e=this.wt,i=this.xt,s=this.Nt;let n=!1,o=this.io?this.jt:0,r=this.kn?this.jt:0,a=s.clientWidth||e+o,h=s.clientHeight||i+r;const l=this.viewportBounds,u=l.x,c=l.y,d=l.width,g=l.height;if((a!==e+o||h!==i+r)&&(this.io=!1,this.kn=!1,o=0,r=0,this.wt=a,this.xt=h,this.Ju=!0,n=!0,this.aa()),!this.so||!this.viewportBounds.isReal())return!0;const f=this.Wb,m=this.Jb;if(this._u=!1,!(n||this.io||this.kn||this.Zu||this.Qu))return!0;const p=this.documentBounds;let x=0,b=0,v=0,P=0;const k=l.width,S=l.height,M=this.fh;this.contentAlignment.isSpot()?(p.width>k&&(x=M.left,b=M.right),p.height>S&&(v=M.top,P=M.bottom)):(x=M.left,b=M.right,v=M.top,P=M.bottom);const C=p.width+x+b,N=p.height+v+P,T=this.scale,L=T;let A=C>a/T,D=N>h/T;if(!(n||this.io||this.kn||A||D))return!0;const F=p.x-x,O=l.x,R=p.right+b;let B=l.right+o;const E=p.y-v,I=l.y,V=p.bottom+P;let z=l.bottom+r,X="1px",U="1px";if(1===this.scrollMode&&(A||D)){if(A&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let t=1;F+1<O&&(t=Math.max((O-F)*T+this.wt,t)),R>B+1&&(t=Math.max((R-B)*T+this.wt,t)),k+o+1<C&&(t=Math.max((C-k)*T+this.wt,t)),X=t.toString()+"px"}if(D&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let t=1;E+1<I&&(t=Math.max((I-E)*T+this.xt,t)),V>z+1&&(t=Math.max((V-z)*T+this.xt,t)),S+r+1<N&&(t=Math.max((N-S)*T+this.xt,t)),U=t.toString()+"px"}}let j="1px"!==X,G="1px"!==U;if((!j||!G)&&(j||G)){if(A=!(C<k+o),D=!(N<S+r),G&&(B-=this.jt),j&&(z-=this.jt),A&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let t=1;F+1<O&&(t=Math.max((O-F)*T+this.wt,t)),R>B+1&&(t=Math.max((R-B)*T+this.wt,t)),k+1<C&&(t=Math.max((C-k)*T+this.wt,t)),X=t.toString()+"px"}j="1px"!==X;let t=this.xt;if(j!==this.kn&&(t=j?this.xt-this.jt:this.xt+this.jt),D&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let e=1;E+1<I&&(e=Math.max((I-E)*T+t,e)),V>z+1&&(e=Math.max((V-z)*T+t,e)),S+1<N&&(e=Math.max((N-S)*T+t,e)),U=e.toString()+"px"}G="1px"!==U}if(this.rp&&j===this.kn&&G===this.io)return(e!==this.wt||i!==this.xt)&&this.maybeUpdate(),!1;if(j!==this.kn&&(this.xt="1px"===X?this.xt+this.jt:Math.max(this.xt-this.jt,1),n=!0),this.kn=j,m.style.width=X,G!==this.io&&(this.wt="1px"===U?this.wt+this.jt:Math.max(this.wt-this.jt,1),n=!0,this.rd)){const e=y.l();G?(t.style.left=this.jt+"px",this.position=e.e(this.ct.x+this.jt/this.scale,this.ct.y)):(t.style.left="0px",this.position=e.e(this.ct.x-this.jt/this.scale,this.ct.y)),y.i(e)}n&&this.aa(),this.io=G,m.style.height=U,this.Bb=!0,n&&(this.Ju=!0);let K=f.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(k+1<C?K=(this.position.x-F)*T:F+1<O?K=f.scrollWidth-f.clientWidth:R>B+1&&(K=this.position.x*T)),this.rd)switch(this.lb){case"negative":K=-(f.scrollWidth-K-f.clientWidth);break;case"reverse":K=f.scrollWidth-K-f.clientWidth}if(f.scrollLeft=K,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(S+1<N?f.scrollTop=(this.position.y-E)*T:E+1<I?f.scrollTop=f.scrollHeight-f.clientHeight:V>z+1&&(f.scrollTop=this.position.y*T)),a=this.wt,h=this.xt,f.style.width=a+(this.io?this.jt:0)+"px",f.style.height=h+(this.kn?this.jt:0)+"px",e!==a||i!==h||this.animationManager.ke){const t=w.z(u,c,d,g);return this.onViewportBoundsChanged(t,this.viewportBounds,L,n),w.i(t),!1}return!0}add(t){const i=t.diagram;if(i===this)return;null!==i&&e.o("Cannot add part "+t.toString()+" to "+this.toString()+". It is already a part of "+i.toString());let s=this.findLayer(t.layerName);if(null===s&&(s=this.findLayer("")),null===s&&e.o('Cannot add a Part when unable find a Layer named "'+t.layerName+'" and there is no default Layer'),t.layer===s)return;const n=s.ch(99999999,t,t.diagram===this);n>=0&&this.raiseChangedEvent(3,"parts",s,null,t,null,n),s.isTemporary||this.invalidateDocumentBounds(),t.invalidateLayout(1);const o=t.layerChanged;null!==o&&o(t,null,s)}ch(t){this.partManager.ch(t);const e=this;wt.isUsingDOM()&&t.Pn((t=>e.gT(t))),t.data||t.Go(),t.hasPlaceholder()&&t.f(),null!==t.data&&t.Pn((t=>e.partManager.C2(t,null))),(!0===t.as()||!0===t.fa())&&this.Cp(t),t.mT(!0,this),t instanceof me&&t.canAvoid()&&this.fd(t),t.pT()?(t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),null!==this.kp&&this.kp(this,t),this.requestUpdate()}ri(t){t.clearAdornments(),this.partManager.ri(t);const e=this;null!==t.data&&t.Pn((t=>e.partManager.L2(t,e))),this.to.delete(t),t instanceof be?this.Or.delete(t):t instanceof me&&t.canAvoid()&&this.fd(t),t.pT()?(t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),null!==this.Pp&&this.Pp(this,t),this.requestUpdate()}remove(t){this.A2(t,!0)}A2(t,e){const i=t.layer;if(null===i||i.diagram!==this)return;t.isSelected=!1,t.isHighlighted=!1,t.invalidateLayout(2),e&&t.rf();const s=i.ri(-1,t,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,t,null,s,null);const n=t.layerChanged;null!==n&&n(t,i,null)}removeParts(t,e){if(void 0===e&&(e=!1),Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++){const i=t[s];e&&!i.canDelete()||this.remove(i)}}else{const i=new u;i.addAll(t);const s=i.iterator;for(;s.next();){const t=s.value;e&&!t.canDelete()||this.remove(t)}}}copyParts(t,e,i){void 0===i&&(i=!1);let s=null;const n=e||this,o=n.model;let r=!1,a=!1;try{o.Vm()&&(r=o.copiesParentKeyOfNodeData,o.copiesParentKeyOfNodeData=n.commandHandler.copiesParentKey),(o.Um()||o.a1())&&(a=o.copiesGroupKeyOfNodeData,o.copiesGroupKeyOfNodeData=n.commandHandler.copiesGroupKey),s=this.partManager.copyParts(t,e,i)}finally{o.Vm()&&(o.copiesParentKeyOfNodeData=r),(o.Um()||o.a1())&&(o.copiesGroupKeyOfNodeData=a)}return s}moveParts(t,e,i,s){if(void 0===i&&(i=!1),void 0===s&&(s=this.Tp()),null===this.toolManager)return;const n=new p;if(null!==t)if(Array.isArray(t))for(let e=0;e<t.length;e++)this._r(n,t[e],i,s);else{const e=t.iterator;for(;e.next();)this._r(n,e.value,i,s)}else{let t=this.parts;for(;t.next();){const e=t.value;this._r(n,e,i,s)}for(t=this.nodes;t.next();){const e=t.value;this._r(n,e,i,s)}for(t=this.links;t.next();){const e=t.value;this._r(n,e,i,s)}}this.Lx(n,e,s,i)}_r(t,e,i,s,n){if(!t.has(e)&&(void 0===n&&(n=!1),!i||n||e.canMove()||e.canCopy()))if(void 0===s&&(s=this.Tp()),e instanceof me){if(t.set(e,this.js(s,e,e.location)),e instanceof Ne&&(e.hasPlaceholder()||s.dragsMembers)){const n=e.memberParts;for(;n.next();){const e=n.value;this._r(t,e,i,s,s.groupsAlwaysMove)}}const n=e.linksConnected;for(;n.next();){const e=n.value;if(t.has(e))continue;const o=e.fromNode,r=e.toNode;null!==o&&t.has(o)&&null!==r&&t.has(r)&&this._r(t,e,i,s)}if(s.dragsTree){const n=e.findTreeChildrenNodes();for(;n.next();){const e=n.value;this._r(t,e,i,s)}}}else if(e instanceof be){t.set(e,this.js(s,e));const n=e.labelNodes;for(;n.next();){const e=n.value;this._r(t,e,i,s)}}else e instanceof ge||t.set(e,this.js(s,e,e.location))}Lx(t,i,s,n){if(null===t||0===t.count)return;const o=y.l(),r=y.l();r.h(i),isNaN(r.x)&&(r.x=0),isNaN(r.y)&&(r.y=0);const a=this.Qb;a||this.gA(t);const h=e.nt(),l=e.nt(),u=t.iterator;let c=y.l();for(;u.next();){const e=u.key,i=u.value;if(e.Di()){const a=this.yT(e,t);if(null!==a)h.push(new Pt(e,i,a));else if(!n||e.canMove()){const t=i.point;o.h(t),this.computeMove(e,o.add(r),s,c),e.location=c,void 0===i.shifted&&(i.shifted=new y),i.shifted.h(c.subtract(t))}}else u.key instanceof be&&l.push(new f(u.key,u.value))}y.i(c);const d=h.length;for(let t=0;t<d;t++){const e=h[t],i=e.wT.point;o.h(i),void 0===e.h1.shifted&&(e.h1.shifted=new y),e.Ri.location=o.add(e.h1.shifted)}const g=y.l(),m=y.l(),p=l.length;for(let e=0;e<p;e++){const i=l[e],n=i.key;if(n instanceof be)if(n.suspendsRouting){n.Dr=null;const e=n.fromNode,a=n.toNode;if(null!==this.draggedLink&&s.dragsLink){const e=i.value.point;if(null===n.dragComputation){t.set(n,this.js(s,n,r));const i=r.x-e.x,o=r.y-e.y;n.kr(i,o)}else{const i=y.z(0,0),o=n.getPoint(0);o&&o.isReal()&&i.h(o),c=y.l().h(i).add(r);let a=c;s.isGridSnapEnabled&&(s.isGridSnapRealtime||this.lastInput.up)&&(a=y.l(),this.aM(n,c,a,s)),c.h(n.dragComputation(n,c,a)).subtract(i),t.set(n,this.js(s,n,c));const h=c.x-e.x,l=c.y-e.y;n.kr(h,l),y.i(i),y.i(c),a!==c&&y.i(a)}}else{if(null!==e){g.h(e.location);const i=t.get(e);null!==i&&g.subtract(i.point)}if(null!==a){m.h(a.location);const e=t.get(a);null!==e&&m.subtract(e.point)}if(null!==e&&null!==a){const e=i.value.point;if(g.equalsApprox(m)||0!==n.computeAdjusting()){const i=o;i.h(g),i.subtract(e),t.set(n,this.js(s,n,g)),n.kr(i.x,i.y)}else n.suspendsRouting=!1,n.$t()}else{const o=i.value.point;let h;h=null!==e?g:null!==a?m:r,t.set(n,this.js(s,n,h));const l=h.x-o.x,u=h.y-o.y;n.kr(l,u)}}}else if(null===n.fromNode||null===n.toNode){const e=i.value.point;t.set(n,this.js(s,n,r));const o=r.x-e.x,a=r.y-e.y;n.kr(o,a)}}y.i(o),y.i(r),y.i(g),y.i(m),e.Z(h),e.Z(l),a||(this.Te(),this.pS(t))}computeMove(t,e,i,s){if(void 0===s&&(s=new y),s.h(e),null===t)return s;let n=e;const o=i.isGridSnapEnabled;o&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=y.l(),this.aM(t,e,n,i));const r=null!==t.dragComputation?t.dragComputation(t,e,n):n,a=t.minLocation;let h=a.x;isNaN(h)&&(h=o?Math.round(1e3*t.location.x)/1e3:t.location.x);let l=a.y;isNaN(l)&&(l=o?Math.round(1e3*t.location.y)/1e3:t.location.y);const u=t.maxLocation;let c=u.x;isNaN(c)&&(c=o?Math.round(1e3*t.location.x)/1e3:t.location.x);let d=u.y;return isNaN(d)&&(d=o?Math.round(1e3*t.location.y)/1e3:t.location.y),s.e(Math.max(h,Math.min(r.x,c)),Math.max(l,Math.min(r.y,d))),n!==e&&y.i(n),s}Tp(){const t=this.toolManager.findTool("Dragging");return t instanceof U?t.dragOptions:this.ld}aM(t,e,i,s){if(void 0===s&&(s=this.Tp()),i.h(e),null===t)return i;const n=this.grid,o=s.gridSnapCellSize;let r=o.width,a=o.height;const h=s.gridSnapOrigin;let l=h.x,u=h.y;const c=s.gridSnapCellSpot;if(null!==n){const t=n.gridCellSize;isNaN(r)&&(r=t.width),isNaN(a)&&(a=t.height);const e=n.gridOrigin;isNaN(l)&&(l=e.x),isNaN(u)&&(u=e.y)}const d=y.z(0,0);return d.setSpot(0,0,r,a,c),k.tm(e.x,e.y,l+d.x,u+d.y,r,a,i),y.i(d),i}gA(t){if(null===t)return;this.Qb=!0;const e=t.iterator;for(;e.next();){const t=e.key;t instanceof be&&(t.suspendsRouting=!0)}}pS(t){if(null===t)return;const e=t.iterator;for(;e.next();){const t=e.key;t instanceof be&&(t.suspendsRouting=!1,t.xT()&&t.$t())}this.Qb=!1}get draggedLink(){return this._b}set draggedLink(t){this._b!==t&&(this._b=t,null!==t&&(this.t1=t.fromPort,this.e1=t.toPort))}get PS(){return this.t1}set PS(t){this.t1=t}get SS(){return this.e1}set SS(t){this.e1=t}yT(t,e){const i=t.containingGroup;if(null!==i){let t=this.yT(i,e);if(null!==t||(t=e.get(i),null!==t))return t}return null}js(t,e,i){if(void 0===i)return new vt(y.dn);let s=t.isGridSnapEnabled;return!t.groupsSnapMembers&&null!==e.containingGroup&&(s=!1),new vt(s?new y(Math.round(1e3*i.x)/1e3,Math.round(1e3*i.y)/1e3):i.copy())}T2(t,i){if(null!==t.diagram&&t.diagram!==this&&e.o("Cannot share a Layer with another Diagram: "+t+" of "+t.diagram),null===i?null!==t.diagram&&e.o("Cannot add an existing Layer to this Diagram again: "+t):(i.diagram!==this&&e.o("Existing Layer must be in this Diagram: "+i+" not in "+i.diagram),t===i&&e.o("Cannot move a Layer before or after itself: "+t)),t.diagram===this)return;const s=t.name,n=this.Vt,o=n.count;for(let t=0;t<o;t++)n.elt(t).name===s&&e.o("Cannot add Layer with the name '"+s+"'; a Layer with the same name is already present in this Diagram.")}addLayer(t){this.T2(t,null),t.Io(this);const e=this.Vt;let i=e.count-1;if(!t.isTemporary)for(;i>=0&&e.elt(i).isTemporary;)i--;return e.insertAt(i+1,t),null!==this.Ce&&this.raiseChangedEvent(3,"layers",this,null,t,null,i+1),this.C(),this.invalidateDocumentBounds(),this}addLayerBefore(t,e){this.T2(t,e),t.Io(this);const i=this.Vt,s=i.indexOf(t);s>=0&&(i.delete(t),null!==this.Ce&&this.raiseChangedEvent(4,"layers",this,t,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===e){i.insertAt(o,t);break}return null!==this.Ce&&this.raiseChangedEvent(3,"layers",this,null,t,null,o),this.C(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(t,e){this.T2(t,e),t.Io(this);const i=this.Vt,s=i.indexOf(t);s>=0&&(i.delete(t),null!==this.Ce&&this.raiseChangedEvent(4,"layers",this,t,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===e){i.insertAt(o+1,t);break}return null!==this.Ce&&this.raiseChangedEvent(3,"layers",this,null,t,null,o+1),this.C(),s<0&&this.invalidateDocumentBounds(),this}Zr(t,e){t.Io(this),this.Vt.insertAt(e,t)}bT(t){this.Vt.removeAt(t)}removeLayer(t){if(t.diagram!==this&&e.o("Cannot remove a Layer from another Diagram: "+t+" of "+t.diagram),""===t.name)return;const i=this.Vt,s=i.indexOf(t);if(i.delete(t)){const e=t.Ct.copy().iterator;for(;e.next();){const i=e.value,s=i.layerName;s!==t.name?i.layerName=s:i.layerName=""}null!==this.Ce&&this.raiseChangedEvent(4,"layers",this,t,null,s,null),this.C(),this.invalidateDocumentBounds()}}findLayer(t){const e=this.layers;for(;e.next();){const i=e.value;if(i.name===t)return i}return null}findRouter(t){for(const e of this.nf)if(e.name===t)return e;return null}addModelChangedListener(t){return e.S(t,wt,"addModelChangedListener:listener"),null===this.eo&&(this.eo=new h),this.eo.add(t),this.model&&this.model.addChangedListener(t),this}removeModelChangedListener(t){e.S(t,wt,"removeModelChangedListener:listener"),null!==this.eo&&(this.eo.delete(t),0===this.eo.count&&(this.eo=null)),this.model.removeChangedListener(t)}addChangedListener(t){return e.S(t,wt,"addChangedListener:listener"),null===this.Ir&&(this.Ir=new h),this.Ir.add(t),this}removeChangedListener(t){e.S(t,wt,"removeChangedListener:listener"),null!==this.Ir&&(this.Ir.delete(t),0===this.Ir.count&&(this.Ir=null))}D2(t){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(t),1!==t.change&&(this.isModified=!0),null!==this.Ir){const e=this.Ir,i=e.length;for(let s=0;s<i;s++)e.elt(s)(t)}}raiseChangedEvent(t,e,i,s,n,o,r){void 0===o&&(o=null),void 0===r&&(r=null);const a=new R;a.diagram=this,a.change=t,a.propertyName=e,a.object=i,a.oldValue=s,a.oldParam=o,a.newValue=n,a.newParam=r,this.D2(a)}raiseChanged(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}t(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}get partAdded(){return this.kp}set partAdded(t){this.partAdded!==t&&(this.kp=t)}get partRemoved(){return this.Pp}set partRemoved(t){this.partRemoved!==t&&(this.Pp=t)}get animationManager(){return this.Ns}get undoManager(){return this.Ce.undoManager}get skipsUndoManager(){return this.Vo}set skipsUndoManager(t){e.s(t,"boolean",wt,"skipsUndoManager"),this.Vo=t,this.Ce.skipsUndoManager=t}get delaysLayout(){return this.Ab}set delaysLayout(t){this.Ab=t}iA(t,i){if(null===t||t.diagram!==this)return;const s=this.wi;try{this.wi=!0;const s=t.change;if(2===s){const e=t.object,s=t.propertyName,n=t.getValue(i);if(t.diagram.model.et(e,s,n),e instanceof At){const t=e.part;null!==t&&(t.invalidateAdornments(),t instanceof be&&(t.fromNode?.Ze(t.fromPort),t.toNode?.Ze(t.toPort)))}this.isModified=!0}else if(3===s){const s=t.object,n=t.newParam,o=t.newValue;if(s instanceof Yt)if("number"==typeof n&&o instanceof At){i?s.ri(n):s.insertAt(n,o);const t=s.part;null!==t&&t.invalidateAdornments()}else"number"==typeof n&&o instanceof Jt&&(o.isRow?s.kT(n,i?void 0:o):s.PT(n,i?void 0:o));else if(s instanceof ft){const e=!0===t.oldParam;"number"==typeof n&&o instanceof ce&&(i?(e||(o.isSelected=!1,o.isHighlighted=!1,o.invalidateAdornments()),s.ri(e?n:-1,o,e)):s.ch(n,o,e))}else s instanceof wt?"number"==typeof n&&o instanceof ft&&(i?this.bT(n):this.Zr(o,n)):e.o("unknown ChangeType.Insert object: "+t.toString());this.isModified=!0}else if(4===s){const s=t.object,n=t.oldParam,o=t.oldValue;if(s instanceof Yt)"number"==typeof n&&o instanceof At?i?s.insertAt(n,o):s.ri(n):"number"==typeof n&&o instanceof Jt&&(o.isRow?s.kT(n,i?o:void 0):s.PT(n,i?o:void 0));else if(s instanceof ft){const e=!0===t.newParam;"number"==typeof n&&o instanceof ce&&(i?s.Ct.indexOf(o)<0&&s.ch(n,o,e):(e||(o.isSelected=!1,o.isHighlighted=!1,o.invalidateAdornments()),s.ri(e?n:-1,o,e)))}else s instanceof wt?"number"==typeof n&&o instanceof ft&&(i?this.Zr(o,n):this.bT(n)):e.o("unknown ChangeType.Remove object: "+t.toString());this.isModified=!0}else 1===s||e.o("unknown ChangedEvent: "+t.toString())}finally{this.wi=s}}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;void 0===i&&(i="");const s=this.skipsUndoManager;null===i&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(t){this.partManager.updateAllTargetBindings(t)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),null!==this.ls){const t=this.ls.part;null!==t&&t.Go()}}setDivBackground(t){this.div&&(this.div.style.backgroundColor=t)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}Np(){const t=this.v,e=this.it,i=this.ct;t.Ue(),1!==e&&t.it(e),(0!==i.x||0!==i.y)&&t.Xs(-i.x,-i.y)}ST(t,e){const i=this.animationManager;if(this.Ht||this.As)return this.it=e,this.aa(),this.C(),this.Nh(),i.VA(t,this.it),void this.Np();if(null===this.lt)return this.it=e,void this.Np();this.Ht=!0;const s=this.viewportBounds.copy(),n=this.wt,o=this.xt;let r=this.zoomPoint.x,a=this.zoomPoint.y;const h=this.contentAlignment;isNaN(r)&&(h.isSide()?h.includesSide(v.LeftSide)?r=0:h.includesSide(v.RightSide)&&(r=n-1):r=h.isSpot()?h.x*(n-1):n/2),isNaN(a)&&(h.isSide()?h.includesSide(v.TopSide)?a=0:h.includesSide(v.BottomSide)&&(a=o-1):a=h.isSpot()?h.y*(o-1):o/2),null!==this.scaleComputation&&!this.animationManager.defaultAnimation.isAnimating&&(e=this.scaleComputation(this,e)),e<this.minScale&&(e=this.minScale),e>this.maxScale&&(e=this.maxScale);const l=y.z(this.ct.x+r/t-r/e,this.ct.y+a/t-a/e);this.position=l,y.i(l),this.it=e,this.Np(),this.aa(),this.Ht=!1,this.onViewportBoundsChanged(s,this.viewportBounds,t,!1),this.Js(!1),i.VA(t,this.it),this.C()}yO(){const t=this.Vt.r;for(let e=0;e<t.length;e++)t[e].HA()}onViewportBoundsChanged(t,e,i,s){if(t.equals(e))return;void 0===s&&(s=!1),s||this.Nh(),this.ha();const n=this.layout;null!==n&&n.isViewportSized&&1===this.autoScale&&(t.width!==e.width||t.height!==e.height)&&n.p();const o=this.currentTool;!0===this.ef&&o instanceof X&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.uA(this)),this.Ht||this.invalidateViewport(t,e),this.ca();const r=this.Vt.r;this.rs(r,r.length,this,this.viewportBounds),this.Ye.scale=i,this.Ye.position.x=t.x,this.Ye.position.y=t.y,this.Ye.bounds.h(t),this.Ye.canvasSize.width=Math.round(t.width*i),this.Ye.canvasSize.height=Math.round(t.height*i),this.Ye.newCanvasSize.width=this.wt,this.Ye.newCanvasSize.height=this.xt,this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,t),this.isVirtualized&&this.links.each((t=>{t.isAvoiding&&t.actualBounds.intersectsRect(e)&&t.$t()}))}ca(t){const e=this.ls;if(null===e||!e.visible||null===e.part||null===e.layer)return;const i=void 0!==t?t:this.Yb;if(!i.isReal())return;const s=i.width,n=i.height;if(e.scale=1,e.angle=0,e.layer.isViewportAligned)e.width=s*this.scale,e.height=n*this.scale,e.part.alignment=v.TopLeft;else{null===e.Pe&&(e.Pe=new Ht);const t=e.Pe.lf;if(!t.isReal())return;e.width=s+2*t.width,e.height=n+2*t.height;const o=y.l();k.tm(i.x,i.y,0,0,t.width,t.height,o),o.offset(-t.width,-t.height),e.part.location=o,y.i(o)}}clearSelection(t){void 0===t&&(t=!1);const e=this.selection;if(0===e.count)return;t||this.T("ChangingSelection",e);const i=e.toArray(),s=i.length;for(let t=0;t<s;t++){i[t].isSelected=!1}e.ce(),e.clear(),e.k(),t||this.T("ChangedSelection",e)}select(t){null!==t&&t.diagram===this&&(!t.isSelected||this.selection.count>1)&&(this.T("ChangingSelection",this.selection),this.clearSelection(!0),t.isSelected=!0,this.T("ChangedSelection",this.selection))}selectCollection(t){if(this.T("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++){const i=t[s];i instanceof ce||e.o("Diagram.selectCollection given something that is not a Part: "+i),i.isSelected=!0}}else{const i=t.iterator;for(;i.next();){const t=i.value;t instanceof ce||e.o("Diagram.selectCollection given something that is not a Part: "+t),t.isSelected=!0}}this.T("ChangedSelection",this.selection)}clearHighlighteds(){const t=this.highlighteds;if(t.count>0){const e=t.toArray(),i=e.length;for(let t=0;t<i;t++){e[t].isHighlighted=!1}t.ce(),t.clear(),t.k()}}highlight(t){null!==t&&t.diagram===this&&(!t.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),t.isHighlighted=!0)}highlightCollection(t){const i=(new u).addAll(t),s=this.highlighteds.copy().removeAll(i).iterator;for(;s.next();){s.value.isHighlighted=!1}const n=i.iterator;for(;n.next();){const t=n.value;t instanceof ce||e.o("Diagram.highlightCollection given something that is not a Part: "+t),t.isHighlighted=!0}}scroll(t,i,s){void 0===s&&(s=1);const n="up"===i||"down"===i;let o=0;const r=y.l();if("pixel"===t)o=s;else if("line"===t)o=s*(n?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if("page"===t){let t=n?this.viewportBounds.height:this.viewportBounds.width;if(t*=this.scale,0!==t){o=s*Math.max(t-(n?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0)}}else{if("document"===t){const t=this.documentBounds,e=this.viewportBounds;return"up"===i?this.position=r.e(e.x,t.y):"left"===i?this.position=r.e(t.x,e.y):"down"===i?this.position=r.e(e.x,t.bottom-e.height):"right"===i&&(this.position=r.e(t.right-e.width,e.y)),void y.i(r)}e.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+t)}o/=this.scale;const a=this.position;"up"===i?this.position=r.e(a.x,a.y-o):"down"===i?this.position=r.e(a.x,a.y+o):"left"===i?this.position=r.e(a.x-o,a.y):"right"===i?this.position=r.e(a.x+o,a.y):e.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+i),y.i(r)}scrollToRect(t){const e=this.viewportBounds;if(e.containsRect(t))return;const i=t.center;i.x-=e.width/2,i.y-=e.height/2,this.position=i}centerRect(t){const e=this.viewportBounds,i=t.center;i.x-=e.width/2,i.y-=e.height/2,this.position=i}transformDocToView(t){return t.copy().v(this.v)}transformViewToDoc(t){return t.copy().Yi(this.v)}YR(t){return t.Yi(this.v)}static None=1;static Uniform=2;static UniformToFill=3;static CycleAll=1;static CycleNotDirected=2;static CycleNotDirectedFast=3;static CycleNotUndirected=4;static CycleDestinationTree=5;static CycleSourceTree=6;static DocumentScroll=1;static InfiniteScroll=2;static TreeParentCollapsed=1;static AllParentsCollapsed=2;static AnyParentsCollapsed=3;get opacity(){return this.Zt}set opacity(t){const i=this.Zt;i!==t&&(e.s(t,"number",wt,"opacity"),(t<0||t>1)&&e.J(t,"0 <= value <= 1",wt,"opacity"),this.Zt=t,this.t("opacity",i,t),this.C())}get validCycle(){return this.Pb}set validCycle(t){const e=this.Pb;e!==t&&(this.Pb=t,this.t("validCycle",e,t))}get layers(){return this.Vt.iterator}get isModelReadOnly(){const t=this.Ce;return null!==t&&t.isReadOnly}set isModelReadOnly(t){const e=this.Ce;null!==e&&(e.isReadOnly=t)}get isReadOnly(){return this.Bo}set isReadOnly(t){const i=this.Bo;i!==t&&(e.s(t,"boolean",wt,"isReadOnly"),this.Bo=t,this.t("isReadOnly",i,t))}get isEnabled(){return this.Be}set isEnabled(t){const i=this.Be;i!==t&&(e.s(t,"boolean",wt,"isEnabled"),this.Be=t,this.t("isEnabled",i,t))}get allowClipboard(){return this.Tb}set allowClipboard(t){const i=this.Tb;i!==t&&(e.s(t,"boolean",wt,"allowClipboard"),this.Tb=t,this.t("allowClipboard",i,t))}get allowCopy(){return this.Yl}set allowCopy(t){const i=this.Yl;i!==t&&(e.s(t,"boolean",wt,"allowCopy"),this.Yl=t,this.t("allowCopy",i,t))}get allowDelete(){return this.Kl}set allowDelete(t){const i=this.Kl;i!==t&&(e.s(t,"boolean",wt,"allowDelete"),this.Kl=t,this.t("allowDelete",i,t))}get allowDragOut(){return this.Db}set allowDragOut(t){const i=this.Db;i!==t&&(e.s(t,"boolean",wt,"allowDragOut"),this.Db=t,this.t("allowDragOut",i,t))}get allowDrop(){return this.vb}set allowDrop(t){const i=this.vb;i!==t&&(e.s(t,"boolean",wt,"allowDrop"),this.vb=t,this.t("allowDrop",i,t))}get allowTextEdit(){return this.Hl}set allowTextEdit(t){const i=this.Hl;i!==t&&(e.s(t,"boolean",wt,"allowTextEdit"),this.Hl=t,this.t("allowTextEdit",i,t))}get allowGroup(){return this.ql}set allowGroup(t){const i=this.ql;i!==t&&(e.s(t,"boolean",wt,"allowGroup"),this.ql=t,this.t("allowGroup",i,t))}get allowUngroup(){return this.jl}set allowUngroup(t){const i=this.jl;i!==t&&(e.s(t,"boolean",wt,"allowUngroup"),this.jl=t,this.t("allowUngroup",i,t))}get allowInsert(){return this.Fb}set allowInsert(t){const i=this.Fb;i!==t&&(e.s(t,"boolean",wt,"allowInsert"),this.Fb=t,this.t("allowInsert",i,t))}get allowLink(){return this.Wl}set allowLink(t){const i=this.Wl;i!==t&&(e.s(t,"boolean",wt,"allowLink"),this.Wl=t,this.t("allowLink",i,t))}get allowRelink(){return this.Jl}set allowRelink(t){const i=this.Jl;i!==t&&(e.s(t,"boolean",wt,"allowRelink"),this.Jl=t,this.t("allowRelink",i,t))}get allowMove(){return this.$l}set allowMove(t){const i=this.$l;i!==t&&(e.s(t,"boolean",wt,"allowMove"),this.$l=t,this.t("allowMove",i,t))}get allowReshape(){return this.Zl}set allowReshape(t){const i=this.Zl;i!==t&&(e.s(t,"boolean",wt,"allowReshape"),this.Zl=t,this.t("allowReshape",i,t))}get allowResize(){return this.Ql}set allowResize(t){const i=this.Ql;i!==t&&(e.s(t,"boolean",wt,"allowResize"),this.Ql=t,this.t("allowResize",i,t))}get allowRotate(){return this._l}set allowRotate(t){const i=this._l;i!==t&&(e.s(t,"boolean",wt,"allowRotate"),this._l=t,this.t("allowRotate",i,t))}get allowSelect(){return this.ta}set allowSelect(t){const i=this.ta;i!==t&&(e.s(t,"boolean",wt,"allowSelect"),this.ta=t,this.t("allowSelect",i,t))}get allowUndo(){return this.Rb}set allowUndo(t){const i=this.Rb;i!==t&&(e.s(t,"boolean",wt,"allowUndo"),this.Rb=t,this.t("allowUndo",i,t))}get allowZoom(){return this.Ob}set allowZoom(t){const i=this.Ob;i!==t&&(e.s(t,"boolean",wt,"allowZoom"),this.Ob=t,this.t("allowZoom",i,t))}get hasVerticalScrollbar(){return this.Qu}set hasVerticalScrollbar(t){const i=this.Qu;i!==t&&(e.s(t,"boolean",wt,"hasVerticalScrollbar"),this.Qu=t,this.Nh(),this.C(),this.t("hasVerticalScrollbar",i,t),this.Js(!1))}get hasHorizontalScrollbar(){return this.Zu}set hasHorizontalScrollbar(t){const i=this.Zu;i!==t&&(e.s(t,"boolean",wt,"hasHorizontalScrollbar"),this.Zu=t,this.Nh(),this.C(),this.t("hasHorizontalScrollbar",i,t),this.Js(!1))}get allowHorizontalScroll(){return this.Ib}set allowHorizontalScroll(t){const i=this.Ib;i!==t&&(e.s(t,"boolean",wt,"allowHorizontalScroll"),this.Ib=t,this.t("allowHorizontalScroll",i,t),this.Js(!1))}get allowVerticalScroll(){return this.Eb}set allowVerticalScroll(t){const i=this.Eb;i!==t&&(e.s(t,"boolean",wt,"allowVerticalScroll"),this.Eb=t,this.t("allowVerticalScroll",i,t),this.Js(!1))}get scrollHorizontalLineChange(){return this.Ub}set scrollHorizontalLineChange(t){const i=this.Ub;i!==t&&(e.s(t,"number",wt,"scrollHorizontalLineChange"),t<0&&e.J(t,">= 0",wt,"scrollHorizontalLineChange"),this.Ub=t,this.t("scrollHorizontalLineChange",i,t))}get scrollVerticalLineChange(){return this.Vb}set scrollVerticalLineChange(t){const i=this.Vb;i!==t&&(e.s(t,"number",wt,"scrollVerticalLineChange"),t<0&&e.J(t,">= 0",wt,"scrollVerticalLineChange"),this.Vb=t,this.t("scrollVerticalLineChange",i,t))}get lastInput(){return this.gh}set lastInput(t){this.gh=t}get previousInput(){return this.Wr}set previousInput(t){this.Wr=t}get firstInput(){return this.fp}set firstInput(t){this.fp=t}get currentCursor(){return this.Sb}set currentCursor(t){if(""===t&&(t=this.op),this.Sb!==t){e.s(t,"string",wt,"currentCursor");const i=this.lt,s=this.Nt;if(null===i||null===s)return;this.Sb=t;const n=i.style.cursor;i.style.cursor=t,s.style.cursor=t,i.style.cursor===n&&(i.style.cursor="-webkit-"+t,s.style.cursor="-webkit-"+t,i.style.cursor===n&&(i.style.cursor="-moz-"+t,s.style.cursor="-moz-"+t,i.style.cursor===n&&(i.style.cursor=t,s.style.cursor=t)))}}get defaultCursor(){return this.op}set defaultCursor(t){""===t&&(t="auto");const i=this.op;i!==t&&(e.s(t,"string",wt,"defaultCursor"),this.op=t,this.t("defaultCursor",i,t))}get click(){return this.Er}set click(t){const i=this.Er;i!==t&&(null!==t&&e.S(t,wt,"click"),this.Er=t,this.t("click",i,t))}get doubleClick(){return this.Ur}set doubleClick(t){const i=this.Ur;i!==t&&(null!==t&&e.S(t,wt,"doubleClick"),this.Ur=t,this.t("doubleClick",i,t))}get contextClick(){return this.Vr}set contextClick(t){const i=this.Vr;i!==t&&(null!==t&&e.S(t,wt,"contextClick"),this.Vr=t,this.t("contextClick",i,t))}get mouseOver(){return this.Br}set mouseOver(t){const i=this.Br;i!==t&&(null!==t&&e.S(t,wt,"mouseOver"),this.Br=t,this.t("mouseOver",i,t))}get mouseHover(){return this.zr}set mouseHover(t){const i=this.zr;i!==t&&(null!==t&&e.S(t,wt,"mouseHover"),this.zr=t,this.t("mouseHover",i,t))}get mouseHold(){return this.Xr}set mouseHold(t){const i=this.Xr;i!==t&&(null!==t&&e.S(t,wt,"mouseHold"),this.Xr=t,this.t("mouseHold",i,t))}get mouseDragOver(){return this.Mb}set mouseDragOver(t){const i=this.Mb;i!==t&&(null!==t&&e.S(t,wt,"mouseDragOver"),this.Mb=t,this.t("mouseDragOver",i,t))}get mouseDrop(){return this.Gr}set mouseDrop(t){const e=this.Gr;e!==t&&(this.Gr=t,this.t("mouseDrop",e,t))}get handlesDragDropForTopLevelParts(){return this.Nb}set handlesDragDropForTopLevelParts(t){const i=this.Nb;i!==t&&(e.s(t,"boolean",wt,"handlesDragDropForTopLevelParts"),this.Nb=t,this.t("handlesDragDropForTopLevelParts",i,t))}get mouseEnter(){return this.Yr}set mouseEnter(t){const i=this.Yr;i!==t&&(null!==t&&e.S(t,wt,"mouseEnter"),this.Yr=t,this.t("mouseEnter",i,t))}get mouseLeave(){return this.Kr}set mouseLeave(t){const i=this.Kr;i!==t&&(null!==t&&e.S(t,wt,"mouseLeave"),this.Kr=t,this.t("mouseLeave",i,t))}get toolTip(){return this.Hr}set toolTip(t){const e=this.Hr;e!==t&&(this.Hr=t,this.t("toolTip",e,t))}get contextMenu(){return this.qr}set contextMenu(t){const e=this.qr;e!==t&&(this.qr=t,this.t("contextMenu",e,t))}get commandHandler(){return this.jM}set commandHandler(t){const e=this.jM;e!==t&&(e&&e.doStop(),this.jM=t,t.Io(this),t.doStart())}get toolManager(){return this.KM}set toolManager(t){this.KM!==t&&(this.KM=t,t.diagram=this)}get defaultTool(){return this.HM}set defaultTool(t){const e=this.HM;e!==t&&(this.HM=t,t.diagram=this,this.currentTool===e&&(this.currentTool=t))}get currentTool(){return this.qM}set currentTool(t){const e=this.qM;e&&(e.isActive&&e.doDeactivate(),e.cancelWaitAfter(),e.doStop()),null===t&&(t=this.defaultTool),null!==t&&(this.qM=t,t.diagram=this,t.doStart())}get selection(){return this.qA}get maxSelectionCount(){return this.Gb}set maxSelectionCount(t){const i=this.Gb;if(i!==t)if(e.s(t,"number",wt,"maxSelectionCount"),t>=0&&!isNaN(t)){if(this.Gb=t,this.t("maxSelectionCount",i,t),!this.undoManager.isUndoingRedoing){const e=this.selection.count-t;if(e>0){this.T("ChangingSelection",this.selection);const t=this.selection.toArray();for(let i=0;i<e;i++)t[i].isSelected=!1;this.T("ChangedSelection",this.selection)}}}else e.J(t,">= 0",wt,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.hp}set nodeSelectionAdornmentTemplate(t){const e=this.hp;e!==t&&(this.hp=t.It(),this.t("nodeSelectionAdornmentTemplate",e,t))}get groupSelectionAdornmentTemplate(){return this.Hb}set groupSelectionAdornmentTemplate(t){const e=this.Hb;e!==t&&(this.Hb=t.It(),this.t("groupSelectionAdornmentTemplate",e,t))}get linkSelectionAdornmentTemplate(){return this.qb}set linkSelectionAdornmentTemplate(t){const e=this.qb;e!==t&&(this.qb=t.It(),this.t("linkSelectionAdornmentTemplate",e,t))}get highlighteds(){return this.jA}get isModified(){const t=this.undoManager;return t.isEnabled?null!==t.currentTransaction||this.sd&&this.Hs!==t.historyIndex:this.sd}set isModified(t){if(this.sd!==t){e.s(t,"boolean",wt,"isModified"),this.sd=t;const i=this.undoManager;!t&&i.isEnabled&&(this.Hs=i.historyIndex),t||this.MT()}}MT(){const t=this.isModified;this.ZM!==t&&(this.ZM=t,this.T("Modified"))}get model(){return this.Ce}set model(t){const i=this.Ce;if(i!==t){this.currentTool.doCancel(),i&&i.undoManager!==t.undoManager&&i.undoManager.isInTransaction&&e.o("Do not replace a Diagram.model while a transaction is in progress.");const s=this.oT(!0);this.so=!1,this.$u=!0,this.Hs=-2,this.Tr=!1;const n=this.Ht;this.Ht=!0,this.animationManager.Gl("Model"),i&&(null!==this.eo&&this.eo.each((t=>i.removeChangedListener(t))),i.removeChangedListener(this.Zc)),this.Ce=t,this.partManager=this.CO(this.Ce.type),this.initializePartManager(this.partManager);for(let t=0;t<s.length;t++)this.add(s[t]);t.addChangedListener(this.$M),this.partManager.v2(),t.removeChangedListener(this.$M),t.addChangedListener(this.Zc),null!==this.eo&&this.eo.each((e=>t.addChangedListener(e))),this.Ht=n,this.invalidateDocumentBounds(),this.Ht||this.C(),i&&t.undoManager.copyProperties(i.undoManager)}}get themeManager(){return this.g2}set themeManager(t){const e=this.g2;e!==t&&(e&&e.removeDiagram(this),this.g2=t,null!==t&&t.addDiagram(this))}initializePartManager(t){}static m2(t,e){wt.ZA.set(t,e)}static get licenseKey(){return wt.F2.last()}static set licenseKey(t){wt.F2.add(t.replace(/\s/g,""))}static get version(){return wt.LO}static F2=new h;static LO="3.1.5";CO(t){const e=wt.ZA.get(t);return null!==e?new e:new Ie}get G(){return this.JM}set G(t){this.JM=t}get nb(){return this.WA}AO(t){if(t.model!==this.model)return;const i=t.change,s=t.propertyName;if(1!==i||"S"!==s[0]){if(this.G){this.G=!1;try{if(""===t.modelChange&&1===i){("FinishedUndo"===s||"FinishedRedo"===s)&&(this.T("ChangedSelection",this.selection),this.Te());const i=this.animationManager;"RolledBackTransaction"===s&&i.stopAnimation(),this.zA(),this.$c=!0,this.maybeUpdate(),(0===this.undoManager.transactionLevel||1===this.undoManager.transactionLevel)&&i.MM(),"CommittedTransaction"===s&&this.undoManager.isJustDiscarded&&(this.Hs=Math.min(this.Hs,this.undoManager.historyIndex-1)),("CommittedTransaction"===s||"RolledBackTransaction"===s)&&this.undoManager.Sx&&e.un((()=>{this.isModified=!1}),1);const n=t.isTransactionFinished;if(n&&(this.MT(),this.nb.clear(),this.animationManager.LR()),!this.Cb&&n&&this.lastInput.targetDiagram){this.Cb=!0;const t=this;e.un((()=>{t.currentTool.standardMouseOver(),t.Cb=!1}),10)}}}finally{this.G=!0}}}else if("StartingFirstTransaction"===s){const t=this,e=this.toolManager;e.mouseDownTools.each((e=>e.diagram=t)),e.mouseMoveTools.each((e=>e.diagram=t)),e.mouseUpTools.each((e=>e.diagram=t)),this.routers.each((e=>e.diagram=t)),!this.As&&!this.so&&(this.$c=!0,this.$u&&(this.Tr=!0))}else if("StartingUndo"===s||"StartingRedo"===s){const t=this.animationManager;this.skipsUndoManager||(t.defaultAnimation.isAnimating&&t.stopAnimation(),t.getBundleAnimation().isAnimating&&t.getBundleAnimation().stop()),this.T("ChangingSelection",this.selection)}else if("StartedTransaction"===s){const t=this.animationManager;t.defaultAnimation.isAnimating&&!this.skipsUndoManager&&t.stopAnimation()}}get wi(){return this.WM}set wi(t){this.WM=t}get Ru(){return this.Lb}set Ru(t){this.Lb=t}gT(t){const e=t.D.r;for(const t of e)t instanceof re&&this.R2(t)}R2(e){const i=e.element;if(!(null!==i&&t.HTMLImageElement&&i instanceof HTMLImageElement&&(i.hs instanceof u&&i.hs.add(this),e.TO(),i.Dp)))return;const s=i.getAttribute("src")||"",n=this.oa.get(s);if(null===n){re.NT(e,i);const t=[];t.push(e),this.oa.set(s,t)}else{for(let t=0;t<n.length;t++)if(n[t]===e)return;n.push(e)}}DO(t){const e=t.D.r,i=e.length;for(let t=0;t<i;t++)this.O2(e[t])}O2(e){if(!(e instanceof re))return;const i=e.element;if(!(null!==i&&t.HTMLImageElement&&i instanceof HTMLImageElement&&i.Dp))return;const s=i.getAttribute("src")||"",n=this.oa.get(s);if(null!==n)for(let t=0;t<n.length;t++)if(n[t]===e)return n.splice(t,1),void(0===n.length&&(this.oa.delete(s),re.vO(i),i.hs instanceof u&&i.hs.delete(this)))}rT(){re.clearCache(),this.oa.clear()}rebuildParts(){this.partManager.rebuildParts()}Yc(t,e){this.Ns.Yc(t,e)}Gc(t,e){this.Ns.Gc(t,e)}findPartForKey(t){return this.partManager.findPartForKey(t)}findNodeForKey(t){return this.partManager.findNodeForKey(t)}findLinkForKey(t){return this.partManager.findLinkForKey(t)}findPartForData(t){return this.partManager.findPartForData(t)}findNodeForData(t){return this.partManager.findNodeForData(t)}findLinkForData(t){return this.partManager.findLinkForData(t)}findNodesByExample(...t){return this.partManager.findNodesByExample(...t)}findLinksByExample(...t){return this.partManager.findLinksByExample(...t)}get nodeTemplate(){return this.jr.get("")}set nodeTemplate(t){const e=this.jr.get("");e!==t&&(this.jr.set("",t),this.t("nodeTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.jr}set nodeTemplateMap(t){const e=this.jr;e!==t&&(this.jr=t,this.t("nodeTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.dh.get("")}set groupTemplate(t){const e=this.dh.get("");e!==t&&(this.dh.set("",t),this.t("groupTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.dh}set groupTemplateMap(t){const e=this.dh;e!==t&&(this.dh=t,this.t("groupTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.na.get("")}set linkTemplate(t){const e=this.na.get("");e!==t&&(this.na.set("",t),this.t("linkTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.na}set linkTemplateMap(t){const e=this.na;e!==t&&(this.na=t,this.t("linkTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.QM}set isMouseCaptured(e){const i=this.lt;if(null===i)return;const s=i.bt;s instanceof SVGElement||(e?(this.lastInput.bubbles=!1,this.Le(s,"pointermove",this.xh,!1),this.Le(s,"pointerdown",this.la,!1),this.Le(s,"pointerup",this.bh,!1),this.Le(s,"pointerout",this.kh,!1),this.Le(s,"pointercancel",this.Ph,!1),this.Et(t,"pointermove",this.xh,!0),this.Et(t,"pointerdown",this.la,!0),this.Et(t,"pointerup",this.bh,!0),this.Et(t,"pointerout",this.kh,!0),this.Et(t,"pointercancel",this.Ph,!0),this.Le(s,"wheel",this.wh,!1),this.Et(t,"wheel",this.wh,!0),this.Et(t,"selectstart",this.oh,!1)):(this.Le(t,"pointermove",this.xh,!0),this.Le(t,"pointerdown",this.la,!0),this.Le(t,"pointerup",this.bh,!0),this.Le(t,"pointerout",this.kh,!0),this.Le(t,"pointercancel",this.Ph,!0),this.Et(s,"pointermove",this.xh,!1),this.Et(s,"pointerdown",this.la,!1),this.Et(s,"pointerup",this.bh,!1),this.Et(s,"pointerout",this.kh,!1),this.Et(s,"pointercancel",this.Ph,!1),this.Le(t,"wheel",this.wh,!0),this.Le(t,"selectstart",this.oh,!1),this.Et(s,"wheel",this.wh,!1)),this.QM=e)}get position(){return this.ct}set position(t){if(this.ct.equals(t))return;const e=y.l().h(this.ct),i=this.viewportBounds.copy();if(this.ct.h(t),this.animationManager.UA(e,this.ct),this.Ht||null===this.lt&&!this.td.isReal())this.aa(),this.Np();else{this.Ht=!0;const t=this.scale,e=this.wt/t,i=this.xt/t;this.k2(this.ap,e,i,this.Wc,!1),this.Ht=!1}if(!this.Ht){const t=this.viewportBounds;this.onViewportBoundsChanged(i,t,this.it,!1)}y.i(e)}get initialPosition(){return this.ab}set initialPosition(t){this.ab.equals(t)||(this.ab=t.N())}get initialScale(){return this.hb}set initialScale(t){this.hb!==t&&(e.s(t,"number",wt,"initialScale"),this.hb=t)}get grid(){return null===this.ls&&(this.ls=this.aT()),this.ls}set grid(t){let i=this.ls;if(i!==t){null===i&&(this.ls=this.aT(),i=this.ls),t.type!==Yt.Grid&&e.o("Diagram.grid must be a Panel of type Panel.Grid");const s=i.panel;null!==s&&s.remove(i),this.ls=t,t.name="GRID",null!==s&&s.add(t),this.ed=!1,this.C(),this.t("grid",i,t)}}get viewportBounds(){return this.Yb}aa(){const t=this.Yb,e=this.ct,i=this.it;t.e(e.x,e.y,Math.max(this.wt,0)/i,Math.max(this.xt,0)/i),this.ha()}get viewSize(){return this.td}set viewSize(t){const e=this.viewSize;if(!e.equals(t)){t=t.N(),this.td=t;let i=0,s=0;t.isReal()?(i=t.width,s=t.height):null!==this.Nt&&(i=this.Nt.clientWidth||1,s=this.Nt.clientHeight||1),this.wt=i,this.xt=s,this.aa(),this.invalidateDocumentBounds(),this.t("viewSize",e,t),this.C()}}get fixedBounds(){return this.db}set fixedBounds(t){const i=this.db;i.equals(t)||((t.width===-1/0||t.height===1/0||t.height===-1/0)&&e.o("fixedBounds width/height must not be Infinity"),t=t.N(),this.db=t,this.invalidateDocumentBounds(),this.t("fixedBounds",i,t))}get scrollMargin(){return this.fh}set scrollMargin(t){"number"==typeof t&&(t=new b(t));const e=this.fh;e.equals(t)||(t=t.N(),this.fh=t,this.t("scrollMargin",e,t),this.Iu())}get scrollMode(){return this.ah}set scrollMode(t){const e=this.ah;e!==t&&(this.ah=t,1===t&&this.Js(!1),this.t("scrollMode",e,t),this.Nh(),this.C())}get scrollsPageOnFocus(){return this.gb}set scrollsPageOnFocus(t){const i=this.gb;i!==t&&(e.s(t,"boolean",wt,"scrollsPageOnFocus"),this.gb=t,this.t("scrollsPageOnFocus",i,t))}get positionComputation(){return this.pb}set positionComputation(t){const i=this.pb;i!==t&&(null!==t&&e.S(t,wt,"positionComputation"),this.pb=t,this.Js(!1),this.t("positionComputation",i,t))}get scaleComputation(){return this.yb}set scaleComputation(t){const i=this.yb;i!==t&&(null!==t&&e.S(t,wt,"scaleComputation"),this.yb=t,this.ST(this.scale,this.scale),this.t("scaleComputation",i,t))}get documentBounds(){return this.ap}CT(t){this.mh=!1;let e=this.ap;e.equals(t)||(e=e.copy(),this.ap.h(t),this.Js(!1),this.T("DocumentBoundsChanged",void 0,e),this.Nh(),this.C())}ensureBounds(){if(this.mh){const t=w.l();this.CT(this.computeBounds(t)),w.i(t)}}get isVirtualized(){return this.Kb}set isVirtualized(t){const i=this.Kb;i!==t&&(e.s(t,"boolean",wt,"isVirtualized"),this.Kb=t,this.t("isVirtualized",i,t))}get scale(){return this.it}set scale(t){const e=this.it;e!==t&&this.ST(e,t)}get defaultScale(){return this.dp}set defaultScale(t){this.dp=t}get autoScale(){return this.ia}set autoScale(t){const e=this.ia;e!==t&&(this.ia=t,this.t("autoScale",e,t),1!==t&&this.Js(!1))}get initialAutoScale(){return this.Rr}set initialAutoScale(t){const e=this.Rr;e!==t&&(this.Rr=t,this.t("initialAutoScale",e,t))}get initialViewportSpot(){return this.xb}set initialViewportSpot(t){const i=this.xb;i!==t&&(t.isSpot()||e.o("initialViewportSpot must be a specific Spot: "+t),this.xb=t,this.t("initialViewportSpot",i,t))}get initialDocumentSpot(){return this.wb}set initialDocumentSpot(t){const i=this.wb;i!==t&&(t.isSpot()||e.o("initialViewportSpot must be a specific Spot: "+t),this.wb=t,this.t("initialDocumentSpot",i,t))}get minScale(){return this.cb}set minScale(t){const i=this.cb;i!==t&&(t>0?(this.cb=t,this.t("minScale",i,t),t>this.scale&&(this.scale=t)):e.J(t,"> 0",wt,"minScale"))}get maxScale(){return this.fb}set maxScale(t){const i=this.fb;i!==t&&(t>0?(this.fb=t,this.t("maxScale",i,t),t<this.scale&&(this.scale=t)):e.J(t,"> 0",wt,"maxScale"))}get zoomPoint(){return this.ub}set zoomPoint(t){this.ub.equals(t)||(t=t.N(),this.ub=t)}get contentAlignment(){return this.Wc}set contentAlignment(t){const e=this.Wc;e.equals(t)||(t=t.N(),this.Wc=t,this.t("contentAlignment",e,t),this.Js(!1))}get initialContentAlignment(){return this.ip}set initialContentAlignment(t){const e=this.ip;e.equals(t)||(t=t.N(),this.ip=t,this.t("initialContentAlignment",e,t))}get padding(){return this.Qt}set padding(t){"number"==typeof t&&(t=new b(t));const e=this.Qt;e.equals(t)||(t=t.N(),this.Qt=t,this.invalidateDocumentBounds(),this.t("padding",e,t))}get partManager(){return this.s2}set partManager(t){const i=this.s2;i!==t&&(null!==t.diagram&&e.o("Cannot share PartManagers between Diagrams: "+t.toString()),i&&i.Io(null),this.s2=t,t.Io(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const t=new u,e=this.nodes;for(;e.next();){const i=e.value;i.isTopLevel&&t.add(i)}const i=this.links;for(;i.next();){const e=i.value;e.isTopLevel&&t.add(e)}return t.iterator}findTopLevelGroups(){return this.$r.iterator}get routers(){return this.nf}doLinkRouting(t){this.Uo=!0;const e=this.nf.r;for(let i=0;i<e.length;i++)e[i].canRoute(t)&&e[i].routeLinks(this.Or,t);this.Uo=!1}get layout(){return this.li}set layout(t){const e=this.li;e!==t&&(this.li=t,t.diagram=this,t.group=null,this.Jr=!0,this.t("layout",e,t),this.requestUpdate())}layoutDiagram(t){this.Te(),t&&this.c1(!0),this.As?this.M2(!1,this.Fl||0!==this.nf.count&&0!==this.to.size):(this.$c=!0,this.Pr())}c1(t){const e=this.$r.iterator;for(;e.next();)this.LT(e.value,t);this.layout&&(t?this.layout.isValidLayout=!1:this.layout.p())}LT(t,e){if(null===t)return;const i=t.Ch.iterator;for(;i.next();){const t=i.value;this.LT(t,e)}null!==t.layout&&(e?t.layout.isValidLayout=!1:t.layout.p())}M2(t,e){if(this.Ab)return;const i=this.G;this.G=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,r=this.animationManager;try{0===n&&(this.undoManager.Dl=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.ke&&(t||r.Gl(s)),this.Jr=!1;let i=this.$r.iterator;for(;i.next();)this.cd(i.value),this.AT(i.value,t,n,e);let a=!1;if(o.isValidLayout||(!t||o.isRealtime||null===o.isRealtime||0===n?(o.doLayout(this),this.cd(this),a=!0,o.isValidLayout=!0):this.Jr=!0),a||this.cd(this),this.doLinkRouting(this),this.Or.clear(),0!==this.uh.size){for(let t=0;t<23&&0!==this.uh.size;t++){for(i=this.$r.iterator;i.next();)this.TT(i.value);const t=this.Or;this.Or=this.uh,this.uh=t,this.cd(this),this.doLinkRouting(this)}this.Or.clear(),this.uh.clear()}}finally{const t=this.undoManager.Dl;0===n&&(this.commitTransaction(s),this.undoManager.Dl=!1),t&&(0===n||1===n)&&r.MM(),this.Jr&&(this.Jr=!o.isValidLayout),this.G=i}}AT(t,e,i,s){const n=t.Ch.iterator;for(;n.next();)this.AT(n.value,e,i,s);const o=t.layout;null===o||o.isValidLayout?s&&this.doLinkRouting(t):!e||o.isRealtime||0===i?(t.Lh=!t.location.isReal(),o.doLayout(t),t.invalidateLayout(32),this.o1(t),this.cd(t),this.doLinkRouting(t),o.isValidLayout=!0):(this.doLinkRouting(t),this.Jr=!0)}TT(t){const e=t.Ch.iterator;for(;e.next();)this.TT(e.value);this.cd(t),this.doLinkRouting(t)}get isTreePathToChildren(){return this.bb}set isTreePathToChildren(t){const i=this.bb;if(i!==t&&(e.s(t,"boolean",wt,"isTreePathToChildren"),this.bb=t,this.t("isTreePathToChildren",i,t),!this.undoManager.isUndoingRedoing)){const t=this.nodes;for(;t.next();)t.value.vp()}}findTreeRoots(){const t=new h,e=this.nodes;for(;e.next();){const i=e.value;i.isTopLevel&&null===i.findTreeParentLink()&&t.add(i)}return t.iterator}get treeCollapsePolicy(){return this.kb}set treeCollapsePolicy(t){const i=this.kb;i!==t&&(1!==t&&2!==t&&3!==t&&e.o("Unknown Diagram.treeCollapsePolicy: "+t),this.kb=t,this.t("treeCollapsePolicy",i,t))}get isCollapsingExpanding(){return this.YM}set isCollapsingExpanding(t){this.YM=t}_R(){const t=new p,e=new p;function i(i){const s=i.toLowerCase(),n=new h;t.set(i,n),t.set(s,n),e.set(i,i),e.set(s,i)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("FocusOrVirtualPointerEnabledChanged"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.XM=t,this.GM=e}dT(t){const e=this.GM.get(t);return null!==e?e:this.GM.get(t.toLowerCase())}I2(t){let i=this.XM.get(t);if(null!==i)return i;const s=t.toLowerCase();if(i=this.XM.get(s),null!==i)return i;e.o("Unknown DiagramEvent name: "+t)}addDiagramListener(t,i){e.s(t,"string",wt,"addDiagramListener:name"),e.S(i,wt,"addDiagramListener:listener");const s=this.I2(t);return null!==s&&s.add(i),this}removeDiagramListener(t,i){e.s(t,"string",wt,"removeDiagramListener:name"),e.S(i,wt,"addDiagramListener:listener");const s=this.I2(t);null!==s&&s.delete(i)}raiseDiagramEvent(t,e,i){this.T(t,e,i)}T(t,e,i){const s=this.I2(t),n=new F;n.diagram=this;const o=this.dT(t);null!==o&&(n.name=o),void 0!==e&&(n.subject=e),void 0!==i&&(n.parameter=i);const r=s.length;if(1===r)s.elt(0)(n);else if(0!==r){const t=s.toArray();for(let e=0;e<r;e++){(0,t[e])(n)}}}isUnoccupied(t,e){return this.getPositions(!1,null,e||null).isUnoccupied(t.x,t.y,t.width,t.height)}computeOccupiedArea(t){return this.isVirtualized?this.viewportBounds.copy():this.mh?this.cT(t):t.h(this.documentBounds)}getPositions(t,e,i){let s=this.sa;null===s&&(this.sa=s=new Pe(this.avoidanceCellSize));let n=e;if(s.Yo||s.Ah!==n||s.E2!==i){if(s.U2=Math.max(s.af+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.V2=Math.max(s.af+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),null!==n&&(n=this.DT(n)),null===n){const t=w.l();this.computeOccupiedArea(t),t.inflate(100,100),s.f1(t);const e=this.nodes;for(;e.next();){const s=e.value,n=s.layer;null===n||!n.visible||n.isTemporary||this.B2(s,i,t)}w.i(t)}else{if(n.memberParts.count>0){const t=this.computePartsBounds(n.memberParts,!1);t.inflate(20,20),s.f1(t)}const t=w.l(),e=n.memberParts;for(;e.next();){const s=e.value;s instanceof me&&this.B2(s,i,t)}w.i(t)}s.Ah=n,s.E2=i,s.Yo=!1}else t&&s.vT();return s}get avoidanceCellSize(){return this._M}set avoidanceCellSize(t){this.sa=null,this._M=new x(Math.max(1,t.width),Math.max(1,t.height))}get avoidanceLimit(){return this.t2}set avoidanceLimit(t){this.t2=Math.max(1,t)}DT(t){return t.canAvoid()?t:null!==t.containingGroup?this.DT(t.containingGroup):null}B2(t,e,i){if(t===e||!t.isVisible())return;const s=t.canAvoid();if(s){const e=t.getAvoidableRect(i);this.sa.FO(e.x,e.y,e.width,e.height)}if(t instanceof Ne&&(!s||t.avoidableMembers)){const s=t.memberParts;for(;s.next();){const t=s.value;t instanceof me&&this.B2(t,e,i)}}}fd(t){null!==this.sa&&!this.sa.Yo&&(void 0===t||t.canAvoid())&&(this.sa.Yo=!0)}get autoScrollInterval(){return this.sp}set autoScrollInterval(t){const e=this.sp;e!==t&&(this.sp=t,this.t("autoScrollInterval",e,t))}get autoScrollRegion(){return this.np}set autoScrollRegion(t){"number"==typeof t&&(t=new b(t));const e=this.np;e.equals(t)||(t=t.N(),this.np=t,this.invalidateDocumentBounds(),this.t("autoScrollRegion",e,t))}doAutoScroll(t){this.cp.h(t);const e=y.l();this.computeAutoScrollPosition(this.cp,e).equalsApprox(this.position)?this.stopAutoScroll():this.FT(),y.i(e)}FT(){if(-1!==this.Jc)return;const t=this.sp,i=this;this.Jc=e.un((()=>{if(-1===i.Jc||(i.stopAutoScroll(),null===i.lastInput.event))return;const t=y.l(),e=i.computeAutoScrollPosition(i.cp,t);if(!e.equalsApprox(i.position)){i.position=e,i.lastInput.documentPoint=i.transformViewToDoc(i.cp),i.doMouseMove(),i.mh=!0;const t=w.l();i.computeBounds(t),t.unionRect(i.documentBounds),i.CT(t),w.i(t),i.qi=!0,i.maybeUpdate(),i.FT()}y.i(t)}),t)}stopAutoScroll(){-1!==this.Jc&&(e.yc(this.Jc),this.Jc=-1)}computeAutoScrollPosition(t,e){let i=this.position;void 0===e&&(e=new y),e.h(i);const s=this.np;if(s.top<=0&&s.left<=0&&s.right<=0&&s.bottom<=0)return e;const n=this.viewportBounds,o=this.scale,r=w.z(0,0,n.width*o,n.height*o),a=y.z(0,0);if(t.x>=r.x&&t.x<r.x+s.left&&this.allowHorizontalScroll){let e=Math.max(this.scrollHorizontalLineChange,1);e|=0,a.x-=e,t.x<r.x+s.left/2&&(a.x-=e),t.x<r.x+s.left/4&&(a.x-=4*e)}else if(t.x<=r.x+r.width&&t.x>r.x+r.width-s.right&&this.allowHorizontalScroll){let e=Math.max(this.scrollHorizontalLineChange,1);e|=0,a.x+=e,t.x>r.x+r.width-s.right/2&&(a.x+=e),t.x>r.x+r.width-s.right/4&&(a.x+=4*e)}if(t.y>=r.y&&t.y<r.y+s.top&&this.allowVerticalScroll){let e=Math.max(this.scrollVerticalLineChange,1);e|=0,a.y-=e,t.y<r.y+s.top/2&&(a.y-=e),t.y<r.y+s.top/4&&(a.y-=4*e)}else if(t.y<=r.y+r.height&&t.y>r.y+r.height-s.bottom&&this.allowVerticalScroll){let e=Math.max(this.scrollVerticalLineChange,1);e|=0,a.y+=e,t.y>r.y+r.height-s.bottom/2&&(a.y+=e),t.y>r.y+r.height-s.bottom/4&&(a.y+=4*e)}return a.equalsApprox(y.dn)||(e.x=i.x+a.x/o,e.y=i.y+a.y/o),w.i(r),y.i(a),e}makeSvg(i){this.zo.has("SVG")||this.addRenderer("SVG",new Rt(this,t.document));const s=new Rt(this,t.document,!0);void 0===i&&(i={});const n=this;return this.OT((function(t,i){const o=n.RT(t,"SVG",s),r=null!==o?o.svg:null,a=t.svgFinished;return r&&a&&a(r),e.st(i)?(i(r),null):r}),i)}makeSVG(t){return this.makeSvg(t)}addRenderer(t,e){this.zo.set(t,e)}removeRenderer(t){this.zo.delete(t)}cacheGroupExternalLinks(t){this.d2=t,t||this.nodes.each((t=>{t instanceof Ne&&(t.Fp=null)}))}OT(i,s){const n=s.callback;let o=!0;const r=this.oa.iterator;for(;r.next();)if(!r.value[0].Sn){o=!1;break}if(!e.st(n)||o)return i(s,n,this);const a=this;function h(){const e=+new Date;for(o=!0,r.reset();r.next();)if(!r.value[0].Sn){o=!1;break}o||e-u>l?i(s,n,a):t.requestAnimationFrame(h)}const l=s.callbackTimeout||300,u=+new Date;return t.requestAnimationFrame((()=>h())),null}makeImage(t){return wt.isUsingDOM()?(void 0===t&&(t={}),t.returnType="Image",this.makeImageData(t)):null}makeImageData(t){return void 0===t&&(t={}),this.OT(this.RO,t)}static img="image";RO(t,i,s){const n=s.RT(t,"canvas",null);if(null===n)return null;const o=n.F.canvas;let r=null;if(null!==o){let s=t.returnType;switch(s=void 0===s?"string":s.toLowerCase(),s){case wt.img+"data":r=n.getImageData(0,0,o.width,o.height);break;case wt.img:const s=(t.document||document).createElement("img");s.src=o.toDataURL(t.type,t.details),r=s;break;case"blob":{const s=o;return e.st(i)||(r="",e.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),e.st(s.toBlob)?(s.toBlob(i,t.type,t.details),"toBlob"):(i(null),null)}default:r=o.toDataURL(t.type,t.details)}}return e.st(i)?(i(r),null):r}static OO=!1;RT(i,s,n){this.animationManager.stopAnimation(),this.maybeUpdate(),e.$(i)||e.o("properties argument must be an Object.");let o=!1,r=i.size||null,a=i.scale||null;void 0!==i.scale&&isNaN(i.scale)&&(a="NaN");let l=i.maxSize;void 0===i.maxSize&&(o=!0,l="SVG"===s?new x(1/0,1/0):new x(2e3,2e3));const u=i.position||null;let c=i.parts||null;Array.isArray(c)&&(c=new h(c));let d=void 0===i.padding?1:i.padding;const g=i.background||null;let f=i.omitTemporary;void 0===f&&(f=!0);const m=i.document||t.document,p=i.elementFinished||null;let v=i.showTemporary;void 0===v&&(v=!f);let P=i.showGrid;void 0===P&&(P=v),null!==r&&isNaN(r.width)&&isNaN(r.height)&&(r=null),"number"==typeof d?d=new b(d):d instanceof b||e.o("MakeImage padding must be a Margin or a number."),d.left=Math.max(d.left,0),d.right=Math.max(d.right,0),d.top=Math.max(d.top,0),d.bottom=Math.max(d.bottom,0),this.Wt&&this.Wt.clearContextCache(!0);const k=new Et(null,m,void 0,!0),S=k._t;if(!(r||a||c||u))return k.width=this.wt+Math.ceil(d.left+d.right),k.height=this.xt+Math.ceil(d.top+d.bottom),"SVG"===s?null===n?null:(n.resize(k.width,k.height,k.width,k.height),n.tl=m,n.ud=p,this.l1(n._t,d,new x(k.width,k.height),this.it,this.ct,c,g,v,P),n._t):(this.nd=!1,this.l1(S,d,new x(k.width,k.height),this.it,this.ct,c,g,v,P),this.nd=!0,k._t);const M=this.dp,C=this.documentBounds.copy();if(C.subtractMargin(this.Qt),v){const t=this.Vt.r,e=t.length;for(let i=0;i<e;i++){const e=t[i];if(!e.visible||!e.isTemporary)continue;const s=e.Ct.r,n=s.length;for(let t=0;t<n;t++){const e=s[t];if(!e.isInDocumentBounds||!e.isVisible())continue;const i=e.actualBounds;i.isReal()&&C.unionRect(i)}}}let N=new y(C.x,C.y);if(null!==c){const t=new w(0,0,0,0);let e=!0;const i=c.iterator;for(i.reset();i.next();){const s=i.value;if(!(s instanceof ce))continue;const n=s.layer;if(null!==n&&!n.visible||null!==n&&!v&&n.isTemporary||!s.isVisible())continue;const o=s.actualBounds;o.isReal()&&(e?(e=!1,t.h(o)):t.unionRect(o))}C.width=t.width,C.height=t.height,N.x=t.x,N.y=t.y}null!==u&&u.isReal()&&(N=u,a||(a=M));let T=0,L=0;null!==d&&(T=d.left+d.right,L=d.top+d.bottom);let A=0,D=0;null!==r&&(A=r.width,D=r.height,isFinite(A)&&(A=Math.max(0,A-T)),isFinite(D)&&(D=Math.max(0,D-L)));let F=0,O=0;if(null!==r&&null!==a?("NaN"===a&&(a=M),r.isReal()?(F=A,O=D):isNaN(D)?(F=A,O=C.height*a):(F=C.width*a,O=D)):null!==r?r.isReal()?(a=Math.min(A/C.width,D/C.height),F=A,O=D):isNaN(D)?(a=A/C.width,F=A,O=C.height*a):(a=D/C.height,F=C.width*a,O=D):null!==a?"NaN"===a&&l.isReal()?(a=Math.min((l.width-T)/C.width,(l.height-L)/C.height),a>M?(a=M,F=C.width,O=C.height):(F=l.width,O=l.height)):(F=C.width*a,O=C.height*a):(a=M,F=C.width,O=C.height),null!==d?(F+=T,O+=L):d=new b(0),null!==l){let t=l.width,e=l.height;"SVG"!==s&&o&&wt.OO,isNaN(t)&&(t=2e3),isNaN(e)&&(e=2e3),isFinite(t)&&(F=Math.min(F,t)),isFinite(e)&&(O=Math.min(O,e))}return k.width=Math.ceil(F),k.height=Math.ceil(O),"SVG"===s?null===n?null:(n.resize(k.width,k.height,k.width,k.height),n.tl=m,n.ud=p,this.l1(n._t,d,new x(Math.ceil(F),Math.ceil(O)),a,N,c,g,v,P),n._t):(this.nd=!1,this.l1(S,d,new x(Math.ceil(F),Math.ceil(O)),a,N,c,g,v,P),this.nd=!0,k._t)}static Mh=null;static z2="5da73c80a36555d5038e4972187c3cae51fd22";static IO="5da73c80a36555d503aa5c72106c30b35bb2006b9cd041b259";static jw=!1;static OP=()=>{if(void 0===wt.z2[5]&&(P.prototype.Ci=P.prototype.Su),!wt.isUsingDOM())return;const t=e.Ni("canvas");t.width=350;const i=t.getContext("2d"),s=e.We("7ca11abfd022028846"),n="7ca11abfd7330390",o=[wt.z2,e.jw+"4ae6247590da4bb21c324ba3a84e385776",P.OP+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",k.za];i.scale(2,2);for(let t=1;t<5;t++)i[e.We(n)](e.We(o[t-1]),8,15*t);i[s]=e.We("39f046ebb36e4b");for(let t=1;t<5;t++)i[e.We(n)](e.We(o[t-1]),8,15*t);(4!==o.length||"5"!==o[0][0]||"7"!==o[3][0])&&(P.prototype.Ci=P.prototype.Su),wt.Mh=t};static EO=()=>{if(void 0===wt.z2[5]&&(P.prototype.Ci=P.prototype.Su),!wt.isUsingDOM())return;const t=e.Ni("canvas"),i=t.getContext("2d"),s=e.We("7ca11abfd022028846"),n="7ca11abfd7330390",o=[wt.IO,k.za];i.scale(2,2);for(let t=1;t<3;t++)i[e.We(n)](e.We(o[t-1]),5,11*t);i[s]=e.We("39f046ebb36e4b");for(let t=1;t<3;t++)i[e.We(n)](e.We(o[t-1]),5,11*t);(2!==o.length||"5"!==o[0][0])&&(P.prototype.Ci=P.prototype.Su),wt.Mh=t}}class bt{IT;ET;X2;bi;constructor(t){if(this.IT=null,this.ET="63ad05bbe23a1786468a4c741b6d2",this.X2="@onz",this.ET===this._tk)return this.X2=!0,void(this.bi=this.X2);this.bi=null}UO(i,s){let n="f";const o=t[e.We("76a715b2f73f148a")][e.We("72ba13b5")]||"",r=e.We;if(this.bi=!0,!wt.isUsingDOM())return;let a=wt[r("76a115b6ed251eaf4692")];if(!a){const t=o[r("76ad18b4f73e")];for(let e=o[r("73a612b6fb191d")](r("35e7"))+2;e<t;e++)n+=o[e];const e=n[r("73a612b6fb191d")](r("7da71ca0ad381e90"));return void(this.bi=!(e>=0&&e<n[r("73a612b6fb191d")](r("35"))))}const h=wt.F2.iterator;for(;h.next();){a=h.value;const l=r(a).split(r("39e9")),u=7===l.length?1:0;if(1===l.length&&a.includes(r("5b8b3797c61b32a7"))){if(wt.EO(),!i.lt)return;i.gp=i.lt._t.F[e.We("7eba17a4ca3b1a8346")][e.We("78a118b7")](i.lt._t.F,wt.Mh,4,4)}if(l.length<6)return;const c=r(l[1+u]).split(".");if("7da71ca0"!==l[4+u])return;const d=r(e[r("6cae19")]).split(".");if(!(c[0]>d[0]||c[0]===d[0]&&c[1]>=d[1]))continue;const g="73a612b6fb191d",f=t[r("74a900bae4370f8b51")][r("6fbb13a1c2311e8a57")].toLowerCase(),m=f[r(g)](r("3aad1ab6e022098b4dc4")),p=r(l[2+u]);if(m>-1){const t=f[r(g)](p.toLowerCase()+"/");if(this.bi=!(t>-1&&t<m),!this.bi)return}const y=o[r("76ad18b4f73e")];for(let t=o[r(g)](r("35e7"))+2;t<y;t++)n+=o[t];let x=n[r(g)](p);if(x<0&&p!==r("7da71ca0ad381e90")&&(x=n[r(g)](r("76a715b2ef3e149757"))),x<0&&(x=n[r(g)](r("76a715b2ef3e149757"))),x<0&&(x=n[r(g)](r("2bfa41fdb3784bca12"))),x<0&&(x=o[r(g)](r("7baa19a6f76c1988428554"))),x<0&&(x=o[r(g)](r("7ea902b2b9221e9c57c45767196566"))),this.bi=!(x>=0&&x<n[r(g)](r("35"))||-1===n[r(g)](r("35"))),!this.bi||o[r(g)](r("7fb002b6ed25128b4da25b2e"))&&(this.bi=!(o[r(g)](p)>-1),!this.bi))return;const w=t[e.We("76a715b2f73f148a")][e.We("69ad17a1e03e")],b=w[r(g)](r("7fb002b6ed25128b4da25b2e"));if(b>-1&&(this.bi=!(w[r(g)](p)>b),!this.bi))return;const v=p;if("#"!==v[0])continue;const P=e.Ni("div");let k=l[0+u].replace(/[A-Za-z]/g,"");for(;k.length<4;)k+="9";const S=k;k=k.substring(k.length-4);const M=parseInt(d[0]),C=parseInt(d[1]);if(M>3||3===M&&C>=1){const t=parseInt(S)%40+30,e=parseInt(v.substring(1,5),16);if(be.UT===t+e)return void(this.bi=!1)}else{let e="";const i=["Header","Background","Display","Feedback"];if(e+=["gsh","gsf"][parseInt(k.substring(0,1),10)%2],e+=i[parseInt(k.substring(0,1),10)%4],P[r("79a417a0f0181a8946")]=e,t.document[r("78a712aa")]){t.document[r("78a712aa")][r("7bb806b6ed32388c4a875b")](P);const i=t.getComputedStyle(P).getPropertyValue(r("78a704b7e62456904c9b12701b6532a8")),s=t.getComputedStyle(P).getPropertyValue(r("75b817b0ea2202"));if(t.document[r("78a712aa")][r("68ad1bbcf533388c4a875b")](P),!i)continue;const n=t[r("77a902b0eb1b1e804a8a")];if(s==="0."+parseInt(S,10)%100||-1!==i.indexOf(parseInt(v[1]+v[2],16).toString())&&-1!==i.indexOf(parseInt(v[3]+v[4],16).toString()))return void(this.bi=!1);if(n&&n(r("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){e="."+e;for(let i=0;i<t.document.styleSheets.length;i++){const s=t.document.styleSheets[i].rules||t.document.styleSheets[i].cssRules;for(const t in s)if(e===s[t].selectorText)return void(this.bi=!1)}}}else this.bi=null,s&&(this.bi=!1)}}}Mh(t,e){return e.setTransform(t.$e/2,0,0,t.$e/2,0,0),e.commitTransform(),null===this.bi&&this.UO(t,!0),0<this.bi&&this!==this.IT}}class vt{G2;Y2;constructor(t){this.G2=void 0===t?new y:t,this.Y2=new y}get point(){return this.G2}set point(t){this.G2=t}get shifted(){return this.Y2}set shifted(t){this.Y2=t}}class Pt{Ri;wT;h1;constructor(t,e,i){this.Ri=t,this.wT=e,this.h1=i}}class kt{isGridSnapEnabled;isGridSnapRealtime;gridSnapCellSize;gridSnapCellSpot;gridSnapOrigin;dragsLink;dragsTree;groupsSnapMembers;groupsAlwaysMove;dragsMembers;constructor(t){this.Ue(),t&&Object.assign(this,t)}Ue(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new x(NaN,NaN).k(),this.gridSnapCellSpot=v.TopLeft,this.gridSnapOrigin=new y(NaN,NaN).k(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class St extends wt{u1;d1;g1;m1;Rp;hf;Bl;K2;H2;p1;q2;constructor(i,s){let n;return void 0===i||"string"==typeof i||t.Element&&i instanceof Element?n=i:e.$(i)&&(s=i),super(n),this.animationManager.isEnabled=!1,this.Ht=!0,this.u1=null,this.Zu=!1,this.Qu=!1,this.d1=!0,this.g1=!0,this.m1=0,this.Rp=!1,this.hf=null,this.setRenderingHint("drawShadows",!1),this.Bl=new ce({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new $t({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).It(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new b(0,0,0,0),this.ct.e(0,0),this.toolManager.Jt("Dragging",new Mt,this.toolManager.mouseMoveTools),this.click=()=>{const t=this.observed;if(null===t)return;const e=t.viewportBounds,i=this.lastInput.documentPoint;t.position=new y(i.x-e.width/2,i.y-e.height/2)},this.K2=t=>{this.invalidateDocumentBounds(),this.Op()},this.H2=t=>{null!==this.observed&&(this.invalidateDocumentBounds(),this.C())},this.p1=t=>{this.updateDelay<1?this.C():this.Rp||(this.Rp=!0,e.un((()=>this.redraw()),this.updateDelay))},this.q2=t=>{null!==this.observed&&this.Op()},this.autoScale=2,this.Ht=!1,s&&this.setProperties(s),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.Rp&&this.updateDelay>=1&&(this.Rp=!1,this.VO()),super.redraw()}Ge(){if(null===this.Nt&&e.o("No div specified"),null===this.lt&&e.o("No canvas specified"),this.lt instanceof Rt||(this.box.BM(),!this.qi))return;const t=this.observed;if(null===t||t.animationManager.defaultAnimation.isAnimating||!t.Qa)return;this.Lp();const i=this.lt,s=this.Wt;if(s.clearContextCache(!0),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height),this.updateDelay<1)this.BT();else if(null!==this.hf){s.drawImage(this.hf.bt,0,0);const t=this.v;s.scale(this.$e,this.$e),s.transform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),s.commitTransform()}const n=this.Vt.r,o=n.length;for(let t=0;t<o;t++)n[t].Ge(s,this);this._c=!1,this.qi=!1}VO(){const t=this.lt,e=this.Wt;if(null!==t&&null!==e){if(this.Lp(),null===this.hf){const e=new Et(null);e.width=t.width,e.height=t.height,this.hf=e}try{this.lt=this.hf,this.Wt=this.lt._t,this.Wt.clearContextCache(!0),this.Wt.setTransform(1,0,0,1,0,0),this.Wt.clearRect(0,0,this.lt.width,this.lt.height),this.BT()}finally{this.lt=t,this.Wt=e}}}BT(){const t=this.observed;if(null===t)return;const e=this.drawsTemporaryLayers,i=this.drawsGrid&&e,s=t.grid;if(i&&null!==s&&s.visible&&!isNaN(s.width)&&!isNaN(s.height)){const e=w.l().h(this.viewportBounds).unionRect(t.viewportBounds);t.ca(e),w.i(e),t.Te()}const n=this.v,o=this.Wt;o.scale(this.$e,this.$e),o.transform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),o.commitTransform();const r=this.viewportBounds,a=t.Vt.r,h=a.length,l=this.Vt.r;this.rs(l,l.length,this,this.viewportBounds);for(let t=0;t<h;t++)a[t].UR(o,r,this,e,i)}get observed(){return this.u1}set observed(t){const i=this.u1;if(null!==t&&e.se(t,wt,St,"observed"),t instanceof St&&e.o("Overview.observed Diagram may not be an Overview itself: "+t),i!==t){if(null!==i&&this.BO(i),this.u1=t,null!==t&&this.zO(t),this.invalidateDocumentBounds(),null===t){this.hf=null;const t=this.lt,e=this.Wt;t&&e&&(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height))}else this.p1(null),this.Op(),this.C();this.t("observed",i,t)}}get box(){return this.Bl}set box(t){const e=this.Bl;e!==t&&(t.It(),this.Bl=t,this.remove(e),this.add(this.Bl),this.Op(),this.t("box",e,t))}get drawsTemporaryLayers(){return this.d1}set drawsTemporaryLayers(t){this.d1!==t&&(this.d1=t,this.redraw())}get drawsGrid(){return this.g1}set drawsGrid(t){this.g1!==t&&(this.g1=t,this.redraw())}get updateDelay(){return this.m1}set updateDelay(t){t<0&&(t=0),this.m1!==t&&(this.m1=t)}zO(t){null!==t&&(t.addDiagramListener("ViewportBoundsChanged",this.K2),t.addDiagramListener("DocumentBoundsChanged",this.H2),t.addDiagramListener("InvalidateDraw",this.p1),t.addDiagramListener("AnimationFinished",this.q2),this.add(this.box))}BO(t){null!==t&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this.K2),t.removeDiagramListener("DocumentBoundsChanged",this.H2),t.removeDiagramListener("InvalidateDraw",this.p1),t.removeDiagramListener("AnimationFinished",this.q2))}Op(){const t=this.box,e=this.observed;if(null===e)return;this.qi=!0;const i=e.viewportBounds,s=t.selectionObject,n=x.l();n.e(i.width,i.height),s.desiredSize=n,x.i(n);const o=2/this.scale;s instanceof $t&&(s.strokeWidth=o),t.location=new y(i.x-o/2,i.y-o/2),t.isSelected=!0}computeBounds(){const t=this.observed;if(null===t)return w.em;const e=t.documentBounds.copy();return e.unionRect(t.viewportBounds),e}invalidateViewport(t,e){!0!==this.qi&&(this.qi=!0,this.requestUpdate())}onViewportBoundsChanged(t,e,i,s){this.Ht||(this.ha(),this.C(),this.Nh(),this.invalidateDocumentBounds(),this.Op(),this.Ye.scale=i,this.Ye.position.x=t.x,this.Ye.position.y=t.y,this.Ye.bounds.h(t),this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,t))}}class Mt extends U{ua;constructor(){super(),this.ua=y.gn}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(null===t||!t.allowMove||!t.allowSelect)return!1;const e=t.observed;if(null===e)return!1;const i=t.lastInput;if(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.delay))return!1;if(null===this.findDraggablePart()){const i=e.viewportBounds;this.ua=new y(i.width/2,i.height/2);const s=t.firstInput.documentPoint;e.position=new y(s.x-this.ua.x,s.y-this.ua.y)}return!0}doActivate(){this.ua=y.gn,super.doActivate()}doUpdateCursor(t){const e=this.diagram,i=e.box;null!==i&&i.cursor&&(e.currentCursor=i.cursor)}moveParts(t,e,i){void 0===i&&(i=!1);const s=this.diagram,n=s.observed;if(null===n)return;const o=s.box;if(null===o)return;if(!this.ua.isReal()){const t=s.firstInput.documentPoint,e=o.location;this.ua=new y(t.x-e.x,t.y-e.y)}const r=s.lastInput.documentPoint;n.position=new y(r.x-this.ua.x,r.y-this.ua.y)}}class Ct{a;w1="go._clipboard";b1="go._clipboardFormat";j2;W2;J2;$2;Z2;Q2;_2;tN;eN;da;iN;k1;P1;S1;M1;sN;Ko;nN;oN;Ip;rN;N1;lN;C1;aN;hN;dd;Ep;Up;cN;Zc;fN;uN;dN;gN;mN;gd;pN;Oi;Ps;L1;Vp;static md=["Ctrl","Shft","Alt","Meta"];static zT=Ct.yN(230,40,15);static XO=Ct.yN(270,40,15);static GO=Ct.yN(310,40,15);constructor(t){u.Je(this),this.a=wt.Om(),this.j2=!0,this.W2=!0,this.J2=!0,this.$2=!1,this.Z2=!1,this.Q2=!1,this._2=!1,this.tN="memory",this.eN=null,this.da=null,this.iN=1.05,this.k1=NaN,this.P1=y.gn,this.S1=NaN,this.M1=w.em,this.sN=!1,this.Ko=null,this.nN=200,this.oN=!1,this.Ip=new ge("Auto",{layerName:"Tool",pickable:!1,selectable:!1}).add(new Yt("Spot").add(new $t({name:"SHAPE",fill:null,stroke:"lime",strokeWidth:4}).bindObject("stroke","adornedPart",(t=>t.isSelected?"darkcyan":"lime")),new $t({name:"SHAPE2",stretch:2,fill:null,stroke:"magenta",strokeWidth:4,strokeDashArray:[4,4]})),new Te({padding:4})),this.rN=null,this.N1="",this.lN="",this.C1=e.fr,this.aN=!1,this.hN=!1,this.dd=new ce({layerName:"Tool",isInDocumentBounds:!1,locationObjectName:"CIRCLE",locationSpot:v.Center,pickable:!1,selectable:!1}).add(new $t("Circle",{isGeometryPositioned:!0,width:30,height:30,fill:null,stroke:"darkcyan",strokeWidth:6,visible:!1}).bind("visible","down"),new $t({isGeometryPositioned:!0,geometryString:"M15 0L15 30",stroke:"magenta"}),new $t({isGeometryPositioned:!0,geometryString:"M0 15L30 15",stroke:"magenta"}),new $t("Circle",{name:"CIRCLE",isGeometryPositioned:!0,width:20,height:20,fill:null,stroke:"magenta",position:new y(5,5)}),new $t({isGeometryPositioned:!0,geometry:Ct.zT,fill:null,stroke:"cyan",strokeWidth:4}).bind("geometry","button",Ct.YO),new ie({position:new y(12,0),font:"bold 10pt sans-serif"}).bind("text","clickCount",(t=>t>1?t.toString():"")),new ie({position:new y(0,16)}).bind("text","modifiers",Ct.KO)).freezeBindings(),this.Ep=10,this.Up=1,this.cN=null,this.Zc=t=>this.HO(t),this.fN=t=>this.qO(t),this.uN=t=>this.jO(t),this.dN=t=>this.WO(t),this.gN=null,this.mN="distance",this.gd=null,this.pN=0,this.Oi={},this.Ps=null,this.L1=!1,this.Vp=null,this.wN(),this.dd.data=this.Oi,t&&Object.assign(this,t)}toString(){return"CommandHandler"}get diagram(){return this.a}Io(t){this.a=t}doStart(){const t=this.a;t&&(t.addModelChangedListener(this.Zc),t.addDiagramListener("ViewportBoundsChanged",this.fN),t.addDiagramListener("GainedFocus",this.uN),t.addDiagramListener("LostFocus",this.dN))}doStop(){const t=this.a;t&&(t.removeDiagramListener("ViewportBoundsChanged",this.fN),t.removeDiagramListener("GainedFocus",this.uN),t.removeDiagramListener("LostFocus",this.dN),t.removeModelChangedListener(this.Zc))}doKeyDown(){const t=this.a,e=t.lastInput,i=e.control||e.meta,s=e.shift,n=e.alt,o=e.commandKey;!i||"Insert"!==o&&"c"!==o?i&&"x"===o||s&&"Delete"===o?this.canCutSelection()&&this.cutSelection():i&&"v"===o||s&&"Insert"===o?this.canPasteSelection()&&this.pasteSelection():i&&"y"===o||i&&s&&"z"===o||n&&s&&"Backspace"===o?this.canRedo()&&this.redo():i&&"z"===o||n&&"Backspace"===o?this.canUndo()&&this.undo():"Delete"===o||"Backspace"===o?this.canDeleteSelection()&&this.deleteSelection():i&&"a"===o?this.canSelectAll()&&this.selectAll():"Escape"===o?this.canStopCommand()&&this.stopCommand():this.XT.indexOf(o)>=0?this.JO(o,i,s):"PageUp"===o?s&&t.allowHorizontalScroll?t.scroll("page","left"):t.allowVerticalScroll&&t.scroll("page","up"):"PageDown"===o?s&&t.allowHorizontalScroll?t.scroll("page","right"):t.allowVerticalScroll&&t.scroll("page","down"):"Home"===o?i&&t.allowVerticalScroll?t.scroll("document","up"):!i&&t.allowHorizontalScroll&&t.scroll("document","left"):"End"===o?i&&t.allowVerticalScroll?t.scroll("document","down"):!i&&t.allowHorizontalScroll&&t.scroll("document","right"):"Space"===o?this.canScrollToPart()&&this.scrollToPart():"Minus"===o||"NumpadSubtract"===o?this.canDecreaseZoom()&&this.decreaseZoom():"Equal"===o||"NumpadAdd"===o?this.canIncreaseZoom()&&this.increaseZoom():i&&"Digit0"===o?this.canResetZoom()&&this.resetZoom():s&&"z"===o?this.canZoomToFit()&&this.zoomToFit():i&&!s&&"g"===o?this.canGroupSelection()&&this.groupSelection():i&&s&&"g"===o?this.canUngroupSelection()&&this.ungroupSelection():"F2"===o?this.canEditTextBlock()&&this.editTextBlock():"ContextMenu"===o||s&&"F10"===o||i&&s&&"Backslash"===o?this.canShowContextMenu()&&this.showContextMenu():e.bubbles=!0:this.canCopySelection()&&this.copySelection()}doKeyUp(){this.a.lastInput.bubbles=!0}stopCommand(){const t=this.a,e=t.currentTool;if(e instanceof X){if(null!==e.currentToolTip)return void e.hideToolTip();t.allowSelect&&t.clearSelection()}null!==e&&e.doCancel()}canStopCommand(){return!0}selectAll(){const t=this.a;t.C();try{t.currentCursor="wait",t.T("ChangingSelection",t.selection);const e=t.parts;for(;e.next();){const t=e.value;t.canSelect()&&!t.layer.isTemporary&&(t.isSelected=!0)}const i=t.nodes;for(;i.next();){const t=i.value;t.canSelect()&&!t.layer.isTemporary&&(t.isSelected=!0)}const s=t.links;for(;s.next();){const t=s.value;t.canSelect()&&!t.layer.isTemporary&&(t.isSelected=!0)}}finally{t.T("ChangedSelection",t.selection),t.currentCursor=""}}canSelectAll(){return this.a.allowSelect}deleteSelection(){const t=this.a;try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Delete"),t.T("SelectionDeleting",t.selection);const e=new u,i=t.selection.iterator;for(;i.next();){const t=i.value;ce.ga(e,t,!0,this.deletesTree?1/0:0,!!this.deletesConnectedLinks&&null,(t=>t.canDelete()))}t.removeParts(e,!0),t.T("SelectionDeleted",e)}finally{t.commitTransaction("Delete"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canDeleteSelection(){const t=this.a;return!(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||0===t.selection.count)}copySelection(){const t=this.a;try{const e=new u,i=t.selection.iterator;for(;i.next();){const t=i.value;ce.ga(e,t,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,(t=>t.canCopy()))}this.copyToClipboard(e)}finally{}}canCopySelection(){const t=this.a;return!(!t.allowCopy||!t.allowClipboard||0===t.selection.count)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const t=this.a;return!(t.isReadOnly||t.isModelReadOnly||!t.allowCopy||!t.allowDelete||!t.allowClipboard||0===t.selection.count)}copyToClipboard(e){const i=this.a,s="systemClipboard"===this.storageLocation;if(s||"memory"!==this.storageLocation)try{if(null===e)if(s&&t.navigator.clipboard)t.navigator.clipboard.writeText("");else{const e=t[this.storageLocation];if(!e)return;e.setItem(this.w1,""),e.setItem(this.b1,"")}else{const n=new wt;if(n.isTreePathToChildren=i.isTreePathToChildren,n.toolManager.draggingTool.dragsLink=i.toolManager.draggingTool.dragsLink,n.model=i.model.copy(),i.copyParts(e,n,!1),s&&t.navigator.clipboard)t.navigator.clipboard.writeText(n.model.toJson());else{const e=t[this.storageLocation];if(!e)return;e.setItem(this.w1,n.model.toJson()),e.setItem(this.b1,n.model.dataFormat)}}return void i.T("ClipboardChanged",e)}catch{return}let n=null;if(null===e)wt.nT();else{let t=null;try{t=i.copyParts(e,null,!0)}finally{n=new h,null!==t&&n.addAll(t.iteratorValues),wt.Sp=n,wt.i1=i.model.dataFormat}}i.T("ClipboardChanged",n)}pasteFromClipboard(){const e=this.a;if("memory"!==this.storageLocation){const i=new u;try{const s=t[this.storageLocation];if(!s)return i;const n=s.getItem(this.w1),o=s.getItem(this.b1);if(null===n||""===n||o!==e.model.dataFormat)return i;{const t=new wt;t.model=Ue.fromJson(n);const i=new u;i.addAll(t.parts).addAll(t.nodes).addAll(t.links);const s=e.copyParts(i,e,!1);return(new u).addAll(s.iteratorValues)}}catch{return i}}const i=new u,s=wt.Sp;if(null===s||wt.i1!==e.model.dataFormat)return i;let n=null;try{n=e.copyParts(s,e,!1)}finally{if(null!==n){const t=n.iterator;for(;t.next();){const e=t.value,s=t.key;e.location.isReal()||(s.location.isReal()?e.location=s.location:!e.position.isReal()&&s.position.isReal()&&(e.position=s.position)),i.add(e)}}}return i}async pasteSelectionAsync(i){const s=this.a;if(void 0!==t.navigator.clipboard)try{s.currentCursor="wait",s.T("ChangingSelection",s.selection),s.startTransaction("Paste");let e=null;const n=await t.navigator.clipboard.readText();try{const t=n;if(null!==t&&""!==t){const i=new wt;i.model=Ue.fromJson(t);const n=new u;n.addAll(i.parts).addAll(i.nodes).addAll(i.links);const o=s.copyParts(n,s,!1);e=(new u).addAll(o.iteratorValues)}}catch{}if(null===e)return;e.count>0&&s.clearSelection(!0);const o=e.iterator;for(;o.next();){o.value.isSelected=!0}if(i){const t=s.computePartsBounds(s.selection);if(t.isReal()){const e=this.computeEffectiveCollection(s.selection,s.ld);s.Lx(e,new y(i.x-t.centerX,i.y-t.centerY),s.ld,!1)}}s.T("ClipboardPasted",e)}finally{s.commitTransaction("Paste"),s.T("ChangedSelection",s.selection),s.currentCursor=""}else e.ne('Cannot paste with storageLocation "clipboard", window.isSecureContext may be false.')}pasteSelection(t){if("systemClipboard"===this.storageLocation)return void this.pasteSelectionAsync(t);const e=this.a;try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Paste");const i=this.pasteFromClipboard();i.count>0&&e.clearSelection(!0);const s=i.iterator;for(;s.next();){s.value.isSelected=!0}if(t){const i=e.computePartsBounds(e.selection);if(i.isReal()){const s=this.computeEffectiveCollection(e.selection,e.ld);e.Lx(s,new y(t.x-i.centerX,t.y-i.centerY),e.ld,!1)}}e.T("ClipboardPasted",i)}finally{e.commitTransaction("Paste"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canPasteSelection(e){const i=this.a;if(i.isReadOnly||i.isModelReadOnly||!i.allowInsert||!i.allowClipboard)return!1;if("systemClipboard"===this.storageLocation)return!0;if("memory"!==this.storageLocation)try{const e=t[this.storageLocation];if(!e)return!1;const s=e.getItem(this.w1),n=e.getItem(this.b1);return!(null===s||""===s||n!==i.model.dataFormat)}catch{return!1}return!(null===wt.Sp||0===wt.Sp.count||wt.i1!==i.model.dataFormat)}undo(){this.a.undoManager.undo()}canUndo(){const t=this.a;return!t.isReadOnly&&!t.isModelReadOnly&&(t.allowUndo&&t.undoManager.canUndo())}redo(){this.a.undoManager.redo()}canRedo(){const t=this.a;return!t.isReadOnly&&!t.isModelReadOnly&&(t.allowUndo&&t.undoManager.canRedo())}decreaseZoom(t){void 0===t&&(t=1/this.zoomFactor);const e=this.a;if(1!==e.autoScale)return;const i=e.scale*t;i<e.minScale||i>e.maxScale||(e.scale=i)}canDecreaseZoom(t){void 0===t&&(t=1/this.zoomFactor);const e=this.a;if(1!==e.autoScale)return!1;const i=e.scale*t;return!(i<e.minScale||i>e.maxScale)&&e.allowZoom}increaseZoom(t){void 0===t&&(t=this.zoomFactor);const e=this.a;if(1!==e.autoScale)return;const i=e.scale*t;i<e.minScale||i>e.maxScale||(e.scale=i)}canIncreaseZoom(t){void 0===t&&(t=this.zoomFactor);const e=this.a;if(1!==e.autoScale)return!1;const i=e.scale*t;return!(i<e.minScale||i>e.maxScale)&&e.allowZoom}resetZoom(t){void 0===t&&(t=this.defaultScale);const e=this.a;t<e.minScale||t>e.maxScale||(e.scale=t)}canResetZoom(t){void 0===t&&(t=this.defaultScale);const e=this.a;return!(t<e.minScale||t>e.maxScale)&&e.allowZoom}zoomToFit(t){const e=this.a,i=e.animationManager;i.stopAnimation(),e.redraw();const s=e.position.copy(),n=e.scale;if(i.Gl("Zoom To Fit"),!t&&this.isZoomToFitRestoreEnabled&&n===this.S1&&!isNaN(this.k1)&&this.P1.isReal()&&e.documentBounds.equals(this.M1))e.scale=this.k1,e.position=this.P1,this.S1=NaN,this.M1=w.em;else{if(this.k1=n,this.P1=s,t){const i=t.copy();if(i.width>0&&i.height>0){const t=e.viewportBounds,s=t.width*n,o=t.height*n,r=Math.min(s/i.width,o/i.height),a=s/r,h=o/r;i.width<a&&(i.x-=(a-i.width)/2),i.height<h&&(i.y-=(h-i.height)/2)}e.zoomToRect(i,2)}else e.zoomToFit();this.S1=e.scale,this.M1=e.documentBounds.copy()}i.MM()}canZoomToFit(t){return this.a.allowZoom}JO(t,e,i){const s=this.a;"ArrowUp"===t?s.allowVerticalScroll&&(e?s.scroll("pixel","up"):s.scroll("line","up")):"ArrowDown"===t?s.allowVerticalScroll&&(e?s.scroll("pixel","down"):s.scroll("line","down")):"ArrowLeft"===t?s.allowHorizontalScroll&&(e?s.scroll("pixel","left"):s.scroll("line","left")):"ArrowRight"===t&&s.allowHorizontalScroll&&(e?s.scroll("pixel","right"):s.scroll("line","right"))}scrollToPart(t){void 0===t&&(t=null),null!==t&&e.se(t,ce,Ct,"part");const i=this.a;if(i.ensureBounds(),null===t){try{null!==this.Ko&&(this.Ko.next()?t=this.Ko.value:this.Ko=null)}catch{this.Ko=null}null===t&&(i.highlighteds.count>0?this.Ko=i.highlighteds.iterator:i.selection.count>0&&(this.Ko=i.selection.iterator),null!==this.Ko&&this.Ko.next()&&(t=this.Ko.value))}if(null!==t){const s=i.animationManager;s.Gl("Scroll To Part");const n=this.scrollToPartPause;if(n>0){const o=this.cf(t,[t]);if(1===o.length)i.startTransaction(),i.centerRect(t.actualBounds),i.commitTransaction("Scroll To Part");else{const t=()=>{i.startTransaction();let t=o.pop();for(;o.length>0&&t instanceof me&&t.isTreeExpanded&&(!(t instanceof Ne)||t.isSubGraphExpanded);)t=o.pop();o.length>0?(t instanceof ce&&i.scrollToRect(t.actualBounds),t instanceof me&&!t.isTreeExpanded&&(t.isTreeExpanded=!0),t instanceof Ne&&!t.isSubGraphExpanded&&(t.isSubGraphExpanded=!0)):(t instanceof ce&&i.centerRect(t.actualBounds),i.removeDiagramListener("LayoutCompleted",r)),i.commitTransaction("Scroll To Part")},r=()=>{e.un(t,(s.isEnabled?s.duration:0)+n)};i.addDiagramListener("LayoutCompleted",r),t()}}else{const e=i.position.copy();i.centerRect(t.actualBounds),e.equalsApprox(i.position)&&s.stopAnimation()}}}cf(t,e){if(t.isVisible())return e;if(t instanceof ge){const i=t.adornedPart;null!==i&&this.cf(i,e)}else if(t instanceof be){const i=t.fromNode;null!==i&&this.cf(i,e);const s=t.toNode;null!==s&&this.cf(s,e)}else{if(t instanceof me){const i=t.labeledLink;null!==i&&this.cf(i,e);const s=t.findTreeParentNode();null!==s&&(!s.isTreeExpanded&&!s.wasTreeExpanded&&e.push(s),this.cf(s,e))}const i=t.containingGroup;null!==i&&(!i.isSubGraphExpanded&&!i.wasSubGraphExpanded&&e.push(i),this.cf(i,e))}return e}canScrollToPart(t){if(void 0===t&&(t=null),null!==t&&!(t instanceof ce))return!1;const e=this.a;return(0!==e.selection.count||0!==e.highlighteds.count)&&(e.allowHorizontalScroll&&e.allowVerticalScroll)}collapseTree(t){void 0===t&&(t=null);const e=this.a,i="Collapse Tree";try{e.startTransaction(i),e.animationManager.Gl(i);const s=new h;if(null!==t&&t.isTreeExpanded)t.collapseTree(),s.add(t);else if(null===t){const t=e.selection.iterator;for(;t.next();){const e=t.value;e instanceof me&&e.isTreeExpanded&&(e.collapseTree(),s.add(e))}}e.T("TreeCollapsed",s)}finally{e.commitTransaction(i)}}canCollapseTree(t){void 0===t&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(null!==t){if(!(t instanceof me&&t.isTreeExpanded))return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{const t=e.selection.iterator;for(;t.next();){const e=t.value;if(e instanceof me){if(!e.isTreeExpanded)continue;if(e.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(t){void 0===t&&(t=null);const e=this.a,i="Expand Tree";try{e.startTransaction(i),e.animationManager.Gl(i);const s=new h;if(null===t||t.isTreeExpanded){if(null===t){const t=e.selection.iterator;for(;t.next();){const e=t.value;e instanceof me&&(e.isTreeExpanded||(e.expandTree(),s.add(e)))}}}else t.expandTree(),s.add(t);e.T("TreeExpanded",s)}finally{e.commitTransaction(i)}}canExpandTree(t){void 0===t&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(null!==t){if(!(t instanceof me)||t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{const t=e.selection.iterator;for(;t.next();){const e=t.value;if(e instanceof me){if(e.isTreeExpanded)continue;if(e.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const t=this.a,e=t.model;if(!e.ff())return;const i=this.archetypeGroupData;if(null===i)return;let s=null;try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Group");const n=new h,o=t.selection.iterator;for(;o.next();){const t=o.value;t.Di()&&t.canGroup()&&n.add(t)}const r=new h,a=n.iterator;for(;a.next();){const t=a.value;let e=!1;const i=n.iterator;for(;i.next();){const s=i.value;if(t.isMemberOf(s)){e=!0;break}}e||r.add(t)}const l=r.first();if(null!==l){let n=l.containingGroup;if(null!==n)for(;null!==n;){let t=!1;const e=r.iterator;for(;e.next();)if(!e.value.isMemberOf(n)){t=!0;break}if(!t)break;n=n.containingGroup}if(i instanceof Ne)i.It(),s=i.copy(),null!==s&&t.add(s);else if(e.isGroupForData(i)){const n=e.copyNodeData(i);e.addNodeData(n),s=t.findNodeForData(n)}if(null!==s){null!==n&&this.isValidMember(n,s)&&(s.containingGroup=n);const e=r.iterator;for(;e.next();){const t=e.value;this.isValidMember(s,t)&&(t.containingGroup=s)}t.clearSelection(!0),s.isSelected=!0}}t.T("SelectionGrouped",s)}finally{t.commitTransaction("Group"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canGroupSelection(){const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowGroup||!t.model.ff()||null===this.archetypeGroupData)return!1;const e=t.selection.iterator;for(;e.next();){const t=e.value;if(t.Di()&&t.canGroup())return!0}return!1}xN(t){const i=e.nt();if(Array.isArray(t))t.forEach((t=>{t instanceof be||t instanceof ce&&i.push(t)}));else{const e=t.iterator;for(;e.next();){const t=e.value;t instanceof be||t instanceof ce&&i.push(t)}}const s=new u,n=i.length;for(let t=0;t<n;t++){const e=i[t];let o=!0;for(let t=0;t<n;t++)if(e.isMemberOf(i[t])){o=!1;break}o&&s.add(e)}return e.Z(i),s}isValidMember(t,e){if(null===e||t===e||e instanceof be)return!1;let i;return(null===t||!(t===e||t.isMemberOf(e)||(i=t.memberValidation,null!==i&&!i(t,e))||null===t.data&&null!==e.data||null!==t.data&&null===e.data))&&(i=this.memberValidation,null===i||i(t,e))}ungroupSelection(t){void 0===t&&(t=null);const e=this.a,i=e.model;if(i.ff())try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Ungroup");const s=new h;if(null!==t)s.add(t);else{const t=e.selection.iterator;for(;t.next();){const e=t.value;e instanceof Ne&&e.canUngroup()&&s.add(e)}}const n=new h;if(s.count>0){e.clearSelection(!0);const t=s.iterator;for(;t.next();){const s=t.value;s.expandSubGraph();const o=s.containingGroup,r=null!==o&&null!==o.data?i.getKeyForNodeData(o.data):void 0;n.addAll(s.memberParts);const a=n.iterator;for(;a.next();){const t=a.value;if(t.isSelected=!0,t instanceof be)continue;const e=t.data;null!==e?i.setGroupForData(e,r):t.containingGroup=o}e.remove(s)}}e.T("SelectionUngrouped",s,n)}finally{e.commitTransaction("Ungroup"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canUngroupSelection(t){void 0===t&&(t=null);const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||!e.allowUngroup||!e.model.ff())return!1;if(null!==t){if(!(t instanceof Ne))return!1;if(t.canUngroup())return!0}else{const t=e.selection.iterator;for(;t.next();){const e=t.value;if(e instanceof Ne&&e.canUngroup())return!0}}return!1}addTopLevelParts(t,e){let i=!0;const s=this.xN(t).iterator;for(;s.next();){const t=s.value;null!==t.containingGroup&&(!e||this.isValidMember(null,t)?t.containingGroup=null:i=!1)}return i}collapseSubGraph(t){void 0===t&&(t=null);const e=this.a,i="Collapse SubGraph";try{e.startTransaction(i),e.animationManager.Gl(i);const s=new h;if(null!==t&&t.isSubGraphExpanded)t.collapseSubGraph(),s.add(t);else if(null===t){const t=e.selection.iterator;for(;t.next();){const e=t.value;e instanceof Ne&&e.isSubGraphExpanded&&(e.collapseSubGraph(),s.add(e))}}e.T("SubGraphCollapsed",s)}finally{e.commitTransaction(i)}}canCollapseSubGraph(t){void 0===t&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(null!==t)return!!(t instanceof Ne&&t.isSubGraphExpanded);{const t=e.selection.iterator;for(;t.next();){const e=t.value;if(e instanceof Ne&&e.isSubGraphExpanded)return!0}}return!1}expandSubGraph(t){void 0===t&&(t=null);const e=this.a,i="Expand SubGraph",s=new h;try{if(e.startTransaction(i),e.animationManager.Gl(i),null===t||t.isSubGraphExpanded){if(null===t){const t=e.selection.iterator;for(;t.next();){const e=t.value;e instanceof Ne&&(e.isSubGraphExpanded||(e.expandSubGraph(),s.add(e)))}}}else t.expandSubGraph(),s.add(t);e.T("SubGraphExpanded",s)}finally{for(const t of s)this.GT(e,t);t&&this.GT(e,t),e.commitTransaction(i)}}GT(t,e){for(const i of e.memberParts)i instanceof me&&t.Gc(i,e)}canExpandSubGraph(t){void 0===t&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(null!==t)return!(!(t instanceof Ne)||t.isSubGraphExpanded);{const t=e.selection.iterator;for(;t.next();){const e=t.value;if(e instanceof Ne&&!e.isSubGraphExpanded)return!0}}return!1}editTextBlock(t){void 0===t&&(t=null),null!==t&&e.se(t,ie,Ct,"editTextBlock");const i=this.a,s=i.toolManager.findTool("TextEditing");if(null!==s){if(null===t){let e=null;const s=i.selection.iterator;for(;s.next();){const t=s.value;if(t.canEdit()){e=t;break}}if(null===e)return;t=e.findInVisualTree((t=>t instanceof ie&&t.editable))}null!==t&&(i.currentTool=null,s.textBlock=t,i.currentTool=s)}}canEditTextBlock(t){void 0===t&&(t=null);const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowTextEdit||null===e.toolManager.findTool("TextEditing"))return!1;if(null!==t){if(!(t instanceof ie))return!1;const e=t.part;if(null!==e&&e.canEdit())return!0}else{const i=e.selection.iterator;for(;i.next();){const e=i.value;if(e.canEdit()&&null!==(t=e.findInVisualTree((t=>t instanceof ie&&t.editable))))return!0}}return!1}showContextMenu(t){const e=this.a,i=e.toolManager.findTool("ContextMenu");if(null===i)return;void 0===t&&(t=null),null===t&&(t=e.selection.count>0?e.selection.first():e);const s=i.findObjectWithContextMenu(t);if(null!==s){const t=e.lastInput;let n;if(n=s instanceof At?s.getDocumentPoint(v.Center):e.viewportBounds.containsPoint(t.documentPoint)?y.gn:e.viewportBounds.center,n.isReal()){const t=new D;t.diagram=e,t.viewPoint=e.transformDocToView(n),t.documentPoint=n,t.button=2,t.up=!0,e.lastInput=t}e.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(t){const e=this.a,i=e.toolManager.findTool("ContextMenu");return!(null===i||(void 0===t&&(t=null),null===t&&(t=e.selection.count>0?e.selection.first():e),null===i.findObjectWithContextMenu(t)))}downloadSvg(t){const e=this.a,i={scale:1,background:e.div?e.div.style.backgroundColor:"white",name:this.$O("svg")};t&&Object.assign(i,t);const s=e.makeSvg(i);if(null!==s){const t=(new XMLSerializer).serializeToString(s);this.ZO(i.name,"image/svg+xml",t)}}downloadSVG(t){this.downloadSvg(t)}canDownloadSvg(t){return null!==this.a}ZO(i,s,n){let o=null,r=null;try{const a=new Blob([n],{type:s});o=t.URL.createObjectURL(a),r=e.Ni("a"),r.style.display="none",r.href=o,r.download=i,t.document.body.appendChild(r),requestAnimationFrame((()=>{try{null!==r&&r.click()}finally{null!==o&&t.URL.revokeObjectURL(o),null!==r&&t.document.body.removeChild(r)}}))}catch{null!==o&&t.URL.revokeObjectURL(o),null!==r&&t.document.body.removeChild(r)}}$O(t){const e="."+t;let i=this.diagram.model.name;return i?i.endsWith(e)&&(i=i.substring(0,i.length-e.length)):i="diagram",i+=e,i}get copiesClipboardData(){return this.j2}set copiesClipboardData(t){this.j2=!!t}get copiesConnectedLinks(){return this.W2}set copiesConnectedLinks(t){this.W2=!!t}get deletesConnectedLinks(){return this.J2}set deletesConnectedLinks(t){this.J2=!!t}get copiesTree(){return this.$2}set copiesTree(t){this.$2=!!t}get deletesTree(){return this.Z2}set deletesTree(t){this.Z2=!!t}get copiesParentKey(){return this.Q2}set copiesParentKey(t){this.Q2=!!t}get copiesGroupKey(){return this._2}set copiesGroupKey(t){this._2=!!t}get storageLocation(){return this.tN}set storageLocation(t){t||(t="memory"),"memory"!==t&&"sessionStorage"!==t&&"localStorage"!==t&&"systemClipboard"!==t&&e.o("Invalid new value for CommandHandler.storageLocation: "+t),this.tN=t}get archetypeGroupData(){return this.eN}set archetypeGroupData(t){null!==t&&e.wc(t,Ct,"archetypeGroupData");this.a;this.eN=t}get memberValidation(){return this.da}set memberValidation(t){null!==t&&e.S(t,Ct,"memberValidation"),this.da=t}get defaultScale(){return this.diagram.defaultScale}set defaultScale(t){this.diagram.defaultScale=t}get zoomFactor(){return this.iN}set zoomFactor(t){t>1||e.o("zoomFactor must be larger than 1.0, not: "+t),this.iN=t}get isZoomToFitRestoreEnabled(){return this.sN}set isZoomToFitRestoreEnabled(t){this.sN=!!t}get scrollToPartPause(){return this.nN}set scrollToPartPause(t){this.nN=t}computeEffectiveCollection(t,e){const i=this.a,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;void 0===e&&(e=i.Tp());const o=new p;if(null===t)return o;let r=t.iterator;for(;r.next();){const t=r.value;i._r(o,t,n,e)}if(null!==i.draggedLink&&e.dragsLink)return o;for(r=t.iterator;r.next();){const t=r.value;if(t instanceof be){const e=t.fromNode;if(null===e||o.has(e)){const e=t.toNode;null!==e&&!o.has(e)&&o.delete(t)}else o.delete(t)}}return o}static getModifierNames(){return Ct.md}static setModifierNames(t){Ct.md=t}static KO(t){let e="";return 1&t&&(e+=Ct.md[0]||""),4&t&&(e+=Ct.md[1]||""),2&t&&(e+=Ct.md[2]||""),8&t&&(e+=Ct.md[3]||""),e}static YO(t){return 1===t?Ct.XO:2===t?Ct.GO:Ct.zT}static yN(t,e,i){var s=new y(i,0).rotate(t-e/2),n=(new N).add(new T(-i,-i)).add(new T(i,i)).add(new T(s.x,s.y).add(new A(5,t-e/2,e,0,0,i,i)));return n.offset(i,i),n}HO(t){t.isTransactionFinished&&this.updateFocusBox()}qO(t){if(t.subject.scale===this.diagram.scale)return;const e=4/this.diagram.scale,i=this.focusBox.findObject("SHAPE");null!==i&&(i.strokeWidth=e);const s=this.focusBox.findObject("SHAPE2");null!==s&&(s.strokeWidth=e,s.strokeDashArray=[e,e]);const n=this.focusBox.placeholder;null!==n&&(n.padding=e)}jO(t){null===this.focus?e.un((()=>{this.focus=this.findFirstFocus()}),500):this.onFocusChanged(this.focus,this.focus)}WO(t){this.isVirtualPointerShown=!1}get isFocusEnabled(){return this.oN}set isFocusEnabled(t){(t=!!t)!==this.isFocusEnabled&&(t||(this.isVirtualPointerShown=!1,this.gN=this.focus,this.focus=null),this.oN=t,t&&(this.focus=this.gN,this.updateFocusBox()))}get focusBox(){return this.Ip}set focusBox(t){if(!(t instanceof ge))return;const e=this.Ip;if(t!==e&&(this.Ip=t,null!==e.adornedObject)){const i=e.adornedPart;null!==i&&i.removeAdornment("Focus"),t.adornedObject=e.adornedObject,null!==i&&i.addAdornment("Focus",t)}}get focus(){return this.Ip.adornedObject}set focus(t){const e=this.focus;if(t!==e){const i=this.a;if(!i||!this.isFocusEnabled||null!==t&&t.diagram!==i)return;i.currentTool instanceof st||this.cancelVirtualPointer();const s=this.focusBox.adornedPart;s&&s.removeAdornment("Focus"),null===t?(this.gd=null,this.virtualPointerLocation=i.viewportBounds.center,this.focusBox.adornedObject=null):(this.virtualPointerLocation=t.getDocumentPoint(v.Center),this.focusBox.adornedObject=t,this.updateFocusBox()),this.onFocusChanged(e,t)}}onFocusChanged(t,e){const i=this.a;if(i&&(null!==this.focusChanged?this.focusChanged(t,e,this):this.QO(this.describe(t,e)),null!==e&&null!==e.part)){const t=e.getDocumentBounds();i.viewportBounds.containsRect(t)||(e instanceof ce?i.commandHandler.scrollToPart(e):i.scrollToRect(t))}}get focusChanged(){return this.rN}set focusChanged(t){null!==t&&e.S(t,Ct,"focusChanged"),this.rN=t}get liveElementId(){return this.N1||this.lN}set liveElementId(t){t!==this.N1&&(this.N1=t,this.bN())}bN(){const e=this.diagram;if(!e||!wt.isUsingDOM())return;const i=e.lt?.bt;if(!i)return;const s=this.liveElementId,n=t.document.getElementById(s);this.isUsingAriaLive?(i.removeAttribute("aria-labelledby"),n&&n.setAttribute("aria-live","polite")):(s&&i.setAttribute("aria-labelledby",s),n&&n.removeAttribute("aria-live"))}get isUsingAriaLive(){return this.C1}set isUsingAriaLive(t){t!==this.C1&&(this.C1=t,this.bN())}QO(i){const s=this.diagram;if(!s||!wt.isUsingDOM()||!s.div)return;let n=this.liveElementId;if(!n){const i=e.Ni("span"),o=i.style;for(o.opacity="0",o.position="absolute",o.right="-9999px",o.bottom="-9999px",o.width="0px",o.height="0px",o.overflow="hidden",o.border="0",n=(s.div.id||"diagram")+"_aria";t.document.getElementById(n);)n+=Math.floor(10*Math.random());i.id=n,this.lN=n,s.div.appendChild(i),this.bN()}const o=t.document.getElementById(n);o&&(o.textContent=i)}describe(t,e){let i="";e instanceof me?i=e instanceof Ne?"Group":"Node":e instanceof be?i="Link":e instanceof ce?i="Part":e&&(e.click?i="button":e instanceof ie&&e.editable&&(i="editable"),null!==e.portId&&(i&&(i+=" "),i+="port",e.portId&&(i+=" "+e.portId)));const s=this.kN(e);s&&(i+=" "+s);const n=e;if(t&&n instanceof be&&n.fromNode&&n.toNode)if(t instanceof me&&t.part===n.fromNode||t instanceof be&&t.fromNode===n.fromNode){i+=" to "+this.kN(n.toNode,!0);const t=n.toPort?.portId;t&&(i+=" port "+t)}else if(t instanceof me&&t.part===n.toNode||t instanceof be&&t.toNode===n.toNode){i+=" from "+this.kN(n.fromNode,!0);const t=n.fromPort?.portId;t&&(i+=" port "+t)}return i}kN(t,e){if(void 0===e&&(e=!1),!t)return"";if(t instanceof ie&&t.text)return t.text;if(t instanceof Yt){let i="";return t instanceof ce&&t.text&&(i=t.text),e&&i||t.walkVisualTreeFrom(t,((t,s)=>{s.isVisibleObject()&&s instanceof ie&&s.text&&(!e||!i)&&i!==s.text&&(i+=" "+s.text)})),i}return""}updateFocusBox(){const t=this.focus;if(null!==t)if(null!==t.diagram&&(t instanceof ce?t.isVisible():t.isVisibleObject()&&t.part?.isVisible()))this.focusBox.adornedObject=t,t.part?.addAdornment("Focus",this.focusBox);else{let e=null;if(t instanceof ce||(e=t.part),e instanceof ce&&e.isVisible())this.focus=e;else{if(e instanceof me&&!e.isVisible()){const t=e.findTreeParentNode();if(null!==t)e=t;else{const t=e.labeledLink;null!==t&&(e=t)}}for(;e instanceof ce&&!e.isVisible();)e=e.containingGroup;e instanceof ce&&e.isVisible()?this.focus=e:this.focus=null}}}findFirstFocus(){const t=this.a;if(null===t||!t.isEnabled)return null;if(null!==this.focus)return this.focus;if(this.isFocusEnabled)if(t.selection.count>0)this.focus=t.selection.first();else{const e=this.YT(t.isTreePathToChildren).first();if(null!==e)return e}return null}get isVirtualPointerEnabled(){return this.aN}set isVirtualPointerEnabled(t){if((t=!!t)!==this.isVirtualPointerEnabled&&(this.aN=t,t)){const t=this.Vp;t&&(this.Vp=null,t.commandHandler.Ps=null,t.commandHandler.cancelVirtualPointer())}}get isVirtualPointerShown(){return this.hN}set isVirtualPointerShown(t){if((t=!!t)!==this.isVirtualPointerShown){const e=this.a;if(!e||!this.isVirtualPointerEnabled)return;this.hN=t;const i=this.focus;t?null===this.virtualPointerBox.diagram&&(this.virtualPointerLocation.isReal()||(this.virtualPointerLocation=null!==i?i.getDocumentPoint(v.Center):e.viewportBounds.center),e.add(this.virtualPointerBox),this.ma()):null!==this.virtualPointerBox.diagram&&(e.remove(this.virtualPointerBox),this.ma())}}cancelVirtualPointer(){const t=this.a;t&&(this.wN(),this.isVirtualPointerShown=!1,t.currentTool.doCancel(),this.isVirtualPointerDown=!1,this.PN())}PN(){const t=this.Ps;if(null!==t){this.Ps=null;const e=t.commandHandler;e.Ps=null,e.Vp=null,e.isVirtualPointerShown=!1,e.isVirtualPointerDown=!1,e.wN(),this.L1&&(e.isVirtualPointerEnabled=!1),this.L1=!1}}wN(){this.Oi.button=0,this.Oi.modifiers=0,this.Oi.clickCount=1,this.Oi.down=!1,this.ma()}ma(){null!==this.virtualPointerChanged&&this.virtualPointerChanged(this.virtualPointerBox,this),this.updateVirtualPointer()}updateVirtualPointer(){const t=this.virtualPointerBox.diagram;t&&(this.virtualPointerBox.scale=1/t.scale),this.virtualPointerBox.updateTargetBindings()}get virtualPointerBox(){return this.dd}set virtualPointerBox(t){if(!(t instanceof ce))return;const e=this.dd;t!==e&&(null!==e&&(t.location=e.location,null!==e.diagram&&e.diagram.remove(e)),this.dd=t,this.isVirtualPointerShown&&this.diagram&&(this.diagram.add(t),t.data=e.data),this.ma())}get virtualPointerChanged(){return this.cN}set virtualPointerChanged(t){null!==t&&e.S(t,Ct,"virtualPointerChanged"),this.cN=t}get virtualPointerLocation(){return this.virtualPointerBox.location}set virtualPointerLocation(t){this.virtualPointerLocation.equals(t)||this.KT(t.x,t.y)}get isVirtualPointerDown(){return!!this.virtualPointerBox.data&&this.virtualPointerBox.data.down}set isVirtualPointerDown(t){if((t=!!t)!==this.isVirtualPointerDown){const e=this.a;if(!e||!this.isVirtualPointerEnabled||(null===this.virtualPointerBox.data&&(this.dd.data=this.Oi),this.virtualPointerBox.data.down=t,this.ma(),!this.isVirtualPointerShown))return;const i=e.lastInput,s=new D;s.diagram=e,this.HT(s,t),t?s.down=!0:s.up=!0,s.clickCount=1,s.button=this.Oi.button,s.modifiers=this.Oi.modifiers,t&&(e.firstInput=s.copy()),this.pd(s,!0),t||2===this.Oi.clickCount&&(s.clickCount=2,s.down=!0,s.up=!1,this.pd(s,!0),s.down=!1,s.up=!0,this.pd(s,!0),this.qT(1)),e.lastInput=i}}get virtualPointerShiftMove(){return this.Ep}set virtualPointerShiftMove(t){this.Ep=t}get virtualPointerControlMove(){return this.Up}set virtualPointerControlMove(t){this.Up=t}Bp(t,e){this.KT(this.virtualPointerLocation.x+t,this.virtualPointerLocation.y+e)}KT(t,e){this.virtualPointerBox.moveTo(t,e,!0);const i=this.a;if(!i||!this.isVirtualPointerEnabled||!this.isVirtualPointerShown)return;i.ensureBounds();const s=i.lastInput,n=new D;n.diagram=i,this.HT(n,this.isVirtualPointerDown),n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,this.pd(n,!0),i.lastInput=s,this.isVirtualPointerDown&&(i.remove(this.virtualPointerBox),i.add(this.virtualPointerBox)),this.ma()}HT(e,i){const s=this.a;if(s){if(e.targetDiagram=s,e.documentPoint=this.virtualPointerLocation,s.allowDragOut){const n=s.div.getBoundingClientRect(),o=s.transformDocToView(this.virtualPointerLocation),r=n.x+o.x,a=n.y+o.y;let h=t.document.elementFromPoint(r,a)||null;h instanceof HTMLCanvasElement&&(h=h.parentElement),null!==h&&h.shadowRoot&&(h=h.shadowRoot.elementFromPoint(r,a)||null,h instanceof HTMLCanvasElement&&(h=h.parentElement));let l=null;if(h instanceof HTMLElement&&(l=wt.ji.get(h))&&l!==s&&l.div){const t=l.div.getBoundingClientRect(),r=new y(o.x-(t.x-n.x),o.y-(t.y-n.y));null!==this.Ps&&this.Ps!==l&&this.PN(),e.targetDiagram=l,e.viewPoint=r,e.documentPoint=l.transformViewToDoc(r),e.viewPoint=l.transformDocToView(e.documentPoint),this.Ps=l;const a=l.commandHandler;return this.L1=!a.isVirtualPointerEnabled,a.isVirtualPointerEnabled=!0,a.isVirtualPointerDown=i,a.virtualPointerLocation=e.documentPoint,a.isVirtualPointerShown=!0,void(a.Vp=s)}}null!==this.Ps&&this.PN(),e.viewPoint=s.transformDocToView(e.documentPoint)}}pd(t,e){this.doVirtualPointerEvent(t,e)}doVirtualPointerEvent(t,e){const i=this.a;i&&(t.timestamp=Date.now(),i.lastInput=t,e&&(t.up?i.doMouseUp():t.down?i.doMouseDown():i.doMouseMove()),this.onVirtualPointerEvent(t,e))}onVirtualPointerEvent(t,e){const i=this.a;i&&(t.up?this.isVirtualPointerDown&&!i.viewportBounds.containsPoint(this.virtualPointerLocation)&&(this.virtualPointerLocation=this.focus instanceof At?this.focus.getDocumentPoint(v.Center):i.viewportBounds.center):t.down)}doVirtualFocusKeyDown(){const t=this.a;if(!t)return!1;const e=t.lastInput,i=e.commandKey;if(this.isVirtualPointerEnabled&&("ShiftLeft"===i||"ShiftRight"===i))return this.isVirtualPointerShown=!0,!0;if(this.XT.indexOf(i)>=0)if(e.shift&&this.isVirtualPointerShown){const t=this.A1(i),s=e.control||e.meta?this.Up:this.Ep;270===t?this.Bp(0,-s):90===t?this.Bp(0,s):180===t?this.Bp(-s,0):this.Bp(s,0)}else this._O();else if(e.shift&&this.isVirtualPointerShown&&("Numpad1"===i||"Numpad2"===i||"Numpad3"===i||"Numpad4"===i||"Numpad6"===i||"Numpad7"===i||"Numpad8"===i||"Numpad9"===i)){const t=e.control||e.meta?this.Up:this.Ep;let s=0;"Numpad1"===i||"Numpad4"===i||"Numpad7"===i?s=-t:("Numpad3"===i||"Numpad6"===i||"Numpad9"===i)&&(s=t);let n=0;"Numpad7"===i||"Numpad8"===i||"Numpad9"===i?n=-t:("Numpad1"===i||"Numpad2"===i||"Numpad3"===i)&&(n=t),this.Bp(s,n)}else if("Enter"===i||"NumpadEnter"===i||"Numpad5"===i)e.shift&&this.isVirtualPointerShown?this.isVirtualPointerDown=!this.isVirtualPointerDown:this.tI();else if("Escape"===i)this.eI();else if("Space"===i)this.iI();else if("ContextMenu"===i||e.shift&&"F10"===i||(e.control||e.meta)&&e.shift&&"Backslash"===i)this.sI();else if(e.shift&&"c"===i)this.T1(1);else if(e.shift&&"a"===i)this.T1(2);else if(e.shift&&"KeyS"===i)this.T1(4);else if(e.shift&&"KeyM"===i)this.T1(8);else if(e.shift&&"Digit1"===i)this.D1(0);else if(e.shift&&"Digit2"===i)this.D1(1);else if(e.shift&&"Digit3"===i)this.D1(2);else if(e.shift&&"Numpad0"===i){const t=this.Oi.button;this.D1(2===t?0:2)}else if(!e.shift||"KeyD"!==i&&"NumpadDecimal"!==i)if(e.shift&&"KeyF"===i){const t=this.nextFocusFormula;this.nextFocusFormula="distance"===t?"linear":"distance"}else{if(!e.shift||"y"!==i)return!1;this.isUsingAriaLive=!this.isUsingAriaLive}else{const t=this.Oi.clickCount;this.qT(2===t?1:2)}return!0}doVirtualFocusKeyUp(){const t=this.a;if(!t)return!1;const e=t.lastInput.commandKey;return this.isVirtualPointerEnabled&&("ShiftLeft"===e||"ShiftRight"===e)&&(this.isVirtualPointerShown=!1),!0}A1(t){switch(t){case"ArrowDown":return 90;case"ArrowLeft":return 180;case"ArrowUp":return 270;default:return 0}}XT=["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"];T1(t){const e=this.Oi.modifiers;this.Oi.modifiers=e&t?e&~t:e|t,this.ma()}qT(t){this.Oi.clickCount=t,this.ma()}D1(t){this.Oi.button=t,this.ma()}_O(){const t=this.a;if(!t)return;const e=t.lastInput,i=this.focus;if(null===i){const e=this.YT(t.isTreePathToChildren).first();null!==e&&(this.focus=e)}else if(i instanceof be)this.nI(i);else if(i instanceof me)this.oI(i);else{i instanceof ce&&(this.gd=null);const t=this.A1(e.commandKey);this.focus=270===t?this.findNextFocus(270):90===t?this.findNextFocus(90):180===t?this.findNextFocus(180):this.findNextFocus(0)}}nI(t){const e=this.a;if(!e)return;const i=e.lastInput,s=this.A1(i.commandKey);let n=null;const o=this.gd;if(null!==o){const e=this.pN;if(s===e)n=t.getOtherNode(o);else if(s===k.Ee(e+180))n=o;else{let i=0===e||180===e?270:180;if(s===(0===e||180===e?90:0)){const i=this.SN(o,e,!0),s=i.indexOf(t);s>=0&&s<i.count-1&&(this.focus=i.elt(s+1))}else if(s===i){const i=this.SN(o,e,!0),s=i.indexOf(t);s>0&&(this.focus=i.elt(s-1))}}}else{const e=t.fromNode,i=t.toNode;if(!e||!i)return;n=270===s?e.location.y<i.location.y?e:i:90==s?e.location.y>i.location.y?e:i:180===s?e.location.x<i.location.x?e:i:e.location.x>i.location.x?e:i}for(;null!==n&&!n.isVisible();)n=n.containingGroup;null!==n&&(this.focus=n)}oI(t){const e=this.a;if(!e)return;const i=e.lastInput,s=this.A1(i.commandKey);if(i.control||i.meta){const e=this.SN(t,s,!0).first();e&&(this.gd=t,this.pN=s,this.focus=e)}else this.gd=null,this.focus=this.findNextFocus(s)}SN(t,e,i){if(null===t)return new h;const s=t.actualBounds;if(!s.isReal())return new h;const n=new Set;(t instanceof Ne?t.findExternalLinksConnected():t.findLinksConnected()).each((o=>{if(!o.isVisible())return;let r=null;if(o.fromNode===t?r=o.toNode:o.toNode===t?r=o.fromNode:t instanceof Ne&&(o.fromNode?.isMemberOf(t)?r=o.toNode:o.toNode?.isMemberOf(t)&&(r=o.fromNode)),null===r||r.isMemberOf(t))return;for(;null!==r&&!r.isVisible();)r=r.containingGroup;if(null===r)return;const a=r.location;if(a.isReal()&&(270!==e||!(r!==t?a.y>=s.top:o.midPoint.y>=s.top))){if(90===e&&(r!==t?a.y<=s.bottom:o.midPoint.y<=s.bottom))return;if(180===e&&(r!==t?a.x>=s.left:o.midPoint.x>=s.left))return;if(0===e&&(r!==t?a.x<=s.right:o.midPoint.x<=s.right))return;i&&o.actualBounds.isReal()?n.add(o):n.add(r)}}));const o=new h(n);return 90===e||270===e?o.sort(((t,e)=>t.actualBounds.centerX-e.actualBounds.centerX)):o.sort(((t,e)=>t.actualBounds.centerY-e.actualBounds.centerY)),o}findNextFocus(t){t=k.Ee(t);const e=this.focus,i=e instanceof me?e.location:e.getDocumentPoint(v.Center);let s=1/0,n=e;const o=(e,o,r,a)=>{if("linear"===this.nextFocusFormula){let o=1/0;0===t&&r>i.x||180===t&&r<i.x?o=Math.abs(r-i.x):(90===t&&a>i.y||270===t&&a<i.y)&&(o=Math.abs(a-i.y)),o<s&&(s=o,n=e)}else{if(0===t&&(o.right<i.x||(o.centerX-i.x)**2>s))return;if(90===t&&(o.bottom<i.y||(o.centerY-i.y)**2>s))return;if(180===t&&(o.x>i.x||(i.x-o.centerX)**2>s))return;if(270===t&&(o.y>i.y||(i.y-o.centerY)**2>s))return;const h=i.direction(r,a),l=k.jF(t,h);if(90===t||270===t?l<=45:l<45){const t=i.distanceSquared(r,a);t<s&&(s=t,n=e)}}};if(e instanceof ce&&null!==e.diagram){const t=e.containingGroup;null!==t?t.memberParts.each((t=>{t===e||t instanceof be||!t.isVisible()||o(t,t.actualBounds,t.location.x,t.location.y)})):(e.diagram.nodes.each((t=>{t===e||!t.isTopLevel||!t.isVisible()||o(t,t.actualBounds,t.location.x,t.location.y)})),e.diagram.parts.each((t=>{t===e||!t.isTopLevel||!t.isVisible()||o(t,t.actualBounds,t.location.x,t.location.y)})))}else if(null!==e.part){const t=new w;this.MN(e.part).each((i=>{i!==e&&(i.getDocumentBounds(t),o(i,t,t.centerX,t.centerY))}))}return n}get nextFocusFormula(){return this.mN}set nextFocusFormula(t){this.mN=t}tI(){const t=this.a;if(!t)return;const e=t.currentTool;if(e instanceof st){const i=e.currentObject;return this.v1(this.focus),e.maybeStopTool(this.focus),void(t.currentTool instanceof st||(this.focus=i))}const i=this.focus,s=t.lastInput;if(null===i)s.control||s.meta?this.v1(null):this.focus=this.findFirstFocus();else if(i instanceof ce)if(s.control||s.meta)this.v1(i);else{const t=this.MN(i);if(t.count>0)this.focus=t.first();else if(i instanceof be&&i.isLabeledLink){const t=i.labelNodes.first();null!==t&&t.isVisible()&&(this.focus=t)}else if(i instanceof Ne&&i.isSubGraphExpanded){const t=i.memberParts.first();null!==t&&t.isVisible()&&(this.focus=t)}}else this.v1(i)}YT(t){const e=new h,i=this.a;if(!i)return e;let s=0;for(;0===e.count&&s<i.nodes.count;){const n=i.nodes;for(;n.next();){const i=n.value;i.isTopLevel&&i.isVisible()&&(t?i.findNodesInto():i.findNodesOutOf()).count===s&&e.add(i)}s++}return e}MN(t){return t instanceof ce?this.Pn(t,new h):new h}Pn(t,e){return!(t instanceof ce)&&t.isVisibleObject()&&t.isEnabledObject()&&(t.contextMenu||t.click||t instanceof ie&&t.editable||t.part instanceof me&&null!==t.portId&&(""!==t.portId||t.part.ports.count>1)||t.toolTip)&&e.add(t),t instanceof Yt&&t.elements.each((t=>this.Pn(t,e))),e}v1(t){const e=this.a;if(!e)return;const i=e.lastInput,s=t instanceof At?t:e;if(s.click){const n=new D;n.diagram=e,n.documentPoint=t instanceof At?t.getDocumentPoint(v.Center):e.viewportBounds.center,n.viewPoint=e.transformDocToView(n.documentPoint),n.button=0,n.clickCount=1,n.targetObject=t,this.pd(n,!1),s instanceof At?s.click(n,s):s.click(n),e.lastInput=i}else s instanceof ie&&s.editable?this.editTextBlock(s):this.jT(t)}eI(){const t=this.a;if(!t)return;const e=t.currentTool;if(e instanceof X&&null!==e.currentToolTip)e.hideToolTip();else{if(e instanceof st){const t=e.currentObject;return e.doKeyDown(),void(this.focus=t)}if(this.focus instanceof ce){const t=this.focus;t instanceof me&&null!==t.labeledLink?this.focus=t.labeledLink:null!==t.containingGroup?this.focus=t.containingGroup:this.focus=null}else if(this.focus instanceof At){const t=this.focus.part;if(t instanceof be&&t.isLabeledLink){const e=t.labelNodes.first();if(null!==e&&e.isVisible())return void(this.focus=e)}else if(t instanceof Ne&&t.isSubGraphExpanded){const e=t.memberParts.first();if(null!==e&&e.isVisible())return void(this.focus=e)}this.focus=t}else this.cancelVirtualPointer(),this.stopCommand()}}iI(){const t=this.a;if(t)if(t.lastInput.shift&&this.isVirtualPointerShown){const e=t.findPartAt(this.virtualPointerLocation);null!==e&&(e===this.focus?this.WT():this.focus=e)}else this.WT()}WT(){const t=this.a;if(!t)return;const e=t.lastInput,i=this.focus;if(i instanceof ce){let s=i.part;if(e.control||e.meta){for(t.raiseDiagramEvent("ChangingSelection",t.selection);null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&(s.isSelected=!s.isSelected),t.raiseDiagramEvent("ChangedSelection",t.selection)}else if(e.shift){if(null!==s&&!s.isSelected){for(t.raiseDiagramEvent("ChangingSelection",t.selection);null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&(s.isSelected=!0),t.raiseDiagramEvent("ChangedSelection",t.selection)}}else if(null!==s&&!s.isSelected){for(;null!==s&&!s.canSelect();)s=s.containingGroup;null!==s&&t.select(s)}}this.jT(i),this.onFocusChanged(i,i)}jT(t){const e=this.a;if(!e)return;e.toolManager.hideToolTip();const i=e.lastInput;let s=t instanceof At?t:e;for(;s instanceof At&&!s.toolTip;)s=s.panel;if(s&&s.toolTip){const n=new D;n.diagram=e,n.documentPoint=null!==t?t.getDocumentPoint(v.Center):e.viewportBounds.center,n.viewPoint=e.transformDocToView(n.documentPoint),n.targetObject=t,this.pd(n,!1),e.toolManager.showToolTip(s.toolTip,t),e.lastInput=i}}sI(){const t=this.a;if(!t)return;const e=this.focus;if(this.canShowContextMenu(e)){this.showContextMenu(e);const i=t.toolManager.contextMenuTool.currentContextMenu;if(i instanceof ge){const t=this.MN(i);t.count>0&&(this.focus=t.first())}}}}var Nt=(t=>(t[t.None=0]="None",t[t.Default=1]="Default",t[t.Vertical=4]="Vertical",t[t.Horizontal=5]="Horizontal",t[t.Fill=2]="Fill",t))(Nt||{}),Tt=(t=>(t[t.None=0]="None",t[t.Along=21]="Along",t[t.Plus90=22]="Plus90",t[t.Minus90=23]="Minus90",t[t.Opposite=24]="Opposite",t[t.Upright=25]="Upright",t[t.Plus90Upright=26]="Plus90Upright",t[t.Minus90Upright=27]="Minus90Upright",t[t.Upright45=28]="Upright45",t))(Tt||{}),Lt=(t=>(t[t.None=0]="None",t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal",t[t.Both=3]="Both",t))(Lt||{});class At{n;zp;Xp;pa;w;ya;ft;ct;hi;Zt;Gp;$s;Lt;cs;el;wa;Se;Th;it;Xt;il;De;Ke;yd;de;wd;Ot;he;sl;F1;xa;uf;constructor(){u.Je(this),this.n=30723,this.Zt=1,this.Gp="",this.$s=null,this.Lt=null,this.ct=new y(NaN,NaN).k(),this.cs=x.Zw,this.el=new P,this.wa=new P,this.Se=null,this.Th=1,this.it=1,this.Xt=0,this.il=b.im,this.hi=new w(NaN,NaN,NaN,NaN).k(),this.De=new w(NaN,NaN,NaN,NaN).k(),this.Ke=new w(0,0,NaN,NaN).k(),this.yd=null,this.zp=null,this.ft=null,this.de=v.Default,this.wd=v.Default,this.Xp=0,this.pa=0,this.Ot=null,this.w=null,this.ya=null,this.he=null,this.F1=null,this.xa=null,this.sl=null,this.uf=null}cloneProtected(t){t.n=-32769&this.n|6144,t.Zt=this.Zt,t.Gp=this.Gp,t.Lt=this.Lt,t.ct.h(this.ct),t.cs=this.cs.N(),null!==this.Se?t.Se=this.Se.copy():t.Se=null,t.it=this.it,t.Xt=this.Xt,t.il=this.il.N(),t.hi.h(this.hi),t.De.h(this.De),t.Ke.h(this.Ke),t.zp=this.zp,null!==this.ft&&(t.ft=this.ft.copy()),t.de=this.de.N(),t.wd=this.wd.N(),t.Xp=this.Xp,t.pa=this.pa,null!==this.Ot&&(t.Ot=this.Ot.copy()),null!==this.w&&(this.w.me?t.w=this.w:t.w=this.w.copy()),null!==this.ya&&(t.ya=this.ya.slice()),null!==this.he&&(t.he=this.he.copy())}addCopyProperty(t){let e=this.ya;if(Array.isArray(e)){for(let i=0;i<e.length;i++)if(e[i]===t)return}else e=[],this.ya=e;e.push(t)}Ho(t){t.yd=null,t.sl=null,t.f()}clone(){const t=new this.constructor;if(this.cloneProtected(t),null!==this.ya)for(let e=0;e<this.ya.length;e++){const i=this.ya[e];t[i]=this[i]}return t}copy(){return this.clone()}ZS(){const t=this.ve;if(null!==t){this.ve=null;for(const e of t)e.xd()&&(e.isToData?this.themeData(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):e.isToObject?this.themeObject(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter,e.sourceName):e.isToModel?this.themeModel(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):this.theme(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter))}return this}fe(t){t in Tt?this.segmentOrientation=t:t in Nt?this.stretch=t:e.ur(this,t)}toString(){return e.Kn(this.constructor)+"#"+u.xs(this)}static None=0;static Default=1;static Fill=2;static Vertical;static Horizontal;static Uniform=6;static UniformToFill=7;static FlipVertical=1;static FlipHorizontal=2;static FlipBoth=3;ba(){null!==this.w&&(this.w.me=!0)}Yt(){return null===this.w?this.w=new Dt:this.w.me&&(this.w=this.w.copy()),this.w}Wi(){if(null===this.ft){const t=new Me;t.Dh=v.None,t.vh=v.None,t.Fh=10,t.Rh=10,t.Oh=0,t.Ih=0,this.ft=t}return this.ft}raiseChangedEvent(t,e,i,s,n,o,r){const a=this.part;if(null!==a){a.df(t,e,i,s,n,o,r),i===this&&2===t&&this.gf()&&this.Eh(a,e);const h=this.diagram;if(null!==this.Ts&&null!==h&&h.Qa&&!h.undoManager.isUndoingRedoing&&!h.animationManager.Eu){const t=this.Ts.get(e);if(null!==t&&h.animationManager.isEnabled&&!h.animationManager.isTicking){null===this.uf&&(this.uf=new p);let i=0===h.undoManager.transactionLevel;if(2===t.startCondition?i=!0:3===t.startCondition&&(i=!1),i){const i=new ut;t.OR(i);const o=this.uf.get(t);null!==o&&o.stop(),this.uf.set(t,i),i.tb=this,i.vM=t,i.add(this,e,s,n),i.start()}else h.animationManager.getBundleAnimation().add(this,e,s,n)}}if(this instanceof Yt&&i===a&&a.NN()&&null!==a.data){const t=this.D.r,i=t.length;for(let s=0;s<i;s++){const i=t[s];i instanceof Yt&&i.Pn((t=>{null!==t.data&&t.NN()&&t.updateTargetBindings(e)}))}}}}DR(t){this.uf&&this.uf.delete(t)}Go(){if(null!==this.diagram&&null===this.findBindingPanel()&&null!==this.ve){const t=this.diagram.model,e=this.ve.iterator;for(;e.next();){const i=e.value;if(!i.isToTheme)continue;let s=null;const n=i.sourceName;i.isToObject&&(s=this.JT(n));let o=this;const r=i.targetId;-1!==r&&(o=this.Yp(r),null===o)||("/"===n?s=o.part:"."===n?s=o:".."===n&&(s=o.panel),i.updateTarget(o,s,void 0,t))}}}Eh(t,e){const i=this.findBindingPanel();if(null!==i){const s=t.diagram,n=this.ve.iterator;for(;n.next();){const t=n.value;let o=null;if(t.isToObject){if(o=t.$T(i,this),null===o)continue;t.updateSource(this,o,e,null)}else if(t.isToModel)null!==s&&!s.wi&&t.updateSource(this,s.model.modelData,e,i);else if(!t.isToTheme){const n=i.data;if(null===n)continue;null!==s&&!s.wi&&t.updateSource(this,n,e,i)}if(o===this){const n=t.targetId,r=i.Yp(n);null!==r&&t.updateTarget(r,o,e,s?.model)}}}}Yp(t){return this.no===t?this:null}JT(t){let e;return e=""===t||"/"===t||"."===t||".."===t?this:this.part.findObject(t),e}get no(){return null!==this.w?this.w.no:-1}set no(t){this.no!==t&&(null===this.w&&(this.w=new Dt),this.w.no=t)}get ve(){return null!==this.w?this.w.ve:null}set ve(t){this.ve!==t&&(null===this.w&&(this.w=new Dt),this.w.ve=t)}get oo(){return null!==this.w?this.w.oo:null}set oo(t){this.oo!==t&&(null===this.w&&(this.w=new Dt),this.w.oo=t)}raiseChanged(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}t(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}ro(t,e,i,s){const n=this.hi;if(n.e(t,e,i,s),1!==this.it||0!==this.Xt){null===this.Se&&(this.Se=new P);const o=this.Se;o.Ue(),this.Kp(o,t,e,i,s),o.sm(n)}}ZT(t,e,i){return!1!==this.pickable&&(i.bc(this.v),e?this.intersectsRect(t,i):this.containedInRect(t,i))}QT(t,e,i){if(!1===this.pickable)return!1;const s=this.naturalBounds,n=t.distanceSquaredPoint(e);return i?y.distanceLineSegmentSquared(t.x,t.y,0,0,0,s.height)<=n||y.distanceLineSegmentSquared(t.x,t.y,0,s.height,s.width,s.height)<=n||y.distanceLineSegmentSquared(t.x,t.y,s.width,s.height,s.width,0)<=n||y.distanceLineSegmentSquared(t.x,t.y,s.width,0,0,0)<=n:t.distanceSquared(0,0)<=n&&t.distanceSquared(0,s.height)<=n&&t.distanceSquared(s.width,0)<=n&&t.distanceSquared(s.width,s.height)<=n}Mn(){return!0}containsPoint(t){const e=y.l();e.h(t),this.v.gt(e);const i=this.actualBounds;if(!i.isReal())return y.i(e),!1;const s=this.diagram;if(null!==s&&s.pp){const t=s.getInputOption("extraTouchThreshold"),n=s.getInputOption("extraTouchArea"),o=n/2,r=this.naturalBounds,a=this.getDocumentScale()*s.scale,h=1/a;if(r.width*a<t&&r.height*a<t){const t=w.contains(i.x-o*h,i.y-o*h,i.width+n*h,i.height+n*h,e.x,e.y);return y.i(e),t}}let n=!1;return(this instanceof ge||this instanceof $t?w.contains(i.x-5,i.y-5,i.width+10,i.height+10,e.x,e.y):i.containsPoint(e))&&(n=!(this.he&&!this.he.containsPoint(e))&&(!(null===this.Lt||!this.Ke.containsPoint(t))||this.ka(t))),y.i(e),n}ka(t){const e=this.naturalBounds;return w.contains(0,0,e.width,e.height,t.x,t.y)}containsRect(t){if(0===this.angle)return this.actualBounds.containsRect(t);const e=this.naturalBounds,i=w.z(0,0,e.width,e.height),s=this.v;let n=!1;const o=y.z(t.x,t.y);return i.containsPoint(s.Ci(o))&&(o.e(t.x,t.bottom),i.containsPoint(s.Ci(o))&&(o.e(t.right,t.bottom),i.containsPoint(s.Ci(o))&&(o.e(t.right,t.y),i.containsPoint(s.Ci(o))&&(n=!0)))),y.i(o),w.i(i),n}containedInRect(t,e){if(void 0===e)return t.containsRect(this.actualBounds);const i=this.naturalBounds,s=e;let n=!1;const o=y.z(0,0);return t.containsPoint(s.gt(o))&&(o.e(0,i.height),t.containsPoint(s.gt(o))&&(o.e(i.width,i.height),t.containsPoint(s.gt(o))&&(o.e(i.width,0),t.containsPoint(s.gt(o))&&(n=!0)))),y.i(o),n}intersectsRect(t,e){if(void 0===e&&(e=this.v,0===this.angle))return t.intersectsRect(this.actualBounds);const i=this.naturalBounds,s=e,n=y.z(0,0),o=y.z(0,i.height),r=y.z(i.width,i.height),a=y.z(i.width,0);let h=!1;if(t.containsPoint(s.gt(n))||t.containsPoint(s.gt(o))||t.containsPoint(s.gt(r))||t.containsPoint(s.gt(a)))h=!0;else{const e=w.z(0,0,i.width,i.height),l=y.z(t.x,t.y);e.containsPoint(s.Ci(l))?h=!0:(l.e(t.x,t.bottom),e.containsPoint(s.Ci(l))?h=!0:(l.e(t.right,t.bottom),e.containsPoint(s.Ci(l))?h=!0:(l.e(t.right,t.y),e.containsPoint(s.Ci(l))&&(h=!0)))),y.i(l),w.i(e),h||(k.lx(t,n,o)||k.lx(t,o,r)||k.lx(t,r,a)||k.lx(t,a,n))&&(h=!0)}return y.i(n),y.i(o),y.i(r),y.i(a),h}getDocumentPoint(t,e){if(void 0===e&&(e=new y),t instanceof v){const i=t,s=this.naturalBounds;return e.e(i.x*s.width+i.offsetX,i.y*s.height+i.offsetY),this.Ws.gt(e),e}return e.set(t),this.Ws.gt(e),e}getDocumentBounds(t){void 0===t&&(t=new w);const e=this.naturalBounds,i=this.Ws,s=y.z(0,0).v(i);return t.e(s.x,s.y,0,0),s.e(e.width,0).v(i),t.re(s.x,s.y,0,0),s.e(e.width,e.height).v(i),t.re(s.x,s.y,0,0),s.e(0,e.height).v(i),t.re(s.x,s.y,0,0),y.i(s),t}getDocumentAngle(){return this.Ws.KF()}getDocumentScale(){if(!1===this.Hp())return this.Th;const t=this.it;return null!==this.panel?t*this.panel.getDocumentScale():t}getLocalPoint(t,e){return void 0===e&&(e=new y),e.h(t),this.Ws.Ci(e),e}getNearestIntersectionPoint(t,e,i){return this.mf(t.x,t.y,e.x,e.y,i)}mf(t,e,i,s,n){const o=this.v,r=1/(o.m11*o.m22-o.m12*o.m21),a=o.m22*r,h=-o.m12*r,l=-o.m21*r,u=o.m11*r,c=r*(o.m21*o.dy-o.m22*o.dx),d=r*(o.m12*o.dx-o.m11*o.dy),g=t*a+e*l+c,f=t*h+e*u+d,m=i*a+s*l+c,p=i*h+s*u+d;n.e(0,0);const y=this.naturalBounds,x=k.Cl(0,0,y.width,y.height,g,f,m,p,n);return n.v(o),x}ht(t,i,s,n){if(!1===this.Xo())return;const o=this.il,r=o.right+o.left,a=o.top+o.bottom;t=Math.max(t-r,0),i=Math.max(i-a,0),s=s||0,n=n||0,s=Math.max(s-r,0),n=Math.max(n-a,0);const h=this.angle;let l=0;const u=this.desiredSize,c=this.qp();90===h||270===h?(t=isFinite(u.height)?u.height+c:t,i=isFinite(u.width)?u.width+c:i):(t=isFinite(u.width)?u.width+c:t,i=isFinite(u.height)?u.height+c:i);let d=s||0,g=n||0;const f=this instanceof Yt;switch(this.Zs(!0)){case 0:d=0,g=0,f&&(t=1/0,i=1/0);break;case 2:isFinite(t)&&t>s&&(d=t),isFinite(i)&&i>n&&(g=i);break;case 5:isFinite(t)&&t>s&&(d=t),g=0,f&&(i=1/0);break;case 4:isFinite(i)&&i>n&&(g=i),d=0,f&&(t=1/0)}const m=this.maxSize,p=this.minSize;d>m.width&&p.width<m.width&&(d=m.width),g>m.height&&p.height<m.height&&(g=m.height),s=Math.max(d,p.width),n=Math.max(g,p.height),m.width<s&&(s=Math.min(p.width,s)),m.height<n&&(n=Math.min(p.height,n)),t=Math.min(m.width,t),i=Math.min(m.height,i),t=Math.max(s,t),i=Math.max(n,i),(90===h||270===h)&&(l=t,t=i,i=l,l=s,s=n,n=l),this.hi.ce(),this.bd(t,i,s,n),this.hi.k(),this.hi.isReal()||e.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.hi.toString()),this.xi(!1)}bd(t,e,i,s){}Qs(){return!1}Ut(t,i,s,n,o){this.pf();const r=w.l();r.h(this.De),this.De.ce(),!1===this.as()?this.De.e(t,i,s,n):this.Pa(t,i,s,n),this.De.k(),this.he=void 0===o?null:o;let a=!1;if(void 0!==o)a=!0;else{let e=this.panel;if(null!==e&&e.nl()&&(e=e.panel),null!==e){const s=e.Ke,n=this.measuredBounds,o=i+n.height,r=t+n.width;if(a=!(0<=t+.05&&r<=s.width+.05&&0<=i+.05&&o<=s.height+.05),this instanceof ie){const t=this.naturalBounds;(this.jp>t.height||this.pe>t.width)&&(a=!0)}}}a?this.n|=256:this.n&=-257,this.De.isReal()||e.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.De.toString()),this.kd(r,this.De),this.lo(!1),w.i(r)}Pa(t,e,i,s){}commonArrange(t,e,i,s){if(this.De.e(t,e,i,s),this.desiredSize.isReal())return;const n=this.hi,o=this.il,r=o.right+o.left,a=o.top+o.bottom,h=n.width+r,l=n.height+a;i+=r,s+=a;let u=this.Zs(!0);switch(h===i&&l===s&&(u=0),u){case 0:(h>i||l>s)&&(this.xi(!0),this.ht(h>i?i:h,l>s?s:l,0,0));break;case 2:this.xi(!0),this.ht(i,s,0,0);break;case 5:this.xi(!0),this.ht(i,l,0,0);break;case 4:this.xi(!0),this.ht(h,s,0,0)}}kd(t,e){const i=this.part;null!==i&&null!==i.diagram&&((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.CN(!0),this.C(),!t.equalsApproxClose(e)&&(i.Sa(),this.Wp(i)))}Wp(t){null!==this.portId&&(t.CN(!0),t instanceof me&&t.invalidateConnectedLinks(void 0,this))}get shadowVisible(){return null!==this.w?this.w.Jp:null}set shadowVisible(t){const e=this.shadowVisible;e!==t&&(this.Yt().Jp=t,this.Ji(!0),this.C(),this.t("shadowVisible",e,t))}rI(t,e){const i=this.naturalBounds,s=this.wa,n=s.m11,o=s.m21,r=s.dx,a=s.m12,h=s.m22,l=s.dy;let u=0,c=0,d=u,g=c;u=d*n+g*o+r,c=d*a+g*h+l;let f=u,m=c,p=0,y=0;d=i.width+e,g=0,u=d*n+g*o+r,c=d*a+g*h+l;let x=Math.min(f,u),w=Math.min(m,c);p=Math.max(f+p,u)-x,y=Math.max(m+y,c)-w,f=x,m=w,d=i.width+e,g=i.height+e,u=d*n+g*o+r,c=d*a+g*h+l,x=Math.min(f,u),w=Math.min(m,c),p=Math.max(f+p,u)-x,y=Math.max(m+y,c)-w,f=x,m=w,d=0,g=i.height+e,u=d*n+g*o+r,c=d*a+g*h+l,x=Math.min(f,u),w=Math.min(m,c),p=Math.max(f+p,u)-x,y=Math.max(m+y,c)-w,f=x,m=w;const b=t.viewportBounds,v=b.x,P=b.y,k=b.width,S=b.height;return f>k+v||v>p+f||m>S+P||P>y+m}Ge(t,e){if(this.lI(t,e)||!this.visible)return;const i=this.opacity;if(0===i)return;let s=1;1!==i&&(s=t.globalAlpha,t.globalAlpha=s*i);let n="";""!==this.filter&&(n=t.filter,t.filter=this.filter);const o=this.v,r=this.panel;!0===this.Hp()&&this.R1();const a=this.part;let h=!1,l=0;if(a&&e.getRenderingHint("drawShadows")&&(h=a.isShadowed,h)){const t=a.shadowOffset;l=Math.max(t.y,t.x)*e.scale*e.$e}const u=this instanceof Yt&&this.nl(),c=this.De;if(u&&(this._T(h,t,!1,r),this.aI(t,e),this.tD(h,t,!1,r),this.eD(h,t,!1)),u||!u&&(0===c.width||0===c.height||isNaN(c.x)||isNaN(c.y)))return 1!==i&&(t.globalAlpha=s),void(""!==this.filter&&(t.filter=n));const d=this.Qs();if(!e.ph&&d&&this.rI(e,l))return 1!==i&&(t.globalAlpha=s),void(""!==this.filter&&(t.filter=n));let g=!!(256&this.n);if(t.clipInsteadOfFill&&(g=!1),this instanceof ie&&(t.font=this.font),g){const e=r.Mn()?r.naturalBounds:r.actualBounds;let o=Math.max(c.x,e.x),a=Math.max(c.y,e.y),h=Math.min(c.right,e.right)-o,l=Math.min(c.bottom,e.bottom)-a;const u=this.he;if(null!==u&&(o=u.x,a=u.y,h=u.width,l=u.height),o>c.width+c.x||c.x>e.width+e.x)return 1!==i&&(t.globalAlpha=s),void(""!==this.filter&&(t.filter=n));t.save(),t.beginPath(),t.rect(o,a,h,l),t.clip()}if(d){if(!a.isVisible())return 1!==i&&(t.globalAlpha=s),void(""!==this.filter&&(t.filter=n));if(h){const i=a.shadowOffset;t.shadowsSet(i.x*e.scale*this.scale*e.$e,i.y*e.scale*this.scale*e.$e,a.shadowBlur),t.shadowsOn(),t.shadowColor=a.shadowColor}}const f=this.naturalBounds;if(t.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this._T(h,t,d,r),null!==this.Lt&&(t.commitTransform(),this.O1(t,f,c)),this.tD(h,t,d,r),this.Ma(t,e),this.eD(h,t,d),g&&(t.restore(),t.clearContextCache(this instanceof Yt)),!o.RP()){const e=1/(o.m11*o.m22-o.m12*o.m21);t.transform(o.m22*e,-o.m12*e,-o.m21*e,o.m11*e,e*(o.m21*o.dy-o.m22*o.dx),e*(o.m12*o.dx-o.m11*o.dy))}1!==i&&(t.globalAlpha=s),""!==this.filter&&(t.filter=n)}_T(t,e,i,s){t&&!0===this.shadowVisible?e.shadowsOn():t&&!1===this.shadowVisible&&e.shadowsOff(),t&&this.I1(s)&&null===this.shadowVisible&&e.shadowsOff()}tD(t,e,i,s){t&&(null!==this.Lt||this.I1(s))?(this.E1(!0),null===this.shadowVisible&&e.shadowsOff()):this.E1(!1)}eD(t,e,i){t&&!0===this.LN()&&e.shadowsOn(),i&&t&&e.shadowsOff()}hI(t,e,i){const s=this.part;let n=!1;s&&t.getRenderingHint("drawShadows")&&(n=s.isShadowed),e.clipInsteadOfFill&&(n=!1),this.Qs()&&n&&e.shadowsOn(),n&&!0===this.shadowVisible?e.shadowsOn():n&&!1===this.shadowVisible&&e.shadowsOff();const o=this.panel;if(n&&this.I1(o)&&null===this.shadowVisible&&e.shadowsOff(),e.ol){const s=t.computePixelRatio(),n=`drop-shadow(${e.shadowOffsetX/s}px ${e.shadowOffsetY/s}px ${e.shadowBlur/s/2}px ${e.shadowColor})`;null!==this.background&&i.Lt.setAttributeNS(null,"filter",n)}return n&&(null!==this.Lt||this.I1(o))?(this.E1(!0),null===this.shadowVisible&&e.shadowsOff()):this.E1(!1),n}cI(t,e,i,s){if(i.ol){const s=e.computePixelRatio(),n=`drop-shadow(${i.shadowOffsetX/s}px ${i.shadowOffsetY/s}px ${i.shadowBlur/s/2}px ${i.shadowColor})`;this.AN(t,n)}s&&!0===this.LN()&&i.shadowsOn(),this.Qs()&&i.shadowsOff()}I1(t){return null!==t&&(t.nl()&&(t=t.panel),t.LN()||(t.type===Yt.Auto||t.type===Yt.Spot)&&t.findMainElement()!==this)}AN(t,e){}O1(t,e,i){const s=this.qp(),n=e.x,o=e.y,r=e.width+s,a=e.height+s;this.bn(t,this.Lt,!0,!1,e,i),this.Lt instanceof Ut&&3===this.Lt.type?(t.beginPath(),t.rect(n-s/2,o-s/2,r,a),t.fillContext(this.Lt,!1,null)):t.fillRect(n-s/2,o-s/2,r,a)}iD(t,e){let i=t.fI(this);const s=null!==t.xa?t.xa:t.svg;if(null!==s&&-1!==i){for(;0!==i&&!t.elt(i-1).isVisibleObject();)i--;if(0===i)this.uI(t,e,s);else{const n=t.elt(i-1).svg;null!==n?n.after(e):s.appendChild(e)}}}uI(t,e,i){if(t.type===Yt.Table){const t=i.getElementsByClassName("gojs-ts"),s=0!==t.length?t[0]:null;null!==s&&s.after(e)}else i.Lt?i.Lt.after(e):i.prepend(e)}lI(t,e){if(!(t instanceof Bt))return!1;if(!this.visible||0===this.opacity)return null!==this.svg&&null!==this.svg.parentNode&&this.svg.remove(),!0;const i=this.De;if(this.Qs()&&(!this.isVisible()||0===i.width||0===i.height||isNaN(i.x)||isNaN(i.y)))return null!==this.svg&&null!==this.svg.parentNode&&this.svg.remove(),!0;t.setCurrentTransform(1,0,0,1,0,0);const s=this.panel,n=this.Pd(t);if(this.yf(t,e,n))return this.sD(this.svg),null!==this.svg.parentElement?(this.Qs()&&(t.lastDrawnPart=this.svg),!0):(this.Qs()?(null!==t.lastDrawnPart?t.lastDrawnPart.after(this.svg):t.diagramGroup.prepend(this.svg),t.lastDrawnPart=this.svg):s&&this.iD(s,this.svg),!0);if(this.Ji(!1),this.Qs()&&this.isShadowed){const i=this.shadowOffset;t.shadowsSet(i.x*e.scale*this.scale*e.$e,i.y*e.scale*this.scale*e.$e,this.shadowBlur),t.shadowsOn(),t.shadowColor=this.shadowColor}this instanceof ie&&(t.font=this.font),t.currentElement=null;const o=this.v,r=this instanceof Yt,a=this instanceof Yt&&this.nl(),h=this.svg;if(!0===this.Hp()&&this.R1(),t.outerGroup=!1,n)if(t.outerGroup=!0,r&&a)t.newGroup(1,0,0,1,0,0),this.svg=t.lastCreatedElement;else if(r&&this.isClipping){const e=this.findMainElement();let i=0,s=0;null!==e&&(i=e.actualBounds.x,s=e.actualBounds.y),t.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx+i,o.dy+s),this.svg=t.lastCreatedElement,null!==e&&t.createOrUpdateClipGroup(this,e.actualBounds),t.currentElement=t.lastCreatedElement}else r?(t.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.svg=t.lastCreatedElement):t.newGroup(1,0,0,1,0,0);const l=this.naturalBounds;r||t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),null!==this.background&&(r?(a&&t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(t,l,i),a&&t.setCurrentTransform(1,0,0,1,0,0)):(t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(t,l,i)),t.currentElement.Lt=t.lastCreatedElement,t.currentElement.prepend(t.lastCreatedElement));const u=this.hI(e,t,t.currentElement);this.Ma(t,e),r&&t.endGroup(),t.outerGroup&&t.endGroup();const c=t.surface.ud,d=r?this.svg:t.currentElement;if(null!==h&&null!==h.parentNode&&d!==h&&(null===this.panel||h.parentNode===this.panel.svg)){const e=this.svg.getAttribute("filter");return null!==e&&d.setAttribute("filter",e),""!==this.filter&&d.setAttributeNS(null,"filter",this.filter),h.replaceWith(d),this.svg=d,null!==d&&this.$p(t,s,i,d),!0}if(this.svg=d,null!==c&&null===d&&t.dummyGroup(),null===d)return!0;this.$p(t,s,i,d),this.cI(d,e,t,u);const g=this.Qs()?this.opacity*t.globalAlpha:this.opacity;if(1!==g&&d.setAttributeNS(null,"opacity",g.toString()),""!==this.filter&&d.setAttributeNS(null,"filter",this.filter),this.Qs()){if(null!==h&&d!==h&&h.parentNode===t.diagramGroup){const t=h.getAttribute("filter");null!==t&&d.setAttribute("filter",t),h.replaceWith(d)}else t.lastDrawnPart?t.lastDrawnPart.after(d):t.diagramGroup.prepend(d);t.lastDrawnPart=d}else null!==s&&this.iD(s,d);return null!==c&&c(this,d),this.sD(d),!0}sD(t){const i=this,s=t.dataset;i instanceof At&&(null!==i.portId&&(s.portId=i.portId),i instanceof Yt&&(isNaN(i.itemIndex)||(s.itemIndex=i.itemIndex.toString()),i instanceof ce&&(s.className=e.Kn(i),void 0!==i.key&&(s.key=i.key.toString()),null!==i.containingGroup&&(s.group=i.containingGroup.key.toString()),i instanceof be&&(null!==i.fromNode&&void 0!==i.fromNode.key&&(s.fromKey=i.fromNode.key.toString()),""!==i.fromPortId&&(s.fromPortId=i.fromPortId),null!==i.toNode&&void 0!==i.toNode.key&&(s.toKey=i.toNode.key.toString()),""!==i.toPortId&&(s.toPortId=i.toPortId)))))}$p(t,e,i,s){let n=!!(256&this.n);if(t.clipInsteadOfFill&&(n=!1),!n)return void s.removeAttributeNS(null,"clip-path");const o=e.Mn()?e.naturalBounds:e.actualBounds;let r=Math.max(i.x,o.x),a=Math.max(i.y,o.y),h=Math.min(i.right,o.right)-r,l=Math.min(i.bottom,o.bottom)-a;const u=this.he;null!==u&&(r=u.x,a=u.y,h=u.width,l=u.height);const c=w.z(r,a,Math.max(h,0),Math.max(l,0));if(this instanceof Yt){const t=P.l();t.set(this.v),t.ex(),t.sm(c),P.i(t)}s.setAttributeNS(null,"clip-path",`path('      M ${c.x},${c.y}       L ${c.width+c.x} ${c.y}       L ${c.width+c.x} ${c.height+c.y}       L ${c.x} ${c.height+c.y} z') view-box`),w.i(c)}dI(){if(null===this.svg)return;const t=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),e=this.svg.ownerDocument;if(null!==t)for(const i of t){const t=e.getElementById(i.split("#")[1].slice(0,-1));null!==t&&t.remove()}this.svg.remove()}aI(t,e){const i=this.De,s=this.Ke,n=this.Lt;null!==n&&t.commitTransform(),null!==n&&(this.bn(t,n,!0,!1,s,i),n instanceof Ut&&3===n.type?(t.beginPath(),t.rect(i.x,i.y,i.width,i.height),t.fillContext(n,!1,null)):t.fillRect(i.x,i.y,i.width,i.height)),this.Ma(t,e)}Ma(t,e){}wf(){this.Ji(!0)}yf(t,e,i){const s=this.svg;if(this.gI()){if(this.wf(),this.Ji(!1),null===s)return!1;const e=s.getAttribute("clip-path");if(null!==e&&e.includes("url")){const i=t.svg.getElementById(e.split("#")[1].slice(0,-1));null!==i&&i.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(null===s)return!1;if(!this.visible)return s.remove(),!1;if("g"!==s.nodeName&&i||"g"===s.nodeName&&!i)return!1;const n=this.v,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof Yt,a=!!r&&this.nl();if(!r||!a)if(this instanceof re){const e=this.U1;t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),null!==e&&t.amendImageTransform(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]),i?s.lastElementChild.setAttributeNS(null,"transform",t.getCurrentTransform()):s.setAttributeNS(null,"transform",t.getCurrentTransform())}else if(i&&!r)if(this instanceof $t){const t=s.getElementsByTagName("path");for(let e=0;e<t.length;e++)t[e].setAttributeNS(null,"transform",o)}else if(this instanceof ie){const t=s.getElementsByTagName("text"),e="string"==typeof this.stroke?this.stroke:null;for(let i=0;i<t.length;i++)t[i].setAttributeNS(null,"transform",o),e&&t[i].setAttributeNS(null,"fill",e)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(r&&this.isClipping&&this.xa){const t=this.findMainElement(),e=null!==t?t.actualBounds.x:0,i=null!==t?t.actualBounds.y:0;this.xa.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-e+", "+-i+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+e)+", "+(n.dy+i)+")")}else s.setAttributeNS(null,"transform",o);const h=this.Qs()?this.opacity*t.globalAlpha:this.opacity;1===h?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",h.toString()),t.setCurrentTransform(1,0,0,1,0,0);const l=this.xa?this.xa:this.F1;if(null!==this.background||void 0!==l.Lt){const e=l.Lt;if(null===this.background)t.removeOldGradient(this,l.Lt,"fill"),l.Lt.remove(),l.Lt=void 0;else{if((a||i&&!(this instanceof Yt))&&t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.O1(t,this.naturalBounds,this.actualBounds),l.Lt){t.removeOldGradient(this,l.Lt,"fill");const e=l.Lt.getAttribute("filter");null!==e&&t.lastCreatedElement.setAttribute("filter",e),l.Lt.replaceWith(t.lastCreatedElement)}else l.prepend(t.lastCreatedElement);l.Lt=t.lastCreatedElement}e&&t.removeOldGradient(this,e,"fill")}return this.$p(t,this.panel,this.actualBounds,s),!0}Pd(t){if(null!==this.background)return!0;let e=!!(256&this.n);return t.clipInsteadOfFill&&(e=!1),!!e}static UU(t,e,i,s,n,o,r){let a=.001;const h=o.length;t.moveTo(e,i);let l=s-e;const u=n-i;0===l&&(l=.001);const c=u/l;let d=Math.sqrt(l*l+u*u),g=0,f=!0;a=o[g%h];let m=0!==r;for(;d>=.1;){if(m){for(a=o[g++%h],a-=r;a<0;)a+=o[g++%h],f=!f;m=!1}else a=o[g++%h];a>d&&(a=d);let s=Math.sqrt(a*a/(1+c*c));l<0&&(s=-s),e+=s,i+=c*s,f?t.lineTo(e,i):t.moveTo(e,i),d-=a,f=!f}}bn(t,i,s,n,o,r){let a,h=1,l=1;if("string"==typeof i)return void(s?t.fillStyle=i:t.strokeStyle=i);if(1===i.type)return void(s?t.fillStyle=i.color:t.strokeStyle=i.color);const u=this.qp();h=o.width,l=o.height,n?(h=r.width,l=r.height):s||(h+=u,l+=u);const c=t instanceof It;if(c&&i.Nn&&(4===i.type||i.xf===h&&i.V1===l))a=i.Nn;else{let o=0,d=0,g=0,f=0,m=0,p=0,y=0,x=0;if(n?(y=r.x,x=r.y):s||(y-=u/2,x-=u/2),o=i.start.x*h+i.start.offsetX+y,d=i.start.y*l+i.start.offsetY+x,g=i.end.x*h+i.end.offsetX+y,f=i.end.y*l+i.end.offsetY+x,2===i.type)a=t.createLinearGradient(o,d,g,f);else if(3===i.type)p=isNaN(i.endRadius)?Math.max(h,l)/2:i.endRadius,isNaN(i.startRadius)?(m=0,p=Math.max(h,l)/2):m=i.startRadius,a=t.createRadialGradient(o,d,m,g,f,p);else if(4===i.type)try{a=t.createPattern(i.pattern,"repeat")}catch{a=null}else e.si(i.type,"Brush type");if(4!==i.type){const t=i.colorStops;if(null!==t){const e=t.iterator;for(;e.next();)a.addColorStop(e.key,e.value)}}if(c&&(i.Nn=a,null!==a&&(i.xf=h,i.V1=l),null===a&&4===i.type&&-1!==i.xf)){i.xf=-1;const t=this.diagram;null!==t&&-1===i.xf&&e.un((()=>{t.redraw()}),600)}}s?t.fillStyle=a:t.strokeStyle=a}isContainedBy(t){return t instanceof Yt&&this.mI(this,t)}mI(t,e){if(t===e||null===e)return!1;let i=t.panel;for(;null!==i;){if(i===e)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const t=this.panel;return null===t||t.isVisibleObject()}isEnabledObject(){let t=this instanceof Yt?this:this.panel;for(;null!==t&&t.isEnabled;)t=t.panel;return null===t}get enabledChanged(){return null!==this.w?this.w.Zp:null}set enabledChanged(t){const i=this.enabledChanged;i!==t&&(null!==t&&e.S(t,At,"enabledChanged"),this.Yt().Zp=t,this.t("enabledChanged",i,t))}R1(){if(!0===this.B1()){const t=this.el;if(t.Ue(),!this.De.isReal()||!this.hi.isReal())return this.Sd(!1),void this.Na(!1);if(t.Xs(this.De.x-this.hi.x,this.De.y-this.hi.y),1!==this.scale||0!==this.angle){const e=this.naturalBounds;this.Kp(t,e.x,e.y,e.width,e.height)}this.Sd(!1),this.Na(!0)}if(!0===this.Hp()){const t=this.panel;if(null===t)this.wa.set(this.el),this.Th=this.scale;else if(null!==t.Ws){const e=this.wa;e.Ue(),t.Mn()?e.bc(t.wa):null!==t.panel&&e.bc(t.panel.wa),e.bc(this.el),this.Th=this.scale*t.Th}this.Na(!1)}}Kp(t,e,i,s,n){if(1!==this.it&&t.it(this.it),0===this.Xt)return;const o=y.l();o.setSpot(e,i,s,n,v.Center),t.ks(this.Xt,o.x,o.y),y.i(o)}f(t){if(this.Xo())return;void 0===t&&(t=!1),this.xi(!0),this.lo(!0);const e=this.panel;null!==e&&!t&&e.f()}bf(){this.Xo()||(this.xi(!0),this.lo(!0))}kf(t){if(this.as())return;const e=this.panel;!t&&null!==e&&e.f(),this.lo(!0)}pf(){!1===this.B1()&&(this.Sd(!0),this.Na(!0))}TN(){this.Na(!0)}C(){const t=this.part;null!==t&&t.C()}Zs(t){const e=this.stretch,i=this.panel;if(null===i)return this.qo(1===e?0:e,t);if(i.type===Yt.Table)return this.Qp(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),t);if(i.type===Yt.Auto&&i.findMainElement()===this)return this.qo(2,t);if(1===e){if(i.type===Yt.Spot&&i.findMainElement()===this)return this.qo(2,t);const e=i.defaultStretch;return 1===e?this.qo(0,t):this.qo(e,t)}return this.qo(e,t)}Qp(t,e,i){const s=this.stretch;if(1!==s)return this.qo(s,i);let n=null,o=null;switch(t.stretch){case 1:case 5:break;case 4:case 2:o=!0}switch(e.stretch){case 1:case 4:break;case 5:case 2:n=!0}const r=this.panel.defaultStretch;return null===n&&(n=5===r||2===r),null===o&&(o=4===r||2===r),!0===n&&!0===o?this.qo(2,i):!0===n?this.qo(5,i):!0===o?this.qo(4,i):this.qo(0,i)}qo(t,e){if(e)return t;if(0===t)return 0;const i=this.desiredSize;if(i.isReal())return 0;const s=!isNaN(i.width),n=!isNaN(i.height),o=this.angle;if(s)if(90!==o&&270!==o){if(5===t)return 0;if(2===t)return 4}else{if(4===t)return 0;if(2===t)return 5}if(n)if(90!==o&&270!==o){if(4===t)return 0;if(2===t)return 5}else{if(5===t)return 0;if(2===t)return 4}return t}get segmentOrientation(){return null!==this.Ot?this.Ot._p:0}set segmentOrientation(t){const e=this.segmentOrientation;e!==t&&(null===this.Ot&&(this.Ot=new Ce),this.Ot._p=t,this.f(),this.t("segmentOrientation",e,t),0===t&&(this.angle=0))}pI(){this.segmentOrientation=21}get segmentIndex(){return null!==this.Ot?this.Ot.t0:-1/0}set segmentIndex(t){t=Math.round(t);const e=this.segmentIndex;e!==t&&(null===this.Ot&&(this.Ot=new Ce),this.Ot.t0=t,this.f(),this.t("segmentIndex",e,t))}get segmentFraction(){return null!==this.Ot?this.Ot.e0:0}set segmentFraction(t){t<0?t=0:t>1&&(t=1);const e=this.segmentFraction;e!==t&&(null===this.Ot&&(this.Ot=new Ce),this.Ot.e0=t,this.f(),this.t("segmentFraction",e,t))}get segmentOffset(){return null!==this.Ot?this.Ot.i0:y.dn}set segmentOffset(t){const e=this.segmentOffset;e.equals(t)||(t=t.N(),null===this.Ot&&(this.Ot=new Ce),this.Ot.i0=t,this.f(),this.t("segmentOffset",e,t))}get stretch(){return null!==this.w?this.w.ao:1}set stretch(t){const e=this.stretch;e!==t&&(this.Yt().ao=t,this.f(),this.t("stretch",e,t))}get name(){return null!==this.w?this.w.Pt:""}set name(t){const e=this.name;e!==t&&(this.Yt().Pt=t,null!==this.part&&this.part.s0(),this.t("name",e,t))}get opacity(){return this.Zt}set opacity(t){t<0?t=0:t>1&&(t=1);const e=this.opacity;if(e!==t){this.Zt=t,this.t("opacity",e,t);const i=this.diagram,s=this.part;null!==i&&null!==s&&i.C(s.hh(s.actualBounds))}}get filter(){return this.Gp}set filter(t){const e=this.filter;if(e!==t){this.Gp=t,this.Ji(!0),this.t("filter",e,t);const i=this.diagram,s=this.part;null!==i&&null!==s&&i.C(s.hh(s.actualBounds))}}get visible(){return!!(1&this.n)}set visible(t){const e=!!(1&this.n);if(e!==t){this.n=1^this.n,this.wf(),this.t("visible",e,t);const i=this.panel;null!==i?i.f():this.Qs()&&this.Xe(t),this.C(),this.nD()}}get pickable(){return!!(2&this.n)}set pickable(t){const e=!!(2&this.n);e!==t&&(this.n=2^this.n,this.t("pickable",e,t))}get fromLinkableDuplicates(){return!!(4&this.n)}set fromLinkableDuplicates(t){const e=!!(4&this.n);e!==t&&(this.n=4^this.n,this.t("fromLinkableDuplicates",e,t))}get fromLinkableSelfNode(){return!!(8&this.n)}set fromLinkableSelfNode(t){const e=!!(8&this.n);e!==t&&(this.n=8^this.n,this.t("fromLinkableSelfNode",e,t))}get toLinkableDuplicates(){return!!(16&this.n)}set toLinkableDuplicates(t){const e=!!(16&this.n);e!==t&&(this.n=16^this.n,this.t("toLinkableDuplicates",e,t))}get toLinkableSelfNode(){return!!(32&this.n)}set toLinkableSelfNode(t){const e=!!(32&this.n);e!==t&&(this.n=32^this.n,this.t("toLinkableSelfNode",e,t))}get isPanelMain(){return!!(64&this.n)}set isPanelMain(t){const e=!!(64&this.n);e!==t&&(this.n=64^this.n,this.f(),this.t("isPanelMain",e,t))}get isActionable(){return!!(128&this.n)}set isActionable(t){const e=!!(128&this.n);e!==t&&(this.n=128^this.n,this.t("isActionable",e,t))}get background(){return this.Lt}set background(t){const e=this.background;e!==t&&(null!==t&&Ut.Md(t,"GraphObject.background"),t instanceof Ut&&t.k(),this.Lt=t,this.C(),this.t("background",e,t))}LN(){return!!(512&this.n)}E1(t){t?this.n|=512:this.n&=-513}gf(){return!!(1024&this.n)}DN(t){t?this.n|=1024:this.n&=-1025}B1(){return!!(2048&this.n)}Sd(t){t?this.n|=2048:this.n&=-2049}Hp(){return!!(4096&this.n)}Na(t){t?this.n|=4096:this.n&=-4097}Xo(){return!!(8192&this.n)}xi(t){t?this.n|=8192:this.n&=-8193}as(){return!!(16384&this.n)}lo(t){t?this.n|=16384:this.n&=-16385}gI(){return!!(32768&this.n)}Ji(t){t?this.n|=32768:this.n&=-32769}get part(){if(this.Qs())return this;if(null!==this.sl)return this.sl;let t=this;for(t=t.panel;t;){if(t instanceof ce)return this.sl=t,t;t=t.panel}return null}get svg(){return this.F1}set svg(t){this.F1=t}jc(){this.svg=null}get panel(){return this.$s}Uh(t){this.$s=t,null!==this.svg&&this.svg.remove()}get layer(){const t=this.part;return null!==t?t.layer:null}get diagram(){const t=this.part;return null!==t?t.diagram:null}get position(){return this.ct}set position(t){const e=t.x,i=t.y,s=this.position,n=s.x,o=s.y;(n===e||isNaN(n)&&isNaN(e))&&(o===i||isNaN(o)&&isNaN(i))?this.FN():(t=t.copy(),this.vN(t,n,o)&&this.t("position",new y(n,o),t.copy()))}FN(){}vN(t,e,i){return this.ct=t,this.kf(),!0}Ec(t,e,i){this.ct.x===t&&this.ct.y===e||(this.ct.e(t,e),this.pf())}get actualBounds(){return this.De}get scale(){return this.it}set scale(t){const i=this.scale;i!==t&&(t<=0&&e.o("GraphObject.scale for "+this+" must be greater than zero, not: "+t),this.it=t,this.f(),this.t("scale",i,t))}get angle(){return this.Xt}set angle(t){const e=this.angle;if(e!==t){if((t%=360)<0&&(t+=360),e===t)return;this.Xt=t,this.nD(),this.f(),this.t("angle",e,t)}}get desiredSize(){return this.cs}set desiredSize(t){const e=t.width,i=t.height,s=this.desiredSize,n=s.width,o=s.height;if((n!==e&&(!isNaN(n)||!isNaN(e))||o!==i&&(!isNaN(o)||!isNaN(i)))&&(t=t.N(),this.cs=t,this.f(),this instanceof $t&&this.ai(),this.t("desiredSize",s,t),this.gf())){const t=this.part;null!==t&&(this.Eh(t,"width"),this.Eh(t,"height"))}}get width(){return this.cs.width}set width(t){const e=this.cs.width;if(!(e===t||isNaN(e)&&isNaN(t))){const e=this.cs,i=new x(t,this.cs.height).k();if(this.cs=i,this.f(),this instanceof $t&&this.ai(),this.t("desiredSize",e,i),this.gf()){const t=this.part;null!==t&&this.Eh(t,"width")}}}get height(){return this.cs.height}set height(t){const e=this.cs.height;if(!(e===t||isNaN(e)&&isNaN(t))){const e=this.cs,i=new x(this.cs.width,t).k();if(this.cs=i,this.f(),this instanceof $t&&this.ai(),this.t("desiredSize",e,i),this.gf()){const t=this.part;null!==t&&this.Eh(t,"height")}}}get minSize(){return null!==this.w?this.w.Nr:x.xc}set minSize(t){const e=this.minSize;e.equals(t)||(t=t.copy(),isNaN(t.width)&&(t.width=0),isNaN(t.height)&&(t.height=0),t.k(),this.Yt().Nr=t,this.f(),this.t("minSize",e,t))}get maxSize(){return null!==this.w?this.w.Cr:x.DP}set maxSize(t){const e=this.maxSize;e.equals(t)||(t=t.copy(),isNaN(t.width)&&(t.width=1/0),isNaN(t.height)&&(t.height=1/0),t.k(),this.Yt().Cr=t,this.f(),this.t("maxSize",e,t))}get measuredBounds(){return this.hi}get naturalBounds(){return this.Ke}qp(){return 0}get margin(){return this.il}set margin(t){"number"==typeof t&&(t=new b(t));const e=this.il;e.equals(t)||(t=t.N(),this.il=t,this.f(),this.t("margin",e,t))}get v(){return!0===this.B1()&&this.R1(),this.el}get Ws(){return!0===this.Hp()&&this.R1(),this.wa}trigger(t,e,i){let s=null;return s="string"==typeof t?new gt(t,e,i):t,s.Ti=this,null===this.Ts&&(this.Ts=new p),this.Ts.set(s.propertyName,s),this}get Ts(){return null!==this.w?this.w.Ts:null}set Ts(t){this.Ts!==t&&(this.Yt().Ts=t)}get Mr(){return null!==this.w?this.w.Mr:0}set Mr(t){this.Mr!==t&&(this.Yt().Mr=t)}get alignment(){return this.de}set alignment(t){const i=this.alignment;i.equals(t)||(t.isNoSpot()&&!t.isDefault()&&e.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+t),t=t.N(),this.de=t,this.kf(),this.t("alignment",i,t))}get column(){return this.pa}set column(t){t=Math.round(t);const i=this.column;i!==t&&(t<0&&e.J(t,">= 0",At,"column"),this.pa=t,this.f(),this.t("column",i,t),null!==this.svg&&this.svg.remove())}get columnSpan(){return null!==this.w?this.w.o0:1}set columnSpan(t){t=Math.round(t);const i=this.columnSpan;i!==t&&(t<1&&e.J(t,">= 1",At,"columnSpan"),this.Yt().o0=t,this.f(),this.t("columnSpan",i,t))}get row(){return this.Xp}set row(t){t=Math.round(t);const i=this.row;i!==t&&(t<0&&e.J(t,">= 0",At,"row"),this.Xp=t,this.f(),this.t("row",i,t),null!==this.svg&&this.svg.remove())}get rowSpan(){return null!==this.w?this.w.r0:1}set rowSpan(t){t=Math.round(t);const i=this.rowSpan;i!==t&&(t<1&&e.J(t,">= 1",At,"rowSpan"),this.Yt().r0=t,this.f(),this.t("rowSpan",i,t))}get spanAllocation(){return null!==this.w?this.w.l0:null}set spanAllocation(t){const i=this.spanAllocation;i!==t&&(null!==t&&e.S(t,At,"spanAllocation"),this.Yt().l0=t,this.f(),this.t("spanAllocation",i,t))}get alignmentFocus(){return this.wd}set alignmentFocus(t){const e=this.alignmentFocus;e.equals(t)||(t=t.N(),this.wd=t,this.f(),this.t("alignmentFocus",e,t))}get portId(){return this.zp}set portId(t){const i=this.portId;if(i!==t){const s=this.part;null!==s&&!(s instanceof me)&&e.o("Cannot set portID on a Link: "+t);const n=s;null!==i&&null!==n&&n.RN(this),this.zp=t,null!==t&&null!==n&&(n.Cn=!0,n.oD(this)),this.t("portId",i,t)}}Vh(){const t=this.part;if(t instanceof me&&(null!==this.portId||this===t.port)){const e=t.diagram;null!==e&&!e.undoManager.isUndoingRedoing&&t.invalidateConnectedLinks(void 0,this)}}nD(){const t=this.diagram;null===t||t.undoManager.isUndoingRedoing||(this instanceof Yt?this instanceof me?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,(t=>{t.Vh()})):this.Vh())}get toSpot(){return null!==this.ft?this.ft.vh:v.None}set toSpot(t){const e=this.toSpot;e.equals(t)||(t=t.N(),this.Wi().vh=t,this.t("toSpot",e,t),this.Vh())}get toEndSegmentLength(){return null!==this.ft?this.ft.Rh:10}set toEndSegmentLength(t){const i=this.toEndSegmentLength;i!==t&&(t<0&&e.J(t,">= 0",At,"toEndSegmentLength"),this.Wi().Rh=t,this.t("toEndSegmentLength",i,t),this.Vh())}get toShortLength(){return null!==this.ft?this.ft.Ih:0}set toShortLength(t){const e=this.toShortLength;e!==t&&(this.Wi().Ih=t,this.t("toShortLength",e,t),this.Vh())}get toLinkable(){return null!==this.ft?this.ft.a0:null}set toLinkable(t){const e=this.toLinkable;e!==t&&(this.Wi().a0=t,this.t("toLinkable",e,t))}get toMaxLinks(){return null!==this.ft?this.ft.h0:1/0}set toMaxLinks(t){const i=this.toMaxLinks;i!==t&&(t<0&&e.J(t,">= 0",At,"toMaxLinks"),this.Wi().h0=t,this.t("toMaxLinks",i,t))}get fromSpot(){return null!==this.ft?this.ft.Dh:v.None}set fromSpot(t){const e=this.fromSpot;e.equals(t)||(t=t.N(),this.Wi().Dh=t,this.t("fromSpot",e,t),this.Vh())}get fromEndSegmentLength(){return null!==this.ft?this.ft.Fh:10}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;i!==t&&(t<0&&e.J(t,">= 0",At,"fromEndSegmentLength"),this.Wi().Fh=t,this.t("fromEndSegmentLength",i,t),this.Vh())}get fromShortLength(){return null!==this.ft?this.ft.Oh:0}set fromShortLength(t){const e=this.fromShortLength;e!==t&&(this.Wi().Oh=t,this.t("fromShortLength",e,t),this.Vh())}get fromLinkable(){return null!==this.ft?this.ft.c0:null}set fromLinkable(t){const e=this.fromLinkable;e!==t&&(this.Wi().c0=t,this.t("fromLinkable",e,t))}get fromMaxLinks(){return null!==this.ft?this.ft.f0:1/0}set fromMaxLinks(t){const i=this.fromMaxLinks;i!==t&&(t<0&&e.J(t,">= 0",At,"fromMaxLinks"),this.Wi().f0=t,this.t("fromMaxLinks",i,t))}get cursor(){return null!==this.w?this.w.Il:""}set cursor(t){const i=this.cursor;i!==t&&(e.s(t,"string",At,"cursor"),this.Yt().Il=t,this.t("cursor",i,t))}get click(){return null!==this.w?this.w.Er:null}set click(t){const i=this.click;i!==t&&(null!==t&&e.S(t,At,"click"),this.Yt().Er=t,this.t("click",i,t))}get doubleClick(){return null!==this.w?this.w.Ur:null}set doubleClick(t){const i=this.doubleClick;i!==t&&(null!==t&&e.S(t,At,"doubleClick"),this.Yt().Ur=t,this.t("doubleClick",i,t))}get contextClick(){return null!==this.w?this.w.Vr:null}set contextClick(t){const i=this.contextClick;i!==t&&(null!==t&&e.S(t,At,"contextClick"),this.Yt().Vr=t,this.t("contextClick",i,t))}get mouseEnter(){return null!==this.w?this.w.Yr:null}set mouseEnter(t){const i=this.mouseEnter;i!==t&&(null!==t&&e.S(t,At,"mouseEnter"),this.Yt().Yr=t,this.t("mouseEnter",i,t))}get mouseLeave(){return null!==this.w?this.w.Kr:null}set mouseLeave(t){const i=this.mouseLeave;i!==t&&(null!==t&&e.S(t,At,"mouseLeave"),this.Yt().Kr=t,this.t("mouseLeave",i,t))}get mouseOver(){return null!==this.w?this.w.Br:null}set mouseOver(t){const i=this.mouseOver;i!==t&&(null!==t&&e.S(t,At,"mouseOver"),this.Yt().Br=t,this.t("mouseOver",i,t))}get mouseHover(){return null!==this.w?this.w.zr:null}set mouseHover(t){const i=this.mouseHover;i!==t&&(null!==t&&e.S(t,At,"mouseHover"),this.Yt().zr=t,this.t("mouseHover",i,t))}get mouseHold(){return null!==this.w?this.w.Xr:null}set mouseHold(t){const i=this.mouseHold;i!==t&&(null!==t&&e.S(t,At,"mouseHold"),this.Yt().Xr=t,this.t("mouseHold",i,t))}get mouseDragEnter(){return null!==this.w?this.w.u0:null}set mouseDragEnter(t){const i=this.mouseDragEnter;i!==t&&(null!==t&&e.S(t,At,"mouseDragEnter"),this.Yt().u0=t,this.t("mouseDragEnter",i,t))}get mouseDragLeave(){return null!==this.w?this.w.d0:null}set mouseDragLeave(t){const i=this.mouseDragLeave;i!==t&&(null!==t&&e.S(t,At,"mouseDragLeave"),this.Yt().d0=t,this.t("mouseDragLeave",i,t))}get mouseDrop(){return null!==this.w?this.w.Gr:null}set mouseDrop(t){const i=this.mouseDrop;i!==t&&(null!==t&&e.S(t,At,"mouseDrop"),this.Yt().Gr=t,this.t("mouseDrop",i,t))}get actionDown(){return null!==this.w?this.w.g0:null}set actionDown(t){const i=this.actionDown;i!==t&&(null!==t&&e.S(t,At,"actionDown"),this.Yt().g0=t,this.t("actionDown",i,t))}get actionMove(){return null!==this.w?this.w.m0:null}set actionMove(t){const i=this.actionMove;i!==t&&(null!==t&&e.S(t,At,"actionMove"),this.Yt().m0=t,this.t("actionMove",i,t))}get actionUp(){return null!==this.w?this.w.p0:null}set actionUp(t){const i=this.actionUp;i!==t&&(null!==t&&e.S(t,At,"actionUp"),this.Yt().p0=t,this.t("actionUp",i,t))}get actionCancel(){return null!==this.w?this.w.y0:null}set actionCancel(t){const i=this.actionCancel;i!==t&&(null!==t&&e.S(t,At,"actionCancel"),this.Yt().y0=t,this.t("actionCancel",i,t))}get toolTip(){return null!==this.w?this.w.Hr:null}set toolTip(t){const e=this.toolTip;e!==t&&(this.Yt().Hr=t,this.t("toolTip",e,t))}get contextMenu(){return null!==this.w?this.w.qr:null}set contextMenu(t){const e=this.contextMenu;e!==t&&(this.Yt().qr=t,this.t("contextMenu",e,t))}findBindingPanel(){let t=this instanceof Yt?this:this.panel;for(;null!==t;){if(t.ON())return t;t=t.panel}return null}bind(t,e,i,s){return this.Pf(t,e,i,s),this}bindTwoWay(t,e,i,s){return this.Pf(t,e,i,s).makeTwoWay(),this}bindModel(t,e,i,s){return this.Pf(t,e,i,s).ofModel(),this}bindObject(t,e,i,s,n){return this.Pf(t,e,i,s).ofObject(n),this}theme(t,e,i,s,n){return this.Ca(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.Ca(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,o){return this.Ca(t,e,i,s,n).ofObject(o),this}themeModel(t,e,i,s,n){return this.Ca(t,e,i,s,n).ofModel(),this}Pf(t,e,i,s){let n=null;return n="string"==typeof t?new ze(t,e,i,s):t,this.w0(n),n}Ca(t,e,i,s,n){let o=null;return o="string"==typeof t?new Xe(t,e,i,s,n):t,this.w0(o),o}w0(t){t.Ti=this;const i=this.findBindingPanel();null!==i&&i.rD()&&e.o("Cannot add a Binding to a template that has already been copied: "+t),null===this.ve&&(this.ve=new h),this.ve.add(t)}set(t){return t?(Object.assign(this,t),this):this}attach(t){return At.IN(this,t),this}apply(t,...e){return t.apply(this,[this,...e]),this}setProperties(t){return wt.Ap(this,t),this}static make(i,...s){let n=arguments,o=null,r=null;if(e.st(i))r=i;else if("string"==typeof i){const s=At.z1.get(i);e.st(s)?(n=Array.prototype.slice.call(n),o=s(n),e.$(o)||e.o('GraphObject.make invoked object builder "'+i+'", but it did not return an Object')):r=t.go[i]}null===o&&((null==r||!r.constructor)&&e.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+i),o=new r);let a=1;if(o instanceof wt&&n.length>1){const t=o,e=n[1];("string"==typeof e||e instanceof HTMLDivElement)&&(t.w2(e),a++)}for(let t=a;t<n.length;t++){const i=n[t];void 0===i?e.o("Undefined value at argument "+t+" for object being constructed by GraphObject.make: "+o):o&&At.IN(o,i)}return o}static IN(t,i){if("number"==typeof i)At.yI(t,i);else if("string"==typeof i)At.wI(t,i);else if(i instanceof At)t instanceof Yt||e.o("A GraphObject can only be added to a Panel, not to: "+t),t.add(i);else if(i instanceof Jt){let s=null;i.isRow&&e.st(t.getRowDefinition)?s=t.getRowDefinition(i.index):!i.isRow&&e.st(t.getColumnDefinition)&&(s=t.getColumnDefinition(i.index)),s instanceof Jt?s.X1(i):e.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+t)}else if(i instanceof jt){t.type=i}else if(i instanceof ze)t instanceof At||t instanceof Jt?t.bind(i):e.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+t);else if(i instanceof gt)t instanceof At?t.trigger(i):e.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+t);else if(i instanceof T)t instanceof N&&4===t.type?t.figures.add(i):e.o("A PathFigure can only be added to a Path Geometry, not to: "+t);else if(i instanceof A)t instanceof T?t.segments.add(i):e.o("A PathSegment can only be added to a PathFigure, not to: "+t);else if(i instanceof Le)t instanceof wt||t instanceof Ne?t.layout=i:e.o("A Layout can only be assigned to a Diagram or a Group, not to: "+t);else if(Array.isArray(i))for(let e=0;e<i.length;e++){const s=i[e];At.IN(t,s)}else e.$(i)?At.xI(t,i):e.o('Unknown initializer "'+i+'" for object being constructed by GraphObject.make: '+t)}static wI(t,i){if(t instanceof ie)t.text=i;else if(t instanceof $t)t.figure=i;else if(t instanceof re)t.source=i;else if(t instanceof Yt){const e=jt.fs.get(i);null!==e&&(t.type=e)}else if(t instanceof Ut){const s=e.$a(Vt,i);null!==s?t.type=s:e.o("Unknown Brush type as an argument to GraphObject.make: "+i)}else if(t instanceof N){const s=e.$a(M,i);null!==s&&(t.type=s)}else if(t instanceof A){const s=e.$a(L,i);null!==s&&(t.type=s)}}static yI(t,i){e.st(t.fe)?t.fe(i):e.ur(t,i)}static xI(t,i){if(t instanceof Ut){const e=new s;for(const s in i){const n=parseFloat(s);isNaN(n)?e[s]=i[s]:t.addColorStop(n,i[s])}wt.Ap(t,e)}else if(t instanceof Jt){if(void 0!==i.row){const s=i.row;(null==s||s===1/0||isNaN(s)||s<0)&&e.o("Must specify non-negative integer row for RowColumnDefinition "+i+", not: "+s),t.isRow=!0,t.index=s}else if(void 0!==i.column){const s=i.column;(null==s||s===1/0||isNaN(s)||s<0)&&e.o("Must specify non-negative integer column for RowColumnDefinition "+i+", not: "+s),t.isRow=!1,t.index=s}const n=new s;for(const t in i)"row"===t||"column"===t||(n[t]=i[t]);wt.Ap(t,n)}else wt.Ap(t,i)}static build(t,i,...s){const n=At.z1.get(t);if(e.st(n)){const e=n([t].concat(s));if(e instanceof At)return i&&e.setProperties(i),e}e.o('GraphObject.build invoked object builder "'+t+'", but it did not return an Object')}static defineBuilder(t,i){e.s(t,"string",At,"defineBuilder:name"),e.S(i,At,"defineBuilder:func");t.toLowerCase();At.z1.set(t,i)}static isBuilderDefined(t){return At.z1.has(t)}static takeBuilderArgument(t,i,s){void 0===s&&(s=null);const n=t[1];return(e.st(s)?s(n):"string"==typeof n)?(t.splice(1,1),n):(void 0===i&&e.o("no "+(e.st(s)?"satisfactory":"string")+" argument for GraphObject builder "+t[0]),i)}static z1=new p}At.Vertical=4,At.Horizontal=5,At.defineBuilder("Button",(t=>{const e=2.76142374915397,i=2.761423749153969,s=new Yt(Yt.Auto,{isActionable:!0,enabledChanged:(t,e)=>{if(t instanceof Yt){const i=t.findObject("ButtonBorder");if(null!==i)if(void 0===t._buttonFillNormal&&(t._buttonFillNormal=i.fill),e){let e=null;null!==t.layer&&null!==t.diagram&&t.isVisibleObject()&&(e=t.layer.findObjectAt(t.diagram.lastInput.documentPoint)),e===t||null!==e&&e.isContainedBy(t)?i.fill=t._buttonFillOver:i.fill=t._buttonFillNormal}else i.fill=t._buttonFillDisabled}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:"#d4d4d4",_buttonStrokeOver:"#737373",_buttonFillDisabled:"#a3a3a3"}).add(new $t("RoundedRectangle",{name:"ButtonBorder",spot1:new v(0,0,e,i),spot2:new v(1,1,-e,-i),parameter1:2,fill:"#f5f5f5",stroke:"#737373"}));return s.mouseEnter=(t,e,i)=>{if(!(e.isEnabledObject()&&e instanceof Yt))return;const s=e.findObject("ButtonBorder");s instanceof $t&&(void 0===e._buttonFillNormal&&(e._buttonFillNormal=s.fill),s.fill=e._buttonFillOver,void 0===e._buttonStrokeNormal&&(e._buttonStrokeNormal=s.stroke),s.stroke=e._buttonStrokeOver)},s.mouseLeave=(t,e,i)=>{if(!(e.isEnabledObject()&&e instanceof Yt))return;const s=e.findObject("ButtonBorder");s instanceof $t&&(void 0!==e._buttonFillNormal&&(s.fill=e._buttonFillNormal),void 0!==e._buttonStrokeNormal&&(s.stroke=e._buttonStrokeNormal))},s})),At.defineBuilder("TreeExpanderButton",(t=>{const e=At.build("Button");return e.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),e.add(new $t("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:x.Pu}).bindObject("figure","isTreeExpanded",((t,e)=>{const i=e.panel;return t?i._treeExpandedFigure:i._treeCollapsedFigure}))),e.bindObject("visible","isTreeLeaf",(t=>!t)),e.click=(t,e)=>{let i=e.part;if(i instanceof ge&&(i=i.adornedPart),!(i instanceof me))return;const s=i.diagram;if(null===s)return;const n=s.commandHandler;if(i.isTreeExpanded){if(!n.canCollapseTree(i))return}else if(!n.canExpandTree(i))return;t.handled=!0,i.isTreeExpanded?n.collapseTree(i):n.expandTree(i)},e})),At.defineBuilder("SubGraphExpanderButton",(t=>{const e=At.build("Button");return e.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),e.add(new $t("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:x.Pu}).bindObject("figure","isSubGraphExpanded",((t,e)=>{const i=e.panel;return t?i._subGraphExpandedFigure:i._subGraphCollapsedFigure}))),e.click=(t,e)=>{let i=e.part;if(i instanceof ge&&(i=i.adornedPart),!(i instanceof Ne))return;const s=i.diagram;if(null===s)return;const n=s.commandHandler;if(i.isSubGraphExpanded){if(!n.canCollapseSubGraph(i))return}else if(!n.canExpandSubGraph(i))return;t.handled=!0,i.isSubGraphExpanded?n.collapseSubGraph(i):n.expandSubGraph(i)},e})),At.defineBuilder("ToolTip",(t=>new ge(Yt.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new y(0,2),mouseOver:(t,e)=>{const i=t.diagram.toolManager;i.extendToolTip(i.toolTipDuration)}}).add(new $t("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new v(0,0,4,6),spot2:new v(1,1,-4,-4)})))),At.defineBuilder("ContextMenu",(t=>new ge(Yt.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new y(0,2)}).bindObject("background","",(t=>null!==t.adornedPart&&t.hasPlaceholder()?null:"#f5f5f5")))),At.defineBuilder("ContextMenuButton",(t=>{const e=At.build("Button");e.stretch=5;const i=e.findObject("ButtonBorder");return i instanceof $t&&(i.figure="Rectangle",i.strokeWidth=0,i.spot1=new v(0,0,4,6),i.spot2=new v(1,1,-4,-4)),e})),At.defineBuilder("PanelExpanderButton",(t=>{const e=At.takeBuilderArgument(t,"COLLAPSIBLE"),i=At.build("Button");i.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),i.add(new $t({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",(t=>t?i._buttonExpandedFigure:i._buttonCollapsedFigure),void 0,e));const s=i.findObject("ButtonBorder");return s instanceof $t&&(s.stroke=null,s.fill="rgba(0, 0, 0, 0)"),i.click=(t,i)=>{if(!(i instanceof Yt))return;const s=i.diagram;if(null===s||s.isReadOnly)return;let n=i.findBindingPanel();if(null===n&&(n=i.part),null!==n){const i=n.findObject(e);null!==i&&(t.handled=!0,s.startTransaction("Collapse/Expand Panel"),i.visible=!i.visible,s.commitTransaction("Collapse/Expand Panel"))}},i})),At.defineBuilder("CheckBoxButton",(t=>{const i=At.takeBuilderArgument(t),s=At.build("Button",{desiredSize:new x(14,14)});s.attach({"ButtonBorder.spot1":new v(0,0,1,1),"ButtonBorder.spot2":new v(1,1,-1,-1)});const n=new $t({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return""!==i&&n.bindTwoWay("visible",i),s.add(n),s.click=(t,s)=>{if(!(s instanceof Yt))return;const n=t.diagram;if(null===n||n.isReadOnly||""!==i&&n.model.isReadOnly)return;t.handled=!0;const o=s.findObject("ButtonIcon");n.startTransaction("checkbox"),null!==o&&(o.visible=!o.visible),e.st(s._doClick)&&s._doClick(t,s),n.commitTransaction("checkbox")},s})),At.defineBuilder("CheckBox",(t=>{const e=At.takeBuilderArgument(t),i=At.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new b(0,1,0,0)},e),s=new Yt("Horizontal",{isActionable:!0,cursor:i.cursor,margin:new b(1),mouseEnter:i.mouseEnter,mouseLeave:i.mouseLeave,click:i.click}).attach({_buttonFillNormal:i._buttonFillNormal,_buttonStrokeNormal:i._buttonStrokeNormal,_buttonFillOver:i._buttonFillOver,_buttonStrokeOver:i._buttonStrokeOver,_buttonFillDisabled:i._buttonFillDisabled,_buttonClick:i.click});return s.add(i),i.mouseEnter=null,i.mouseLeave=null,i.click=null,s})),At.defineBuilder("AutoRepeatButton",(t=>{const i=At.takeBuilderArgument(t,50,(t=>"number"==typeof t)),s=At.takeBuilderArgument(t,500,(t=>"number"==typeof t));function n(t,i){r(t,i),i.click&&(i.Nd=e.un((()=>o(t,i)),s))}function o(t,s){s.Nd&&e.yc(s.Nd),s.click&&(s.Nd=e.un((()=>{s.click&&(s.click(t,s),o(t,s))}),i))}function r(t,i){i.Nd&&(e.yc(i.Nd),i.Nd=void 0)}const a=At.build("Button");return a.actionDown=(t,e)=>n(t,e),a.actionUp=(t,e)=>r(0,e),a.actionCancel=(t,e)=>r(0,e),a})),At.defineBuilder("ToggleSwitch",(function(t){const i=At.takeBuilderArgument(t);i||e.o("ToggleSwitch must be data-bound to a property name, not: "+i);const s=At.takeBuilderArgument(t,!1,(t=>"boolean"==typeof t)),n="gray",o="transparent",r="white",a=new Yt("Auto",{width:s?15:28,height:s?28:15}).attach({_buttonFillOff:n,_buttonBorderOff:o,_buttonIconFillOff:r,_buttonFillOn:"green",_buttonBorderOn:"transparent",_buttonIconFillOn:"white"}).add(new $t("Capsule",{name:"ButtonBorder",fill:n,stroke:o,strokeWidth:1}).bind("fill",i,((t,e)=>t?e.panel._buttonFillOn:e.panel._buttonFillOff)).bind("stroke",i,((t,e)=>t?e.panel._buttonBorderOn:e.panel._buttonBorderOff))).add(new $t("Circle",{name:"ButtonIcon",width:11,height:11,fill:r,stroke:null,alignment:s?v.Bottom:v.Left}).bind("fill",i,((t,e)=>t?e.panel._buttonIconFillOn:e.panel._buttonIconFillOff)).bind("alignment",i,(t=>t?s?v.Top:v.Right:s?v.Bottom:v.Left)));return a.click=function(t,e){if(!e.isEnabledObject())return;const s=t.diagram;if(null===s||s.isReadOnly||""!==i&&s.model.isReadOnly)return;t.handled=!0;const n=e.findBindingPanel();null!==n&&(s.startTransaction("toggle switch"),s.model.set(n.data,i,!n.data[i]),"function"==typeof e._doClick&&e._doClick(t,e),s.commitTransaction("toggle switch"))},a})),At.defineBuilder("Toggle",(function(t){const e=At.takeBuilderArgument(t),i=At.build("ToggleSwitch",{name:"Button"},e),s=new Yt("Horizontal",{cursor:i.cursor,margin:1,mouseEnter:i.mouseEnter,mouseLeave:i.mouseLeave,click:i.click}).attach({_buttonClick:i.click}).add(i);return i.mouseEnter=null,i.mouseLeave=null,i.click=null,s}));class Dt{me;Pt;no;ve;oo;Ds;Il;Er;Ur;Vr;Yr;Kr;Br;zr;Xr;u0;d0;Gr;g0;m0;p0;y0;Hr;qr;Zp;l0;Ts;Nr;Cr;ao;r0;o0;Mr;Jp;x0;b0;constructor(){this.me=!1,this.Pt="",this.no=-1,this.ve=null,this.oo=null,this.Ds=null,this.Il="",this.Er=null,this.Ur=null,this.Vr=null,this.Yr=null,this.Kr=null,this.Br=null,this.zr=null,this.Xr=null,this.u0=null,this.d0=null,this.Gr=null,this.g0=null,this.m0=null,this.p0=null,this.y0=null,this.Hr=null,this.qr=null,this.Zp=null,this.l0=null,this.Ts=null,this.Nr=x.xc,this.Cr=x.DP,this.ao=1,this.r0=1,this.o0=1,this.Mr=0,this.Jp=null,this.x0=null,this.b0="category"}copy(){const t=new Dt;return t.Pt=this.Pt,t.no=this.no,t.ve=this.ve,t.Ds=this.Ds,t.Il=this.Il,t.Er=this.Er,t.Ur=this.Ur,t.Vr=this.Vr,t.Yr=this.Yr,t.Kr=this.Kr,t.Br=this.Br,t.zr=this.zr,t.Xr=this.Xr,t.u0=this.u0,t.d0=this.d0,t.Gr=this.Gr,t.g0=this.g0,t.m0=this.m0,t.p0=this.p0,t.y0=this.y0,t.Hr=this.Hr,t.qr=this.qr,t.Zp=this.Zp,t.l0=this.l0,t.Ts=this.Ts,t.Nr=this.Nr.N(),t.Cr=this.Cr.N(),t.ao=this.ao,t.r0=this.r0,t.o0=this.o0,t.Mr=this.Mr,t.Jp=this.Jp,t.x0=this.x0,t.b0=this.b0,t}}class Ft{m;constructor(){this.m=[1,0,0,1,0,0]}copy(){const t=new Ft;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}translate(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e}scale(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e}rotate(t,e,i){if(0===(t=k.Ee(t)))return;this.translate(e,i);let s=0,n=0;if(90===t)s=0,n=1;else if(180===t)s=-1,n=0;else if(270===t)s=0,n=-1;else{const e=t*Math.PI/180;s=Math.cos(e),n=Math.sin(e)}const o=this.m[0]*s+this.m[2]*n,r=this.m[1]*s+this.m[3]*n,a=this.m[0]*-n+this.m[2]*s,h=this.m[1]*-n+this.m[3]*s;this.m[0]=o,this.m[1]=r,this.m[2]=a,this.m[3]=h,this.translate(-e,-i)}}class Ot{type;x1;y1;r1;x2;y2;r2;colors;pattern;constructor(t){this.type=t,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(t,e){this.colors.push({offset:t,color:e})}}class Rt{bt;_t;tl;ud;EN;constructor(e,i,s){const n=void 0===i?t.document:i;this.tl=n,this.EN="http://www.w3.org/2000/svg";const o="http://www.w3.org/2000/xmlns/";void 0!==n&&(this.bt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",s||(this.style.position="absolute"),this.bt.setAttributeNS(o,"xmlns",this.EN),this.bt.setAttributeNS(o,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.ud=null,this._t=new Bt(this,s)}resize(t,e,i,s){return(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",this.bt.setAttributeNS(null,"width",i+"px"),this.bt.setAttributeNS(null,"height",s+"px"),this.bt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this._t.UN.firstElementChild.setAttributeNS(null,"width",i+"px"),this._t.UN.firstElementChild.setAttributeNS(null,"height",s+"px"),!0)}makeElement(t,i,s){const n=this.tl.createElementNS(this.EN,t);if(e.$(i))for(const t in i)n.setAttributeNS("href"===t?"http://www.w3.org/1999/xlink":"",t,i[t]);return void 0!==s&&(n.textContent=s),n}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return parseInt(this.bt.getAttribute("width")||"1")}set width(t){this.bt.setAttribute("width",t+"px")}get height(){return parseInt(this.bt.getAttribute("height")||"1")}set height(t){this.bt.setAttribute("height",t+"px")}dispose(){this.tl=null}get style(){return this.bt.style}}class Bt{Sf;Mf;Ln;Fe;$i;fillStyle;font;globalAlpha;lineCap;lineDashOffset;lineJoin;lineWidth;miterLimit;shadowBlur;shadowColor;shadowOffsetX;shadowOffsetY;strokeStyle;textAlign;imageSmoothingEnabled;clipInsteadOfFill;lastCreatedElement;Nf;Cf;surface;svg;UN;lD;G1;jo;La;Bh;currentElement;clipPathGroup;diagramGroup;lastDrawnPart;currentPath;outerGroup;pathAttributes;ol;vr;filter;letterSpacing;wordSpacing;partClipRect;constructor(t,e){if(this.surface=t,this.svg=t.bt,this.Nf=[],this.Cf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.ol=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.Sf=0,this.Mf=0,this.Ln=0,this.lastCreatedElement=null,this.currentElement=null,this.Fe=[],this.pathAttributes={},this.G1=!1,this.jo=null,this.La=0,this.lD={},this.vr=!!e,this.filter="",this.partClipRect=null,this.$i=new Ft,this.letterSpacing="0px",this.wordSpacing="0px",null===t.tl||void 0===t.tl)return;this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const i=u.Ww++,s=this.makeElement("clipPath",{id:"mainClip"+i}),n={x:0,y:0,width:t.width,height:t.height};s.appendChild(this.makeElement("rect",n)),this.UN=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")")}setDiagramPosScale(t,e,i,s,n,o){void 0===this.diagramGroup?this.newGroup(t,e,i,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+t+", "+e+", "+i+", "+s+", "+n+", "+o+")")}resetInnerSVG(){null!==this.diagramGroup&&(this.diagramGroup.innerHTML="")}arc(t,e,i,s,n,o,r,a){const h=2*Math.PI,l=1e-6,u=h-l,c=i*Math.cos(s),d=i*Math.sin(s),g=t+c,f=e+d,m=o?0:1;let p=o?s-n:n-s;(Math.abs(r-g)>l||Math.abs(a-f)>l)&&this.Fe.push(["L",g,+f]),p<0&&(p=p%h+h),p>u?(this.Fe.push(["A",i,i,0,1,m,t-c,e-d]),this.Fe.push(["A",i,i,0,1,m,g,f])):p>l&&this.Fe.push(["A",i,i,0,+(p>=Math.PI),m,t+i*Math.cos(n),e+i*Math.sin(n)])}beginPath(){this.Fe=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(t){this.bI(this.Fe,this.$i,t||0)}bezierCurveTo(t,e,i,s,n,o){this.Fe.push(["C",t,e,i,s,n,o])}clearRect(t,e,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Fe.push(["z"])}createLinearGradient(t,e,i,s){const n=new Ot("linear");return n.x1=t,n.y1=e,n.x2=i,n.y2=s,n}createPattern(t,e){let i="";t instanceof HTMLCanvasElement&&(i=t.toDataURL()),t instanceof HTMLImageElement&&(i=t.getAttribute("src"));const s=this.lD;if(s[i])return"url(#"+s[i]+")";const n="PATTERN"+u.Ww++,o={width:t.width,height:t.height,id:n,patternUnits:"userSpaceOnUse"},r={x:0,y:0,width:t.width,height:t.height,href:i},a=this.makeElement("pattern",o);return a.appendChild(this.makeElement(wt.img,r)),this.svg.appendChild(a),s[i]=n,"url(#"+n+")"}createRadialGradient(t,e,i,s,n,o){const r=new Ot("radial");return r.x1=t,r.y1=e,r.r1=i,r.x2=s,r.y2=n,r.r2=o,r}amendImageTransform(t,e,i,s,n,o,r,a){const h=r/i,l=a/s;(0!==n||0!==o)&&this.$i.translate(n,o),(1!==h||1!==l)&&this.$i.scale(h,l),(0!==t||0!==e)&&this.$i.translate(-t,-e)}drawImage(t,e,i,s,n,o,r,a,h){let l="",u=t.width,c=t.height;"function"==typeof t.toDataURL?t.toDataURL():(l=t.getAttribute("src"),u=t.naturalWidth,c=t.naturalHeight),void 0===s&&(o=e,r=i,a=s=u,h=n=c),s=s||0,n=n||0,o=o||0,r=r||0,a=a||0,h=h||0,this.amendImageTransform(e,i,s,n,o,r,a,h);const d={x:0,y:0,width:u||s,height:c||n,href:l};k.X(s,a)&&k.X(n,h)?-1===l.toLowerCase().indexOf(".svg")&&-1===l.toLowerCase().indexOf("data:image/svg")&&(d.preserveAspectRatio="xMidYMid slice"):d.preserveAspectRatio="none",(0!==e||0!==i||s!==u||n!==c)&&(s+=e,n+=i,d["clip-path"]=`path('M ${e},${i} L ${s} ${i} L ${s} ${n} L ${e} ${n} z')`),this.processCommon(wt.img,d,this.$i),this.Cd(wt.img,d)}fill(t,e){t&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(t,e,i){this.clipInsteadOfFill?this.clip():this.fill(e,i)}createOrUpdateClipGroup(t,e){const i=this.newGroup(1,0,0,1,-e.x,-e.y);i.setAttributeNS(null,"class","spotClip"),t.xa=i}fillRect(t,e,i,s){this.addRect("fill",[t,e,i,s],this.$i)}fillBackground(t,e,i,s){const n={x:t,y:e,width:i,height:s};this.processCommon("fill",n,this.$i),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(t,e,i){this.addText("fill",[t,e,i],this.$i)}lineTo(t,e){this.Fe.push(["L",t,e])}moveTo(t,e){this.Fe.push(["M",t,e])}quadraticCurveTo(t,e,i,s){this.Fe.push(["Q",t,e,i,s])}rect(t,e,i,s){this.Fe.push(["M",t,e],["L",t+i,e],["L",t+i,e+s],["L",t,e+s],["z"])}restore(){this.$i=this.Nf.pop(),this.Fe=this.Nf.pop();const t=this.Nf.pop();this.fillStyle=t.fillStyle,this.font=t.font,this.globalAlpha=t.globalAlpha,this.lineCap=t.lineCap,this.lineDashOffset=t.lineDashOffset,this.lineJoin=t.lineJoin,this.lineWidth=t.lineWidth,this.miterLimit=t.miterLimit,this.shadowBlur=t.shadowBlur,this.shadowColor=t.shadowColor,this.shadowOffsetX=t.shadowOffsetX,this.shadowOffsetY=t.shadowOffsetY,this.strokeStyle=t.strokeStyle,this.textAlign=t.textAlign,this.partClipRect=t.partClipRect,this.letterSpacing=t.letterSpacing,this.wordSpacing=t.wordSpacing}save(){const t={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.Nf.push(t);const e=[];for(let t=0;t<this.Fe.length;t++)e.push(this.Fe[t]);this.Nf.push(e),this.Nf.push(this.$i.copy())}setTransform(t,e,i,s,n,o){1===t&&0===e&&0===i&&1===s&&0===n&&0===o||this.newGroup(t,e,i,s,n,o)}setCurrentTransform(t,e,i,s,n,o){this.$i.m=[t,e,i,s,n,o]}getCurrentTransform(){const t=this.$i.m;return"matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}scale(t,e){this.$i.scale(t,e)}translate(t,e){this.$i.translate(t,e)}transform(t,e,i,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(t,e,i,s){this.addRect("stroke",[t,e,i,s],this.$i)}makeElement(t,e,i){return this.surface.makeElement(t,e,i)}Cd(t,e,i){const s=this.makeElement(t,e,i);return null!==this.currentElement?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(t,e,i){if("fill"===t?this.setFill(e):"stroke"===t&&this.setStroke(e),null!==i){const t=i.m;e.transform="matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}}setFill(t){if(this.fillStyle instanceof Ot)t.fill=this.addGradient(this.fillStyle,"fill");else if(/^rgba\(/.test(this.fillStyle)){const e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.fill="rgb("+e[1]+","+e[2]+","+e[3]+")",t["fill-opacity"]=e[4]}else t.fill=this.fillStyle}setFillOrStrokeInPlace(t,e){const i=e?"fill":"stroke";if(this.fillStyle instanceof Ot)t.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,i));else if(/^rgba\(/.test(this.fillStyle)){const e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.setAttributeNS(null,i,"rgb("+e[1]+","+e[2]+","+e[3]+")"),t.setAttributeNS(null,i+"-opacity",e[4])}else t.setAttributeNS(null,i,this.fillStyle)}setStroke(t){if(this.strokeStyle instanceof Ot)t.stroke=this.addGradient(this.strokeStyle,"stroke");else if(/^rgba\(/.test(this.strokeStyle)){const e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);t.stroke="rgb("+e[1]+","+e[2]+","+e[3]+")",t["stroke-opacity"]=e[4]}else t.stroke=this.strokeStyle;t["stroke-width"]=this.lineWidth,t["stroke-linecap"]=this.lineCap,t["stroke-linejoin"]=this.lineJoin,t["stroke-miterlimit"]=this.miterLimit,this.G1&&(t["stroke-dasharray"]=this.jo.toString(),t["stroke-dashoffset"]=this.La)}addGradient(t,i){let s="";const n=null!==this.currentPath?this.currentPath.getAttribute(i):null;if(null!==n&&-1!==n.indexOf("GRAD")){s=n.split("#")[1].slice(0,-1);const t=this.svg.getElementById(s);null!==t&&t.remove()}else s="GRAD"+u.Ww++;let o;if("linear"===t.type){const e={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,id:s,gradientUnits:"userSpaceOnUse"};o=this.makeElement("linearGradient",e)}else if("radial"===t.type){const e={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,r1:t.r1,r2:t.r2,id:s};o=this.makeElement("radialGradient",e)}else e.o("invalid gradient");const r=t.colors.sort(((t,e)=>t.offset>e.offset?1:-1)),a=r.length;for(let t=0;t<a;t++){const e=r[t],i=e.color;o.appendChild(this.makeElement("stop",{offset:e.offset,"stop-color":i}))}return this.svg.appendChild(o),"url(#"+s+")"}addRect(t,e,i){const s={x:e[0],y:e[1],width:e[2],height:e[3]};this.processCommon(t,s,i),this.Cd("rect",s)}addText(t,e,i){let s=this.textAlign;"left"===s?s="start":"right"===s?s="end":"center"===s&&(s="middle");const n={x:e[1],y:e[2],style:"font: "+this.font,"text-anchor":s};n["letter-spacing"]=this.letterSpacing,n["word-spacing"]=this.wordSpacing,this.processCommon(t,n,i),this.Cd("text",n,e[0])}bI(t,e,i){const s=this.kI(t),n=this.pathAttributes;if(n.clipPath)this.Cf.length>1&&this.Cf[this.Cf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');else if(n.d=s,this.processCommon("",n,e),null!==this.currentPath){const t=this.currentPath;if("g"!==t.nodeName)for(const e in n)"transform"!==e&&t.setAttributeNS(null,e,n[e]);else{const e=t.getElementsByTagName("path");for(const t in n)"transform"!==t&&e[i].setAttributeNS(null,t,n[t])}}else this.Cd("path",n)}kI(t){const e=[];for(let i=0;i<t.length;i++){const s=t[i].slice(),n=[s.shift()];if("A"===n[0])n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());e.push(n.join(" "))}return e.join(" ")}newGroup(t,e,i,s,n,o){const r=new Ft;r.m=[t,e,i,s,n,o];const a={};this.processCommon("g",a,r);const h=this.Cd("g",a);return this.Cf.push(h),h}newGroup2(t){const e={};t&&(e.class=t);const i=this.Cd("g",e);return this.Cf.push(i),i}endGroup(){return this.Cf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(t,e,i){this.Sf=t,this.Mf=e,this.Ln=i}shadowsOff(){this.ol=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.ol=!0,this.shadowOffsetX=this.Sf,this.shadowOffsetY=this.Mf,this.shadowBlur=this.Ln}enableDash(t,e){this.G1=!0,this.jo=t,this.La=e}disableDash(){this.G1=!1}clearContextCache(t){}setImageSmoothingEnabled(t){}rotate(t){this.$i.rotate(57.2958*t,0,0)}getImageData(t,e,i,s){return null}measureText(t){return null}removeOldGradient(t,e,i){const s=e.getAttribute(i);if(null===s)return;const n=s.split("#");if(1===n.length)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(null!==o){const t=new RegExp(o.id,"g");1===this.svg.innerHTML.match(t).length&&o.remove()}}removePartFromView(t){null!==t.svg&&t.svg.parentNode===this.diagramGroup&&t.svg.remove()}}class Et{bt;_t;tl;ud;constructor(e,i,s,n){const o=void 0===i?t.document:i;this.tl=o,this.ud=null;const r=o.createElement("canvas");r.tabIndex=0,this.bt=r,this._t=new It(r,s,n),e&&wt.ji.set(r,e)}resize(t,e,i,s){return(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",!0)}toDataURL(t,e){return this.bt.toDataURL(t,e)}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return this.bt.width}set width(t){this.bt.width=t}get height(){return this.bt.height}set height(t){this.bt.height=t}dispose(){wt.ji.delete(this.bt),this.tl=null}get style(){return this.bt.style}}class It{F;Y1;K1;H1;clipInsteadOfFill;Sf;Mf;Ln;Bh;ol;vr;constructor(t,i,s){t.getContext||e.o("Browser does not support HTML Canvas Element"),this.F=t.getContext("2d",i),this.Y1="",this.K1="",this.H1="",this.clipInsteadOfFill=!1,this.Sf=0,this.Mf=0,this.Ln=0,this.ol=!1,this.Bh=new P,this.vr=!!s}createOrUpdateClipGroup(t,e){}setImageSmoothingEnabled(t){this.F.imageSmoothingEnabled=t}get fillStyle(){return this.F.fillStyle}set fillStyle(t){this.H1!==t&&(this.F.fillStyle=t,this.H1=t)}get font(){return this.F.font}set font(t){this.Y1!==t&&(this.F.font=t,this.Y1=t)}get globalAlpha(){return this.F.globalAlpha}set globalAlpha(t){this.F.globalAlpha=t}get lineCap(){return this.F.lineCap}set lineCap(t){this.F.lineCap=t}get lineDashOffset(){return this.F.lineDashOffset}set lineDashOffset(t){this.F.lineDashOffset=t}get lineJoin(){return this.F.lineJoin}set lineJoin(t){this.F.lineJoin=t}get lineWidth(){return this.F.lineWidth}set lineWidth(t){this.F.lineWidth=t}get miterLimit(){return this.F.miterLimit}set miterLimit(t){this.F.miterLimit=t}get shadowBlur(){return this.F.shadowBlur}set shadowBlur(t){this.F.shadowBlur=t}get shadowColor(){return this.F.shadowColor}set shadowColor(t){this.F.shadowColor=t}get shadowOffsetX(){return this.F.shadowOffsetX}set shadowOffsetX(t){this.F.shadowOffsetX=t}get shadowOffsetY(){return this.F.shadowOffsetY}set shadowOffsetY(t){this.F.shadowOffsetY=t}get strokeStyle(){return this.F.strokeStyle}set strokeStyle(t){this.K1!==t&&(this.F.strokeStyle=t,this.K1=t)}get textAlign(){return this.F.textAlign}set textAlign(t){this.F.textAlign=t}get imageSmoothingEnabled(){return this.F.imageSmoothingEnabled}set imageSmoothingEnabled(t){this.F.imageSmoothingEnabled=t}get filter(){return this.F.filter}set filter(t){this.F.filter=""===t?"none":t}get letterSpacing(){return this.F.letterSpacing}set letterSpacing(t){this.F.letterSpacing=t}get wordSpacing(){return this.F.wordSpacing}set wordSpacing(t){this.F.wordSpacing=t}arc(t,e,i,s,n,o,r,a){this.F.arc(t,e,i,s,n,o)}beginPath(){this.F.beginPath()}endPath(){}bezierCurveTo(t,e,i,s,n,o){this.F.bezierCurveTo(t,e,i,s,n,o)}clearRect(t,e,i,s){this.commitTransform(),this.F.clearRect(t,e,i,s)}clip(t){t?this.F.clip(t):this.F.clip()}closePath(){this.F.closePath()}createLinearGradient(t,e,i,s){return this.F.createLinearGradient(t,e,i,s)}createPattern(t,e){return this.F.createPattern(t,e)}createRadialGradient(t,e,i,s,n,o){return this.F.createRadialGradient(t,e,i,s,n,o)}drawImage(t,e,i,s,n,o,r,a,h){void 0===s?this.F.drawImage(t,e,i):this.F.drawImage(t,e,i,s,n,o,r,a,h)}fill(t,e){e?this.F.fill(e,t?"evenodd":"nonzero"):this.F.fill(t?"evenodd":"nonzero")}fillRect(t,e,i,s){this.F.fillRect(t,e,i,s)}fillBackground(t,e,i,s){this.F.fillRect(t,e,i,s)}fillText(t,e,i){this.F.fillText(t,e,i)}getImageData(t,e,i,s){return this.F.getImageData(t,e,i,s)}lineTo(t,e){this.F.lineTo(t,e)}measureText(t){return this.F.measureText(t)}moveTo(t,e){this.F.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this.F.quadraticCurveTo(t,e,i,s)}rect(t,e,i,s){this.F.rect(t,e,i,s)}restore(){this.F.restore()}save(){this.commitTransform(),this.F.save()}rotate(t){this.Bh.ks(57.2958*t,0,0)}setTransform(t,e,i,s,n,o){this.Bh.setTo(t,e,i,s,n,o)}scale(t,e){this.Bh.it(t,e)}translate(t,e){this.Bh.Xs(t,e)}stroke(t){t?this.F.stroke(t):this.F.stroke()}transform(t,e,i,s,n,o){if(1===t&&0===e&&0===i&&1===s&&0===n&&0===o)return;const r=this.Bh,a=r.m11*t+r.m21*e,h=r.m12*t+r.m22*e,l=r.m11*i+r.m21*s,u=r.m12*i+r.m22*s;r.dx=r.m11*n+r.m21*o+r.dx,r.dy=r.m12*n+r.m22*o+r.dy,r.m11=a,r.m12=h,r.m21=l,r.m22=u}commitTransform(){const t=this.Bh;this.F.setTransform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy)}fillContext(t,e,i){this.radialFill(t,e,i)||this.fillOrClip(e,i)}radialFill(t,e,i){if(!(t instanceof Ut)||3!==t.type)return!1;const s=t.xf,n=t.V1;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(e,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(t,e){this.clipInsteadOfFill?this.clip(e):this.fill(t,e)}shadowsSet(t,e,i){this.Sf=t,this.Mf=e,this.Ln=i}shadowsOff(){this.ol=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.ol=!0,this.shadowOffsetX=this.Sf,this.shadowOffsetY=this.Mf,this.shadowBlur=this.Ln}enableDash(t,e){const i=this.F;void 0!==i.setLineDash&&(i.setLineDash(t),i.lineDashOffset=e)}disableDash(){const t=this.F;void 0!==t.setLineDash&&(t.setLineDash(It.EmptyArray),t.lineDashOffset=0)}clearContextCache(t){t&&(this.Y1=""),this.K1="",this.H1=""}removePartFromView(t){}static EmptyArray=Object.freeze([])}var Vt=(t=>(t[t.Solid=1]="Solid",t[t.Linear=2]="Linear",t[t.Radial=3]="Radial",t[t.Pattern=4]="Pattern",t))(Vt||{}),zt=(t=>(t[t.Lab=1]="Lab",t[t.HSL=2]="HSL",t[t.Oklch=3]="Oklch",t))(zt||{});class Xt{n0;n1;n2;n3;constructor(){this.n0=0,this.n1=0,this.n2=0,this.n3=0}}class Ut{u;W;zh;ae;Cs;k0;P0;Wo;S0;Nn;xf;V1;constructor(t,i){if(u.Je(this),this.u=!1,void 0===t)this.W=1,this.zh="black";else if("string"==typeof t){const i=e.$a(Vt,t);null!==i?(this.W=i,this.zh="black"):(this.W=1,this.zh=t)}else Object.keys(Vt).hasOwnProperty(t)?(this.W=t,this.zh="black"):"object"==typeof t&&(this.W=1,i=t);const s=this.W;if(2===s?(this.ae=v.TopCenter,this.Cs=v.BottomCenter):3===s?(this.ae=v.Center,this.Cs=v.Center):(this.ae=v.None,this.Cs=v.None),this.k0=0,this.P0=NaN,this.Wo=null,this.S0=null,this.Nn=null,this.xf=0,this.V1=0,i){const t={};for(const e in i)isFinite(parseFloat(e))?this.addColorStop(parseFloat(e),i[e]):t[e]=i[e];Object.assign(this,t)}}copy(){const t=new Ut;return t.W=this.W,t.zh=this.zh,t.ae=this.ae.N(),t.Cs=this.Cs.N(),t.k0=this.k0,t.P0=this.P0,null!==this.Wo&&(t.Wo=this.Wo.copy()),t.S0=this.S0,t}k(){return this.u=!0,null!==this.Wo&&this.Wo.k(),this}fe(t){t in Vt?this.type=t:e.ur(this,t)}toString(){let t="Brush(";if(1===this.type)t+=this.color;else if(2===this.type?t+="Linear ":3===this.type?t+="Radial ":4===this.type?t+="Pattern ":t+="(unknown) ",t+=this.start+" "+this.end,null!==this.colorStops){const e=this.colorStops.iterator;for(;e.next();){t+=" "+e.key+":"+e.value}}return t+=")",t}addColorStop(t,i){return this.u&&e.L(this),("number"!=typeof t||!isFinite(t)||t>1||t<0)&&e.J(t,"0 <= loc <= 1",Ut,"addColorStop:loc"),e.s(i,"string",Ut,"addColorStop:color"),null===this.Wo&&(this.Wo=new p),this.Wo.set(t,i),1===this.W&&(this.type=2),this.Nn=null,this}get type(){return this.W}set type(t){this.u&&e.L(this,t),this.W=t,this.start.isNoSpot()&&(2===t?this.start=v.TopCenter:3===t&&(this.start=v.Center)),this.end.isNoSpot()&&(2===t?this.end=v.BottomCenter:3===t&&(this.end=v.Center)),this.Nn=null}get color(){return this.zh}set color(t){this.u&&e.L(this,t),this.zh=t,this.Nn=null}get start(){return this.ae}set start(t){this.u&&e.L(this,t),this.ae=t.N(),this.Nn=null}get end(){return this.Cs}set end(t){this.u&&e.L(this,t),this.Cs=t.N(),this.Nn=null}get startRadius(){return this.k0}set startRadius(t){this.u&&e.L(this,t),t<0&&e.J(t,">= zero",Ut,"startRadius"),this.k0=t,this.Nn=null}get endRadius(){return this.P0}set endRadius(t){this.u&&e.L(this,t),t<0&&e.J(t,">= zero",Ut,"endRadius"),this.P0=t,this.Nn=null}get colorStops(){return this.Wo}set colorStops(t){this.u&&e.L(this,t),this.Wo=t,this.Nn=null}get pattern(){return this.S0}set pattern(t){this.u&&e.L(this,t),this.S0=t,this.Nn=null}static randomColor(t,e){void 0===t&&(t=128),void 0===e&&(e=Math.max(t,255));const i=Math.abs(e-t);let s=Math.floor(t+Math.random()*i).toString(16),n=Math.floor(t+Math.random()*i).toString(16),o=Math.floor(t+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(e){return!t.CSS||t.CSS.supports("color",e)}static lighten(t){return Ut.lightenBy(t)}lightenBy(t,i){this.u&&e.L(this);const s=void 0===t||"number"!=typeof t?.2:t,n=void 0===i?3:i;if(1===this.type)Ut.Eo(this.color),this.color=Ut.Ld(s,n);else if((2===this.type||3===this.type)&&null!==this.colorStops){const t=this.colorStops.iterator;for(;t.next();)Ut.Eo(t.value),this.addColorStop(t.key,Ut.Ld(s,n))}return this}static lightenBy(t,e,i){const s=void 0===e||"number"!=typeof e?.2:e,n=void 0===i?3:i;return Ut.Eo(t),Ut.Ld(s,n)}static darken(t){return Ut.darkenBy(t)}darkenBy(t,i){this.u&&e.L(this);const s=void 0===t||"number"!=typeof t?.2:t,n=void 0===i?3:i;if(1===this.type)Ut.Eo(this.color),this.color=Ut.Ld(-s,n);else if((2===this.type||3===this.type)&&null!==this.colorStops){const t=this.colorStops.iterator;for(;t.next();)Ut.Eo(t.value),this.addColorStop(t.key,Ut.Ld(-s,n))}return this}static darkenBy(t,e,i){const s=void 0===e||"number"!=typeof e?.2:e,n=void 0===i?3:i;return Ut.Eo(t),Ut.Ld(-s,n)}static mix(t,e,i){Ut.Eo(t);const s=Ut.Y.n0,n=Ut.Y.n1,o=Ut.Y.n2,r=Ut.Y.n3;Ut.Eo(e),void 0===i&&(i=.5);return`rgba(${Math.round((Ut.Y.n0-s)*i+s)}, ${Math.round((Ut.Y.n1-n)*i+n)}, ${Math.round((Ut.Y.n2-o)*i+o)}, ${Math.round((Ut.Y.n3-r)*i+r)})`}isDark(){if(1===this.type)return Ut.isDark(this.color);if((2===this.type||3===this.type)&&null!==this.colorStops){const t=this.colorStops;if(3===this.type){const e=t.first();return!!e&&Ut.isDark(e.value)}if(null!==t.get(.5))return Ut.isDark(t.get(.5));if(2===t.count){const e=t.toArray();return Ut.isDark(Ut.mix(e[0].value,e[1].value))}const e=t.iterator;let i=-1,s=-1,n=1,o=1;for(;e.next();){const t=e.key,r=Math.abs(.5-e.key);n>o&&r<n?(i=t,n=r):o>=n&&r<o&&(s=t,o=r)}if(i>s){let t=i;i=s,s=t,t=n,n=o,o=t}const r=s-i;return Ut.isDark(Ut.mix(t.get(i),t.get(s),1-o/r))}return!1}static isDark(t){return!!t&&(t instanceof Ut?t.isDark():(Ut.Eo(t),(299*Ut.Y.n0+587*Ut.Y.n1+114*Ut.Y.n2)/1e3<128))}static Ld(t,i){switch(i){case 1:return Ut.SI(),Ut.ho.n0=Math.min(100,Math.max(0,Ut.ho.n0+100*t)),Ut.MI(),"rgba("+Ut.Y.n0+", "+Ut.Y.n1+", "+Ut.Y.n2+", "+Ut.Y.n3+")";case 2:return Ut.IM(),Ut.ze.n2=Math.min(100,Math.max(0,Ut.ze.n2+100*t)),"hsla("+Ut.ze.n0+", "+Ut.ze.n1+"%, "+Ut.ze.n2+"%, "+Ut.ze.n3+")";case 3:return Ut.NI(),Ut.co.n0=Math.min(100,Math.max(0,Ut.co.n0+100*t)),Ut.CI(),"rgba("+Ut.Y.n0+", "+Ut.Y.n1+", "+Ut.Y.n2+", "+Ut.Y.n3+")";default:e.o("Unknown color space: "+i)}}static Eo(t){!1===Ut.M0&&(Ut.M0=!0,Ut.us=wt.isUsingDOM()?new Et(null,void 0,{willReadFrequently:!0})._t:null);const e=Ut.us;if(null===e)return;e.clearRect(0,0,1,1),e.fillStyle="#000000";const i=e.fillStyle;if(e.fillStyle=t,e.fillStyle!==i){e.fillRect(0,0,1,1);const t=e.getImageData(0,0,1,1).data;Ut.Y.n0=t[0],Ut.Y.n1=t[1],Ut.Y.n2=t[2],Ut.Y.n3=t[3]/255}else{e.fillStyle="#FFFFFF";e.fillStyle;e.fillStyle=t,e.fillStyle,Ut.Y.n0=0,Ut.Y.n1=0,Ut.Y.n2=0,Ut.Y.n3=1}}static IM(){const t=Ut.Y.n0/255,e=Ut.Y.n1/255,i=Ut.Y.n2/255,s=Math.max(t,e,i),n=Math.min(t,e,i),o=s-n;let r,a;const h=(s+n)/2;if(0===o)r=a=0;else{switch(s){case t:r=(e-i)/o%6;break;case e:r=(i-t)/o+2;break;case i:r=(t-e)/o+4;break;default:r=0}r*=60,r<0&&(r+=360),a=o/(1-Math.abs(2*h-1))}Ut.ze.n0=Math.round(r),Ut.ze.n1=Math.round(100*a),Ut.ze.n2=Math.round(100*h),Ut.ze.n3=Ut.Y.n3}static VU(){const t=Ut.ze.n0,e=Ut.ze.n1/100,i=Ut.ze.n2/100;let s,n,o;const r=(1-Math.abs(2*i-1))*e,a=t/60,h=r*(1-Math.abs(a%2-1));a>=0&&a<1?(s=r,n=h,o=0):a>=1&&a<2?(s=h,n=r,o=0):a>=2&&a<3?(s=0,n=r,o=h):a>=3&&a<4?(s=0,n=h,o=r):a>=4&&a<5?(s=h,n=0,o=r):(s=r,n=0,o=h);const l=i-.5*r;s+=l,n+=l,o+=l,Ut.Y.n0=Math.round(255*s),Ut.Y.n1=Math.round(255*n),Ut.Y.n2=Math.round(255*o),Ut.Y.n3=Ut.ze.n3}static SI(){Ut.aD(),Ut.LI()}static MI(){Ut.AI(),Ut.hD()}static VN(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}static BN(t){return t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055}static aD(){const t=Ut.VN(Ut.Y.n0),e=Ut.VN(Ut.Y.n1),i=Ut.VN(Ut.Y.n2);Ut.At.n0=.4124564*t+.3575761*e+.1804375*i,Ut.At.n1=.2126729*t+.7151522*e+.072175*i,Ut.At.n2=.0193339*t+.119192*e+.9503041*i,Ut.At.n3=Ut.Y.n3}static hD(){const t=3.2404542*Ut.At.n0+-1.5371385*Ut.At.n1+-.4985314*Ut.At.n2,e=-.969266*Ut.At.n0+1.8760108*Ut.At.n1+.041556*Ut.At.n2,i=.0556434*Ut.At.n0+-.2040259*Ut.At.n1+1.0572252*Ut.At.n2;Ut.Y.n0=255*Ut.BN(t),Ut.Y.n1=255*Ut.BN(e),Ut.Y.n2=255*Ut.BN(i),Ut.Y.n3=Ut.At.n3,Ut.Y.n0=Math.round(Ut.Y.n0),Ut.Y.n0>255?Ut.Y.n0=255:Ut.Y.n0<0&&(Ut.Y.n0=0),Ut.Y.n1=Math.round(Ut.Y.n1),Ut.Y.n1>255?Ut.Y.n1=255:Ut.Y.n1<0&&(Ut.Y.n1=0),Ut.Y.n2=Math.round(Ut.Y.n2),Ut.Y.n2>255?Ut.Y.n2=255:Ut.Y.n2<0&&(Ut.Y.n2=0)}static zN=216/24389;static q1=24389/27;static Ad=[95.047,100,108.883];static XN(t){return t>Ut.zN?Math.pow(t,1/3):(Ut.q1*t+16)/116}static LI(){const t=Ut.XN(100*Ut.At.n0/Ut.Ad[0]),e=Ut.XN(100*Ut.At.n1/Ut.Ad[1]),i=Ut.XN(100*Ut.At.n2/Ut.Ad[2]);Ut.ho.n0=116*e-16,Ut.ho.n1=500*(t-e),Ut.ho.n2=200*(e-i),Ut.ho.n3=Ut.At.n3}static cD(t){const e=t*t*t;return e>Ut.zN?e:(116*t-16)/Ut.q1}static AI(){const t=(Ut.ho.n0+16)/116,e=Ut.ho.n1/500+t,i=t-Ut.ho.n2/200;Ut.At.n0=Ut.Ad[0]/100*Ut.cD(e),Ut.At.n1=Ut.Ad[1]/100*(Ut.ho.n0>Ut.q1*Ut.zN?Math.pow(t,3):Ut.ho.n0/Ut.q1),Ut.At.n2=Ut.Ad[2]/100*Ut.cD(i),Ut.At.n3=Ut.ho.n3}static TI(){let t=.8190224*Ut.At.n0+.3619062*Ut.At.n1+-.1288737*Ut.At.n2,e=.03298366*Ut.At.n0+.9292868*Ut.At.n1+.03614466*Ut.At.n2,i=.04817719*Ut.At.n0+.2642395*Ut.At.n1+.6335478*Ut.At.n2;t=Math.cbrt(t),e=Math.cbrt(e),i=Math.cbrt(i),Ut.ge.n0=.2104542*t+.7936177*e+-.004072046*i,Ut.ge.n1=1.977998*t+-2.428592*e+.4505937*i,Ut.ge.n2=.02590403*t+.7827717*e+-.8086757*i,Ut.ge.n3=Ut.At.n3,Ut.ge.n0*=100}static DI(){Ut.ge.n0/=100;let t=.9999999*Ut.ge.n0+.3963377*Ut.ge.n1+.2158037*Ut.ge.n2,e=1.000000009*Ut.ge.n0+-.1055613*Ut.ge.n1+-.06385417*Ut.ge.n2,i=1.00000005*Ut.ge.n0+-.08948418*Ut.ge.n1+-1.291485*Ut.ge.n2;t=t**3,e=e**3,i=i**3,Ut.At.n0=1.2268798*t+-.5578149*e+.281391*i,Ut.At.n1=-.04057576*t+1.112286*e+-.07171106*i,Ut.At.n2=-.07637294*t+-.4214933*e+1.586924*i,Ut.At.n3=Ut.ge.n3}static vI(){const t=180*Math.atan2(Ut.ge.n2,Ut.ge.n1)/Math.PI;Ut.co.n0=Ut.ge.n0,Ut.co.n1=Math.sqrt(Ut.ge.n1**2+Ut.ge.n2**2),Ut.co.n2=t>=0?t:t+360,Ut.co.n3=Ut.ge.n3}static FI(){Ut.ge.n0=Ut.co.n0,Ut.ge.n1=Ut.co.n1*Math.cos(Ut.co.n2*Math.PI/180),Ut.ge.n2=Ut.co.n1*Math.sin(Ut.co.n2*Math.PI/180),Ut.ge.n3=Ut.co.n3}static NI(){Ut.aD(),Ut.TI(),Ut.vI()}static CI(){Ut.FI(),Ut.DI(),Ut.hD()}static Md(t,i){"string"==typeof t||t instanceof Ut||e.o("Value for "+i+" must be a color string or a Brush, not "+t)}static Solid=1;static Linear=2;static Radial=3;static Pattern=4;static Lab=1;static HSL=2;static us=null;static M0=!1;static Y=new Xt;static ze=new Xt;static At=new Xt;static ho=new Xt;static ge=new Xt;static co=new Xt}class jt{Pt="Base";static fs=new p;static An(t,e){e.name=t,jt.fs.set(t,e)}get name(){return this.Pt}set name(t){this.Pt=t}constructor(){}get classType(){return Yt}measure(t,e,i,s,n,o,r){}measureElement(t,e,i,s,n){t.ht(e,i,s,n)}arrange(t,e,i){}arrangeElement(t,e,i,s,n,o){t.Ut(e,i,s,n,o)}remeasureObject(t){t.bf()}Ge(t,e,i){}}jt.An("Position",new class extends jt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=s.length,h=t.Jo();for(let t=0;t<a;t++){const a=s[t];if(!a.visible&&a!==h)continue;const l=a.margin,u=l.right+l.left,c=l.top+l.bottom;a.ht(e,i,o,r);const d=a.measuredBounds,g=Math.max(d.width+u,0),f=Math.max(d.height+c,0);let m=a.position.x,p=a.position.y;if(isFinite(m)||(m=0),isFinite(p)||(p=0),a instanceof $t&&a.isGeometryPositioned){const t=a.strokeWidth/2;m-=t,p-=t}n.re(m,p,g,f)}}arrange(t,e,i){const s=e.length,n=t.padding,o=i.x-n.left,r=i.y-n.top;for(let t=0;t<s;t++){const i=e[t],s=i.measuredBounds,n=i.margin,a=i.position.x,h=i.position.y;let l=isNaN(a)?-o:a-o,u=isNaN(h)?-r:h-r;if(i instanceof $t&&i.isGeometryPositioned){const t=i.strokeWidth/2;l-=t,u-=t}i.visible&&i.Ut(l+n.left,u+n.top,s.width,s.height)}}});jt.An("Horizontal",new class extends jt{constructor(){super()}measure(t,i,s,n,o,r,a){const h=n.length,l=e.nt(),u=t.Jo();for(let t=0;t<h;t++){const e=n[t];if(!e.visible&&e!==u)continue;const i=e.Zs(!1);if(0!==i&&5!==i){l.push(e);continue}e.ht(1/0,s,0,a);const r=e.margin,h=e.measuredBounds,c=Math.max(h.width+r.right+r.left,0),d=Math.max(h.height+r.top+r.bottom,0);o.Hn(o.width+c,Math.max(o.height,d))}const c=l.length;t.desiredSize.height?s=Math.min(t.desiredSize.height,t.maxSize.height):0!==o.height&&(s=Math.min(o.height,t.maxSize.height));for(let t=0;t<c;t++){const e=l[t];if(!e.visible&&e!==u)continue;const i=e.margin,n=i.right+i.left,r=i.top+i.bottom;e.ht(1/0,s,0,a);const h=e.measuredBounds,c=Math.max(h.width+n,0),d=Math.max(h.height+r,0);o.width+=c,o.height=Math.max(o.height,d)}e.Z(l)}arrange(t,e,i){const s=e.length,n=t.padding,o=n.top,r=t.isOpposite;let a=r?i.width:n.left;for(let h=0;h<s;h++){const s=o,l=e[h];if(!l.visible)continue;const u=l.measuredBounds,c=l.margin,d=c.top+c.bottom,g=o+n.bottom;let f=u.height;const m=l.Zs(!1);(isNaN(l.desiredSize.height)&&2===m||4===m)&&(f=Math.max(i.height-d-g,0));const p=f+d+g;let y=l.alignment;y.isDefault()&&(y=t.defaultAlignment),y.isSpot()||(y=v.Center),r&&(a-=u.width+c.left+c.right),l.Ut(a+y.offsetX+c.left,s+y.offsetY+c.top+(i.height*y.y-p*y.y),u.width,f),r||(a+=u.width+c.left+c.right)}}});jt.An("Vertical",new class extends jt{constructor(){super()}measure(t,i,s,n,o,r,a){const h=n.length,l=e.nt(),u=t.Jo();for(let t=0;t<h;t++){const e=n[t];if(!e.visible&&e!==u)continue;const s=e.Zs(!1);if(0!==s&&4!==s){l.push(e);continue}e.ht(i,1/0,r,0);const a=e.margin,h=e.measuredBounds,c=Math.max(h.width+a.right+a.left,0),d=Math.max(h.height+a.top+a.bottom,0);o.Hn(Math.max(o.width,c),o.height+d)}const c=l.length;t.desiredSize.width?i=Math.min(t.desiredSize.width,t.maxSize.width):0!==o.width&&(i=Math.min(o.width,t.maxSize.width));for(let t=0;t<c;t++){const e=l[t];if(!e.visible&&e!==u)continue;const s=e.margin,n=s.right+s.left,a=s.top+s.bottom;e.ht(i,1/0,r,0);const h=e.measuredBounds,c=Math.max(h.width+n,0),d=Math.max(h.height+a,0);o.width=Math.max(o.width,c),o.height+=d}e.Z(l)}arrange(t,e,i){const s=e.length,n=t.padding,o=n.left,r=t.isOpposite;let a=r?i.height:n.top;for(let h=0;h<s;h++){const s=o,l=e[h];if(!l.visible)continue;const u=l.measuredBounds,c=l.margin,d=c.left+c.right,g=o+n.right;let f=u.width;const m=l.Zs(!1);(isNaN(l.desiredSize.width)&&2===m||5===m)&&(f=Math.max(i.width-d-g,0));const p=f+d+g;let y=l.alignment;y.isDefault()&&(y=t.defaultAlignment),y.isSpot()||(y=v.Center),r&&(a-=u.height+c.bottom+c.top),l.Ut(s+y.offsetX+c.left+(i.width*y.x-p*y.x),a+y.offsetY+c.top,f,u.height),r||(a+=u.height+c.bottom+c.top)}}});class Gt extends jt{constructor(){super()}static fD=!1;measure(t,i,s,n,o,r,a){const h=n.length;if(0===h)return;const l=t.findMainElement();let u=l.margin,c=0,d=0;const g=u.right+u.left,f=u.top+u.bottom;l.ht(i,s,r,a);let m=l.measuredBounds,p=m.width,x=m.height,b=Math.max(p+g,0),P=Math.max(x+f,0);const k=t.isClipping;k&&0!==l.qp()&&!Gt.fD&&(Gt.fD=!0,e.ne("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+t.toString()));const S=w.z(-u.left,-u.top,b,P);let M=w.z(0,0,p,x);this.GN(l,M,!0),p=M.width,x=M.height;let C=!0;const N=t.Jo();let T;for(let e=0;e<h;e++){const r=n[e];let a=i,h=s;if(r===l||!r.visible&&r!==N)continue;u=r.margin;let g=u.left,f=u.top;switch(c=u.right+u.left,d=u.top+u.bottom,T=r.Zs(!1),T){case 2:a=p,h=x,c=0,d=0,g=0,f=0;break;case 5:a=p,c=0,g=0;break;case 4:h=x,d=0,f=0}r.ht(a,h,0,0),m=r.measuredBounds,b=Math.max(m.width+c,0),P=Math.max(m.height+d,0);let w=r.alignment;w.isDefault()&&(w=t.defaultAlignment),w.isSpot()||(w=v.Center);let k=r.alignmentFocus;k.isDefault()&&(k=v.Center);let S=null;r instanceof Yt&&""!==r.fo&&(S=r.findObject(r.fo),S===r&&(S=null));let L=M.x-g,A=M.y-f;if(null!==S){r.Ut(0,0,m.width,m.height);const t=S.actualBounds,e=y.z(t.x+(k.x*t.width-k.offsetX),t.y+(k.y*t.height-k.offsetY));for(S=S.panel;null!==S&&S!==r;)S.v.gt(e),S=S.panel;L+=w.x*p+w.offsetX-e.x,A+=w.y*x+w.offsetY-e.y,y.i(e)}else L+=w.x*p+w.offsetX-(k.x*m.width+k.offsetX),A+=w.y*x+w.offsetY-(k.y*m.height+k.offsetY);C?(C=!1,o.e(L,A,b,P)):o.re(L,A,b,P)}switch(C?o.h(S):k?o.intersect(M.x,M.y,M.width,M.height):o.re(S.x,S.y,S.width,S.height),w.i(S),w.i(M),T=l.stretch,1===T&&(T=l.Zs(!1)),T){case 0:return;case 2:if(!isFinite(i)&&!isFinite(s))return;break;case 5:if(!isFinite(i))return;break;case 4:if(!isFinite(s))return}m=l.measuredBounds,p=m.width,x=m.height,b=Math.max(p+g,0),P=Math.max(x+f,0),u=l.margin,M=w.z(-u.left,-u.top,b,P),this.GN(l,M,!0),p=M.width,x=M.height;for(let e=0;e<h;e++){const i=n[e];if(i===l||!i.visible&&i!==N)continue;u=i.margin,c=u.right+u.left,d=u.top+u.bottom,m=i.measuredBounds,b=Math.max(m.width+c,0),P=Math.max(m.height+d,0);let s=i.alignment;s.isDefault()&&(s=t.defaultAlignment),s.isSpot()||(s=v.Center);let r=i.alignmentFocus;r.isDefault()&&(r=v.Center),C?(C=!1,o.e(s.x*p+s.offsetX-(r.x*m.width+r.offsetX)-u.left,s.y*x+s.offsetY-(r.y*m.height+r.offsetY)-u.top,b,P)):o.re(s.x*p+s.offsetX-(r.x*m.width+r.offsetX)-u.left,s.y*x+s.offsetY-(r.y*m.height+r.offsetY)-u.top,b,P)}C?o.h(S):k?o.intersect(M.x,M.y,M.width,M.height):o.re(S.x,S.y,S.width,S.height),w.i(M)}arrange(t,e,i){const s=e.length;if(0===s)return;const n=t.findMainElement(),o=n.measuredBounds,r=o.width,a=o.height,h=t.padding,l=h.left,u=h.top;let c=l-i.x,d=u-i.y;n.Ut(c,d,r,a);const g=w.z(0,0,r,a);this.GN(n,g,!1);for(let o=0;o<s;o++){const s=e[o];if(s===n)continue;const r=s.measuredBounds,a=r.width,h=r.height;let f=s.alignment;f.isDefault()&&(f=t.defaultAlignment),f.isSpot()||(f=v.Center);let m=s.alignmentFocus;m.isDefault()&&(m=v.Center);let p=null;if(s instanceof Yt&&""!==s.fo&&(p=s.findObject(s.fo),p===s&&(p=null)),null!==p){const t=p.actualBounds,e=y.z(t.x+(m.x*t.width-m.offsetX),t.y+(m.y*t.height-m.offsetY));for(p=p.panel;null!==p&&p!==s;)p.v.gt(e),p=p.panel;c=f.x*g.width+f.offsetX-e.x,d=f.y*g.height+f.offsetY-e.y,y.i(e)}else c=f.x*g.width+f.offsetX-(m.x*a+m.offsetX),d=f.y*g.height+f.offsetY-(m.y*h+m.offsetY);c+=g.x-i.x,d+=g.y-i.y,s.visible&&s.Ut(l+c,u+d,a,h)}w.i(g)}GN(t,e,i){let s=null;if(t instanceof Yt&&""!==t.fo&&(s=t.findObject(t.fo),s===t&&(s=null)),null!==s)for(i&&t.Ut(0,0,e.width,e.height),e.h(s.actualBounds),s=s.panel;null!==s&&s!==t;)s.v.sm(e),s=s.panel}}jt.An("Spot",new Gt);jt.An("Auto",new class extends jt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=s.length;if(0===a)return;const h=t.findMainElement();let l=h.margin,u=e,c=i;const d=l.right+l.left,g=l.top+l.bottom;h.ht(e,i,o,r);let f=h.measuredBounds,m=0,p=null;h instanceof $t&&(p=h,m=p.strokeWidth*p.scale);let y=Math.max(f.width+d,0),w=Math.max(f.height+g,0),b=t.YN(h);const v=b.x*y+b.offsetX,P=b.y*w+b.offsetY;let k=t.KN(h);const S=k.x*y+k.offsetX,M=k.y*w+k.offsetY;isFinite(e)&&(u=Math.max(Math.abs(v-S)-m,0)),isFinite(i)&&(c=Math.max(Math.abs(P-M)-m,0));let C=0,N=0;o>0&&(C=Math.max(Math.abs(b.x*o+b.offsetX-(k.x*o+k.offsetX))-m,0)),r>0&&(N=Math.max(Math.abs(b.y*r+b.offsetY-(k.y*r+k.offsetY))-m,0));const T=x.l();T.e(0,0);const L=t.Jo();for(let t=0;t<a;t++){const e=s[t];if(e===h||!e.visible&&e!==L)continue;l=e.margin;const i=l.right+l.left,n=l.top+l.bottom;e.ht(u,c,C,N),f=e.measuredBounds,y=Math.max(f.width+i,0),w=Math.max(f.height+n,0),T.e(Math.max(y,T.width),Math.max(w,T.height))}if(1===a)return f=h.measuredBounds,n.width=y,n.height=w,void x.i(T);b=t.YN(h),k=t.KN(h);let A=0,D=0;k.x!==b.x&&k.y!==b.y&&(A=T.width/Math.abs(k.x-b.x),D=T.height/Math.abs(k.y-b.y)),x.i(T),m=0,null!==p&&(m=p.strokeWidth*p.scale,6===p.tM()&&(A=D=Math.max(A,D))),A+=Math.abs(b.offsetX)+Math.abs(k.offsetX)+m,D+=Math.abs(b.offsetY)+Math.abs(k.offsetY)+m;let F=h.stretch;switch(1===F&&(F=h.Zs(!1)),F){case 0:o=0,r=0;break;case 2:isFinite(e)&&(A=e),isFinite(i)&&(D=i);break;case 5:isFinite(e)&&(A=e),r=0;break;case 4:o=0,isFinite(i)&&(D=i)}h.bf(),h.ht(A,D,o,r),n.width=h.measuredBounds.width+d,n.height=h.measuredBounds.height+g}arrange(t,e,i){const s=e.length;if(0===s)return;const n=t.findMainElement(),o=n.measuredBounds,r=w.l();r.e(0,0,1,1);let a=n.margin;const h=a.left,l=a.top,u=t.padding,c=u.left,d=u.top;let g=h,f=l,m=o.width,p=o.height;n.Ut(c+g,d+f,m,p);const y=t.YN(n),x=t.KN(n),b=0+y.x*o.width+y.offsetX,P=0+y.y*o.height+y.offsetY,k=0+x.x*o.width+x.offsetX,S=0+x.y*o.height+x.offsetY;r.x=b,r.y=P,r.re(k,S,0,0),r.x+=h+c,r.y+=l+d;for(let i=0;i<s;i++){const s=e[i];if(s===n)continue;const o=s.measuredBounds;a=s.margin;const h=Math.max(o.width+a.right+a.left,0),l=Math.max(o.height+a.top+a.bottom,0);let u=s.alignment;u.isDefault()&&(u=t.defaultAlignment),u.isSpot()||(u=v.Center),g=r.width*u.x+u.offsetX-h*u.x+a.left+r.x,f=r.height*u.y+u.offsetY-l*u.y+a.top+r.y,m=r.width,p=r.height,s.visible&&(w.contains(r.x,r.y,r.width,r.height,g,f,o.width,o.height)?s.Ut(g,f,o.width,o.height):s.Ut(g,f,o.width,o.height,new w(r.x,r.y,r.width,r.height)))}w.i(r)}});jt.An("Table",new class extends jt{constructor(){super(),this.name="Table"}measure(t,i,s,n,o,r,a){let h=n.length;const l=e.nt(),u=e.nt();for(let t=0;t<h;t++){const e=n[t],i=e instanceof Yt?e:null;if(null!==i&&i.nl()&&e.visible){u.push(i);const t=i.D.r,s=t.length;for(let n=0;n<s;n++){const s=t[n];i.type===Yt.TableRow?s.row=e.row:i.type===Yt.TableColumn&&(s.column=e.column),l.push(s)}}else l.push(e)}h=l.length,0===h&&(t.getRowDefinition(0),t.getColumnDefinition(0));const c=[];for(let t=0;t<h;t++){const e=l[t];e.visible&&(e.xi(!0),e.lo(!0),c[e.row]||(c[e.row]=[]),c[e.row][e.column]||(c[e.row][e.column]=[]),c[e.row][e.column].push(e))}e.Z(l);const d=e.nt(),g=e.nt(),f=e.nt(),m={count:0},p={count:0};let y=i,w=s;const b=t.Zi,v=t.Qi;let P;h=b.length;for(let t=0;t<h;t++)P=b[t],void 0!==P&&(P.actual=0,P.Re=0);h=v.length;for(let t=0;t<h;t++)P=v[t],void 0!==P&&(P.actual=0,P.Re=0);let k=c.length,S=0;for(let t=0;t<k;t++)c[t]&&(S=Math.max(S,c[t].length));const M=Math.min(t.topIndex,k-1),C=Math.min(t.leftIndex,S-1);let N,T=0;k=c.length;const L=t.Jo();for(let e=0;e<k;e++){if(!c[e])continue;S=c[e].length;const i=t.getRowDefinition(e);i.actual=0,i.Re=0;for(let s=0;s<S;s++){if(!c[e][s])continue;const n=t.getColumnDefinition(s);void 0===d[s]&&(n.actual=0,n.Re=0,d[s]=!0);const o=c[e][s],r=o.length;for(let a=0;a<r;a++){const r=o[a];if(!r.visible&&r!==L)continue;const h=r.rowSpan>1,l=r.columnSpan>1;(h||l)&&!(e<M)&&!(s<C)&&g.push(r);const u=r.margin,c=u.right+u.left,d=u.top+u.bottom;N=r.Qp(i,n,!1);const x=r.desiredSize,b=!isNaN(x.width),v=!isNaN(x.height);if(0!==N&&!(b&&v)&&!(e<M)&&!(s<C)&&(!l&&void 0===m[s]&&(2===N||5===N)&&(m[s]=-1,m.count++),!h&&void 0===p[e]&&(2===N||4===N)&&(p[e]=-1,p.count++),!h&&!l&&f.push(r)),r.ht(1/0,1/0,0,0),e<M||s<C)continue;const k=r.measuredBounds,S=Math.max(k.width+c,0),A=Math.max(k.height+d,0);if(1===r.rowSpan&&(0===N||5===N)){P=t.getRowDefinition(e);const i=P.computeEffectiveSpacing(),s=0===P.q;T=Math.max(A-P.actual,0),T+(s?i:0)>w&&(T=Math.max(w-i,0)),P.Re=P.Re+T,P.actual=P.q+T,w=Math.max(w-(T+(s?i:0)),0)}if(1===r.columnSpan&&(0===N||4===N)){P=t.getColumnDefinition(s);const e=P.computeEffectiveSpacing(),i=0===P.q;T=Math.max(S-P.actual,0),T+(i?e:0)>y&&(T=Math.max(y-e,0)),P.Re=P.Re+T,P.actual=P.q+T,y=Math.max(y-(T+(i?e:0)),0)}(h||l)&&r.bf()}}}e.Z(d);let A=0,D=0;h=t.columnCount;for(let t=0;t<h;t++){const e=v[t];void 0!==e&&(A+=isNaN(e.ki)?e.Re:e.ki,0!==e.Re&&(A+=e.computeEffectiveSpacing()))}h=t.rowCount;for(let t=0;t<h;t++){const e=b[t];void 0!==e&&(D+=isNaN(e.ki)?e.Re:e.ki,0!==e.Re&&(D+=e.computeEffectiveSpacing()))}y=Math.max(i-A,0),w=Math.max(s-D,0);let F=w,O=y;h=f.length;for(let e=0;e<h;e++){const i=f[e],s=t.getRowDefinition(i.row),n=t.getColumnDefinition(i.column),o=i.measuredBounds,r=i.margin,a=r.right+r.left,h=r.top+r.bottom;0===n.Re&&void 0!==m[i.column]?m[i.column]=Math.max(o.width+a,m[i.column]):m[i.column]=null,0===s.Re&&void 0!==p[i.row]?p[i.row]=Math.max(o.height+h,p[i.row]):p[i.row]=null}let R,B=0,E=0;for(R in p)"count"!==R&&(B+=p[R]);for(R in m)"count"!==R&&(E+=m[R]);const I=x.l();for(let e=0;e<h;e++){const i=f[e];if(!i.visible&&i!==L)continue;const s=t.getRowDefinition(i.row),n=t.getColumnDefinition(i.column);let o=0;isFinite(n.width)?o=n.width:(o=isFinite(y)&&null!==m[i.column]?0===E?n.actual+y:m[i.column]/E*O:null!==m[i.column]?y:n.actual||y,o=Math.max(0,o-n.computeEffectiveSpacing()));let r=0;switch(isFinite(s.height)?r=s.height:(r=isFinite(w)&&null!==p[i.row]?0===B?s.actual+w:p[i.row]/B*F:null!==p[i.row]?w:s.actual||w,r=Math.max(0,r-s.computeEffectiveSpacing())),I.e(Math.max(n.minimum,Math.min(o,n.maximum)),Math.max(s.minimum,Math.min(r,s.maximum))),N=i.Qp(s,n,!1),N){case 5:I.height=Math.max(I.height,s.actual+w);break;case 4:I.width=Math.max(I.width,n.actual+y)}const a=i.margin,h=a.right+a.left,l=a.top+a.bottom;i.bf();let u=n.minimum,c=s.minimum;const d=i.measuredBounds;0===d.width&&null!==m[i.column]&&(u=Math.max(u,m[i.column])),0===d.height&&null!==p[i.row]&&(c=Math.max(u,p[i.row])),i.ht(I.width,I.height,u,c);const g=i.measuredBounds;let x=Math.max(g.width+h,0),b=Math.max(g.height+l,0);isFinite(y)&&(x=Math.min(x,I.width)),isFinite(w)&&(b=Math.min(b,I.height));let v=0;v=s.actual,s.actual=Math.max(s.actual,b),s.Re=Math.max(s.Re,b),T=s.actual-v,w=Math.max(w-T,0),null===p[i.row]&&(F=Math.max(F-T,0)),v=n.actual,n.actual=Math.max(n.actual,x),n.Re=Math.max(n.Re,x),T=n.actual-v,y=Math.max(y-T,0),null===m[i.column]&&(O=Math.max(O-T,0))}e.Z(f);const V=x.l(),z=e.nt(),X=e.nt();if(h=g.length,0!==h)for(let e=0;e<k;e++){if(!c[e])continue;S=c[e].length;const i=t.getRowDefinition(e);z[e]=i.actual;for(let i=0;i<S;i++){if(!c[e][i])continue;const s=t.getColumnDefinition(i);X[i]=s.actual}}for(let e=0;e<h;e++){const n=g[e];if(!n.visible&&n!==L)continue;const o=t.getRowDefinition(n.row),r=t.getColumnDefinition(n.column);switch(I.e(Math.max(r.minimum,Math.min(i,r.maximum)),Math.max(o.minimum,Math.min(s,o.maximum))),N=n.Qp(o,r,!1),N){case 2:0!==X[r.index]&&(I.width=Math.min(I.width,X[r.index])),0!==z[o.index]&&(I.height=Math.min(I.height,z[o.index]));break;case 5:0!==X[r.index]&&(I.width=Math.min(I.width,X[r.index]));break;case 4:0!==z[o.index]&&(I.height=Math.min(I.height,z[o.index]))}isFinite(r.width)&&(I.width=r.width),isFinite(o.height)&&(I.height=o.height),V.e(0,0);let a=r.minimum,h=o.minimum;for(let e=1;e<n.rowSpan&&!(n.row+e>=t.rowCount);e++){if(P=t.getRowDefinition(n.row+e),T=0,2===N||4===N){if(0===P.q)continue;T=Math.max(P.minimum,0===P.q?P.maximum:Math.min(P.q,P.maximum))}else T=Math.max(P.minimum,isNaN(P.ki)?P.maximum:Math.min(P.ki,P.maximum));V.height+=T,h+=P.minimum}for(let e=1;e<n.columnSpan&&!(n.column+e>=t.columnCount);e++){if(P=t.getColumnDefinition(n.column+e),T=0,2===N||5===N){if(0===P.q)continue;T=Math.max(P.minimum,0===P.q?P.maximum:Math.min(P.q,P.maximum))}else T=Math.max(P.minimum,isNaN(P.ki)?P.maximum:Math.min(P.ki,P.maximum));V.width+=T,a+=P.minimum}I.width+=V.width,I.height+=V.height;const l=n.margin,u=l.right+l.left,c=l.top+l.bottom;n.ht(I.width,I.height,a,h);const d=n.measuredBounds,f=Math.max(d.width+u,0),m=Math.max(d.height+c,0);let p=0;for(let e=0;e<n.rowSpan&&!(n.row+e>=t.rowCount);e++)P=t.getRowDefinition(n.row+e),p+=P.total||0;if(p<m){let e=m-p;const i=m-p;if(null!==n.spanAllocation){const s=n.spanAllocation;for(let o=0;o<n.rowSpan&&!(e<=0||n.row+o>=t.rowCount);o++){P=t.getRowDefinition(n.row+o);const r=P.q||0,a=s(n,P,i);P.actual=Math.min(P.maximum,r+a),P.q!==r&&(e-=P.q-r)}}for(;e>0&&void 0!==P;){const i=P.q||0;if(isNaN(P.height)&&P.maximum>i&&(P.actual=Math.min(P.maximum,i+e),P.q!==i&&(e-=P.q-i)),0===P.index)break;P=t.getRowDefinition(P.index-1)}}let y=0;for(let e=0;e<n.columnSpan&&!(n.column+e>=t.columnCount);e++)P=t.getColumnDefinition(n.column+e),y+=P.total||0;if(y<f){let e=f-y;const i=f-y;if(null!==n.spanAllocation){const s=n.spanAllocation;for(let o=0;o<n.columnSpan&&!(e<=0||n.column+o>=t.columnCount);o++){P=t.getColumnDefinition(n.column+o);const r=P.q||0,a=s(n,P,i);P.actual=Math.min(P.maximum,r+a),P.q!==r&&(e-=P.q-r)}}for(;e>0&&void 0!==P;){const i=P.q||0;if(isNaN(P.width)&&P.maximum>i&&(P.actual=Math.min(P.maximum,i+e),P.q!==i&&(e-=P.q-i)),0===P.index)break;P=t.getColumnDefinition(P.index-1)}}}e.Z(g),x.i(V),x.i(I),void 0!==z&&e.Z(z),void 0!==X&&e.Z(X);let U=0,j=0;const G=t.desiredSize,K=t.maxSize;N=t.Zs(!0),A=0,D=0;let Y=0,q=0;h=t.columnCount;for(let e=0;e<h;e++)if(void 0!==v[e]){if(P=t.getColumnDefinition(e),isFinite(P.width)){Y+=P.width,Y+=P.computeEffectiveSpacing();continue}if(2===P.j1()){Y+=P.q,Y+=P.computeEffectiveSpacing();continue}0!==P.q&&(A+=P.q,A+=P.computeEffectiveSpacing())}U=isFinite(G.width)?Math.min(G.width,K.width):0!==N&&isFinite(i)?i:A,U=Math.max(U,isFinite(i)?Math.min(r,i):r),U=Math.max(U-Y,0);const H=0===A?1:Math.max(U/A,1);for(let e=0;e<h;e++)void 0!==v[e]&&(P=t.getColumnDefinition(e),!isFinite(P.width)&&2!==P.j1()&&(P.actual=P.q*H),P.position=o.width,0!==P.q&&(o.width+=P.q,o.width+=P.computeEffectiveSpacing()));h=t.rowCount;for(let e=0;e<h;e++)if(void 0!==b[e]){if(P=t.getRowDefinition(e),isFinite(P.height)){q+=P.height,q+=P.computeEffectiveSpacing();continue}if(2===P.j1()){q+=P.q,q+=P.computeEffectiveSpacing();continue}0!==P.q&&(D+=P.q,D+=P.computeEffectiveSpacing())}j=isFinite(G.height)?Math.min(G.height,K.height):0!==N&&isFinite(s)?s:D,j=Math.max(j,isFinite(s)?Math.min(a,s):a),j=Math.max(j-q,0);const W=0===D?1:Math.max(j/D,1);for(let e=0;e<h;e++)void 0!==b[e]&&(P=t.getRowDefinition(e),!isFinite(P.height)&&2!==P.j1()&&(P.actual=P.q*W),P.position=o.height,0!==P.q&&(o.height+=P.q,o.height+=P.computeEffectiveSpacing()));h=u.length;for(let e=0;e<h;e++){const i=u[e];let s=0,n=0;i.type===Yt.TableRow?(s=o.width,P=t.getRowDefinition(i.row),n=P.actual):(P=t.getColumnDefinition(i.column),s=P.actual,n=o.height),i.measuredBounds.e(0,0,s,n),i.xi(!1)}e.Z(u),t.Aa=c}arrange(t,e,i){const s=e.length,n=t.padding,o=n.left,r=n.top,a=t.Aa;if(null===a)return;let h=0,l=0;const u=a.length;let c=0;for(let t=0;t<u;t++)a[t]&&(c=Math.max(c,a[t].length));const d=t.Zi,g=t.Qi;let f=0,m=0,p=Math.min(t.topIndex,u-1);if(d.length>0){for(;p!==u&&(void 0===d[p]||0===d[p].q);)p++;p=Math.max(Math.min(p,u-1),0),f=-d[p].position}let y=Math.min(t.leftIndex,c-1);if(g.length>0){for(;y!==c&&(void 0===g[y]||0===g[y].q);)y++;y=Math.max(Math.min(y,c-1),0),m=-g[y].position}let b=0,P=0;for(;b!==u&&void 0===d[b];)b++;for(;P!==u&&void 0===g[P];)P++;const k=t.part;let S=t.getRowDefinition(b),M=t.getColumnDefinition(P);for(let i=0;i<e.length;i++){const s=e[i];if(!(s instanceof Yt&&s.visible&&s.nl()))continue;s.type===Yt.TableRow?(S=t.getRowDefinition(s.row),M=t.getColumnDefinition(P)):(S=t.getRowDefinition(b),M=t.getColumnDefinition(s.column)),l=S.position+f+r,0!==S.q&&(l+=S.computeEffectiveSpacingTop(Math.max(b,p))),h=M.position+m+o,0!==M.q&&(h+=M.computeEffectiveSpacingTop(Math.max(P,y)));const n=s.measuredBounds;s.pf(),s.actualBounds.ce();const a=s.actualBounds,u=w.z(a.x,a.y,a.width,a.height);(a.x=s.type===Yt.TableRow?o:h,a.y=s.type===Yt.TableColumn?r:l,a.width=n.width,a.height=n.height,s.actualBounds.k(),s.lo(!1),u.equalsApproxClose(a))?w.i(u):(null!==k&&(k.Sa(),s.Wp(k)),w.i(u))}const C=x.l();for(let e=0;e<u;e++){if(!a[e])continue;c=a[e].length;const s=t.getRowDefinition(e);l=s.position+f+r,0!==s.q&&(l+=s.computeEffectiveSpacingTop(Math.max(b,p)));for(let n=0;n<c;n++){if(!a[e][n])continue;const r=t.getColumnDefinition(n);h=r.position+m+o,0!==r.q&&(h+=r.computeEffectiveSpacingTop(Math.max(P,y)));const u=a[e][n],c=u.length;for(let o=0;o<c;o++){const a=u[o],c=a.measuredBounds;C.e(0,0);for(let i=1;i<a.rowSpan&&!(e+i>=t.rowCount);i++){const s=t.getRowDefinition(e+i);0!==s.q&&(C.height+=s.total)}for(let e=1;e<a.columnSpan&&!(n+e>=t.columnCount);e++){const i=t.getColumnDefinition(n+e);0!==i.q&&(C.width+=i.total)}const d=r.q+C.width,g=s.q+C.height;let f=h,m=l;const p=d,y=g,x=h,b=l;let P=d,k=g;h+d>i.width&&(P=Math.max(i.width-h,0)),l+g>i.height&&(k=Math.max(i.height-l,0));let S=a.alignment,M=0,N=0,T=0,L=0;if(S.isDefault()){S=t.defaultAlignment,S.isSpot()||(S=v.Center),M=S.x,N=S.y,T=S.offsetX,L=S.offsetY;const e=r.alignment,i=s.alignment;e.isSpot()&&(M=e.x,T=e.offsetX),i.isSpot()&&(N=i.y,L=i.offsetY)}else M=S.x,N=S.y,T=S.offsetX,L=S.offsetY;(isNaN(M)||isNaN(N))&&(M=.5,N=.5,T=0,L=0);let A=c.width,D=c.height;const F=a.margin,O=F.left+F.right,R=F.top+F.bottom,B=a.Qp(s,r,!1);isNaN(a.desiredSize.width)&&(2===B||5===B)&&(A=Math.max(d-O,0)),isNaN(a.desiredSize.height)&&(2===B||4===B)&&(D=Math.max(g-R,0));const E=a.maxSize,I=a.minSize;A=Math.min(E.width,A),D=Math.min(E.height,D),A=Math.max(I.width,A),D=Math.max(I.height,D);const V=D+R;f+=p*M-(A+O)*M+T+F.left,m+=y*N-V*N+L+F.top,a.visible&&(w.contains(x,b,P,k,f,m,c.width,c.height)?a.Ut(f,m,A,D):a.Ut(f,m,A,D,new w(x,b,P,k)))}}}x.i(C);for(let t=0;t<s;t++){const i=e[t],s=i instanceof Yt?i:null;if(null!==s&&s.nl()){const t=i.actualBounds;i.naturalBounds.ce(),i.naturalBounds.e(0,0,t.width,t.height),i.naturalBounds.k()}}}});jt.An("TableRow",new class extends jt{constructor(){super()}measure(t,e,i,s,n,o,r){}arrange(t,e,i){}});jt.An("TableColumn",new class extends jt{constructor(){super()}measure(t,e,i,s,n,o,r){}arrange(t,e,i){}});jt.An("Viewbox",new class extends jt{constructor(){super()}measure(t,i,s,n,o,r,a){1!==n.length&&e.o("Viewbox Panel must contain exactly one GraphObject.");const h=n[0];h.it=1,h.bf(),h.ht(1/0,1/0,r,a);let l=h.measuredBounds;const u=h.margin,c=u.right+u.left,d=u.top+u.bottom;if(isFinite(i)||isFinite(s)){const e=h.scale,n=l.width,o=l.height,u=Math.max(i-c,0),g=Math.max(s-d,0);let f=1;6===t.viewboxStretch?(0!==n&&0!==o&&(f=Math.min(u/n,g/o)),0===f&&(f=1e-4),h.it*=f):(0!==n&&0!==o&&(f=Math.max(u/n,g/o)),0===f&&(f=1e-4),h.it*=f),e!==h.scale&&(h.xi(!0),h.ht(1/0,1/0,r,a))}l=h.measuredBounds,o.width=isFinite(i)?i:Math.max(l.width+c,0),o.height=isFinite(s)?s:Math.max(l.height+d,0)}arrange(t,e,i){const s=e[0],n=s.measuredBounds,o=s.margin,r=o.right+o.left,a=o.top+o.bottom,h=Math.max(n.width+r,0),l=Math.max(n.height+a,0);let u=s.alignment;u.isDefault()&&(u=t.defaultAlignment),u.isSpot()||(u=v.Center),s.Ut(i.width*u.x-h*u.x+u.offsetX,i.height*u.y-l*u.y+u.offsetY,n.width,n.height)}});jt.An("Grid",new class extends jt{constructor(){super()}measure(t,e,i,s,n,o,r){null===t.Pe&&(t.Pe=new Ht),this.RI(t),this.OI(t)}arrange(t,e,i){}Ge(t,e,i){const s=t.naturalBounds;e.save(),e.beginPath(),e.rect(0,0,s.width,s.height),e.clip(),e.endPath(),this.II(t,e,i),e.restore(),e.clearContextCache(!1)}II(t,e,i){let s=t.getDocumentScale()*i.scale;s<=0&&(s=1);const n=t.gridCellSize,o=n.width,r=n.height,a=t.naturalBounds,h=t.actualBounds,l=a.width,u=a.height,c=Math.ceil(l/o),d=Math.ceil(u/r),g=t.gridOrigin,f=g.x,m=g.y,p=t.Pe.N0,y=t.D.r,x=y.length;for(let i=0;i<x;i++){const n=y[i];if(!n.visible)continue;const g=n.interval||1,x=Math.abs(g);if(o*x*s<2)continue;let w=n.segmentIndex;(!isFinite(w)||isNaN(w))&&(w=0),w<0&&(w=x-Math.min(-w,x)),w=Math.round(w%x);const b=n.opacity;let v=1;if(1!==b){if(0===b)continue;v=e.globalAlpha,e.globalAlpha=v*b}const P=p[i];let k=!1;const S=n.strokeDashArray;if(null!==S&&(k=!0,e.enableDash(S,n.strokeDashOffset)),null!==n.stroke&&n.strokeWidth>0&&("LineV"===n.figure||"LineH"===n.figure)){if(e.lineWidth=n.strokeWidth,t.bn(e,n.stroke,!1,!1,a,h),e.beginPath(),"LineV"===n.figure){const t=Math.floor((f-o)/o);for(let i=t;i<=t+c;i++){const t=i*o+f;0<=t&&t<=l&&this.W1(i,g,w,P)&&(e.moveTo(t,0),e.lineTo(t,u))}}else if("LineH"===n.figure){const t=Math.floor((m-r)/r);for(let i=t;i<=t+d;i++){const t=i*r+m;0<=t&&t<=u&&this.W1(i,g,w,P)&&(e.moveTo(0,t),e.lineTo(l,t))}}e.stroke(),e.endPath()}else if(null!==n.fill)if(t.bn(e,n.fill,!0,!1,a,h),"BarV"===n.figure){let t=n.width;isNaN(t)&&(t=o);const i=Math.floor((f-o)/o);for(let s=i;s<=i+c;s++){const i=s*o+f;0<=i+t&&i<=l&&this.W1(s,g,w,P)&&e.fillRect(i,0,t,u)}}else if("BarH"===n.figure){let t=n.height;isNaN(t)&&(t=r);const i=Math.floor((m-r)/r);for(let s=i;s<=i+d;s++){const i=s*r+m;0<=i+t&&i<=u&&this.W1(s,g,w,P)&&e.fillRect(0,i,l,t)}}k&&e.disableDash(),1!==b&&(e.globalAlpha=v)}}W1(t,e,i,s){if(e<0)return t%e===i;if(t%e!==i)return!1;const n=s.length;for(let e=0;e<n;e++){if(t%s[e]===i)return!1}return!0}OI(t){const e=[],i=t.D.r,s=i.length;for(let t=0;t<s;t++){const n=i[t],o=[];if(e.push(o),!n.visible)continue;const r=n.interval;if(r<0)continue;const a=n.figure,h=this.HN(a);for(let e=0;e<s;e++){if(e===t)continue;const s=i[e];if(!s.visible)continue;const n=s.figure;if(this.HN(n)!==h)continue;const a=s.interval;a>r&&o.push(a)}}t.Pe.N0=e}HN(t){return"LineV"===t||"BarV"===t}RI(t){let e=1,i=1;const s=t.D.r,n=s.length;for(let t=0;t<n;t++){const n=s[t],o=Math.abs(n.interval);o<2||(this.HN(n.figure)?i=i*o/k.jL(i,o):e=e*o/k.jL(e,o))}const o=t.gridCellSize,r=t.Pe;r.lf.isReal()?r.lf.e(i*o.width,e*o.height):r.lf=new x(i*o.width,e*o.height)}});jt.An("Link",new class extends jt{constructor(){super()}measure(t,i,s,n,o,r,a){const h=n.length;if(!(t instanceof ge||t instanceof be))return;let l=null,u=null;if(t instanceof be&&(l=t),t instanceof ge&&(u=t,l=u.adornedPart,null===t.Lf&&(t.Lf=[])),!(l instanceof be))return;const c=l;if(0===h)return t.naturalBounds.Hn(0,0),void t.measuredBounds.e(0,0,0,0);const d=t instanceof ge?null:l.path,g=l.routeBounds,f=t.$o;f.e(0,0,g.width,g.height);const m=c.points,p=l.pointsCount;null!==u?u.Td(!1):null!==l&&l.Td(!1);const x=g.width,b=g.height,k=t.Lf;if(k.length=0,null!==d){this.measureLinkPath(t,x,b,d);const e=d.measuredBounds;f.unionRect(e),k.push(e)}const S=P.l(),M=y.l(),C=y.l();for(let i=0;i<h;i++){const s=n[i];if(s===d)continue;let o=s.measuredBounds;if(s.isPanelMain&&s instanceof $t){this.measureLinkPath(t,x,b,s),o=s.measuredBounds,f.unionRect(o),k.push(o);continue}if(p<2){s.ht(1/0,1/0,0,0),o=s.measuredBounds,f.unionRect(o),k.push(o);continue}const r=s.segmentIndex,a=s.segmentFraction;let h=s.alignmentFocus;h.isNoSpot()&&(h=v.Center);const l=s.segmentOrientation,u=s.segmentOffset;let P=0,N=0,T=0,L=0;if(isNaN(r)){const t=c.ut,i=e.nt();t.getPointAndAngleAlongPath(a,i);const n=y.z(i[0],i[1]);L=i[2],0!==l&&(T=c.computeAngle(s,l,L),s.Xt=T,s.xi(!0),s.lo(!0)),P=n.x,N=n.y,y.i(n),e.Z(i)}else if(r<-p||r>=p){const t=y.l();c.qN(t),L=c.midAngle,0!==l&&(T=c.computeAngle(s,l,L),s.Xt=T,s.xi(!0),s.lo(!0)),P=t.x-g.x,N=t.y-g.y,y.i(t)}else{let t,e,i=0;if(r>=0?(t=m.elt(r),e=r<p-1?m.elt(r+1):t):(i=p+r,t=m.elt(i),e=i>0?m.elt(i-1):t),t.equalsApprox(e)){let s,n;r>=0?(s=r>0?m.elt(r-1):t,n=r<p-2?m.elt(r+2):e):(s=i<p-1?m.elt(i+1):t,n=i>1?m.elt(i-2):e);const o=s.distanceSquaredPoint(t),a=e.distanceSquaredPoint(n);L=o>a+10?r>=0?s.directionPoint(t):t.directionPoint(s):a>o+10?r>=0?e.directionPoint(n):n.directionPoint(e):r>=0?s.directionPoint(n):n.directionPoint(s)}else L=r>=0?t.directionPoint(e):e.directionPoint(t);0!==l&&(T=c.computeAngle(s,l,L),s.Xt=T,s.xi(!0),s.lo(!0)),P=t.x+(e.x-t.x)*a-g.x,N=t.y+(e.y-t.y)*a-g.y}s.ht(1/0,1/0,0,0),o=s.measuredBounds;const A=s.naturalBounds;let D=0;s instanceof $t&&(D=s.strokeWidth);const F=A.width+D,O=A.height+D;S.Ue(),S.Xs(-o.x,-o.y),S.it(s.scale,s.scale),S.ks(0===l?s.angle:L,F/2,O/2),(22===l||26===l)&&S.ks(90,F/2,O/2),(23===l||27===l)&&S.ks(-90,F/2,O/2),28===l&&(L>45&&L<135||L>225&&L<315)&&S.ks(-L,F/2,O/2);const R=new w(0,0,F,O);M.setRectSpot(R,h),S.gt(M);const B=-M.x+D/2*s.scale,E=-M.y+D/2*s.scale;C.h(u);const I=isNaN(u.x),V=isNaN(u.y);if(I||V){const t=F/2+be.J1,e=O/2+be.J1,i=L>=45&&L<=135,s=L>=225&&L<=315;0===l&&(i||s)?(C.x=V?t:u.y,C.y=I?e:u.x,i?r>=0||isNaN(r)&&a<.5||I&&(C.y=-e):s&&((r>=0||isNaN(r)&&a<.5)&&I&&(C.y=-e),V&&(C.x=-t))):(I&&(r>=0||isNaN(r)&&a<.5?C.x=t:C.x=-t),V&&(C.y=-e),C.rotate(L))}else C.rotate(L);P+=C.x,N+=C.y,R.e(P+B,N+E,o.width,o.height),k.push(R),f.unionRect(R)}if(null!==l){const t=l.labelNodes;for(;t.next();)t.value.ht(1/0,1/0)}t.$o=f,t.position.e(g.x+f.x,g.y+f.y),o.Hn(f.width||0,f.height||0),P.i(S),y.i(M),y.i(C)}arrange(t,e,i){const s=e.length;if(!(t instanceof ge||t instanceof be))return;let n=t,o=null;t instanceof ge&&(o=t,n=o.adornedPart);const r=t,a=t instanceof ge?null:n.path,h=t.Lf;if(0!==h.length){let t=0;if(null!==a&&t<h.length){const e=h[t];t++,a.Ut(e.x-r.$o.x,e.y-r.$o.y,e.width,e.height)}for(let i=0;i<s;i++){const s=e[i];if(s!==a&&t<h.length){const e=h[t];t++,s.Ut(e.x-r.$o.x,e.y-r.$o.y,e.width,e.height)}}}const l=n.points,u=l.count;if(u>=2&&r instanceof be){const t=r.labelNodes;for(;t.next();){const e=t.value;r.EI(e,u,l)}}null!==o?o.Td(!1):n.Td(!1);const c=t.uD(y.l());t.location.e(t.position.x+c.x,t.position.y+c.y),y.i(c)}measureLinkPath(t,e,i,s){if(!1===s.Xo())return;let n=s.strokeWidth;if(0===n&&t instanceof ge&&t.type===Yt.Link&&t.adornedObject instanceof $t&&(n=t.adornedObject.strokeWidth),n*=s.it,t instanceof be&&null!==t.ut){const e=t.geometry.bounds;s.ro(e.x-n/2,e.y-n/2,e.width+n,e.height+n)}else if(t instanceof ge&&null!==t.adornedPart.ut){const e=t.adornedPart.ut.bounds;s.ro(e.x-n/2,e.y-n/2,e.width+n,e.height+n)}else s.ro(-n/2,-n/2,e+n,i+n);s.UI(),s.xi(!1)}});jt.An("Graduated",new class extends jt{constructor(){super()}measure(t,e,i,s,n,o,r){const a=t.findMainElement();if(!(a instanceof $t))return;t._i=[];const h=a.margin,l=h.right+h.left,u=h.top+h.bottom;a.ht(e,i,o,r);const c=a.measuredBounds,d=c.width,g=c.height,f=Math.max(d+l,0),m=Math.max(g+u,0),p=new w(-h.left,-h.top,f,m);t._i.push(p),n.h(p),this.determineGraduatedMarks(t,a);const y=t.vs;if(null===y)return;const x=s.length;for(let e=0;e<x;e++){const i=s[e],o=y[e];!i.visible||i===a||0===o.length||(i instanceof $t?this.measureGraduatedTicks(t,i,o,n):i instanceof ie&&this.measureGraduatedLabels(t,i,o,n),i.xi(!1))}}arrange(t,e,i){if(null===t._i)return;const s=t.findMainElement(),n=t.vs;if(null===n)return;const o=t._i;let r=0,a=o[r];r++,null!==s&&s.Ut(a.x-i.x,a.y-i.y,a.width,a.height);const h=e.length;for(let t=0;t<h;t++){const h=e[t],l=n[t];!h.visible||h===s||0===l.length||(a=o[r],r++,h.Ut(a.x-i.x,a.y-i.y,a.width,a.height))}t._i=null}measureGraduatedTicks(t,e,i,s){let n=e.alignmentFocus;n.isNoSpot()&&(n=v.TopCenter);const o=e.angle;e.Xt=0,e.ht(1/0,1/0,0,0),e.Xt=o;const r=e.measuredBounds,a=r.width,h=r.height,l=w.z(0,0,a,h),u=y.l();u.setRectSpot(l,n),w.i(l);const c=-u.x,d=-u.y,g=new w,f=i.length;for(let t=0;t<f;t++){const s=i[t],n=s.pt.x,o=s.pt.y,r=s.angle;for(let i=0;i<4;i++){switch(i){case 0:u.e(c,d);break;case 1:u.e(c+a,d);break;case 2:u.e(c,d+h);break;case 3:u.e(c+a,d+h)}u.rotate(r+e.angle),u.offset(n,o),0===t&&0===i?g.e(u.x,u.y,0,0):g.unionPoint(u),u.offset(-n,-o),u.rotate(-r-e.angle)}}y.i(u),null!==t._i&&t._i.push(g),s.re(g.x,g.y,g.width,g.height)}measureGraduatedLabels(t,e,i,s){null===t.vi&&(t.vi=new ie);const n=t.vi;this.dD(e,n);let o=e.alignmentFocus;o.isNoSpot()&&(o=v.TopCenter);const r=e.segmentOrientation,a=e.segmentOffset,h=new w;let l=0,u=0,c=0,d=0,g=0;const f=i.length;for(let t=0;t<f;t++){const s=i[t];l=s.pt.x,u=s.pt.y,c=s.angle,d=e.angle,g=e.angle,0!==r&&(g=21===r||25===r?c+e.angle:c,d=be.computeAngle(r,g)),n.Xt=d,n.text=s.text||"",n.ht(1/0,1/0,0,0);const f=n.measuredBounds,m=n.naturalBounds,p=m.width,x=m.height,b=P.l();b.Ue(),b.Xs(-f.x,-f.y),b.it(n.scale,n.scale),b.ks(g,p/2,x/2),(22===r||26===r)&&b.ks(90,p/2,x/2),(23===r||27===r)&&b.ks(-90,p/2,x/2),28===r&&(c>45&&c<135||c>225&&c<315)&&b.ks(-c,p/2,x/2);const v=w.z(0,0,p,x),k=y.l();k.setRectSpot(v,o),b.gt(k);const S=-k.x,M=-k.y,C=y.l();C.h(a),isNaN(C.x)&&(C.x=p/2+3),isNaN(C.y)&&(C.y=-(x/2+3)),C.rotate(c),l+=C.x+S,u+=C.y+M;const N=new w(l,u,f.width,f.height),T=new w(f.x,f.y,f.width,f.height),L=new w(m.x,m.y,m.width,m.height);s.labelAngle=d,s.lineCount=n.lineCount,s.lines=n.getMetrics(),s.actualBounds=N,s.measuredBounds=T,s.naturalBounds=L,0===t?h.h(N):h.unionRect(N),y.i(C),y.i(k),w.i(v),P.i(b)}null!==t._i&&t._i.push(h),s.re(h.x,h.y,h.width,h.height)}determineGraduatedMarks(t,i){const s=i.geometry,n=i.strokeWidth,o=s.flattenedSegments,r=s.flattenedLengths,a=s.flattenedTotalLength,h=o.length;let l=0,u=0;const c=e.nt();for(let t=0;t<h;t++){const e=o[t],i=[];l=0,u=0;const s=e.length;for(let t=0;t<s;t+=2){const s=e[t],n=e[t+1];if(0===t){l=s,u=n;continue}let o=180*Math.atan2(n-u,s-l)/Math.PI;o<0&&(o+=360),i.push(o),l=s,u=n}c.push(i)}const d=this.VI(t),g=t.D.r,f=g.length;let m,p=0,x=0,w=a;t.vs=[];for(let e=0;e<f;e++){const h=g[e];if(m=[],!h.visible||h===i){t.vs.push(m);continue}const l=Math.abs(h.interval),u=t.graduatedTickUnit;if(u*l*a/t.graduatedRange<2&&null===h.graduatedSkip){t.vs.push(m);continue}let f=r[0][0],b=0,v=0;x=a*h.graduatedStart-1e-4,w=a*h.graduatedEnd+1e-4;const P=u*l;let k=t.graduatedTickBase;if(k<t.graduatedMin){let e=(t.graduatedMin-k)/P;e=e%1==0?e:Math.floor(e+1),k+=e*P}else if(k>t.graduatedMin+P){k-=Math.floor((k-t.graduatedMin)/P)*P}const S=d[e],M=k,C=1e-6*t.graduatedMax;for(let e=1;k<=t.graduatedMax+C;e++){if(this.BI(t,k-t.graduatedTickBase,S)&&(k>t.graduatedMax&&(k=t.graduatedMax),(null===h.graduatedSkip||h instanceof ie&&!h.graduatedSkip(k,h)||h instanceof $t&&!h.graduatedSkip(k,h))&&(p=(k-t.graduatedMin)*a/t.graduatedRange,p>a&&(p=a),x<=p&&p<=w))){let t=c[b][v],e=r[b][v];for(;b<r.length;){for(;p>f&&v<r[b].length-1;)v++,t=c[b][v],e=r[b][v],f+=e;if(p<=f)break;b++,v=0,t=c[b][v],e=r[b][v],f+=e}const a=o[b],l=a[2*v],u=a[2*v+1],d=a[2*v+2],g=a[2*v+3],x=(p-(f-e))/e,w=new y(l+(d-l)*x+n/2-s.bounds.x,u+(g-u)*x+n/2-s.bounds.y);if(w.scale(i.scale,i.scale),t=this.zI(t,x,a,c[b],v),h instanceof ie){let e="";null!==h.graduatedFunction?(e=h.graduatedFunction(k,h),e=null!=e?e.toString():""):e=(+k.toFixed(2)).toString(),""!==e&&m.push({pt:w,angle:t,text:e})}else m.push({pt:w,angle:t})}k=M+e*P}t.vs.push(m)}e.Z(c)}zI(t,e,i,s,n){if(e<.5005&&e>.4995)return t;let o=t;if(e<.5?n>0?o=s[n-1]:k.X(i[0],i[i.length-2])&&k.X(i[1],i[i.length-1])&&(o=s[s.length-1]):e>.5&&(n+1<s.length?o=s[n+1]:k.X(i[0],i[i.length-2])&&k.X(i[1],i[i.length-1])&&(o=s[0])),t!==o){let i=Math.abs(t-o);if(i>180&&(t<o?t+=360:o+=360,i=Math.abs(t-o)),e<5e-4||e>.9995)return(t+o)/2%360;if(i<10){const i=1-Math.abs(.5-e);return(t*i+o*(1-i))%360}}return t}VI(t){if(null===t.ds){const e=[],i=t.D.r,s=i.length;for(let t=0;t<s;t++){const n=i[t],o=[];if(e.push(o),!n.visible)continue;const r=n.interval;if(!(r<0))for(let e=0;e<s;e++){if(e===t)continue;const s=i[e];if(!s.visible||n.constructor!==s.constructor)continue;const a=s.interval;a>r&&o.push(a)}}t.ds=e}return t.ds}BI(t,e,i){const s=i.length;for(let n=0;n<s;n++){const s=e%(i[n]*t.graduatedTickUnit),o=1e-6*t.graduatedTickUnit;if(s<o&&s>-o)return!1}return!0}Ge(t,e,i){const s=i.ph;i.ph=!0;const n=t.naturalBounds,o=n.width,r=n.height,a=e instanceof Bt;e.save(),e.beginPath(),e.rect(-1,-1,o+1,r+1),e.clip(),e.endPath();const h=t.findMainElement();h.Ge(e,i);let l=t.getDocumentScale()*i.scale;l<=0&&(l=1);const u=h.actualBounds,c=t.D.r,d=t.vs,g=c.length;for(let s=0;s<g;s++){const n=c[s],o=d[s],r=o.length;if(n.visible&&n!==h&&0!==o.length)if(n instanceof $t){if(t.graduatedTickUnit*n.interval*h.geometry.flattenedTotalLength/t.graduatedRange*l<2&&null===n.graduatedSkip)continue;const s=n.measuredBounds,c=n.strokeWidth*n.scale;let d=n.alignmentFocus;d.isNoSpot()&&(d=v.TopCenter);for(let h=0;h<r;h++){const r=o[h].pt,l=o[h].angle;this.XI(n,r,u,l,s,c,d),n.Ge(e,i),a&&(t.svg.appendChild(n.svg),n.svg=null),n.el.Ue()}}else if(n instanceof ie){null===t.vi&&(t.vi=new ie);const s=t.vi;this.dD(n,s),s.jN=!0;for(let h=0;h<r;h++){const r=o[h];if(r.actualBounds&&r.measuredBounds&&r.naturalBounds){s.GI(r);const o=r.actualBounds;s.Ut(o.x,o.y,o.width,o.height),this.YI(s,u,o,r.measuredBounds,r.naturalBounds),s.sl=n.part,s.$s=n.panel,s.Ge(e,i),s.$s=null,s.sl=null,a&&(t.svg.appendChild(s.svg),s.svg=null)}}}}i.ph=s,e.restore(),e.clearContextCache(!0)}XI(t,e,i,s,n,o,r){const a=t.el;a.Ue(),a.Xs(e.x+i.x,e.y+i.y),a.ks(s+t.angle,0,0),a.Xs(-n.width*r.x+r.offsetX+o/2,-n.height*r.y+r.offsetY+o/2),a.it(t.scale,t.scale),t.Sd(!1),t.wa.set(t.el),t.Th=t.scale,t.Na(!1)}YI(t,e,i,s,n){const o=t.el;o.Ue(),o.Xs(i.x+e.x,i.y+e.y),o.Xs(-s.x,-s.y),t.Kp(o,n.x,n.y,n.width,n.height),t.Sd(!1),t.wa.set(t.el),t.Th=t.scale,t.Na(!1)}dD(t,e){e.KI(t)}});var Kt=(t=>(t[t.Uniform=6]="Uniform",t[t.UniformToFill=7]="UniformToFill",t))(Kt||{});class Yt extends At{W;D;Qt;Dd;Zn;rl;fo;$o;WN;O;vd;ot;Pe;te;Fd;Ta;_s;constructor(t,i){if(super(),void 0===t)this.W=Yt.Position;else if("string"==typeof t){const i=jt.fs.get(t);null!==i?this.W=i:e.o("PanelLayout not loaded: "+t)}else t instanceof jt?this.W=t:(this.W=Yt.Position,t&&(i=t));this.n|=4194304|(this.W===Yt.Grid?1048576:0),this.D=new h,this.Qt=b.im,this.Dd=v.Default,this.Zn=1,this.rl=null,this.fo="",this.$o=new w(NaN,NaN,NaN,NaN),this.WN=null,this.O=null,this.vd=6,this.Pe=null,this.ot=null,this.te=null,this.Fd=NaN,this.Ta=null,this._s=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.W=this.W,t.Qt=this.Qt.N(),t.Dd=this.Dd.N(),t.Zn=this.Zn,t.fo=this.fo,t.$o.h(this.$o),null!==this.O&&(t.O=this.O.copy(t)),t.vd=this.vd,null!==this.ot&&(t.ot=this.ot.copy()),null!==this.Pe&&(t.Pe=this.Pe.copy()),t.te=this.te,t.Fd=this.Fd,t.Ta=this.Ta}Ho(t){super.Ho(t),t.D=this.D;const e=t.D.r,i=e.length;for(let s=0;s<i;s++){e[s].$s=t}t.rl=null}copy(){const t=super.copy(),e=this.D.r,i=e.length;for(let s=0;s<i;s++){const i=e[s].copy();t.HI(i)}return t}toString(){return"Panel("+this.type.name+")#"+u.xs(this)}get type(){return this.W}set type(t){const e=this.W;e!==t&&(this.W=t,this.Af=this.W===Yt.Grid,this.f(),this.t("type",e,t))}get elements(){return this.D.iterator}get naturalBounds(){return this.Ke}get padding(){return this.Qt}set padding(t){"number"==typeof t?(t<0&&e.J(t,">= 0",Yt,"padding"),t=new b(t)):(t.left<0&&e.J(t.left,">= 0",Yt,"padding:value.left"),t.right<0&&e.J(t.right,">= 0",Yt,"padding:value.right"),t.top<0&&e.J(t.top,">= 0",Yt,"padding:value.top"),t.bottom<0&&e.J(t.bottom,">= 0",Yt,"padding:value.bottom"));const i=this.Qt;i.equals(t)||(t=t.N(),this.Qt=t,this.f(),this.t("padding",i,t))}get defaultAlignment(){return this.Dd}set defaultAlignment(t){const e=this.Dd;e.equals(t)||(t=t.N(),this.Dd=t,this.f(),this.t("defaultAlignment",e,t))}get defaultStretch(){return this.Zn}set defaultStretch(t){const e=this.Zn;e!==t&&(this.Zn=t,this.f(),this.t("defaultStretch",e,t))}get defaultSeparatorPadding(){return null!==this.O?this.O.C0:b.im}set defaultSeparatorPadding(t){"number"==typeof t&&(t=new b(t));const e=this.defaultSeparatorPadding;e.equals(t)||(t=t.N(),null===this.O&&(this.O=new Wt),this.O.C0=t,this.f(),this.t("defaultSeparatorPadding",e,t))}get defaultRowSeparatorStroke(){return null!==this.O?this.O.L0:null}set defaultRowSeparatorStroke(t){const e=this.defaultRowSeparatorStroke;e!==t&&(null===t||"string"==typeof t||t instanceof Ut)&&(t instanceof Ut&&t.k(),null===this.O&&(this.O=new Wt),this.O.L0=t,this.C(),this.t("defaultRowSeparatorStroke",e,t))}get defaultRowSeparatorStrokeWidth(){return null!==this.O?this.O.A0:1}set defaultRowSeparatorStrokeWidth(t){const e=this.defaultRowSeparatorStrokeWidth;e!==t&&isFinite(t)&&t>=0&&(null===this.O&&(this.O=new Wt),this.O.A0=t,this.f(),this.t("defaultRowSeparatorStrokeWidth",e,t))}get defaultRowSeparatorDashArray(){return null!==this.O?this.O.T0:null}set defaultRowSeparatorDashArray(t){const i=this.defaultRowSeparatorDashArray;if(i!==t){if(null!==t&&!Array.isArray(t)&&e.si(t,"Array",Yt,"defaultRowSeparatorDashArray:value"),null!==t){const s=t.length;let n=0;for(let i=0;i<s;i++){const s=t[i];("number"!=typeof s||!(s>=0)||!isFinite(s))&&e.o("defaultRowSeparatorDashArray value "+s+" at index "+i+" must be a positive number or zero."),n+=s}if(0===n){if(null===i)return;t=null}}null===this.O&&(this.O=new Wt),this.O.T0=t,this.C(),this.t("defaultRowSeparatorDashArray",i,t)}}get defaultColumnSeparatorStroke(){return null!==this.O?this.O.D0:null}set defaultColumnSeparatorStroke(t){const e=this.defaultColumnSeparatorStroke;e!==t&&(null===t||"string"==typeof t||t instanceof Ut)&&(t instanceof Ut&&t.k(),null===this.O&&(this.O=new Wt),this.O.D0=t,this.C(),this.t("defaultColumnSeparatorStroke",e,t))}get defaultColumnSeparatorStrokeWidth(){return null!==this.O?this.O.v0:1}set defaultColumnSeparatorStrokeWidth(t){const e=this.defaultColumnSeparatorStrokeWidth;e!==t&&isFinite(t)&&t>=0&&(null===this.O&&(this.O=new Wt),this.O.v0=t,this.f(),this.t("defaultColumnSeparatorStrokeWidth",e,t))}get defaultColumnSeparatorDashArray(){return null!==this.O?this.O.F0:null}set defaultColumnSeparatorDashArray(t){const i=this.defaultColumnSeparatorDashArray;if(i!==t){if(null!==t&&!Array.isArray(t)&&e.si(t,"Array",Yt,"defaultColumnSeparatorDashArray:value"),null!==t){const s=t.length;let n=0;for(let i=0;i<s;i++){const s=t[i];("number"!=typeof s||!(s>=0)||!isFinite(s))&&e.o("defaultColumnSeparatorDashArray value "+s+" at index "+i+" must be a positive number or zero."),n+=s}if(0===n){if(null===i)return;t=null}}null===this.O&&(this.O=new Wt),this.O.F0=t,this.C(),this.t("defaultColumnSeparatorDashArray",i,t)}}get Aa(){return null!==this.O?this.O.Aa:null}set Aa(t){null===this.O&&(this.O=new Wt),this.O.Aa=t}get viewboxStretch(){return this.vd}set viewboxStretch(t){const e=this.vd;e!==t&&(this.vd=t,this.f(),this.t("viewboxStretch",e,t))}get gridCellSize(){return null!==this.Pe?this.Pe.Rd:x.EL}set gridCellSize(t){null===this.Pe&&(this.Pe=new Ht);const i=this.Pe.Rd;if(!i.equals(t)){(!t.isReal()||0===t.width||0===t.height)&&e.o("Invalid Panel.gridCellSize: "+t),this.Pe.Rd=t.N();const s=this.diagram;null!==s&&this===s.grid&&s.ca(),this.C(),this.t("gridCellSize",i,t)}}get gridOrigin(){return null!==this.Pe?this.Pe.Od:y.dn}set gridOrigin(t){null===this.Pe&&(this.Pe=new Ht);const i=this.Pe.Od;if(!i.equals(t)){t.isReal()||e.o("Invalid Panel.gridOrigin: "+t),this.Pe.Od=t.N();const s=this.diagram;null!==s&&this===s.grid&&s.ca(),this.C(),this.t("gridOrigin",i,t)}}get graduatedMin(){return null!==this.ot?this.ot.R0:0}set graduatedMin(t){const e=this.graduatedMin;if(e!==t&&(null===this.ot&&(this.ot=new qt),this.ot.R0=t,this.f(),this.t("graduatedMin",e,t),this.gf())){const t=this.part;null!==t&&this.Eh(t,"graduatedRange")}}get graduatedMax(){return null!==this.ot?this.ot.O0:100}set graduatedMax(t){const e=this.graduatedMax;if(e!==t&&(null===this.ot&&(this.ot=new qt),this.ot.O0=t,this.f(),this.t("graduatedMax",e,t),this.gf())){const t=this.part;null!==t&&this.Eh(t,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return null!==this.ot?this.ot.I0:10}set graduatedTickUnit(t){const e=this.graduatedTickUnit;e!==t&&t>0&&(null===this.ot&&(this.ot=new qt),this.ot.I0=t,this.f(),this.t("graduatedTickUnit",e,t))}get graduatedTickBase(){return null!==this.ot?this.ot.E0:0}set graduatedTickBase(t){const e=this.graduatedTickBase;e!==t&&(null===this.ot&&(this.ot=new qt),this.ot.E0=t,this.f(),this.t("graduatedTickBase",e,t))}get vs(){return null!==this.ot?this.ot.vs:null}set vs(t){null!==this.ot?this.ot.vs=t:null!==t&&(this.ot=new qt,this.ot.vs=t)}get _i(){return null!==this.ot?this.ot._i:null}set _i(t){null!==this.ot?this.ot._i=t:null!==t&&(this.ot=new qt,this.ot._i=t)}get ds(){return null!==this.ot?this.ot.ds:null}set ds(t){null!==this.ot?this.ot.ds=t:null!==t&&(this.ot=new qt,this.ot.ds=t)}get vi(){return null!==this.ot?this.ot.vi:null}set vi(t){null!==this.ot?this.ot.vi=t:null!==t&&(this.ot=new qt,this.ot.vi=t)}Wp(t){super.Wp(t);const e=this.D.r,i=e.length;for(let s=0;s<i;s++)e[s].Wp(t)}Ma(t,e){if(this.W===Yt.Grid)return t.commitTransform(),void this.W.Ge(this,t,e);if(this.W===Yt.Graduated)return t.commitTransform(),void this.W.Ge(this,t,e);if(this.W===Yt.Table)if(t.commitTransform(),t instanceof Bt){const i=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.JN(t,e),t.endGroup(),t.currentElement=i}else this.JN(t,e);const i=this.isClipping&&this.W===Yt.Spot;i&&t.save();const s=this.findMainElement(),n=this.D.r,o=n.length;for(let r=0;r<o;r++){const o=n[r];i&&o===s&&(t.clipInsteadOfFill=!0),o.Ge(t,e),i&&o===s&&(t.clipInsteadOfFill=!1)}i&&(t.restore(),t.clearContextCache(!0))}JN(t,e){t.lineCap="butt";const i=this.rowCount>0?this.Zi:null,s=this.columnCount>0?this.Qi:null;null!==i&&this.$1(t,e,!0,i,!0),null!==s&&this.$1(t,e,!1,s,!0),null!==i&&this.gD(t,!0,i),null!==s&&this.gD(t,!1,s),null!==i&&this.$1(t,e,!0,i,!1),null!==s&&this.$1(t,e,!1,s,!1)}gD(t,e,i){const s=i.length,n=this.actualBounds,o=this.naturalBounds;let r=!0;for(let a=0;a<s;a++){const s=i[a];if(void 0===s||0===s.actual)continue;if(r){r=!1;continue}if(e){if(s.position>o.height)continue}else if(s.position>o.width)continue;let h=s.separatorStrokeWidth;isNaN(h)&&(h=e?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let l=s.separatorStroke;if(null===l&&(l=e?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),0===h||null===l)continue;this.bn(t,l,!1,!1,o,n);let u=!1,c=s.separatorDashArray;null===c&&(c=e?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),null!==c&&(u=!0,t.enableDash(c,0)),t.beginPath();const d=s.position+h;e?d>o.height&&(h-=d-o.height):d>o.width&&(h-=d-o.width);let g=s.position+h/2;t.lineWidth=h;const f=this.Qt;if(e){g+=f.top;const e=f.left,i=o.width-f.right;t.moveTo(e,g),t.lineTo(i,g)}else{g+=f.left;const e=f.top,i=o.height-f.bottom;t.moveTo(g,e),t.lineTo(g,i)}t.stroke(),t.endPath(),u&&t.disableDash()}}$1(t,e,i,s,n){const o=s.length,r=this.actualBounds,a=this.naturalBounds,h=this.mD(!0),l=this.mD(!1);for(let e=0;e<o;e++){const o=s[e];if(void 0===o||null===o.background||o.coversSeparators===n||0===o.actual)continue;const u=i?r.height:r.width;if(o.position>u)continue;let c=o.computeEffectiveSpacing(),d=o.separatorStrokeWidth;isNaN(d)&&(d=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let g=o.separatorStroke;null===g&&(g=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(null===g||o.index===(i?h:l))&&(d=0),c-=d;const f=o.position+d;let m=c+o.actual;if(f+m>u&&(m=u-f),m<=0)continue;const p=this.Qt;this.bn(t,o.background,!0,!1,a,r),i?t.fillRect(p.left,f+p.top,r.width-(p.left+p.right),m):t.fillRect(f+p.left,p.top,m,r.height-(p.top+p.bottom))}}mD(t){const e=t?this.rowCount:this.columnCount;for(let i=0;i<e;i++){const e=t?this.Zi[i]:this.Qi[i];if(void 0!==e)return e.index}return 0}wf(){const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].wf();this.Ji(!0)}yf(t,e,i){const s=this.svg;if(null===s)return!1;if(this.type===Yt.Table){const i=s.getElementsByClassName("gojs-ts"),n=0!==i.length?i[0]:null;null!==n&&(n.innerHTML=""),t.currentElement=n,this.JN(t,e),t.currentElement=null}else{if(this.W===Yt.Grid)return s.innerHTML="",s.remove(),!1;if(this.W===Yt.Graduated)return s.innerHTML="",s.remove(),!1;if(this.W===Yt.Spot&&this.isClipping)return s.innerHTML="",s.remove(),this.xa=null,this.wf(),!1}if(!super.yf(t,e,i))return!1;const n=this.D.r,o=n.length;for(let i=0;i<o;i++)n[i].Ge(t,e);return!0}Pd(t){return!0}$p(t,e,i,s){if(!this.isClipping){if(this.Qs()&&null!==t.partClipRect){const e=t.partClipRect,n=this.D.r;let o=0,r=0;for(let t=0;t<n.length;t++){if(!n[t].isVisibleObject())continue;const e=n[t].actualBounds;o=0===t?e.x:Math.min(e.x,o),r=0===t?e.y:Math.min(e.y,r)}return void s.setAttributeNS(null,"clip-path",`path('M ${e.x-i.x-o},${e.y-i.y-r} l ${e.width} 0 l 0 ${e.height} l -${e.width} 0 z')`)}super.$p(t,e,i,s)}}mf(t,e,i,s,n){const o=this.Mn(),r=this.v,a=1/(r.m11*r.m22-r.m12*r.m21);let h=r.m22*a,l=-r.m12*a,u=-r.m21*a,c=r.m11*a,d=a*(r.m21*r.dy-r.m22*r.dx),g=a*(r.m12*r.dx-r.m11*r.dy);if(null!==this.background){const o=t*h+e*u+d,a=t*l+e*c+g,f=i*h+s*u+d,m=i*l+s*c+g;n.e(0,0);const p=this.naturalBounds,y=k.Cl(0,0,p.width,p.height,o,a,f,m,n);return n.v(r),y}{o||(h=1,l=0,u=0,c=1,d=0,g=0);const a=t*h+e*u+d,f=t*l+e*c+g,m=i*h+s*u+d,p=i*l+s*c+g;n.e(m,p);let x=(m-a)**2+(p-f)**2,w=!1;const b=this.D.r,v=b.length,P=y.l();let k=null,S=1/0,M=null;const C=this.isClipping&&this.W===Yt.Spot;C&&(M=y.l(),k=this.findMainElement(),w=k.mf(a,f,m,p,M),w&&(S=(a-M.x)**2+(f-M.y)**2));for(let t=0;t<v;t++){const e=b[t];if(!e.visible||e===k||!e.mf(a,f,m,p,P))continue;w=!0;const i=(a-P.x)**2+(f-P.y)**2;i<x&&(x=i,n.set(P))}return C&&(S>x&&n.set(M),y.i(M)),y.i(P),o&&n.v(r),w}}jc(){const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].jc();super.jc()}f(t){if(this.Xo())return;super.f(t);let e=null;(this.W===Yt.Auto||this.W===Yt.Link)&&(e=this.findMainElement());const i=this.D.r,s=i.length;for(let t=0;t<s;t++){const s=i[t];if((s===e||s.isPanelMain)&&s.f(!0),s.desiredSize.isReal()||!s.visible)continue;const n=s.Zs(!1);!(s instanceof Te)&&!(s instanceof Yt)&&!(s instanceof ie)&&0===n||s.f(!0)}}bf(){if(this.Xo())return;this.xi(!0),this.lo(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].bf()}pf(){if(!1===this.B1()){this.Sd(!0),this.Na(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].TN()}}TN(){this.Na(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].TN()}bd(t,e,i,s){const n=this.$o;n.e(0,0,0,0);const o=this.desiredSize,r=this.minSize;void 0===i&&(i=r.width,s=r.height),i=Math.max(i,r.width),s=Math.max(s,r.height);const a=this.maxSize;isNaN(o.width)||(t=Math.min(o.width,a.width)),isNaN(o.height)||(e=Math.min(o.height,a.height)),t=Math.max(i,t),e=Math.max(s,e);const h=this.Qt;t=Math.max(t-h.left-h.right,0),e=Math.max(e-h.top-h.bottom,0);const l=this.D.r;this.W.measure(this,t,e,l,n,i,s);let u=n.width+h.left+h.right,c=n.height+h.top+h.bottom;isFinite(o.width)&&(u=o.width),isFinite(o.height)&&(c=o.height),u=Math.min(a.width,u),c=Math.min(a.height,c),u=Math.max(r.width,u),c=Math.max(r.height,c),u=Math.max(i,u),c=Math.max(s,c),n.Hn(u,c),this.naturalBounds.Hn(u,c),this.ro(0,0,u,c)}findMainElement(){if(null===this.rl){const t=this.D.r,e=t.length;if(0===e)return null;for(let i=0;i<e;i++){const e=t[i];if(!0===e.isPanelMain)return this.rl=e,e}this.rl=t[0]}return this.rl}Jo(){return null!==this.part?this.part.locationObject:null}get panelLayoutState(){return this.WN}set panelLayoutState(t){this.WN=t}Pa(t,e,i,s){const n=this.D.r;if(this.actualBounds.e(t,e,i,s),!this.desiredSize.isReal()){let t=this.Zs(!0);const e=this.measuredBounds,n=e.width,o=e.height,r=this.il,a=r.left+r.right,h=r.top+r.bottom;switch(n===i&&o===s&&(t=0),t){case 0:(n>i||o>s)&&(this.f(),this.ht(n>i?i:n,o>s?s:o,0,0));break;case 2:this.f(!0),this.ht(i+a,s+h,0,0);break;case 5:this.f(!0),this.ht(i+a,o+h,0,0);break;case 4:this.f(!0),this.ht(n+a,s+h,0,0)}}this.W.arrange(this,n,this.$o)}ka(t){const e=this.naturalBounds,i=this.Jo();if(w.contains(0,0,e.width,e.height,t.x,t.y)){const e=this.D.r,s=e.length,n=y.z(0,0);for(let o=s;o--;){const s=e[o];if((s.visible||s===i)&&(n.set(t).Yi(s.v),s.containsPoint(n)))return y.i(n),!0}return y.i(n),null!==this.Lt}return!1}Yp(t){if(this.no===t)return this;const e=this.D.r,i=e.length;for(let s=0;s<i;s++){const i=e[s].Yp(t);if(null!==i)return i}return null}walkVisualTreeFrom(t,e){if(e(this,t),t instanceof Yt){const i=t.D.r,s=i.length;for(let t=0;t<s;t++)this.walkVisualTreeFrom(i[t],e)}}Pn(t){this.pD(this,t)}pD(t,e){e(t);const i=t.D.r,s=i.length;for(let t=0;t<s;t++){const s=i[t];s instanceof Yt&&this.pD(s,e)}}qI(t){this.yD(this,t)}yD(t,e){if(e(t),t instanceof Yt){const i=t.D.r,s=i.length;for(let t=0;t<s;t++)this.yD(i[t],e)}}findInVisualTree(t){return this.wD(this,t)}wD(t,e){if(e(t))return t;if(t instanceof Yt){const i=t.D.r,s=i.length;for(let t=0;t<s;t++){const s=this.wD(i[t],e);if(null!==s)return s}}return null}findObject(t){if(this.name===t)return this;const e=this.D.r;let i=e.length;null!==this.Ta&&(i=this.U0());for(let s=0;s<i;s++){const i=e[s];if(i instanceof Yt){const e=i.findObject(t);if(null!==e)return e}if(i.name===t)return i}return null}xD(){const t=this.D.r,e=t.length;let i=0;for(let s=0;s<e;s++){const e=t[s];e instanceof Yt?i=Math.max(i,e.xD()):e instanceof $t&&(i=Math.max(i,e.jI()))}return i}Mn(){return!(this.type===Yt.TableRow||this.type===Yt.TableColumn)}nl(){return this.type===Yt.TableRow||this.type===Yt.TableColumn}XA(t,e,i){if(!1===this.pickable||(void 0===e&&(e=null),void 0===i&&(i=null),this.as()))return null;const s=this.naturalBounds,n=1/this.getDocumentScale(),o=this.Mn(),r=o?t:y.z(t.x,t.y).Yi(this.v),a=this.diagram;let h=10,l=5;if(null!==a&&(h=a.getInputOption("extraTouchArea"),l=h/2),w.contains(-l*n,-l*n,s.width+h*n,s.height+h*n,r.x,r.y)){if(!this.Af){const s=this.D.r,n=s.length,a=y.l(),h=this.isClipping&&this.W===Yt.Spot,l=h?this.findMainElement():null;if(h&&l&&(l.Mn()?a.set(t).Yi(l.v):a.set(t),!l.containsPoint(a)))return y.i(a),o||y.i(r),null;const u=this.Jo();for(let c=n;c--;){const n=s[c];if(!n.visible&&n!==u||(n.Mn()?a.set(t).Yi(n.v):a.set(t),h&&n===l))continue;let d=null;if(n instanceof Yt?d=n.XA(a,e,i):!0===n.pickable&&n.containsPoint(a)&&(d=n),null!==d&&(null!==e&&(d=e(d)),null!==d&&(null===i||i(d))))return y.i(a),o||y.i(r),d}y.i(a)}if(null===this.background)return o||y.i(r),null;const n=w.contains(0,0,s.width,s.height,r.x,r.y)?this:null;return o||y.i(r),n}return o||y.i(r),null}GA(t,e,i,s){if(!1===this.pickable)return!1;void 0===e&&(e=null),void 0===i&&(i=null);const n=this.naturalBounds,o=this.Mn(),r=o?t:y.z(t.x,t.y).Yi(this.v),a=this.nl(),h=w.contains(0,0,n.width,n.height,r.x,r.y);if(a||h){if(!this.Af){const n=this.D.r,o=n.length,r=y.l(),a=this.Jo();for(let h=o;h--;){const o=n[h];if(!o.visible&&o!==a)continue;o.Mn()?r.set(t).Yi(o.v):r.set(t);let l=o;const u=o instanceof Yt?o:null;if(null!==u?u.GA(r,e,i,s):l.containsPoint(r)){if(!1===l.pickable)continue;null!==e&&(l=e(l)),null!==l&&(null===i||i(l))&&s.add(l)}}y.i(r)}return o||y.i(r),h&&null!==this.background}return o||y.i(r),!1}Zm(t,e,i,s,n,o){if(!1===this.pickable)return!1;void 0===e&&(e=null),void 0===i&&(i=null);let r=o;if(void 0===r&&(r=P.l(),r.Ue()),r.bc(this.v),this.containedInRect(t,r))return this.$N(e,i,n),void 0===o&&P.i(r),!0;if(this.intersectsRect(t,r)){if(!this.Af){const o=this.Jo(),a=this.D.r;for(let h=a.length;h--;){const l=a[h];if(!l.visible&&l!==o)continue;const u=l.actualBounds,c=this.naturalBounds;if(u.x>c.width||u.y>c.height||u.x+u.width<0||u.y+u.height<0)continue;let d=l;const g=l instanceof Yt?l:null,f=P.l();f.set(r),(null!==g?g.Zm(t,e,i,s,n,f):d.ZT(t,s,f))&&(null!==e&&(d=e(d)),null!==d&&(null===i||i(d))&&n.add(d)),P.i(f)}}return void 0===o&&P.i(r),s}return void 0===o&&P.i(r),!1}$N(t,e,i){const s=this.D.r;for(let n=s.length;n--;){const o=s[n];if(!o.visible)continue;const r=o.actualBounds,a=this.naturalBounds;if(r.x>a.width||r.y>a.height||r.x+r.width<0||r.y+r.height<0)continue;o instanceof Yt&&o.$N(t,e,i);let h=o;null!==t&&(h=t(h)),null!==h&&(null===e||e(h))&&i.add(h)}}YA(t,e,i,s,n,o){if(!1===this.pickable)return!1;void 0===i&&(i=null),void 0===s&&(s=null);const r=this.naturalBounds,a=this.Mn(),h=a?t:y.z(t.x,t.y).Yi(this.v),l=a?e:y.z(e.x,e.y).Yi(this.v),u=h.distanceSquaredPoint(l),c=h.x>0&&h.x<r.width&&h.y>0&&h.y<r.height||y.distanceLineSegmentSquared(h.x,h.y,0,0,0,r.height)<=u||y.distanceLineSegmentSquared(h.x,h.y,0,r.height,r.width,r.height)<=u||y.distanceLineSegmentSquared(h.x,h.y,r.width,r.height,r.width,0)<=u||y.distanceLineSegmentSquared(h.x,h.y,r.width,0,0,0)<=u,d=h.distanceSquared(0,0)<=u&&h.distanceSquared(0,r.height)<=u&&h.distanceSquared(r.width,0)<=u&&h.distanceSquared(r.width,r.height)<=u;if(a||(y.i(h),y.i(l)),c){if(!this.Af){const r=y.l(),h=y.l(),l=this.Jo(),u=this.D.r;for(let c=u.length;c--;){const d=u[c];if(!d.visible&&d!==l)continue;const g=d.actualBounds,f=this.naturalBounds;if(a&&(g.x>f.width||g.y>f.height||g.x+g.width<0||g.y+g.height<0))continue;if(d.Mn()){const i=d.v;r.set(t).Yi(i),h.set(e).Yi(i)}else r.set(t),h.set(e);let m=d;const p=d instanceof Yt?d:null;(null!==p?p.YA(r,h,i,s,n,o):m.QT(r,h,n))&&(null!==i&&(m=i(m)),null!==m&&(null===s||s(m))&&o.add(m))}y.i(r),y.i(h)}return n?c:d}return!1}YN(t){let e=null;if(t instanceof $t){e=t.spot1,e===v.Default&&(e=null);const i=t.geometry;null!==i&&null===e&&(e=i.spot1)}return null===e&&(e=v.TopLeft),e}KN(t){let e=null;if(t instanceof $t){e=t.spot2,e===v.Default&&(e=null);const i=t.geometry;null!==i&&null===e&&(e=i.spot2)}return null===e&&(e=v.BottomRight),e}add(...t){for(let e=0;e<t.length;e++)this.insertAt(this.D.count,t[e]);return this}elt(t){return this.D.elt(t)}insertAt(t,i){i instanceof ce&&e.o("Cannot add a Part to a Panel: "+i+"; use a Panel instead"),(this===i||this.isContainedBy(i))&&(this===i&&e.o("Cannot make a Panel contain itself: "+this.toString()),e.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+i.toString()));const s=i.panel;if(null!==s&&s!==this&&e.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+i.toString()+", already contained by "+s.toString()+", cannot be shared by this Panel: "+this.toString()),this.W===Yt.Grid&&!(i instanceof $t)&&e.o("Can only add Shapes to a Grid Panel, not: "+i),this.W===Yt.Graduated&&!(i instanceof $t||i instanceof ie)&&e.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+i),i.Uh(this),i.sl=null,null!==this.itemArray){const t=i.data;e.$(t)&&(null===this._s&&(this._s=new p),this._s.set(t,i))}const n=this.D;let o=-1;if(s===this){let r=-1;const a=this.D.r,h=a.length;for(let t=0;t<h;t++)if(a[t]===i){r=t;break}if(-1!==r){if(r===t||r+1>=n.count&&t>=n.count)return;n.removeAt(r),o=r}else e.o("element "+i.toString()+" has panel "+s.toString()+" but is not contained by it.")}(t<0||t>n.count)&&(t=n.count),n.insertAt(t,i),(0===t||i.isPanelMain)&&(this.rl=null),this.Xo()||this.f(),i.f(!1),(null!==i.portId||i instanceof Yt&&!0===i.Cn)&&(this.Cn=!0),this.ds=null,this.isEnabledObject()||this.Z1(i,!1);const r=this.part;if(null!==r){r.s0(),r.Tf(),this.Cn&&r instanceof me&&(r.Cn=!0),r.Cn&&r instanceof me&&(r.ci=null);const e=this.diagram;if(null!==e&&e.undoManager.isUndoingRedoing)return;-1!==o&&r.raiseChangedEvent(4,"elements",this,i,null,o,null),r.raiseChangedEvent(3,"elements",this,null,i,null,t)}}get Cn(){return!!(8388608&this.n)}set Cn(t){!!(8388608&this.n)!==t&&(this.n=8388608^this.n)}NN(){return!!(16777216&this.n)}ZN(t){t?this.n|=16777216:this.n&=-16777217}HI(t){t.Uh(this),t.sl=null;const e=this.D,i=e.count;e.insertAt(i,t);const s=this.part;if(null!==s){s.s0(),null!==t.portId&&s instanceof me&&(s.Cn=!0);const e=this.diagram;if(null!==e&&e.undoManager.isUndoingRedoing)return;s.raiseChangedEvent(3,"elements",this,null,t,null,i)}}fI(t){const e=this.D.r,i=e.length;let s=-1;for(let n=0;n<i;n++)if(e[n]===t){s=n;break}return s}remove(t){const e=this.D.r,i=e.length;let s=-1;for(let n=0;n<i;n++)if(e[n]===t){s=n;break}-1!==s&&this.ri(s,!0)}removeAt(t){t>=0&&this.ri(t,!0)}ri(t,i){const s=this.D,n=s.elt(t);if(n.sl=null,n.Uh(null),null!==this._s){const t=n.data;e.$(t)&&this._s.delete(t)}s.removeAt(t),this.xi(!1),this.f(),this.rl===n&&(this.rl=null),this.ds=null;const o=this.part;if(null!==o){o.s0(),o.Tf(),o.invalidateAdornments(),o instanceof me&&(n instanceof Yt?n.walkVisualTreeFrom(n,((t,e)=>o.RN(e,i))):o.RN(n,i));const e=this.diagram;if(null!==e&&e.undoManager.isUndoingRedoing)return;o.raiseChangedEvent(4,"elements",this,n,null,t,null)}}get Zi(){return null===this.O&&(this.O=new Wt),this.O.Zi}get rowCount(){return null===this.O?0:this.Zi.length}getRowDefinition(t){t<0&&e.J(t,">= 0",Yt,"getRowDefinition:idx"),t=Math.round(t);const i=this.Zi;if(void 0===i[t]){const e=new Jt;e.Uh(this),e.isRow=!0,e.index=t,i[t]=e,this.raiseChangedEvent(3,"rowdefs",this,null,e,null,t)}return i[t]}removeRowDefinition(t){if(t<0&&e.J(t,">= 0",Yt,"removeRowDefinition:idx"),0===this.rowCount)return;t=Math.round(t);const i=this.Zi,s=i[t];if(s){i[t]=void 0;let e=i.length-1;for(;e>=0&&void 0===i[e--];)i.length--;this.raiseChangedEvent(4,"rowdefs",this,s,null,t,null),this.f()}}kT(t,e){const i=this.Zi;if(!(t<0)){if(i[t]=e instanceof Jt?e:void 0,!e){let t=i.length-1;for(;t>=0&&void 0===i[t--];)i.length--}this.f()}}get Qi(){return null===this.O&&(this.O=new Wt),this.O.Qi}get columnCount(){return null===this.O?0:this.Qi.length}getColumnDefinition(t){t<0&&e.J(t,">= 0",Yt,"getColumnDefinition:idx"),t=Math.round(t);const i=this.Qi;if(void 0===i[t]){const e=new Jt;e.Uh(this),e.isRow=!1,e.index=t,i[t]=e,this.raiseChangedEvent(3,"coldefs",this,null,e,null,t)}return i[t]}removeColumnDefinition(t){if(t<0&&e.J(t,">= 0",Yt,"removeColumnDefinition:idx"),0===this.columnCount)return;t=Math.round(t);const i=this.Qi,s=i[t];if(s){i[t]=void 0;let e=i.length-1;for(;e>=0&&void 0===i[e--];)i.length--;this.raiseChangedEvent(4,"coldefs",this,s,null,t,null),this.f()}}PT(t,e){const i=this.Qi;if(!(t<0)){if(i[t]=e instanceof Jt?e:void 0,!e){let t=i.length-1;for(;t>=0&&void 0===i[t--];)i.length--}this.f()}}addRowColumnDefinition(t){let e=null;return t.isRow?e=this.getRowDefinition(t.index):t.isRow||(e=this.getColumnDefinition(t.index)),e&&e.X1(t),this}addRowDefinition(t,e){const i=this.getRowDefinition(t);return i&&i.X1(new Jt(e)),this}addColumnDefinition(t,e){const i=this.getColumnDefinition(t);return i&&i.X1(new Jt(e)),this}get rowSizing(){return null!==this.O?this.O.V0:3}set rowSizing(t){const e=this.rowSizing;e!==t&&(null===this.O&&(this.O=new Wt),this.O.V0=t,this.f(),this.t("rowSizing",e,t))}get columnSizing(){return null!==this.O?this.O.B0:3}set columnSizing(t){const e=this.columnSizing;e!==t&&(null===this.O&&(this.O=new Wt),this.O.B0=t,this.f(),this.t("columnSizing",e,t))}get topIndex(){return null!==this.O?this.O.z0:0}set topIndex(t){const i=this.topIndex;i!==t&&((!isFinite(t)||t<0)&&e.o("Panel.topIndex must be greater than zero and a real number, not: "+t),null===this.O&&(this.O=new Wt),this.O.z0=t,this.f(),this.t("topIndex",i,t))}get leftIndex(){return null!==this.O?this.O.X0:0}set leftIndex(t){const i=this.leftIndex;i!==t&&((!isFinite(t)||t<0)&&e.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),null===this.O&&(this.O=new Wt),this.O.X0=t,this.f(),this.t("leftIndex",i,t))}findRowForLocalY(t){if(t<0||this.type!==Yt.Table||0===this.rowCount)return-1;let e=0;const i=this.Zi,s=i.length;let n=this.topIndex;for(;n<s;n++){const s=i[n];if(void 0!==s&&(e+=s.total,t<e))return n}return n}findColumnForLocalX(t){if(t<0||this.type!==Yt.Table||0===this.columnCount)return-1;let e=0;const i=this.Qi,s=i.length;let n=this.leftIndex;for(;n<s;n++){const s=i[n];if(void 0!==s&&(e+=s.total,t<e))return n}return n}graduatedPointForValue(t,e){if(void 0===e&&(e=new y(NaN,NaN)),this.type!==Yt.Graduated)return e.e(NaN,NaN),e;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);const i=this.findMainElement();return i.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,e),i.v.gt(e)}graduatedValueForPoint(t){if(this.type!==Yt.Graduated)return NaN;const e=this.findMainElement();return e.v.Ci(t),e.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this.te}set data(t){const i=this.te;if(i!==t){const s=this instanceof ce&&!(this instanceof ge);s&&e.s(t,"object",Yt,"data"),this.It(),this.te=t;const n=this.diagram;if(null!==n)if(s){n.partManager.WI(this,i,t);let e=this.adornments;for(;e.next();){const t=e.value,i=t.adornedObject;if(null!==i){const e=i.findBindingPanel();null!==e&&(t.data=e.data)}}}else{const e=this.panel;null!==e&&null!==e._s&&(null!==i&&e._s.delete(i),null!==t&&e._s.set(t,this))}if(this.t("data",i,t),null!==n&&n.undoManager.isUndoingRedoing)return;null!==t&&this.updateTargetBindings()}}get itemIndex(){return this.Fd}set itemIndex(t){const e=this.Fd;e!==t&&(this.Fd=t,this.t("itemIndex",e,t))}get Ds(){return null!==this.w?this.w.Ds:null}set Ds(t){this.ve!==t&&(null===this.w&&(this.w=new Dt),this.w.Ds=t)}ON(){return null!==this.Ds}rD(){const t=this.Ds;return null!==t&&t.u}freezeBindings(){return this.It()}It(){let t=this.Ds;if(null===t)null!==this.data&&e.o("Template cannot have .data be non-null: "+this),this.Ds=t=new h;else if(t.u)return this;const i=new h;this.ZN(!1),this.walkVisualTreeFrom(this,((e,s)=>{s.ba();const n=s.ve;if(null!==n){s.DN(!1);const o=n.iterator;for(;o.next();){const n=o.value;2===n.mode&&s.DN(!0);const r=n.sourceName;if(n.isToObject){"/"===r&&e.ZN(!0);const t=n.$T(e,s);null!==t&&(i.add(t),null===t.oo&&(t.oo=new h),t.oo.add(n))}t.add(n)}}if(s instanceof Yt&&s.type===Yt.Table){if(s.rowCount>0){const e=s.Zi,i=e.length;for(let s=0;s<i;s++){const i=e[s];if(void 0!==i&&null!==i.Fs){const e=i.Fs.iterator;for(;e.next();){const s=e.value;s.Ti=i,s.Id=2,s.Df=i.index,t.add(s)}}}}if(s.columnCount>0){const e=s.Qi,i=e.length;for(let s=0;s<i;s++){const i=e[s];if(void 0!==i&&null!==i.Fs){const e=i.Fs.iterator;for(;e.next();){const s=e.value;s.Ti=i,s.Id=1,s.Df=i.index,t.add(s)}}}}}}));const s=i.iterator;for(;s.next();){const t=s.value;if(null!==t.oo){t.DN(!0);const e=t.oo.iterator;for(;e.next();){const i=e.value;null===t.ve&&(t.ve=new h),t.ve.add(i)}}t.oo=null}let n=t.iterator;for(;n.next();){const t=n.value;let i=t.Ti;if(null!==i){t.Ti=null;const s=t.targetProperty,n=s.indexOf(".");if(n>0&&i instanceof Yt){const o=s.substring(0,n),r=s.substring(n+1),a=i.findObject(o);null!==a?(i=a,t.targetProperty=r):(e.ne('Warning: unable to find GraphObject named "'+o+'" for Binding: '+t.toString()),i=null)}if(i instanceof Jt){const e=u.xs(i.panel);t.targetId=void 0===e?-1:e,i.panel.no=t.targetId}else if(i instanceof At){const e=u.xs(i);t.targetId=void 0===e?-1:e,i.no=t.targetId}else e.o("Unknown type of binding target: "+i);t.check(i)}}return t.k(),this instanceof ce&&this.Di()&&this.ensureBounds(),this}static BU=!1;copyTemplate(t){void 0===t&&(t=!1);const e=this.copy();return e.qI((t=>{t instanceof Yt&&(t.Ds=null,t.te=null);const e=t.ve;null!==e&&(t.ve=null,e.each((e=>t.bind(e.copy()))));const i=t.Ts;null!==i&&(t.Ts=null,i.each((e=>t.trigger(e.value.copy()))))})),t&&e.It(),e}updateTargetBindings(t){const e=this.Ds;if(null===e)return;void 0===t&&(t="");const i=this.diagram?.model,s=e.iterator;for(;s.next();){const e=s.value,n=this.QN(e,t);if(null===n)continue;const{data:o,elt:r}=n;e.isToTheme&&null===this.diagram||void 0!==r&&e.updateTarget(r,o,void 0,i)}}JI(t){if(""===t)return void this.updateTargetBindings(t);const e=this.Ds;if(null===e)return;const i=this.diagram?.model,s=e.iterator;for(;s.next();){const t=s.value;if(t.isToData&&""!==t.sourceProperty)continue;const e=this.QN(t,"");if(null===e)continue;const{data:n,elt:o}=e;void 0!==o&&t.updateTarget(o,n,void 0,i)}}Go(){if(null!==this.diagram)if(this.ON()){const t=this.diagram.model,e=this.Ds.iterator;for(;e.next();){const i=e.value;if(!i.isToTheme)continue;const s=this.QN(i);if(null===s)continue;const{data:n,elt:o}=s;void 0!==o&&i.updateTarget(o,n,void 0,t)}}else{const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].Go()}}QN(t,e=""){const i=t.sourceProperty;if(""!==e&&""!==i&&i!==e)return null;const s=t.targetProperty;if(null===t.converter&&""===s)return null;let n=this.data;const o=t.sourceName;if(t.isToObject){if(n=this.JT(o),null===n)return null}else if(t.isToModel){const t=this.diagram;if(null===t)return null;n=t.model.modelData}let r=this;const a=t.targetId;if(-1!==a){if(r=this.Yp(a),null===r)return null}else null!==t.Ti&&(r=t.Ti);"/"===o?n=r.part:"."===o?n=r:".."===o&&(n=r.panel);const h=t.Id;if(0!==h){if(!(r instanceof Yt))return null;1===h?r=r.getColumnDefinition(t.Df):2===h&&(r=r.getRowDefinition(t.Df))}return{data:n,elt:r}}get itemArray(){return this.Ta}set itemArray(t){const e=this.Ta;if(e!==t||null!==t&&this.$I(t)){const i=this.diagram;if(e!==t&&(null!==i&&null!==e&&i.partManager.L2(this,i),this.Ta=t,null!==i&&null!==t&&i.partManager.C2(this,i)),this.t("itemArray",e,t),null!==i&&i.undoManager.isUndoingRedoing)return;this.bD(e,t)}}findItemPanelForData(t){return null==t||null===this._s?null:(e.wc(t,Yt,"findItemPanelForData"),this._s.get(t))}$I(t){const e=this.D.r,i=e.length,s=t.length;let n=0,o=null;for(;n<i&&(o=e[n],!(o instanceof Yt)||null===o.data);)n++,o=e[n];if(i-n!==s)return!0;if(null===o)return s>0;let r=0;for(;n<i&&r<s;){if(o=e[n],!(o instanceof Yt)||o.data!==t[r])return!0;n++,r++}return!1}U0(){if(this.type===Yt.Spot||this.type===Yt.Auto)return Math.min(this.D.length,1);if(this.type===Yt.Link){const t=this.D,e=t.length;let i=0;for(;i<e;i++){const e=t.elt(i);if(!(e instanceof $t&&e.isPanelMain))return i}return i}if(this.type===Yt.Table&&this.D.length>0){const t=this.D.elt(0);if(t.isPanelMain&&t instanceof Yt&&t.nl())return 1}return 0}rebuildItemElements(){const t=this.U0();for(;this.D.length>t;)this.ri(this.D.length-1,!1);this.bD(null,this.itemArray)}bD(t,e){const i=this.U0(),s=e;if(null!==s&&0!==s.length)if(this.D.length<=i){const t=s.length;for(let e=0;e<t;e++)this.Q1(s[e],e,!0)}else{let t=i;for(let e=0;e<s.length;e++,t++){const i=s[e],n=t<this.D.length?this.D.elt(t):null;if(n instanceof Yt){if(n.data!==i){const s=this._N(n.data,e),o=this._N(i,e);let r=o!==s;if(!r){const t=this.tC(n.data,e,s);r=this.tC(i,e,o)!==t}r?(this.ri(t,!1),this.Q1(i,e,!1)):n.data=i}}else this.Q1(i,e,!1)}for(;t<this.D.length;)this.ri(t,!1);this.rl=null,this.eC(i,0),this.Xo()||this.f(),this.ds=null,this.isEnabledObject()||this.Z1(this,!1);const e=this.part;null!==e&&(e.s0(),e.Tf(),this.Cn&&e instanceof me&&(e.Cn=!0),e.Cn&&e instanceof me&&(e.ci=null))}else for(;this.D.length>i;)this.ri(this.D.length-1,!1)}Q1(t,i,s){if(null==t||i<0)return;const n=this._N(t,i),o=this.tC(t,i,n);if(null!==o){o.It();const n=o.copy();if(n.NN()){const t=this.findBindingPanel();null!==t&&t.ZN(!0)}e.$(t)&&(null===this._s&&(this._s=new p),this._s.set(t,n));const r=i+this.U0();this.insertAt(r,n),s&&(n.te=t,this.eC(r,i),n.te=null),n.data=t}}ZI(t){if(t<0)return;const e=t+this.U0();this.ri(e,!0),this.eC(e,t)}eC(t,e){const i=this.D;let s=t,n=e;for(;s<i.length;){const t=i.elt(s);t instanceof Yt&&t.QI(s,n),s++,n++}}QI(t,e){this.type===Yt.TableRow?this.row=t:this.type===Yt.TableColumn&&(this.column=t),this.itemIndex=e}get itemTemplate(){const t=this.itemTemplateMap;if(null!==t){const e=t.get("");if(e)return e}return Yt.kD()}set itemTemplate(t){const i=this.itemTemplate;if(i!==t){(t instanceof ce||t.isPanelMain)&&e.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),null===this.itemTemplateMap&&(this.itemTemplateMap=new p),this.itemTemplateMap.set("",t),this.t("itemTemplate",i,t);const s=this.diagram;if(null!==s&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return null!==this.w?this.w.x0:null}set itemTemplateMap(t){const e=this.itemTemplateMap;if(e!==t){const i=t.iterator;for(;i.next();){i.value}this.Yt().x0=t,this.t("itemTemplateMap",e,t);const s=this.diagram;if(null!==s&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return null!==this.w?this.w.b0:"category"}set itemCategoryProperty(t){const i=this.itemCategoryProperty;i!==t&&("string"!=typeof t&&!e.st(t)&&e.si(t,"string or function",Yt,"itemCategoryProperty"),this.Yt().b0=t,this.t("itemCategoryProperty",i,t))}_N(t,i){if(null===t)return"";const s=this.itemCategoryProperty;let n="";if(e.st(s))n=s(t);else{if("string"!=typeof s||!e.$(t))return"";{if(""===s)return"";const e=this.diagram,i=null!==e?e.model:null;n=i?i.St(t,s):Ue.St(t,s)}}return void 0===n?"":"string"==typeof n?n:void e.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+n)}static PD=!1;static iC;static kD(){return Yt.iC||(Yt.iC=(new Yt).add((new ie).bind("text","",e.toString).theme("stroke","text"))),Yt.iC}tC(t,i,s){let n=null;const o=this.itemTemplateMap;return null!==o&&(n=o.get(s),null===n&&(n=o.get(""))),null===n&&(Yt.PD||(Yt.PD=!0,e.ne('No item template Panel found for category "'+s+'" on '+this),e.ne("  Using default item template.")),n=Yt.kD()),n}get Af(){return!!(1048576&this.n)}set Af(t){const i=!!(1048576&this.n);i!==t&&(e.s(t,"boolean",Yt,"isAtomic"),this.n=1048576^this.n,this.t("isAtomic",i,t))}get isClipping(){return!!(2097152&this.n)}set isClipping(t){const e=!!(2097152&this.n);e!==t&&(this.wf(),this.n=2097152^this.n,this instanceof Ne&&(this.he=null),this.f(),this.t("isClipping",e,t))}get isOpposite(){return!!(33554432&this.n)}set isOpposite(t){const e=!!(33554432&this.n);e!==t&&(this.n=33554432^this.n,this.f(),this.t("isOpposite",e,t))}get isEnabled(){return!!(4194304&this.n)}set isEnabled(t){const e=!!(4194304&this.n);if(e!==t){const i=null===this.panel||this.panel.isEnabledObject();this.n=4194304^this.n,this.t("isEnabled",e,t);const s=this.diagram;if(null!==s&&s.undoManager.isUndoingRedoing)return;i&&this.Z1(this,t)}}Z1(t,e){const i=t.enabledChanged;if(null!==i&&i(t,e),t instanceof Yt){const i=t.D.r,s=i.length;for(let t=0;t<s;t++){const s=i[t];e&&s instanceof Yt&&!s.isEnabled||this.Z1(s,e)}}}get alignmentFocusName(){return this.fo}set alignmentFocusName(t){const e=this.fo;e!==t&&(this.fo=t,this.f(),this.t("alignmentFocusName",e,t))}static definePanelLayout(t,e){jt.An(t,e)}static isLayoutDefined(t){return jt.fs.has(t)}static Position=jt.fs.get("Position");static Horizontal=jt.fs.get("Horizontal");static Vertical=jt.fs.get("Vertical");static Spot=jt.fs.get("Spot");static Auto=jt.fs.get("Auto");static Table=jt.fs.get("Table");static Viewbox=jt.fs.get("Viewbox");static TableRow=jt.fs.get("TableRow");static TableColumn=jt.fs.get("TableColumn");static Link=jt.fs.get("Link");static Grid=jt.fs.get("Grid");static Graduated=jt.fs.get("Graduated")}Yt.definePanelLayout=Yt.definePanelLayout;class qt{R0;O0;I0;E0;vs;_i;ds;vi;constructor(){this.R0=0,this.O0=100,this.I0=10,this.E0=0,this.vs=null,this._i=null,this.ds=null,this.vi=null}copy(){const t=new qt;return t.R0=this.R0,t.O0=this.O0,t.I0=this.I0,t.E0=this.E0,t.vs=this.vs,t._i=this._i,t.ds=this.ds,t.vi=this.vi,t}}class Ht{Rd;Od;lf;N0;constructor(){this.Rd=x.EL,this.Od=y.dn,this.lf=x.Zw,this.N0=[]}copy(){const t=new Ht;return t.Rd=this.Rd.copy(),t.Od=this.Od.copy(),t.lf=this.lf.copy(),t.N0=this.N0,t}}class Wt{Zi;Qi;V0;B0;z0;X0;C0;A0;L0;T0;v0;D0;F0;Aa;constructor(){this.Zi=[],this.Qi=[],this.V0=3,this.B0=3,this.z0=0,this.X0=0,this.C0=b.im,this.A0=1,this.L0=null,this.T0=null,this.v0=1,this.D0=null,this.F0=null,this.Aa=null}copy(t){const e=new Wt,i=this.Zi,s=i.length,n=e.Zi;for(let e=0;e<s;e++){const s=i[e];if(void 0===s)continue;const o=s.copy();o.Uh(t),n[e]=o}const o=this.Qi,r=o.length,a=e.Qi;for(let e=0;e<r;e++){const i=o[e];if(void 0===i)continue;const s=i.copy();s.Uh(t),a[e]=s}return e.V0=this.V0,e.B0=this.B0,e.z0=this.z0,e.X0=this.X0,e.C0=this.C0.N(),e.A0=this.A0,e.L0=this.L0,e.T0=this.T0,e.v0=this.v0,e.D0=this.D0,e.F0=this.F0,e.Aa=this.Aa,e}}var _t=(t=>(t[t.Default=1]="Default",t[t.None=2]="None",t[t.ProportionalExtra=3]="ProportionalExtra",t))(_t||{});class Jt{$s;G0;Tt;Xh;Gh;de;ct;Ed;ao;ll;Ud;Vd;Yh;Lt;Bd;Fs;q;Re;ki;constructor(t){u.Je(this),this.$s=null,this.G0=!0,this.Tt=0,this.ki=NaN,this.Xh=0,this.Gh=1/0,this.de=v.Default,this.q=0,this.Re=0,this.ct=0,this.Fs=null,this.Ed=1,this.ao=1,this.ll=null,this.Ud=null,this.Vd=NaN,this.Yh=null,this.Lt=null,this.Bd=!1,t&&(Object.assign(this,t),void 0!==t.column?(this.isRow=!1,this.index=t.column):void 0!==t.row&&(this.isRow=!0,this.index=t.row))}copy(){const t=new Jt;return t.G0=this.G0,t.Tt=this.Tt,t.ki=this.ki,t.Xh=this.Xh,t.Gh=this.Gh,t.de=this.de,t.q=this.q,t.Re=this.Re,t.ct=this.ct,t.ao=this.ao,t.Ed=this.Ed,null===this.ll?t.ll=null:t.ll=this.ll.N(),t.Ud=this.Ud,t.Vd=this.Vd,t.Yh=null,null!==this.Yh&&(t.separatorDashArray=this.Yh.slice()),t.Lt=this.Lt,t.Bd=this.Bd,t.Fs=this.Fs,t}X1(t){t.isRow?void 0!==t.height&&(this.height=t.height):void 0!==t.width&&(this.width=t.width),void 0!==t.minimum&&(this.minimum=t.minimum),void 0!==t.maximum&&(this.maximum=t.maximum),void 0!==t.alignment&&(this.alignment=t.alignment),void 0!==t.stretch&&(this.stretch=t.stretch),void 0!==t.sizing&&(this.sizing=t.sizing),void 0!==t.separatorPadding&&(this.separatorPadding=t.separatorPadding),void 0!==t.separatorStroke&&(this.separatorStroke=t.separatorStroke),void 0!==t.separatorStrokeWidth&&(this.separatorStrokeWidth=t.separatorStrokeWidth),void 0!==t.separatorDashArray&&(this.Yh=t.separatorDashArray),void 0!==t.background&&(this.background=t.background),void 0!==t.coversSeparators&&(this.coversSeparators=t.coversSeparators),void 0!==t.Fs&&(this.Fs=t.Fs)}fe(t){t in _t?this.sizing=t:e.ur(this,t)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+u.xs(this)}static Default=1;static None=2;static ProportionalExtra=3;Uh(t){this.$s=t}computeEffectiveSpacingTop(t){let e=0;const i=this.$s;if(this.index!==t){let t=this.separatorStroke;null===t&&null!==i&&(t=this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),null!==t&&(e=this.separatorStrokeWidth,isNaN(e)&&(e=null!==i?this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:0))}let s=this.ll;if(null===s){if(null===i)return e;s=i.defaultSeparatorPadding}return e+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let t=0;const e=this.$s;let i=0;const s=this.isRow;if(null!==e&&e.type===Yt.Table){const t=s?e.Zi.length:e.Qi.length;for(let n=0;n<t;n++){const t=s?e.Zi[n]:e.Qi[n];if(void 0!==t&&0!==t.q){i=t.index;break}}}if(this.index!==i){let i=this.separatorStroke;null===i&&null!==e&&(i=s?e.defaultRowSeparatorStroke:e.defaultColumnSeparatorStroke),null!==i&&(t=this.separatorStrokeWidth,isNaN(t)&&(t=null!==e?s?e.defaultRowSeparatorStrokeWidth:e.defaultColumnSeparatorStrokeWidth:0))}let n=this.ll;if(null===n){if(null===e)return t;n=e.defaultSeparatorPadding}return t+(this.isRow?n.top+n.bottom:n.left+n.right)}t(t,e,i,s,n){const o=this.$s;if(null!==o&&(o.raiseChangedEvent(2,t,this,e,i,s,n),null!==this.Fs)){const e=o.diagram;if(null!==e&&!e.wi){const e=o.findBindingPanel();if(null!==e){const i=e.data;if(null!==i){const s=this.Fs.iterator;for(;s.next();)s.value.updateSource(this,i,t,e)}}}}}get panel(){return this.$s}get isRow(){return this.G0}set isRow(t){this.G0=t}get index(){return this.Tt}set index(t){this.Tt=t}get height(){return this.ki}set height(t){const i=this.ki;i!==t&&(t<0&&e.J(t,">= 0",Jt,"height"),this.ki=t,this.actual=this.q,null!==this.panel&&this.panel.f(),this.t("height",i,t))}get width(){return this.ki}set width(t){const i=this.ki;i!==t&&(t<0&&e.J(t,">= 0",Jt,"width"),this.ki=t,this.actual=this.q,null!==this.panel&&this.panel.f(),this.t("width",i,t))}get minimum(){return this.Xh}set minimum(t){const i=this.Xh;i!==t&&((t<0||!isFinite(t))&&e.J(t,">= 0",Jt,"minimum"),this.Xh=t,this.actual=this.q,null!==this.panel&&this.panel.f(),this.t("minimum",i,t))}get maximum(){return this.Gh}set maximum(t){const i=this.Gh;i!==t&&(t<0&&e.J(t,">= 0",Jt,"maximum"),this.Gh=t,this.actual=this.q,null!==this.panel&&this.panel.f(),this.t("maximum",i,t))}get alignment(){return this.de}set alignment(t){const e=this.de;e.equals(t)||(this.de=t.N(),null!==this.panel&&this.panel.f(),this.t("alignment",e,t))}get stretch(){return this.ao}set stretch(t){const e=this.ao;e!==t&&(this.ao=t,null!==this.panel&&this.panel.f(),this.t("stretch",e,t))}get separatorPadding(){return this.ll}set separatorPadding(t){"number"==typeof t&&(t=new b(t));const e=this.ll;(null===t||null===e||!e.equals(t))&&(null!==t&&(t=t.N()),this.ll=t,null!==this.panel&&this.panel.f(),this.t("separatorPadding",e,t))}get separatorStroke(){return this.Ud}set separatorStroke(t){const e=this.Ud;e!==t&&(null!==t&&Ut.Md(t,"RowColumnDefinition.separatorStroke"),t instanceof Ut&&t.k(),this.Ud=t,null!==this.panel&&this.panel.f(),this.t("separatorStroke",e,t))}get separatorStrokeWidth(){return this.Vd}set separatorStrokeWidth(t){const e=this.Vd;e!==t&&(this.Vd=t,null!==this.panel&&this.panel.f(),this.t("separatorStrokeWidth",e,t))}get separatorDashArray(){return this.Yh}set separatorDashArray(t){const i=this.Yh;if(i!==t){if(null!==t&&!Array.isArray(t)&&e.si(t,"Array",Jt,"separatorDashArray:value"),null!==t){const s=t.length;let n=0;for(let i=0;i<s;i++){const s=t[i];("number"!=typeof s||!(s>=0)||!isFinite(s))&&e.o("separatorDashArray value "+s+" at index "+i+" must be a positive number or zero."),n+=s}if(0===n){if(null===i)return;t=null}}this.Yh=t,null!==this.panel&&this.panel.C(),this.t("separatorDashArray",i,t)}}get background(){return this.Lt}set background(t){const e=this.Lt;e!==t&&(null!==t&&Ut.Md(t,"RowColumnDefinition.background"),t instanceof Ut&&t.k(),this.Lt=t,null!==this.panel&&this.panel.C(),this.t("background",e,t))}get coversSeparators(){return this.Bd}set coversSeparators(t){const i=this.Bd;i!==t&&(e.s(t,"boolean",Jt,"coversSeparators"),this.Bd=t,null!==this.panel&&this.panel.C(),this.t("coversSeparators",i,t))}get sizing(){return this.Ed}set sizing(t){const e=this.Ed;e!==t&&(this.Ed=t,null!==this.panel&&this.panel.f(),this.t("sizing",e,t))}j1(){if(1===this.sizing){const t=this.$s;return null===t?2:this.isRow?t.rowSizing:t.columnSizing}return this.sizing}get actual(){return this.q}set actual(t){isNaN(this.ki)?this.q=Math.max(Math.min(this.Gh,t),this.Xh):this.q=Math.max(Math.min(this.Gh,this.ki),this.Xh)}get measured(){return this.Re}set measured(t){this.Re=t}get total(){return this.q+this.computeEffectiveSpacing()}get position(){return this.ct}set position(t){this.ct=t}bind(t,e,i,s){return this.Pf(t,e,i,s),this}bindTwoWay(t,e,i,s){const n=this.Pf(t,e,i,s);return void 0===s&&n.makeTwoWay(),this}theme(t,e,i,s,n){return this.Ca(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.Ca(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,o){return this.Ca(t,e,i,s,n).ofObject(o),this}themeModel(t,e,i,s,n){return this.Ca(t,e,i,s,n).ofModel(),this}Pf(t,e,i,s){let n;return n="string"==typeof t?new ze(t,e,i,s):t,this.w0(n),n}Ca(t,e,i,s,n){let o;return o="string"==typeof t?new Xe(t,e,i,s,n):t,this.w0(o),o}w0(t){t.Ti=this;const i=this.panel;if(null!==i){const s=i.findBindingPanel();null!==s&&s.rD()&&e.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+t+" on "+i)}null===this.Fs&&(this.Fs=new h),this.Fs.add(t)}}class $t extends At{ut;tn;zd;Kh;Qe;Zo;jo;Kt;Xd;Gd;K;constructor(t,e){super(),this.ut=null,this.tn=null,this.zd="None",this.Kh="black",this.Qe="black",this.Zo=1,this.jo=null,this.Kt=null,this.Xd=NaN,this.Gd=NaN,this.K=null,"string"==typeof t?this.figure=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.ut=this.ut,t.tn=this.tn,t.zd=this.zd,t.Kh=this.Kh,t.Qe=this.Qe,t.Zo=this.Zo,null!==this.jo&&(t.jo=this.jo.slice()),null!==this.Kt&&(this.Kt.me?t.Kt=this.Kt:t.Kt=this.Kt.copy()),t.Xd=this.Xd,t.Gd=this.Gd,null!==this.K&&(t.K=this.K.copy())}Hh(){return null===this.Kt?this.Kt=new Zt:this.Kt.me&&(this.Kt=this.Kt.copy()),this.Kt}ba(){super.ba(),null!==this.Kt&&(this.Kt.me=!0)}fe(t){t in C?this.geometryStretch=t:super.fe(t)}toString(){return"Shape("+("None"!==this.figure?this.figure:"None"!==this.toArrow?this.toArrow:this.fromArrow)+")#"+u.xs(this)}_I(t,i){const s=this.pathPattern;if(null===s)return;s.ht(1/0,1/0);const n=s.measuredBounds;s.Ut(0,0,n.width,n.height);const o=this.geometry;if(null===o)return;t.save(),t.beginPath();const r=e.nt();if(1===o.type)r.push(o.startX),r.push(o.startY),r.push(o.endX),r.push(o.endY),this.Yd(t,i,r,s);else if(4===o.type){const n=o.figures.iterator;for(;n.next();){const o=n.value;r.length=0,r.push(o.startX),r.push(o.startY);let a=o.startX,h=o.startY,l=a,u=h;const c=o.segments.r,d=c.length;for(let n=0;n<d;n++){const d=c[n];switch(d.type){case 1:this.Yd(t,i,r,s),r.length=0,r.push(d.endX),r.push(d.endY),a=d.endX,h=d.endY,l=a,u=h;break;case 2:r.push(d.endX),r.push(d.endY),a=d.endX,h=d.endY;break;case 3:k.jn(a,h,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,r),a=d.endX,h=d.endY;break;case 4:k.nm(a,h,d.point1X,d.point1Y,d.endX,d.endY,.5,r),a=d.endX,h=d.endY;break;case 5:{const t=d.vo(o),e=t.length;if(0===e){r.push(d.centerX),r.push(d.centerY),a=d.centerX,h=d.centerY;break}for(let i=0;i<e;i++){const e=t[i];k.jn(a,h,e[2],e[3],e[4],e[5],e[6],e[7],.5,r),a=e[6],h=e[7]}break}case 6:{const t=d.Za(o,a,h),e=t.length;if(0===e){r.push(d.endX),r.push(d.endY),a=d.endX,h=d.endY;break}for(let i=0;i<e;i++){const e=t[i];k.jn(a,h,e[2],e[3],e[4],e[5],e[6],e[7],.5,r),a=e[6],h=e[7]}break}default:e.o("Segment not of valid type: "+d.type)}d.isClosed&&(r.push(l),r.push(u),this.Yd(t,i,r,s))}this.Yd(t,i,r,s)}}else if(2===o.type)r.push(o.startX),r.push(o.startY),r.push(o.endX),r.push(o.startY),r.push(o.endX),r.push(o.endY),r.push(o.startX),r.push(o.endY),r.push(o.startX),r.push(o.startY),this.Yd(t,i,r,s);else if(3===o.type){const e=new T;e.startX=o.endX,e.startY=(o.startY+o.endY)/2;const n=new A(5);n.startAngle=0,n.sweepAngle=360,n.centerX=(o.startX+o.endX)/2,n.centerY=(o.startY+o.endY)/2,n.radiusX=Math.abs(o.startX-o.endX)/2,n.radiusY=Math.abs(o.startY-o.endY)/2,e.add(n);const a=n.vo(e),h=a.length;if(0===h)r.push(n.centerX),r.push(n.centerY);else{let t=e.startX,i=e.startY;for(let e=0;e<h;e++){const s=a[e];k.jn(t,i,s[2],s[3],s[4],s[5],s[6],s[7],.5,r),t=s[6],i=s[7]}}this.Yd(t,i,r,s)}e.Z(r),t.restore(),t.clearContextCache(!1)}tE(t){let e=t.measuredBounds.width;return t instanceof $t&&(e-=t.strokeWidth),e<1&&(e=1),e}Yd(t,i,s,n){const o=s.length;if(o<4)return;const r=n.measuredBounds,a=Math.max(1,r.width),h=r.height;let l=s[0],u=s[1],c=0,d=0,g=0,f=0,m=0,p=0,y=0,x=0;const w=e.nt();for(let t=2;t<o;t+=2)c=s[t],d=s[t+1],g=c-l,f=d-u,0===g&&(g=.001),m=f/g,p=Math.atan2(f,g),y=Math.sqrt(g*g+f*f),w.push([g,p,m,y]),x+=y,l=c,u=d;l=s[0],u=s[1];const b=this.tE(n);let v=b;const P=a/2;let k=0!==P,S=0,M=w[S];g=M[0],p=M[1],m=M[2],y=M[3];let C=0;for(;x>=.1;){if(0===C&&(k?(v=b,v-=P,x-=P,k=!1):v=b,0===v&&(v=1)),v>x)return v=x,void e.Z(w);v>y?(C=v-y,v=y):C=0;let s=Math.sqrt(v*v/(1+m*m));if(g<0&&(s=-s),l+=s,u+=m*s,t.translate(l,u),t.rotate(p),t.translate(-a/2,-h/2),0===C&&n.Ma(t,i),t.translate(a/2,h/2),t.rotate(-p),t.translate(-l,-u),x-=v,y-=v,0!==C){if(S++,S===w.length)return void e.Z(w);M=w[S],g=M[0],p=M[1],m=M[2],y=M[3],v=C}}e.Z(w)}Ma(t,e){const i=t instanceof Bt;let s=this.Qe;const n=this.Kh;if(null===s&&null===n)return;const o=this.ut;if(null===o)return;t.commitTransform();const r=this.actualBounds,a=this.naturalBounds;null!==n&&this.bn(t,n,!0,!1,a,r);const h=this.part;let l=this.Zo;null!==s&&0===l&&null!==h&&(this.isPanelMain||h.findMainElement()===this)&&(l=h.eE()),0===l&&(s=null),null!==s&&0!==l&&(this.bn(t,s,!1,!1,a,r),t.lineWidth=l,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let u=!1;h&&e.getRenderingHint("drawShadows")&&(u=h.isShadowed),!1===t.ol&&(u=!1);let c=!0;null!==s&&(null===n||"transparent"===n)&&(c=!1);let d=!1;const g=this.strokeDashArray;if(null!==g&&(d=!0,t.enableDash(g,this.strokeDashOffset)),1===o.type)t.beginPath(),t.moveTo(o.startX,o.startY),t.lineTo(o.endX,o.endY),null!==s&&t.strokeContext(),t.endPath();else if(2===o.type){const e=o.startX,i=o.startY,r=o.endX,a=o.endY,h=Math.min(e,r),l=Math.min(i,a),d=Math.abs(r-e),g=Math.abs(a-i);t.beginPath(),t.rect(h,l,d,g),null!==n&&t.fillContext(n,!1,null),null!==s&&(c&&u&&t.shadowsOff(),t.strokeContext(),c&&u&&t.shadowsOn()),t.endPath()}else if(3===o.type){const e=o.startX,i=o.startY,r=o.endX,a=o.endY,h=Math.abs(r-e)/2,l=Math.abs(a-i)/2,d=Math.min(e,r)+h,g=Math.min(i,a)+l;t.beginPath(),t.moveTo(d,g-l),t.bezierCurveTo(d+k.qn*h,g-l,d+h,g-k.qn*l,d+h,g),t.bezierCurveTo(d+h,g+k.qn*l,d+k.qn*h,g+l,d,g+l),t.bezierCurveTo(d-k.qn*h,g+l,d-h,g+k.qn*l,d-h,g),t.bezierCurveTo(d-h,g-k.qn*l,d-k.qn*h,g-l,d,g-l),t.closePath(),null!==n&&t.fillContext(n,!1,null),null!==s&&(c&&u&&t.shadowsOff(),t.strokeContext(),c&&u&&t.shadowsOn()),t.endPath()}else if(4===o.type){const e=o.figures,r=e.length;for(let o=0;o<r;o++){const r=e.r[o];i?(t.beginPath(),this.SD(t,r)):null===r.Hi&&(r.Hi=new Path2D,this.SD(r.Hi,r));const a=r.isFilled;u?r.isShadowed?(!0===a&&"transparent"!==n&&null!==n&&t.fillContext(n,r.isEvenOdd,r.Hi),null!==s&&(a&&c&&t.shadowsOff(),t.stroke(r.Hi),a&&c&&t.shadowsOn())):(t.shadowsOff(),a&&"transparent"!==n&&null!==n&&t.fillContext(n,r.isEvenOdd,r.Hi),null!==s&&t.stroke(r.Hi),t.shadowsOn()):(a&&null!==n&&t.fillContext(n,r.isEvenOdd,r.Hi),null!==s&&t.stroke(r.Hi)),t.endPath(o)}}d&&t.disableDash(),this._I(t,e)}SD(t,e){t.moveTo(e.startX,e.startY);const i=e.segments.r,s=i.length;let n=null;for(let o=0;o<s;o++){const s=i[o];switch(s.type){case 1:t.moveTo(s.endX,s.endY);break;case 2:t.lineTo(s.endX,s.endY);break;case 3:t.bezierCurveTo(s.point1X,s.point1Y,s.point2X,s.point2Y,s.endX,s.endY);break;case 4:t.quadraticCurveTo(s.point1X,s.point1Y,s.endX,s.endY);break;case 5:if(s.radiusX===s.radiusY){const i=null!==n?n.endX:e.startX,o=null!==n?n.endY:e.startY,r=Math.PI/180;t.arc(s.point1X,s.point1Y,s.radiusX,s.startAngle*r,(s.startAngle+s.sweepAngle)*r,s.sweepAngle<0,i,o)}else{const i=s.vo(e),n=i.length;if(0===n){t.lineTo(s.centerX,s.centerY);break}for(let e=0;e<n;e++){const s=i[e];0===e&&t.lineTo(s[0],s[1]),t.bezierCurveTo(s[2],s[3],s[4],s[5],s[6],s[7])}}break;case 6:{let i,o=0,r=0;if(null!==n&&5===n.type){i=n.vo(e);const a=i.length;if(0===a){t.lineTo(s.endX,s.endY);break}const h=i[a-1]||null;null!==h&&(o=h[6],r=h[7])}else o=null!==n?n.endX:e.startX,r=null!==n?n.endY:e.startY;i=s.Za(e,o,r);const a=i.length;if(0===a){t.lineTo(s.endX,s.endY);break}for(let e=0;e<a;e++){const s=i[e];t.bezierCurveTo(s[2],s[3],s[4],s[5],s[6],s[7])}break}}s.isClosed&&t.closePath(),n=s}}yf(t,e,i){if(!super.yf(t,e,i)||null===this.Qe&&null===this.Kh||null===this.ut||null!==this.pathPattern)return!1;const s=this.svg.getElementsByTagName("path");return this.geometry.figures.length===s.length&&(t.currentPath=this.svg,this.Ma(t,e),t.currentPath=null,!0)}Pd(t){return null!==this.geometry&&this.geometry.figures.length>1||null!==this.pathPattern||super.Pd(t)}AN(t,e){if("g"!==t.nodeName)t.setAttributeNS(null,"filter",e);else{const i=t.getElementsByTagName("path");for(let t=0;t<i.length;t++)i[t].setAttributeNS(null,"filter",e)}}getDocumentPoint(t,i){if(void 0===i&&(i=new y),t instanceof v){const s=t;s.isNoSpot()&&e.o("getDocumentPoint Spot must be a real, specific Spot, not: "+s.toString());const n=this.naturalBounds,o=this.strokeWidth;return i.e(s.x*(n.width+o)-o/2+n.x+s.offsetX,s.y*(n.height+o)-o/2+n.y+s.offsetY),this.Ws.gt(i),i}return i.set(t),this.Ws.gt(i),i}getDocumentBounds(t){void 0===t&&(t=new w);const e=this.naturalBounds,i=this.Ws,s=w.z(e.x,e.y,e.width,e.height),n=this.strokeWidth;s.inflate(n/2,n/2);const o=y.z(s.x,s.y).v(i);return t.e(o.x,o.y,0,0),o.e(s.right,s.y).v(i),t.re(o.x,o.y,0,0),o.e(s.right,s.bottom).v(i),t.re(o.x,o.y,0,0),o.e(s.x,s.bottom).v(i),t.re(o.x,o.y,0,0),w.i(s),y.i(o),t}ka(t,i){const s=this.geometry;if(null===s||null===this.fill&&null===this.stroke)return!1;const n=s.bounds;let o=this.strokeWidth/2;1===s.type&&!i&&(o+=2);const r=w.l();if(r.h(n),r.inflate(o+2,o+2),!r.containsPoint(t))return w.i(r),!1;const a=o+1e-4;if(1===s.type){if(null===this.stroke)return!1;const e=(s.startX-s.endX)*(t.x-s.endX)+(s.startY-s.endY)*(t.y-s.endY),i=(s.endX-s.startX)*(t.x-s.startX)+(s.endY-s.startY)*(t.y-s.startY);return!(e<0||i<0)&&(w.i(r),k.Ve(s.startX,s.startY,s.endX,s.endY,o,t.x,t.y))}if(2===s.type){const e=s.startX,i=s.startY,n=s.endX,h=s.endY;if(r.x=Math.min(e,n),r.y=Math.min(i,h),r.width=Math.abs(n-e),r.height=Math.abs(h-i),null===this.fill){if(r.inflate(-a,-a),r.containsPoint(t))return w.i(r),!1;r.inflate(a,a)}null!==this.stroke&&r.inflate(o,o);const l=r.containsPoint(t);return w.i(r),l}if(3===s.type){const e=s.startX,i=s.startY,n=s.endX,o=s.endY;let h=Math.min(e,n),l=Math.min(i,o);let u=Math.abs(n-e)/2,c=Math.abs(o-i)/2;if(h=t.x-(h+u),l=t.y-(l+c),null===this.fill){if(u-=a,c-=a,u<=0||c<=0)return w.i(r),!1;if(h*h/(u*u)+l*l/(c*c)<=1)return w.i(r),!1;u+=a,c+=a}return null!==this.stroke&&(u+=a,c+=a),w.i(r),!(u<=0||c<=0)&&h*h/(u*u)+l*l/(c*c)<=1}if(4===s.type)return w.i(r),null===this.fill?s._L(t.x,t.y,o):s.VP(t,o,this.strokeWidth>1,i);e.o("Unknown Geometry type: "+s.type)}bd(t,i,s,n){const o=this.desiredSize,r=this.Zo;let a;if(t=Math.max(t,0),i=Math.max(i,0),null!==this.tn)a=this.geometry.bounds;else{const t=this.figure;let i=$t.sC[t];if(void 0===i){let s=k.Wn[t];"string"==typeof s&&(s=k.Wn[s]),e.st(s)?(i=s(null,100,100),$t.sC[t]=i):e.o("Unsupported Figure: "+t)}a=i.bounds}let h=a.width,l=a.height,u=a.width,c=a.height;switch(this.Zs(!0)){case 0:s=0,n=0;break;case 2:u=Math.max(t-r,0),c=Math.max(i-r,0);break;case 5:u=Math.max(t-r,0),n=0;break;case 4:s=0,c=Math.max(i-r,0)}isFinite(o.width)&&(u=o.width),isFinite(o.height)&&(c=o.height);const d=this.maxSize,g=this.minSize;s=Math.max(s-r,g.width),n=Math.max(n-r,g.height),u=Math.min(d.width,u),c=Math.min(d.height,c),u=isFinite(u)?Math.max(s,u):Math.max(h,s),c=isFinite(c)?Math.max(n,c):Math.max(l,n);const f=this.tM();switch(f){case 0:break;case 2:h=u,l=c;break;case 6:{let t=Math.min(u/h,c/l);isFinite(t)||(t=1),h*=t,l*=t;break}default:e.o(f+" is not a valid geometryStretch.")}if(null!==this.tn){0===h&&(h=.001),0===l&&(l=.001);const t=this.tn.nR(h,l);this.ut=t}else(null===this.ut||!k.X(this.ut.Pc,t-r)||!k.X(this.ut.Sc,i-r))&&(this.ut=$t.iE(this,h,l));a=this.ut.bounds,t===1/0||i===1/0?this.ro(a.x-r/2,a.y-r/2,0===t&&0===h?0:a.width+r,0===i&&0===l?0:a.height+r):this.ro(-r/2,-r/2,u+r,c+r),o.isReal()?(u=o.width,c=o.height,u=Math.min(d.width,u),c=Math.min(d.height,c),u=Math.max(g.width,u),c=Math.max(g.height,c),this.Ke.e(0,0,u,c)):this.Ke.h(a)}tM(){const t=this.geometryStretch;return null!==this.tn?1===t?2:t:1===t?$t.sC[this.figure].defaultStretch:t}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}getNearestIntersectionPoint(t,e,i){return this.mf(t.x,t.y,e.x,e.y,i)}mf(t,i,s,n,o){const r=this.v,a=1/(r.m11*r.m22-r.m12*r.m21),h=r.m22*a,l=-r.m12*a,u=-r.m21*a,c=r.m11*a,d=a*(r.m21*r.dy-r.m22*r.dx),g=a*(r.m12*r.dx-r.m11*r.dy),f=t*h+i*u+d,m=t*l+i*c+g,p=s*h+n*u+d,x=s*l+n*c+g,b=this.Zo/2;let v=this.ut;null===v&&(this.ht(1/0,1/0),v=this.ut);const P=v.bounds;let S=!1;if(1===v.type)if(this.strokeWidth<=1.5)S=k.Do(v.startX,v.startY,v.endX,v.endY,f,m,p,x,o);else{let t=0,i=0;if(v.startX===v.endX)t=b,i=0;else{const e=(v.endY-v.startY)/(v.endX-v.startX);i=b/Math.sqrt(1+e*e),t=i*e}const s=e.nt();let n=new y;k.Do(v.startX+t,v.startY+i,v.endX+t,v.endY+i,f,m,p,x,n)&&s.push(n),n=new y,k.Do(v.startX-t,v.startY-i,v.endX-t,v.endY-i,f,m,p,x,n)&&s.push(n),n=new y,k.Do(v.startX+t,v.startY+i,v.startX-t,v.startY-i,f,m,p,x,n)&&s.push(n),n=new y,k.Do(v.endX+t,v.endY+i,v.endX-t,v.endY-i,f,m,p,x,n)&&s.push(n);const r=s.length;if(0===r)return e.Z(s),!1;S=!0;let a=1/0;for(let t=0;t<r;t++){const e=s[t],i=(e.x-f)**2+(e.y-m)**2;i<a&&(a=i,o.x=e.x,o.y=e.y)}e.Z(s)}else if(2===v.type)S=k.Cl(P.x-b,P.y-b,P.x+P.width+b,P.y+P.height+b,f,m,p,x,o);else if(3===v.type){const t=w.z(P.x,P.y,P.width,P.height).inflate(b,b);S=this.sE(t,f,m,p,x,o),w.i(t)}else if(4===v.type){let r=0,a=0,h=0,l=0;const u=y.l();let c=p-f,d=x-m,g=c*c+d*d,w=f,M=m;if(g>0&&P.contains(w,M)&&(u.x=w,u.y=M,this.containsPoint(u)))for(0!==c&&Math.abs(c)<.5?(d*=.5/c,c=.5):0!==d&&Math.abs(d)<.5&&(c*=.5/d,d=.5),w-=c,M-=d;P.contains(w,M);)w-=c,M-=d;const C=.6;o.x=p,o.y=x;for(let t=0;t<v.figures.count;t++){const i=v.figures.r[t],s=i.isFilled?w:f,n=i.isFilled?M:m,c=i.segments;r=i.startX,a=i.startY;let d=r,y=a;for(let t=0;t<c.count;t++){const f=c.r[t],m=f.type;h=f.endX,l=f.endY;let w=!1;switch(m){case 1:d=h,y=l;break;case 2:w=this._1(r,a,h,l,s,n,p,x,u);break;case 3:w=k.om(r,a,f.point1X,f.point1Y,f.point2X,f.point2Y,h,l,s,n,p,x,C,u);break;case 4:w=k.om(r,a,r+2/3*(f.point1X-r),a+2/3*(f.point1Y-a),h+2/3*(f.point1X-h),l+2/3*(f.point1Y-l),h,l,s,n,p,x,C,u);break;case 5:case 6:{const t=5===f.type?f.vo(i):f.Za(i,r,a),e=t.length;if(0===e){w=this._1(r,a,5===f.type?f.centerX:f.endX,5===f.type?f.centerY:f.endY,s,n,p,x,u);break}let c=null;for(let i=0;i<e;i++){if(c=t[i],0===i&&this._1(r,a,c[0],c[1],s,n,p,x,u)){const t=this.tk(s,n,u,g,o);t<g&&(g=t,S=!0)}if(k.om(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],s,n,p,x,C,u)){const t=this.tk(s,n,u,g,o);t<g&&(g=t,S=!0)}}h=c[6],l=c[7];break}default:e.o("Unknown Segment type: "+m)}if(r=h,a=l,w){const t=this.tk(s,n,u,g,o);t<g&&(g=t,S=!0)}if(f.isClosed&&(h=d,l=y,this._1(r,a,h,l,s,n,p,x,u))){const t=this.tk(s,n,u,g,o);t<g&&(g=t,S=!0)}}}let N=s-t,T=n-i;const L=Math.sqrt(N*N+T*T);0!==L&&(N/=L,T/=L),o.x-=N*b,o.y-=T*b,y.i(u)}else e.o("Unknown Geometry type: "+v.type);return!!S&&(this.v.gt(o),!0)}tk(t,e,i,s,n){const o=i.x-t,r=i.y-e,a=o*o+r*r;return a<s?(n.x=i.x,n.y=i.y,a):s}_1(t,e,i,s,n,o,r,a,h){if(k.X(t,i)&&k.X(e,s)||k.X(n,r)&&k.X(o,a))return!1;let l=!1;const u=(n-r)*(e-s)-(o-a)*(t-i);if(0===u)return!1;if(h.x=((n*a-o*r)*(t-i)-(n-r)*(t*s-e*i))/u,h.y=((n*a-o*r)*(e-s)-(o-a)*(t*s-e*i))/u,(t>i?t-i:i-t)<(e>s?e-s:s-e)){const t=e<s?e:s,i=e<s?s:e;(h.y>t||k.X(h.y,t))&&(h.y<i||k.X(h.y,i))&&(l=!0)}else{const e=t<i?t:i,s=t<i?i:t;(h.x>e||k.X(h.x,e))&&(h.x<s||k.X(h.x,s))&&(l=!0)}return l}nE(t,e,i){return!1!==this.pickable&&(i.bc(this.v),e?this.oE(t,i):this.containedInRect(t,i))}containedInRect(t,e){if(void 0===e)return t.containsRect(this.actualBounds);let i=this.ut;null===i&&(this.ht(1/0,1/0),i=this.ut);const s=i.bounds,n=this.strokeWidth/2;let o=!1;const r=y.l();return r.e(s.x-n,s.y-n),t.containsPoint(e.gt(r))&&(r.e(s.x-n,s.bottom+n),t.containsPoint(e.gt(r))&&(r.e(s.right+n,s.bottom+n),t.containsPoint(e.gt(r))&&(r.e(s.right+n,s.y-n),t.containsPoint(e.gt(r))&&(o=!0)))),y.i(r),o}intersectsRect(t,e){if(this.containedInRect(t,e)||void 0===e&&(e=this.v,t.containsRect(this.actualBounds)))return!0;const i=P.l();i.set(e),i.ex();const s=t.left,n=t.right,o=t.top,r=t.bottom,a=y.l();if(a.e(s,o),i.gt(a),this.ka(a,!0))return y.i(a),!0;if(a.e(n,o),i.gt(a),this.ka(a,!0))return y.i(a),!0;if(a.e(s,r),i.gt(a),this.ka(a,!0))return y.i(a),!0;if(a.e(n,r),i.gt(a),this.ka(a,!0))return y.i(a),!0;const h=y.l(),l=y.l();i.set(e),i.GL(this.v),i.ex(),h.x=n,h.y=o,h.v(i),a.x=s,a.y=o,a.v(i);let u=!1;return this.qh(a,h,l)?u=!0:(a.x=n,a.y=r,a.v(i),this.qh(a,h,l)?u=!0:(h.x=s,h.y=r,h.v(i),this.qh(a,h,l)?u=!0:(a.x=s,a.y=o,a.v(i),this.qh(a,h,l)&&(u=!0)))),y.i(a),P.i(i),y.i(h),y.i(l),u}qh(t,e,i){if(!this.getNearestIntersectionPoint(t,e,i))return!1;const s=t.x,n=t.y,o=e.x,r=e.y,a=i.x,h=i.y;if(s===o){let t=0,e=0;return n<r?(t=n,e=r):(t=r,e=n),h>=t&&h<=e}{let t=0,e=0;return s<o?(t=s,e=o):(t=o,e=s),a>=t&&a<=e}}oE(t,e){if(this.containedInRect(t,e)||void 0===e&&(e=this.v,t.containsRect(this.actualBounds)))return!0;const i=t.left,s=t.right,n=t.top,o=t.bottom,r=y.l(),a=y.l(),h=y.l(),l=P.l();l.set(e),l.GL(this.v),l.ex(),a.x=s,a.y=n,a.v(l),r.x=i,r.y=n,r.v(l);let u=!1;return this.qh(r,a,h)?u=!0:(r.x=s,r.y=o,r.v(l),this.qh(r,a,h)?u=!0:(a.x=i,a.y=o,a.v(l),this.qh(r,a,h)?u=!0:(r.x=i,r.y=n,r.v(l),this.qh(r,a,h)&&(u=!0)))),P.i(l),y.i(r),y.i(a),y.i(h),u}QT(t,i,s){if(s&&null!==this.fill&&this.ka(t,!0))return!0;let n=t.distanceSquaredPoint(i);const o=n;this.strokeWidth>1.5&&(n=this.strokeWidth/2+Math.sqrt(n),n*=n);let r=this.ut;if(null===r&&(this.ht(1/0,1/0),r=this.ut,null===r))return!1;if(!s){const e=r.bounds,i=e.x,s=e.y,o=e.x+e.width,a=e.y+e.height;if(y.distanceSquared(t.x,t.y,i,s)<=n&&y.distanceSquared(t.x,t.y,o,s)<=n&&y.distanceSquared(t.x,t.y,i,a)<=n&&y.distanceSquared(t.x,t.y,o,a)<=n)return!0}function a(t,e){const i=t.length;for(let s=0;s<i;s+=2)if(e.distanceSquared(t[s],t[s+1])>n)return!0;return!1}const h=r.startX,l=r.startY,u=r.endX,c=r.endY;if(1===r.type){const e=y.distanceLineSegmentSquared(t.x,t.y,h,l,u,c),i=(u-h)*(t.x-h)+(c-l)*(t.y-l),s=(h-u)*(t.x-u)+(l-c)*(t.y-c);return e<=(i>=0&&s>=0?n:o)}if(2===r.type){let e=!1;return s&&(e=y.distanceLineSegmentSquared(t.x,t.y,h,l,h,c)<=n||y.distanceLineSegmentSquared(t.x,t.y,h,l,u,l)<=n||y.distanceLineSegmentSquared(t.x,t.y,u,l,u,c)<=n||y.distanceLineSegmentSquared(t.x,t.y,h,c,u,c)<=n),e}if(3===r.type){const e=(h+u)/2,i=(l+c)/2,o=t.x-e,r=t.y-i,a=Math.abs(u-h)/2,d=Math.abs(c-l)/2;if(0===a||0===d)return y.distanceLineSegmentSquared(t.x,t.y,h,l,u,c)<=n;if(s){const t=k.JF(a,d,o,r);return t*t<=n}return!(y.distanceSquared(o,r,-a,0)>=n||y.distanceSquared(o,r,0,-d)>=n||y.distanceSquared(o,r,0,d)>=n||y.distanceSquared(o,r,a,0)>=n)}if(4===r.type){const i=r.bounds,o=i.x,h=i.y,l=i.x+i.width,u=i.y+i.height;if(t.x>l&&t.x<o&&t.y>u&&t.y<h&&y.distanceLineSegmentSquared(t.x,t.y,o,h,o,u)>n&&y.distanceLineSegmentSquared(t.x,t.y,o,h,l,h)>n&&y.distanceLineSegmentSquared(t.x,t.y,l,u,o,u)>n&&y.distanceLineSegmentSquared(t.x,t.y,l,u,l,h)>n)return!1;const c=Math.sqrt(n);if(!s){const i=r.figures;for(let s=0;s<i.count;s++){const o=i.r[s];let r=o.startX,h=o.startY;if(t.distanceSquared(r,h)>n)return!1;const l=o.segments.r,u=l.length;for(let i=0;i<u;i++){const s=l[i];switch(s.type){case 1:case 2:if(r=s.endX,h=s.endY,t.distanceSquared(r,h)>n)return!1;break;case 3:{const i=e.nt();k.jn(r,h,s.point1X,s.point1Y,s.point2X,s.point2Y,s.endX,s.endY,.8,i);const o=a(i,t);if(e.Z(i),o||(r=s.endX,h=s.endY,t.distanceSquared(r,h)>n))return!1;break}case 4:{const i=e.nt();k.nm(r,h,s.point1X,s.point1Y,s.endX,s.endY,.8,i);const o=a(i,t);if(e.Z(i),o||(r=s.endX,h=s.endY,t.distanceSquared(r,h)>n))return!1;break}case 5:case 6:{const i=5===s.type?s.vo(o):s.Za(o,r,h),l=i.length;if(0===l){if(r=5===s.type?s.centerX:s.endX,h=5===s.type?s.centerY:s.endY,t.distanceSquared(r,h)>n)return!1;break}let u=null;const c=e.nt();for(let s=0;s<l;s++)if(u=i[s],c.length=0,k.jn(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],.8,c),a(c,t))return e.Z(c),!1;e.Z(c),null!==u&&(r=u[6],h=u[7]);break}default:e.o("Unknown Segment type: "+s.type)}}}return!0}if(null===this.fill?r._L(t.x,t.y,c):r.VP(t,c,!0,!1))return!0}return!1}sE(t,e,i,s,n,o){if(0===t.width)return k.Do(t.x,t.y,t.x,t.y+t.height,e,i,s,n,o);if(0===t.height)return k.Do(t.x,t.y,t.x+t.width,t.y,e,i,s,n,o);{const r=t.width/2,a=t.height/2,h=t.x+r,l=t.y+a;let u=9999;if(e!==s&&(u=(i-n)/(e-s)),Math.abs(u)<9999){const t=i-l-u*(e-h);if(r*r*(u*u)+a*a-t*t<0)return o.x=NaN,o.y=NaN,!1;const s=Math.sqrt(r*r*(u*u)+a*a-t*t),n=(-r*r*u*t+r*a*s)/(a*a+r*r*(u*u))+h,c=(-r*r*u*t-r*a*s)/(a*a+r*r*(u*u))+h,d=u*(n-h)+t+l,g=u*(c-h)+t+l;Math.abs((e-n)**2)+Math.abs((i-d)**2)<Math.abs((e-c)**2)+Math.abs((i-g)**2)?(o.x=n,o.y=d):(o.x=c,o.y=g)}else{const t=a*a,s=e-h,n=t-t/(r*r)*(s*s);if(n<0)return o.x=NaN,o.y=NaN,!1;const u=Math.sqrt(n),c=l+u,d=l-u;Math.abs(c-i)<Math.abs(d-i)?(o.x=e,o.y=c):(o.x=e,o.y=d)}return!0}}jI(){return this.Zo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return null!==this.ut?this.ut:this.tn}set geometry(t){const e=this.ut,i=this.tn;if(e===t)return;null!==t?(this.ut=t.k(),this.tn=this.ut):(this.ut=null,this.tn=null);const s=this.part;if(null!==s&&s.Tf(),this.f(),this.t("geometry",e||i,t),this.gf()){const t=this.part;null!==t&&this.Eh(t,"geometryString")}}get geometryString(){return null===this.geometry?"":this.geometry.toString()}set geometryString(t){const e=N.parse(t),i=e.normalize();this.geometry=e;const s=y.z(-i.x,-i.y);this.position=s,y.i(s)}get isGeometryPositioned(){return!!(1048576&this.n)}set isGeometryPositioned(t){const e=!!(1048576&this.n);e!==t&&(this.n=1048576^this.n,this.f(),this.t("isGeometryPositioned",e,t))}ai(){this.ut=null}get fill(){return this.Kh}set fill(t){const e=this.Kh;e!==t&&(null!==t&&Ut.Md(t,"Shape.fill"),t instanceof Ut&&t.k(),this.Kh=t,this.C(),this.t("fill",e,t))}get stroke(){return this.Qe}set stroke(t){const e=this.Qe;e!==t&&(null!==t&&Ut.Md(t,"Shape.stroke"),t instanceof Ut&&t.k(),this.Qe=t,this.C(),this.t("stroke",e,t))}get strokeWidth(){return this.Zo}set strokeWidth(t){const i=this.Zo;if(i!==t)if(t>=0){this.Zo=t,this.f();const e=this.part;null!==e&&e.Tf(),this.t("strokeWidth",i,t)}else e.J(t,"value >= 0",$t,"strokeWidth:value")}qp(){return this.Zo}get strokeCap(){return null!==this.Kt?this.Kt.Y0:"butt"}set strokeCap(t){const i=this.strokeCap;i!==t&&("string"!=typeof t||"butt"!==t&&"round"!==t&&"square"!==t?e.J(t,'"butt", "round", or "square"',$t,"strokeCap"):(this.Hh().Y0=t,this.C(),this.t("strokeCap",i,t)))}get strokeJoin(){return null!==this.Kt?this.Kt.K0:"miter"}set strokeJoin(t){const i=this.strokeJoin;i!==t&&("string"!=typeof t||"miter"!==t&&"bevel"!==t&&"round"!==t?e.J(t,'"miter", "bevel", or "round"',$t,"strokeJoin"):(this.Hh().K0=t,this.C(),this.t("strokeJoin",i,t)))}get strokeMiterLimit(){return null!==this.Kt?this.Kt.H0:10}set strokeMiterLimit(t){const e=this.strokeMiterLimit;if(e!==t&&t>=1){this.Hh().H0=t,this.C();const i=this.part;null!==i&&i.Tf(),this.t("strokeMiterLimit",e,t)}}get strokeDashArray(){return this.jo}set strokeDashArray(t){const i=this.jo;if(i!==t){if(null!==t&&!Array.isArray(t)&&e.si(t,"Array",$t,"strokeDashArray:value"),null!==t){const s=t.length;let n=0;for(let i=0;i<s;i++){const s=t[i];(!(s>=0)||!isFinite(s))&&e.o("strokeDashArray:value "+s+" at index "+i+" must be a positive number or zero."),n+=s}if(0===n){if(null===i)return;t=null}}this.jo=t,this.C(),this.t("strokeDashArray",i,t)}}get strokeDashOffset(){return null!==this.Kt?this.Kt.La:0}set strokeDashOffset(t){const e=this.strokeDashOffset;e!==t&&t>=0&&(this.Hh().La=t,this.C(),this.t("strokeDashOffset",e,t))}get figure(){return this.zd}set figure(t){const i=this.zd;if(i!==t){let s=k.Wn[t];if(e.st(s)?s=t:(s=k.Wn[t.toLowerCase()],(!s||"function"==typeof s)&&e.o("Unknown Shape.figure: "+t)),i!==s){const t=this.part;null!==t&&t.Tf(),this.zd=s,this.tn=null,this.ai(),this.f(),this.t("figure",i,s)}}}get toArrow(){return null!==this.Ot?this.Ot.q0:"None"}set toArrow(t){const i=this.toArrow;if(!0===t?t="Standard":!1===t&&(t=""),i!==t){const s=$t.MD(t);null===s?e.o("Unknown Shape.toArrow: "+t):i!==s&&(null===this.Ot&&(this.Ot=new Ce),this.Ot.q0=s,this.tn=null,this.ai(),this.f(),this.ND(s),this.t("toArrow",i,s))}}get fromArrow(){return null!==this.Ot?this.Ot.j0:"None"}set fromArrow(t){const i=this.fromArrow;if(!0===t?t="Standard":!1===t&&(t=""),i!==t){const s=$t.MD(t);null===s?e.o("Unknown Shape.fromArrow: "+t):i!==s&&(null===this.Ot&&(this.Ot=new Ce),this.Ot.j0=s,this.tn=null,this.ai(),this.f(),this.ND(s),this.t("fromArrow",i,s))}}ND(t){const e=this.diagram;null!==e&&e.undoManager.isUndoingRedoing||(this.pI(),"None"!==this.toArrow?(this.segmentIndex=-1,this.alignmentFocus=v.Right):"None"!==this.fromArrow&&(this.segmentIndex=0,this.alignmentFocus=v.Left))}get spot1(){return null!==this.Kt?this.Kt.Jn:v.Default}set spot1(t){const e=this.spot1;e.equals(t)||(t=t.N(),this.Hh().Jn=t,this.f(),this.t("spot1",e,t))}get spot2(){return null!==this.Kt?this.Kt.$n:v.Default}set spot2(t){const e=this.spot2;e.equals(t)||(t=t.N(),this.Hh().$n=t,this.f(),this.t("spot2",e,t))}get parameter1(){return this.Xd}set parameter1(t){const e=this.Xd;e!==t&&(this.Xd=t,this.ai(),this.f(),this.t("parameter1",e,t))}get parameter2(){return this.Gd}set parameter2(t){const e=this.Gd;e!==t&&(this.Gd=t,this.ai(),this.f(),this.t("parameter2",e,t))}get naturalBounds(){return this.Ke}UI(){const t=this.desiredSize;if(t.isReal()||null===this.ut)this.Ke.e(0,0,t.width,t.height);else{const t=this.ut.bounds;this.Ke.h(t)}}get pathPattern(){return null!==this.Kt?this.Kt.W0:null}set pathPattern(t){const e=this.pathPattern;e!==t&&(this.Hh().W0=t,this.C(),this.t("pathPattern",e,t))}get geometryStretch(){return null!==this.Kt?this.Kt.J0:1}set geometryStretch(t){const e=this.geometryStretch;e!==t&&(this.Hh().J0=t,this.f(),this.t("geometryStretch",e,t))}get interval(){return null!==this.K?this.K.vf:1}set interval(t){const e=this.interval;if(e!==(t=Math.round(t))&&0!==t&&isFinite(t)){null===this.K&&(this.K=new ne),this.K.vf=t;const i=this.diagram;null!==i&&this.panel===i.grid&&i.ca(),this.f();const s=this.panel;null!==s&&(s.ds=null),this.t("interval",e,t)}}get graduatedStart(){return null!==this.K?this.K.Ff:0}set graduatedStart(t){const e=this.graduatedStart;e!==t&&(t<0?t=0:t>1&&(t=1),null===this.K&&(this.K=new ne),this.K.Ff=t,this.f(),this.t("graduatedStart",e,t))}get graduatedEnd(){return null!==this.K?this.K.Rf:1}set graduatedEnd(t){const e=this.graduatedEnd;e!==t&&(t<0?t=0:t>1&&(t=1),null===this.K&&(this.K=new ne),this.K.Rf=t,this.f(),this.t("graduatedEnd",e,t))}get graduatedSkip(){return null!==this.K?this.K.Of:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(null!==t&&e.S(t,$t,"graduatedSkip"),null===this.K&&(this.K=new ne),this.K.Of=t,this.f(),this.t("graduatedSkip",i,t))}polygonContainsRect(t){const e=this;if(!e.part||!e.part.actualBounds.containsRect(t))return!1;const i=e.geometry;if(!i)return!1;const s=t.x,n=t.y,o=t.width,r=t.height,a=y.l();if(a.x=s,a.y=n,e.getLocalPoint(a,a),!i.containsPoint(a)||o>0&&r>0&&(a.x=s+o,a.y=n+r,e.getLocalPoint(a,a),!i.containsPoint(a))||o>0&&(a.x=s+o,a.y=n,e.getLocalPoint(a,a),!i.containsPoint(a))||r>0&&(a.x=s,a.y=n+r,e.getLocalPoint(a,a),!i.containsPoint(a))||1===i.type)return!1;if(4===i.type){const t=i.figures.iterator;for(;t.next();){const i=t.value;if(!i.isFilled)continue;a.x=i.startX,a.y=i.startY,e.getDocumentPoint(a,a);let h=a.x,l=a.y,u=h,c=l,d=h,g=l;const f=i.segments.iterator;for(;f.next();){const t=f.value;if(a.x=t.endX,a.y=t.endY,e.getDocumentPoint(a,a),d=a.x,g=a.y,1===t.type)h=d,l=g;else if(5!==t.type&&(w.intersectsLineSegment(s,n,o,r,u,c,d,g)||t.isClosed&&w.intersectsLineSegment(s,n,o,r,d,g,h,l)))return!1;u=d,c=g}}}return y.i(a),!0}static iE(t,i,s){let n=null;if("None"!==t.toArrow)n=$t.Tn[t.toArrow];else if("None"!==t.fromArrow)n=$t.Tn[t.fromArrow];else{let o=k.Wn[t.figure];"string"==typeof o&&(o=k.Wn[o]),void 0===o&&e.o("Unknown Shape.figure: "+t.figure),n=o(t,i,s),n.Pc=i,n.Sc=s}if(null===n){const o=k.Wn.Rectangle;e.st(o)&&(n=o(t,i,s))}return n}static getFigureGenerators(){const t=new p;for(const e in k.Wn){if(e===e.toLowerCase())continue;const i=k.Wn[e];t.set(e,i)}return t.k(),t}static defineFigureGenerator(t,i){e.s(t,"string",$t,"defineFigureGenerator:name"),"string"==typeof i||e.S(i,$t,"defineFigureGenerator:func");const s=t.toLowerCase(),n=k.Wn;n[t]=i,n[s]=t}static isFigureDefined(t){return t in k.Wn}static getArrowheadGeometries(){const t=new p;for(const t in k.lm)if(void 0===$t.Tn[t]){const e=N.parse(k.lm[t],!1);$t.Tn[t]=e;const i=t.toLowerCase();i!==t&&($t.Tn[i]=t)}for(const e in $t.Tn){if(e===e.toLowerCase())continue;const i=$t.Tn[e];i instanceof N&&t.set(e,i)}return t.k(),t}static defineArrowheadGeometry(t,i){e.s(t,"string",$t,"defineArrowheadGeometry:name");let s=null;"string"==typeof i?(e.s(i,"string",$t,"defineArrowheadGeometry:pathstr"),s=N.parse(i,!1)):s=i;const n=t.toLowerCase();("none"===n||t===n)&&e.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);const o=$t.Tn;o[t]=s,o[n]=t}static isArrowheadDefined(t){return $t.Tn.has(t)}static Tn=new s;static sC=new s;static MD(t){let e=$t.Tn[t];if(void 0===e){const i=t.toLowerCase();if("none"===i)return"None";if(e=$t.Tn[i],void 0===e){let t=null;for(const e in k.lm)if(e.toLowerCase()===i){t=e;break}if(null!==t){const e=N.parse(k.lm[t],!1);return $t.Tn[t]=e,i!==t&&($t.Tn[i]=t),t}}}return"string"==typeof e?e:e instanceof N?t:null}}class Zt{me;Y0;K0;H0;La;W0;J0;Jn;$n;constructor(){this.me=!1,this.Y0="butt",this.K0="miter",this.H0=10,this.La=0,this.W0=null,this.J0=1,this.Jn=v.Default,this.$n=v.Default}copy(){const t=new Zt;return t.Y0=this.Y0,t.K0=this.K0,t.H0=this.H0,t.La=this.La,t.W0=this.W0,t.J0=this.J0,t.Jn=this.Jn.N(),t.$n=this.$n.N(),t}}var Qt=(t=>(t[t.None=0]="None",t[t.Fit=1]="Fit",t[t.DesiredSize=2]="DesiredSize",t[t.BreakAll=3]="BreakAll",t))(Qt||{}),te=(t=>(t[t.Clip=0]="Clip",t[t.Ellipsis=1]="Ellipsis",t))(te||{}),ee=(t=>(t[t.Trim=0]="Trim",t[t.None=1]="None",t))(ee||{});class ie extends At{ue;Qe;Dn;Pi;pe;jp;Kd;K;tt;Xl;uo;vn;Ii;ye;Fn;constructor(t,e){return super(),!1===ie.M0&&(ie.M0=!0,ie.us=wt.isUsingDOM()?new Et(null)._t:null),this.n|=2097152,this.ue="",this.Qe="black",this.Dn="13px sans-serif",this.Pi=0,this.pe=0,this.jp=0,this.Kd=null,this.K=null,this.tt=null,this.Xl=0,this.uo=null,this.vn=0,this.Ii=null,this.ye=null,this.Fn=null,"string"==typeof t?this.text=t:t&&Object.assign(this,t),e&&Object.assign(this,e),this}cloneProtected(t){super.cloneProtected(t),t.ue=this.ue,t.Qe=this.Qe,t.Dn=this.Dn,t.Pi=this.Pi,t.pe=this.pe,t.jp=this.jp,t.Kd=this.Kd,null!==this.K&&(t.K=this.K.copy()),null!==this.tt&&(this.tt.me?t.tt=this.tt:t.tt=this.tt.copy()),t.Xl=this.Xl,t.uo=this.uo,t.vn=this.vn,t.Ii=this.Ii,t.ye=this.ye,t.Fn=this.Fn}Rs(){return null===this.tt?this.tt=new se:this.tt.me&&(this.tt=this.tt.copy()),this.tt}ba(){super.ba(),null!==this.tt&&(this.tt.me=!0)}KI(t){this.n=6144|t.n,this.Zt=t.opacity,this.Lt=t.background,this.cs=t.desiredSize.N(),this.minSize=t.minSize.N(),this.maxSize=t.maxSize.N(),null!==t.Se?this.Se=t.Se.copy():this.Se=null,this.it=t.scale,this.Xt=t.angle,this.stretch=t.stretch,this.il=t.margin.N(),this.de=t.alignment.N(),this.wd=t.alignmentFocus.N(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.N(),this.segmentOrientation=t.segmentOrientation,null!==t.he&&(this.he=t.he.copy()),this.shadowVisible=t.shadowVisible,this.ue=t.ue,this.Qe=t.Qe,this.Dn=t.Dn,null!==this.K&&(this.K=t.K.copy()),null!==t.tt&&(t.tt.me?this.tt=t.tt:this.tt=t.tt.copy()),this.Xl=t.Xl}GI(t){if(this.ue=t.text||"",this.Xt=t.labelAngle||0,this.Pi=t.lineCount||0,this.rE(t.lines),t.naturalBounds&&(this.Ke=t.naturalBounds),t.actualBounds){const e=t.actualBounds;this.Ut(e.x,e.y,e.width,e.height)}}fe(t){t in Qt?this.wrap=t:super.fe(t)}toString(){return this.ue.length>22?'TextBlock("'+this.ue.substring(0,20)+'"...)':'TextBlock("'+this.ue+'")'}static getEllipsis(){return ie.$0}static setEllipsis(t){ie.$0=t,ie.ek=new s,ie.nC=0}static getBaseline(){return ie.ik}static setBaseline(t){ie.ik=t}static ik=null;static getUnderline(){return ie.sk}static setUnderline(t){ie.sk=t}static sk=null;static None=0;static WrapFit=1;static WrapDesiredSize=2;static WrapBreakAll=3;static OverflowClip=0;static OverflowEllipsis=1;static FormatTrim=0;static FormatNone=1;f(){super.f(),this.Ji(!0)}get font(){return this.Dn}set font(t){const e=this.Dn;e!==t&&(this.Dn=t,this.uo=null,this.f(),this.t("font",e,t))}static isValidFont(e){return!t.CSS||t.CSS.supports("font",e)}get text(){return this.ue}set text(t){const e=this.ue;e!==(t=null!=t?t.toString():"")&&(this.ue=t,this.f(),this.t("text",e,t))}get textAlign(){return null!==this.tt?this.tt.Z0:"start"}set textAlign(t){const e=this.textAlign;e!==t&&("start"===t||"end"===t||"left"===t||"right"===t||"center"===t)&&(this.Rs().Z0=t,this.C(),this.t("textAlign",e,t))}get flip(){return null!==this.tt?this.tt.go:0}set flip(t){const e=this.flip;e!==t&&(this.Rs().go=t,this.C(),this.t("flip",e,t))}get verticalAlignment(){return null!==this.tt?this.tt.al:v.Top}set verticalAlignment(t){const e=this.verticalAlignment;e.equals(t)||(t=t.N(),this.Rs().al=t,this.kf(),this.t("verticalAlignment",e,t))}get naturalBounds(){if(!this.Ke.isReal()){const t=x.l();this.oC(this.ue,999999,t);let e=t.width;x.i(t);let i=this.CD(e);const s=this.desiredSize;isNaN(s.width)||(e=s.width),isNaN(s.height)||(i=s.height),this.Ke.Hn(e,i)}return this.Ke}get isMultiline(){return!!(2097152&this.n)}set isMultiline(t){const e=!!(2097152&this.n);e!==t&&(this.n=2097152^this.n,this.f(),this.t("isMultiline",e,t))}get isUnderline(){return!!(4194304&this.n)}set isUnderline(t){const e=!!(4194304&this.n);e!==t&&(this.n=4194304^this.n,this.Ji(!0),this.C(),this.t("isUnderline",e,t))}get isStrikethrough(){return!!(8388608&this.n)}set isStrikethrough(t){const e=!!(8388608&this.n);e!==t&&(this.n=8388608^this.n,this.Ji(!0),this.C(),this.t("isStrikethrough",e,t))}get wrap(){return null!==this.tt?this.tt.Q0:2}set wrap(t){const e=this.wrap;e!==t&&(this.Rs().Q0=t,this.f(),this.t("wrap",e,t))}get overflow(){return null!==this.tt?this.tt._0:0}set overflow(t){const e=this.overflow;e!==t&&(this.Rs()._0=t,this.f(),this.t("overflow",e,t))}get isOverflowed(){return!!(16777216&this.n)}rC(t){t?this.n|=16777216:this.n&=-16777217}get stroke(){return this.Qe}set stroke(t){const e=this.Qe;e!==t&&(null!==t&&Ut.Md(t,"TextBlock.stroke"),t instanceof Ut&&t.k(),this.Qe=t,"string"!=typeof t&&this.wf(),this.C(),this.t("stroke",e,t))}get lineCount(){return this.Pi}get lineHeight(){return this.ty()}get editable(){return!!(1048576&this.n)}set editable(t){const e=!!(1048576&this.n);e!==t&&(this.n=1048576^this.n,this.t("editable",e,t))}get jN(){return!!(33554432&this.n)}set jN(t){this.n=33554432^this.n}get textEditor(){return null!==this.tt?this.tt.ey:null}set textEditor(t){const e=this.textEditor;e!==t&&(this.Rs().ey=t,this.t("textEditor",e,t))}get errorFunction(){return null!==this.tt?this.tt.gs:null}set errorFunction(t){const i=this.errorFunction;i!==t&&(null!==t&&e.S(t,ie,"errorFunction"),this.Rs().gs=t,this.t("errorFunction",i,t))}get interval(){return null!==this.K?this.K.vf:1}set interval(t){const e=this.interval;if(e!==(t=Math.round(t))&&0!==t&&isFinite(t)){null===this.K&&(this.K=new ne),this.K.vf=t,this.f();const i=this.panel;null!==i&&(i.ds=null),this.t("interval",e,t)}}get graduatedStart(){return null!==this.K?this.K.Ff:0}set graduatedStart(t){const e=this.graduatedStart;e!==t&&(t<0?t=0:t>1&&(t=1),null===this.K&&(this.K=new ne),this.K.Ff=t,this.f(),this.t("graduatedStart",e,t))}get graduatedEnd(){return null!==this.K?this.K.Rf:1}set graduatedEnd(t){const e=this.graduatedEnd;e!==t&&(t<0?t=0:t>1&&(t=1),null===this.K&&(this.K=new ne),this.K.Rf=t,this.f(),this.t("graduatedEnd",e,t))}get graduatedFunction(){return null!==this.K?this.K.iy:null}set graduatedFunction(t){const i=this.graduatedFunction;i!==t&&(null!==t&&e.S(t,ie,"graduatedFunction"),null===this.K&&(this.K=new ne),this.K.iy=t,this.f(),this.t("graduatedFunction",i,t))}get graduatedSkip(){return null!==this.K?this.K.Of:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(null!==t&&e.S(t,ie,"graduatedSkip"),null===this.K&&(this.K=new ne),this.K.Of=t,this.f(),this.t("graduatedSkip",i,t))}Ma(t,e){if(null===this.Qe||0===this.ue.length||null===this.Dn)return;const i=this.naturalBounds,s=this.actualBounds,n=i.width,o=i.height,r=this.ty();let a=t.textAlign=this.textAlign;const h=e.rd;"start"===a?a=h?"right":"left":"end"===a&&(a=h?"left":"right");const l=this.isUnderline,u=this.isStrikethrough;this.bn(t,this.Qe,!0,!1,i,s),(l||u)&&this.bn(t,this.Qe,!1,!1,i,s);let c=0;const d=n;let g=!1;e.Wt===t&&!(e.Wt instanceof Bt)&&!this.jN&&!0===e.getRenderingHint("textGreeking")&&r*this.Th*e.scale<3&&(g=!0);const f=this.spacingAbove,m=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(n,0),t.scale(-1,1);break;case 1:t.translate(0,o),t.scale(1,-1);break;case 3:t.translate(n,o),t.scale(-1,-1)}t.commitTransform();const p=this.Pi,y=(f+r+m)*p;if(o>y){const t=this.verticalAlignment;c=t.y*o-t.y*y+t.offsetY}if(ie.nk&&(t.letterSpacing=this.letterSpacing,t.wordSpacing=this.wordSpacing),1===p&&null!==this.Fn){let e=this.pe;e>d&&(e=d),c+=f,this.LD(this.Fn,t,0,c,d,r,e,g,a,l,u)}else if(null!==this.Ii&&null!==this.ye)for(let e=0;e<p;e++){let i=this.Ii[e];i>d&&(i=d),c+=f,this.LD(this.ye[e],t,0,c,d,r,i,g,a,l,u),c+=r+m}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-n,0);break;case 1:t.scale(1,-1),t.translate(0,-o);break;case 3:t.scale(-1,-1),t.translate(-n,-o)}}LD(t,e,i,s,n,o,r,a,h,l,u){let c=0;if(a){"left"===h?c=0:"right"===h?c=n-r:"center"===h&&(c=(n-r)/2);const t=e.globalAlpha;return e.globalAlpha=t/2,e.fillRect(i+c,s+o/4,r,o/2),void(e.globalAlpha=t)}"left"===h?c=0:"right"===h?c=n:"center"===h&&(c=n/2);const d=null!==ie.ik?ie.ik(this,o):.75*o;e.fillText(t,i+c,s+d);let g=o/20|0;if(0===g&&(g=1),"right"===h?c-=r:"center"===h&&(c-=r/2),l){const t=null!==ie.sk?ie.sk(this,o):.8*o;this.AD(i+c,s+t,i+c+r,s+t,g,e),e instanceof Bt&&e.lastCreatedElement.classList.add("gojs-td")}if(u){let t=s+o-o/2.2|0;g%2!=0&&(t+=.5),this.AD(i+c,t,i+c+r,t,g,e),e instanceof Bt&&e.lastCreatedElement.classList.add("gojs-td")}}AD(t,e,i,s,n,o){o.beginPath(),o.lineWidth=n,o.moveTo(t,e),o.lineTo(i,s),o.stroke(),o.endPath()}yf(t,e,i){if(!super.yf(t,e,i))return!1;if(this.bn(t,this.Qe,!0,!1,this.naturalBounds,this.actualBounds),i){if(0===this.svg.getElementsByTagName("text").length)return!0;const e=this.svg.getElementsByClassName("gojs-td");for(let i=0;i<e.length;i++)t.setFillOrStrokeInPlace(e[i],!1)}else this.lE(this.svg,this.ye?this.ye[0]:this.text,t);return!0}lE(t,e,i){t.innerHTML=e,i.setFillOrStrokeInPlace(t,!0)}Pd(t){return!!(this.lineCount>1||this.isUnderline||this.isStrikethrough)||super.Pd(t)}AN(t,e){if("g"!==t.nodeName)t.setAttributeNS(null,"filter",e);else{const i=t.getElementsByTagName("text");for(let t=0;t<i.length;t++)i[t].setAttributeNS(null,"filter",e)}}aE(){this.vn=0,this.pe=0,this.uo=null,this.Ii=null,this.ye=null,this.Fn=null}bd(t,e,i,s){const n=this.Pi;this.Xl=t,this.rC(!1);const o=this.Dn;null!==ie.us&&(ie.TD!==o&&(ie.us.font=o,ie.TD=o),ie.nk&&(ie.us.letterSpacing=this.letterSpacing,ie.us.wordSpacing=this.wordSpacing)),this.aE();let r=0,a=0;isNaN(this.desiredSize.width)?(r=this.hE(),r=Math.min(r,t/this.scale)):r=this.desiredSize.width,null!==this.panel&&(r=Math.min(r,this.panel.maxSize.width)),a=this.CD(r),a=isNaN(this.desiredSize.height)?Math.min(a,e/this.scale):this.desiredSize.height,this.cE(t,a),(1===this.wrap||isNaN(this.desiredSize.width))&&(r=isNaN(t)?this.pe:Math.min(t,this.pe)),r=Math.max(i,r),a=Math.max(s,a),this.Ke.Hn(r,a),this.ro(0,0,r,a),null!==this.svg&&n!==this.Pi&&this.Ji(!0)}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}Rn(t,e){null===this.Fn?(this.Fn=t,this.pe=e):((null===this.ye||null===this.Ii)&&(this.ye=[],this.Ii=[],this.ye.push(this.Fn),this.Ii.push(this.pe)),this.ye.push(t),this.Ii.push(e),this.ye.length>this.maxLines&&(this.n|=16777216))}oC(t,e,i){const s=0===this.formatting;s&&(t=t.trim());let n=0,o=0,r=0;const a=this.Dn,h=this.spacingAbove+this.spacingBelow,l=Math.max(0,this.ty()+h),u=1===this.overflow?this.DD(a):0;if(this.Pi>=this.maxLines)return void(void 0!==i&&i.e(0,l));let c=t;if(0===this.wrap){if(this.vn=1,o=this.getStringWidth(t),0===u||o<=e)return this.pe=Math.max(this.pe,o),this.Rn(t,this.pe),void(void 0!==i&&i.e(o,l));let n=this.Hd(c);c=c.substring(n.length);let a=this.Hd(c);for(o=this.getStringWidth(n+a),r=0;a.length>0&&o<=e;){n+=a,c=c.substring(a.length),a=this.Hd(c),r=o;let t=n+a;s&&(t=t.trim()),o=this.getStringWidth(t)}for(s&&(a=a.trim()),n+=a,e=Math.max(1,e-u);this.getStringWidth(n)>e&&n.length>1;)n=n.substring(0,n.length-1);return this.rC(!0),n+=ie.$0,r=this.getStringWidth(n),this.pe=r,this.Rn(n,r),void(void 0!==i&&i.e(r,l))}let d=0;for(0===c.length&&(d=1,this.Rn(c,0));c.length>0;){let t=this.Hd(c);for(c=c.substring(t.length);this.getStringWidth(t)>e;){let i=1;for(o=this.getStringWidth(t.substring(0,i)),r=0;o<=e;)i++,r=o,o=this.getStringWidth(t.substring(0,i));let s=0;1===i?(s=o,n=Math.max(n,o)):(s=r,n=Math.max(n,r)),i--,i<1&&(i=1);const a=t.substring(0,i);if(this.Rn(a,s),d++,t=t.substring(i),this.Pi+d>this.maxLines)break}let i=this.Hd(c);for(o=this.getStringWidth(t+i),r=0;i.length>0&&o<=e;){t+=i,c=c.substring(i.length),i=this.Hd(c),r=o;let e=t+i;s&&(e=e.trim()),o=this.getStringWidth(e)}if(s&&(t=t.trim()),""===t)continue;""===t[t.length-1]&&(t=t.substring(0,t.length-1)+"");let a=0;if(0===i.length?(a=o,n=Math.max(n,o)):(r=this.getStringWidth(t),a=r,n=Math.max(n,r)),this.Rn(t,a),d++,this.Pi+d>this.maxLines)break}this.vn=Math.min(this.maxLines-this.Pi,d),this.pe=Math.max(this.pe,n),void 0!==i&&i.e(this.pe,l*this.vn)}cE(t,e){if(0===this.pe||null===this.Ii||null===this.ye||1!==this.overflow)return;const i=this.Dn,s=1===this.overflow?this.DD(i):0,n=this.spacingAbove+this.spacingBelow,o=Math.max(0,this.ty()+n),r=Math.min(this.maxLines-1,Math.max(Math.floor(e/o+.01)-1,0));if(r+1>=this.ye.length)return;this.rC(!0);let a=this.ye[r];const h=Math.max(1,t-s);for(;this.getStringWidth(a)>h&&a.length>1;)a=a.substring(0,a.length-1);a+=ie.$0;const l=this.getStringWidth(a);this.ye[r]=a,this.ye=this.ye.slice(0,r+1),this.Ii[r]=l,this.Ii=this.Ii.slice(0,r+1),this.vn=this.ye.length,this.pe=Math.max(this.pe,l),this.Pi=this.vn,1===this.Pi&&(this.Fn=this.ye[0])}Hd(t){if(3===this.wrap)return t.substring(0,1);let e=t.length,i=0;const s=ie.fE;for(;i<e&&!s.test(t.charAt(i));)i++;for(1===this.formatting&&(e=Math.min(e,i+1));i<e&&s.test(t.charAt(i));)i++;return i>=t.length?t:t.substring(0,i)}getStringWidth(t){return null===ie.us?8*t.length:ie.us.measureText(t).width}ty(){if(null!==this.uo)return this.uo;const t=this.Dn;let e=0;if(null===ie.us)return e=16,this.uo=e,e;if(void 0!==ie.lC[t]&&ie.vD<5e3)e=ie.lC[t];else{ie.us.letterSpacing="0px";const i=ie.us.measureText("M");ie.us.letterSpacing=this.letterSpacing,e=1.3*i.width,ie.lC[t]=e,ie.vD++}return this.uo=e,e}DD(t){if(null===ie.us)return 6;let e=0;return void 0!==ie.ek[t]&&ie.nC<5e3?e=ie.ek[t]:(e=ie.us.measureText(ie.$0).width,ie.ek[t]=e,ie.nC++),e}ok(t,e){return t.indexOf("\n",e)}CD(t){let e=this.ue.replace(/\r\n/g,"\n").replace(/\r/g,"\n");const i=this.spacingAbove+this.spacingBelow,s=Math.max(0,this.ty()+i);if(0===e.length)return this.pe=0,this.Pi=1,s;if(!this.isMultiline){const t=this.ok(e,0);t>=0&&(e=e.substring(0,t))}let n=0;this.Pi=0;let o=0,r=-1,a=!1;for(;!a;){if(r=this.ok(e,o),-1===r&&(r=e.length,a=!0),o<=r){const i=e.substring(o,r);if(0!==this.wrap){this.vn=0;const e=x.l();this.oC(i,t,e),n+=e.height,x.i(e),this.Pi+=this.vn}else this.oC(i,t),n+=s,this.Pi++;this.Pi===this.maxLines&&(a=!0)}o=r+1}return this.jp=n,n}hE(){let t=this.ue.replace(/\r\n/g,"\n").replace(/\r/g,"\n");if(0===t.length)return 8;if(this.isMultiline){let e=0,i=0,s=!1;for(;!s;){let n=this.ok(t,i);-1===n&&(n=t.length,s=!0);let o=t.substring(i,n);0===this.formatting&&(o=o.trim()),e=Math.max(e,this.getStringWidth(o)),i=n+1}return e}{const e=this.ok(t,0);return e>=0&&(t=t.substring(0,e)),this.getStringWidth(t)}}get textValidation(){return null!==this.tt?this.tt.zl:null}set textValidation(t){const i=this.textValidation;i!==t&&(null!==t&&e.S(t,ie,"textValidation"),this.Rs().zl=t,this.t("textValidation",i,t))}get textEdited(){return null!==this.tt?this.tt.ny:null}set textEdited(t){const i=this.textEdited;i!==t&&(null!==t&&e.S(t,ie,"textEdited"),this.Rs().ny=t,this.t("textEdited",i,t))}get spacingAbove(){return null!==this.tt?this.tt.ly:0}set spacingAbove(t){const e=this.spacingAbove;e!==t&&(this.Rs().ly=t,this.f(),this.t("spacingAbove",e,t))}get spacingBelow(){return null!==this.tt?this.tt.hy:0}set spacingBelow(t){const e=this.spacingBelow;e!==t&&(this.Rs().hy=t,this.f(),this.t("spacingBelow",e,t))}get letterSpacing(){return null!==this.tt?this.tt.cy:"0px"}set letterSpacing(t){const e=this.letterSpacing;e!==t&&(ie.nk=!0,this.Rs().cy=t,this.f(),this.t("letterSpacing",e,t))}get wordSpacing(){return null!==this.tt?this.tt.fy:"0px"}set wordSpacing(t){const e=this.wordSpacing;e!==t&&(ie.nk=!0,this.Rs().fy=t,this.f(),this.t("wordSpacing",e,t))}get formatting(){return null!==this.tt?this.tt.uy:0}set formatting(t){const e=this.formatting;e!==t&&(this.Rs().uy=t,this.f(),this.t("formatting",e,t))}get maxLines(){return null!==this.tt?this.tt.gy:1/0}set maxLines(t){const i=this.maxLines;i!==t&&((t=Math.floor(t))<=0&&e.J(t,"> 0",ie,"maxLines"),this.Rs().gy=t,this.f(),this.t("maxLines",i,t))}getMetrics(){return[this.pe,this.Xl,this.uo,this.vn,this.Ii,this.ye,this.Fn||""]}rE(t){void 0!==t&&(this.pe=t[0],this.Xl=t[1],this.uo=t[2],this.vn=t[3],this.Ii=t[4],this.ye=t[5],this.Fn=t[6])}get metrics(){return{arrSize:null!==this.Ii?this.Ii:[this.pe],arrText:null!==this.ye?this.ye:[this.Fn],maxLineWidth:this.pe,fontHeight:this.uo}}get choices(){return this.Kd}set choices(t){const e=this.Kd;e!==t&&(this.Kd=t,this.t("choices",e,t))}static fE=new RegExp("[ ]");static lC=new s;static vD=0;static ek=new s;static nC=0;static $0="...";static TD="";static us=null;static M0=!1;static nk=!1}class se{me;gs;go;uy;gy;_0;ly;hy;Z0;ny;ey;zl;al;Q0;cy;fy;constructor(){this.me=!1,this.gs=null,this.go=0,this.uy=0,this.gy=1/0,this._0=0,this.ly=0,this.hy=0,this.Z0="start",this.ny=null,this.ey=null,this.zl=null,this.al=v.Top,this.Q0=2,this.cy="0px",this.fy="0px"}copy(){const t=new se;return t.gs=this.gs,t.go=this.go,t.uy=this.uy,t.gy=this.gy,t._0=this._0,t.ly=this.ly,t.hy=this.hy,t.Z0=this.Z0,t.ny=this.ny,t.ey=this.ey,t.zl=this.zl,t.al=this.al,t.Q0=this.Q0,t.cy=this.cy,t.fy=this.fy,t}}class ne{vf;Ff;Rf;iy;Of;constructor(){this.vf=1,this.Ff=0,this.Rf=1,this.iy=null,this.Of=null}copy(){const t=new ne;return t.vf=this.vf,t.Ff=this.Ff,t.Rf=this.Rf,t.iy=this.iy,t.Of=this.Of,t}}var oe=(t=>(t[t.None=0]="None",t[t.Fill=2]="Fill",t[t.Uniform=6]="Uniform",t[t.UniformToFill=7]="UniformToFill",t))(oe||{});class re extends At{hl;en;cl;If;gs;fl;Ef;go;Uf;Vf;U1;constructor(t,e){super(),this.n|=2097152,this.hl=null,this.en="",this.cl=w.YF,this.If=2,this.gs=null,this.fl=null,this.Ef=v.Center,this.go=0,this.Uf=null,this.Vf=null,this.U1=null,"string"==typeof t?this.source=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.en=this.en,t.element=this.hl,t.cl=this.cl.N(),t.If=this.If,t.go=this.go,t.gs=this.gs,t.fl=this.fl,t.Ef=this.Ef.N(),t.Vf=this.Vf}fe(t){t in oe?this.imageStretch=t:super.fe(t)}toString(){return"Picture("+this.source+")#"+u.xs(this)}get Bf(){return!!(1048576&this.n)}set Bf(t){this.Bf!==t&&(this.n=1048576^this.n)}get my(){return!!(2097152&this.n)}set my(t){this.my!==t&&(this.n=2097152^this.n)}get Sn(){return!!(4194304&this.n)}set Sn(t){this.Sn!==t&&(this.n=4194304^this.n)}static clearCache(t){void 0===t&&(t=""),e.s(t,"string",re,"clearCache:url"),""!==t?re.yy[t]&&(delete re.yy[t],re.rk--):(re.yy=new s,re.rk=0)}static NT(t,e){e.FD||(e.lk=i=>{re.uE(e,i),t.desiredSize.isReal()||(t.xi(!1),t.f())},e.ak=t=>re.dE(e,t),e.addEventListener("load",e.lk),e.addEventListener("error",e.ak),e.FD=!0)}static vO(t){t.lk&&t.removeEventListener("load",t.lk),t.ak&&t.removeEventListener("error",t.ak),delete t.lk,delete t.ak,t.FD=!1}get element(){return this.hl}set element(t){const i=this.hl;if(this.Ji(!0),i!==t){let s=!1;wt.isUsingDOM()&&(this.Bf=t instanceof HTMLCanvasElement,s=t instanceof HTMLImageElement,null!==t&&!(s||t instanceof HTMLVideoElement||this.Bf)&&e.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t));const n=this.diagram;null!==n&&n.O2(this),this.hl=t,null!==t&&s&&void 0===t.hs&&(t.hs=new u),null!==n&&s&&n.R2(this),this.t("element",i,t),this.C()}}TO(){const t=this.hl;if(null===t)return;const e=this.desiredSize.isReal();(this.Bf||!0===t.complete)&&(t.Dp&&(t.wy instanceof Event&&null!==this.gs?this.gs(this,t.wy):!0===t.Sn&&!t.wy&&null!==this.fl&&t.aC&&this.fl(this,t.aC)),t.Sn=!0),t.Sn&&e&&null!==this.diagram&&this.diagram.od.add(this)}gE(){if(null===this.hl)return void(this.Uf=!1);const t=new Et(null)._t;try{t.drawImage(this.hl,0,0)}catch{this.my=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.Uf=!1),this.Uf=!1}catch{this.Uf=!0}}get source(){return this.en}set source(t){const i=this.en;if(i!==t){this.Ji(!0),e.s(t,"string",re,"source"),this.en=t;let s=re.yy,n=null;if(void 0!==s[t])n=s[t];else if(""!==t){re.rk>30&&(re.clearCache(),s=re.yy),n=e.Ni("img"),n.Dp=!0,re.NT(this,n);const i=this.Vf;null!==i&&(n.crossOrigin=i(this)),n.src=t,s[t]=n,re.rk++}this.element=n,null!==n&&void 0===n.__goCache&&(n.__goCache=new ae),this.f(),this.C(),this.t("source",i,t)}}static uE(t,e){let i;t.Sn=!0,t.wy=!1;const s=t.hs.copy();if(null==s)return;const n=s.iterator;for(;n.next();){const s=n.value;s.C();const o=t.getAttribute("src")||"",r=s.oa.get(o);if(null===r)continue;const a=r.length;for(let n=0;n<a;n++)i=r[n],i.desiredSize.isReal()||s.od.add(i),i.Ji(!0),s.requestUpdate(),t.Dp&&(void 0===t.aC&&(t.aC=e),null!==i.fl&&i.fl(i,e))}t.hs.clear()}static dE(t,i){let s;t.wy=i;const n=t.hs.copy();if(null==n)return;const o=n.iterator;for(;o.next();){const n=o.value,r=t.getAttribute("src")||"",a=n.oa.get(r);if(null===a)continue;const h=a.length,l=e.nt();for(let t=0;t<h;t++)l.push(a[t]);if(t.Dp)for(let t=0;t<h;t++)s=l[t],null!==s.gs&&s.gs(s,i);e.Z(l)}t.hs.clear()}reloadSource(){if(""===this.source)return;re.clearCache(this.source);const t=this.source;this.source="",this.source=t}redraw(){this.C(),this.Ji(!0)}get sourceCrossOrigin(){return this.Vf}set sourceCrossOrigin(t){if(this.Vf!==t){null!==t&&e.S(t,re,"sourceCrossOrigin"),this.Vf=t;const i=this.element;if(null!==i){const e=i.getAttribute("src");void 0!==i.crossOrigin&&(null===t&&"string"==typeof e?i.crossOrigin=null:null!==t&&(i.crossOrigin=t(this)),e&&(i.src=e))}}}get sourceRect(){return this.cl}set sourceRect(t){const e=this.cl;e.equals(t)||(t=t.N(),this.cl=t,this.f(),this.t("sourceRect",e,t))}get imageStretch(){return this.If}set imageStretch(t){const e=this.If;e!==t&&(this.If=t,this.C(),this.t("imageStretch",e,t))}get flip(){return this.go}set flip(t){const e=this.go;e!==t&&(this.go=t,this.C(),this.t("flip",e,t))}get imageAlignment(){return this.Ef}set imageAlignment(t){const e=this.Ef;e.equals(t)||(t=t.N(),this.Ef=t,this.C(),this.t("imageAlignment",e,t))}get errorFunction(){return this.gs}set errorFunction(t){const i=this.gs;i!==t&&(null!==t&&e.S(t,re,"errorFunction"),this.gs=t,this.t("errorFunction",i,t))}get successFunction(){return this.fl}set successFunction(t){const i=this.fl;i!==t&&(null!==t&&e.S(t,re,"successFunction"),this.fl=t,this.t("successFunction",i,t))}Ma(t,e){const i=this.hl;if(null===i)return;const s=i.getAttribute("src"),n=wt.isUsingDOM();if(n&&i instanceof HTMLImageElement&&(null===s||""===s)||i.wy instanceof Event&&t instanceof It)return;const o=t instanceof Bt,r=this.naturalBounds;let a=0,h=0;const l=this.Bf;let u=l?+i.width:i.naturalWidth,c=l?+i.height:i.naturalHeight;if(void 0===u&&i.videoWidth&&(u=i.videoWidth),void 0===c&&i.videoHeight&&(c=i.videoHeight),n){if(0===u||0===c)return}else u=this.width,c=this.height;const d=u,g=c;this.sourceRect.isReal()&&(a=this.cl.x,h=this.cl.y,u=this.cl.width,c=this.cl.height);let f=u,m=c;const p=this.If,y=this.Ef;switch(p){case 0:if(this.sourceRect.isReal())break;f>=r.width&&(a=a+y.offsetX+(f*y.x-r.width*y.x)),m>=r.height&&(h=h+y.offsetY+(m*y.y-r.height*y.y)),u=Math.min(r.width,f),c=Math.min(r.height,m);break;case 2:f=r.width,m=r.height;break;case 6:case 7:let t=0;6===p?(t=Math.min(r.height/m,r.width/f),f*=t,m*=t):7===p&&(t=Math.max(r.height/m,r.width/f),f*=t,m*=t,f>=r.width&&(a=(a+y.offsetX+(f*y.x-r.width*y.x)/f)*u),m>=r.height&&(h=(h+y.offsetY+(m*y.y-r.height*y.y)/m)*c),u*=1/(f/r.width),c*=1/(m/r.height),f=r.width,m=r.height)}const x=u*c,w=this.getDocumentScale()*e.scale,b=f*w*(m*w),v=x/b,P=i.__goCache;let k=null;const S=re.mE;if(!o){if(i.Sn&&void 0!==P&&d<8e3&&g<8e3&&b>4&&v>S*S){null===P.Bt&&(P.RD(4,d,g,i),P.RD(16,d,g,i));const t=P.Bt,e=t.length;for(let i=0;i<e&&t[i].qd*t[i].qd<v;i++)k=t[i]}if(!e.nd&&(null===this.Uf&&this.gE(),this.Uf))return}const M=f<r.width?y.offsetX+(r.width*y.x-f*y.x):0,C=m<r.height?y.offsetY+(r.height*y.y-m*y.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(r.width,f),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(r.height,m)),t.scale(1,-1);break;case 3:t.translate(Math.min(r.width,f),Math.min(r.height,m)),t.scale(-1,-1)}if(t.commitTransform(),e.getRenderingHint("pictureRatioOptimization")&&!e.ph&&void 0!==P&&null!==k&&1!==k.qd){t.save();const e=k.qd;try{t.drawImage(k.en,a/e,h/e,Math.min(k.en.width,u/e),Math.min(k.en.height,c/e),M,C,Math.min(r.width,f),Math.min(r.height,m)),t instanceof Bt&&(this.U1=[a/e,h/e,Math.min(k.en.width,u/e),Math.min(k.en.height,c/e),M,C,Math.min(r.width,f),Math.min(r.height,m)])}catch{this.my=!1}t.restore()}else try{t.drawImage(i,a,h,u,c,M,C,Math.min(r.width,f),Math.min(r.height,m)),t instanceof Bt&&(this.U1=[a,h,u,c,M,C,Math.min(r.width,f),Math.min(r.height,m)])}catch{this.my=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(r.width,f),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(r.height,m));break;case 3:t.scale(-1,-1),t.translate(-Math.min(r.width,f),-Math.min(r.height,m))}}get naturalBounds(){return this.Ke}bd(t,e,i,s){const n=this.desiredSize,o=this.Zs(!0),r=this.hl,a=this.Bf;let h=0,l=0;(a||!this.Sn&&r&&r.complete)&&(this.Sn=!0),null===r?(isFinite(n.width)||(t=i),isFinite(n.height)||(e=s)):(h=a?+r.width:r.naturalWidth,l=a?+r.height:r.naturalHeight),isFinite(n.width)||2===o||5===o?(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:null!==r&&(t=h)),i=0):null!==r&&!1!==this.Sn&&(t=this.sourceRect.isReal()?this.sourceRect.width:h),isFinite(n.height)||2===o||4===o?(isFinite(e)||(this.sourceRect.isReal()?e=this.sourceRect.height:null!==r&&(e=l)),s=0):null!==r&&!1!==this.Sn&&(e=this.sourceRect.isReal()?this.sourceRect.height:l),isFinite(n.width)&&(t=n.width),isFinite(n.height)&&(e=n.height);const u=this.maxSize,c=this.minSize;i=Math.max(i||0,c.width),s=Math.max(s||0,c.height),t=Math.min(u.width,t),e=Math.min(u.height,e),t=Math.max(i,t),e=Math.max(s,e),null!==r&&!r.complete&&(isFinite(t)||(t=0),isFinite(e)||(e=0)),this.Ke.Hn(t,e),this.ro(0,0,t,e)}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}static yy=new s;static rk=0;static mE=4}class ae{Bt;constructor(){this.Bt=null}RD(t,e,i,s){null===this.Bt&&(this.Bt=[]);const n=new Et(null),o=n._t,r=1/t;if(n.width=e/t,n.height=i/t,0===n.width||0===n.height)return;const a=new he(n.bt,t);let h=s,l=1;if(this.Bt.length>0){const t=this.Bt[this.Bt.length-1];h=t.en,l=t.qd}o.setTransform(r*l,0,0,r*l,0,0),o.commitTransform(),o.drawImage(h,0,0),this.Bt.push(a)}}class he{en;qd;constructor(t,e){this.en=t,this.qd=e}}class le{Ne;um;constructor(){this.um=new N,this.Ne=null}Ue(t){null!==t?(this.um=t,t.figures.clear()):this.um=new N,this.Ne=null}Lu(t,e,i,s,n,o){if(void 0!==s&&!0===s){const i=new A(1);i.endX=t,i.endY=e,this.Ne.segments.add(i)}else this.Ne=new T,this.Ne.startX=t,this.Ne.startY=e,this.Ne.isFilled=i,this.Ne.isEvenOdd=o||!1,this.um.figures.add(this.Ne);void 0!==n&&(this.Ne.isShadowed=n)}tR(){const t=this.Ne.segments.length;t>0&&this.Ne.segments.elt(t-1).close()}eR(){this.Ne.segments.length>0&&(this.Ne.isFilled=!0)}iR(t){this.Ne.isShadowed=t}zU(t){this.Ne.isEvenOdd=t}ZF(t,e,i){void 0===i&&(i=!1);const s=new A(1);s.endX=t,s.endY=e,i&&s.close(),this.Ne.segments.add(s)}Ys(t,e,i){void 0===i&&(i=!1);const s=new A(2);s.endX=t,s.endY=e,i&&s.close(),this.Ne.segments.add(s)}wr(t,e,i,s,n,o,r){void 0===r&&(r=!1);const a=new A(3);a.point1X=t,a.point1Y=e,a.point2X=i,a.point2Y=s,a.endX=n,a.endY=o,r&&a.close(),this.Ne.segments.add(a)}Au(t,e,i,s,n){void 0===n&&(n=!1);const o=new A(4);o.point1X=t,o.point1Y=e,o.endX=i,o.endY=s,n&&o.close(),this.Ne.segments.add(o)}QF(t,e,i,s,n,o,r){void 0===o&&(o=0),void 0===r&&(r=!1);const a=new A(5);a.startAngle=t,a.sweepAngle=e,a.centerX=i,a.centerY=s,a.radiusX=n,a.radiusY=0!==o?o:n,r&&a.close(),this.Ne.segments.add(a)}_F(t,e,i,s,n,o,r,a){void 0===a&&(a=!1);const h=new A(6,o,r,t,e,i,s,n);a&&h.close(),this.Ne.segments.add(h)}static hC=null;static JL(t){const e=le.hC;if(null!==e)return le.hC=null,e.Ue(t),e;{const e=new le;return e.Ue(t),e}}static $L(t){le.hC=t}}{const t=function(t,e){const i=t.toLowerCase(),s=k.Wn;s[t]=e,s[i]=t};t("Rectangle",((t,e,i)=>{const s="r"+e+","+i;let n=k.pr[s];return void 0!==n||(n=new N(2),n.endX=e,n.endY=i,k.yr<k.am&&(k.pr[s]=n,k.yr++)),n})),t("Square",((t,e,i)=>{const s="s"+e+","+i;let n=k.pr[s];return void 0!==n||(n=new N(2),n.endX=e,n.endY=i,n.defaultStretch=6,k.yr<k.am&&(k.pr[s]=n,k.yr++)),n}));const e=(t,e,i,s,n)=>{(isNaN(s)||s<0)&&(s=5),isNaN(n)&&(n=15);const o="rr"+e+","+i+","+s+","+n;let r=k.pr[o];if(void 0!==r)return r;let a=s;1&~n?a=0:(a=Math.min(a,2&~n?e:e/3),a=Math.min(a,8&~n?i:i/3));const h=new T(a,0,!0);r=(new N).add(h);const l=v.TopLeft.copy(),u=v.BottomRight.copy();if(2&~n)h.add(new A(2,e,0));else{let t=s;t=Math.min(t,1&~n?e:e/3),t=Math.min(t,4&~n?i:i/3);const o=t*k.qn;h.add(new A(2,e-t,0)).add(new A(3,e,t,e-o,0,e,o)),l.offsetY=o,u.offsetX=-o}if(4&~n)h.add(new A(2,e,i));else{let t=s;t=Math.min(t,8&~n?e:e/3),t=Math.min(t,2&~n?i:i/3);const o=t*k.qn;h.add(new A(2,e,i-t)).add(new A(3,e-t,i,e,i-o,e-o,i)),u.offsetX=-o,u.offsetY=-o}if(8&~n)h.add(new A(2,0,i));else{let t=s;t=Math.min(t,4&~n?e:e/3),t=Math.min(t,1&~n?i:i/3);const o=t*k.qn;h.add(new A(2,t,i)).add(new A(3,0,i-t,o,i,0,i-o)),l.offsetX=o,u.offsetY=-o}if(1&~n)h.add(new A(2,0,0).close());else{const t=a*k.qn;h.add(new A(2,0,a)).add(new A(3,a,0,0,t,t,0).close()),l.offsetX=t,l.offsetY=t}return r.spot1=l,r.spot2=u,k.yr<k.am&&(k.pr[o]=r,k.yr++),r};t("RoundedRectangle",((t,i,s)=>{const n=t?t.parameter1:NaN,o=t?t.parameter2:NaN;return e(t,i,s,n,o)})),t("Border","RoundedRectangle"),t("RoundedTopRectangle",((t,i,s)=>{const n=t?t.parameter1:NaN;return e(t,i,s,n,3)})),t("RoundedBottomRectangle",((t,i,s)=>{const n=t?t.parameter1:NaN;return e(t,i,s,n,12)})),t("RoundedLeftRectangle",((t,i,s)=>{const n=t?t.parameter1:NaN;return e(t,i,s,n,9)})),t("RoundedRightRectangle",((t,i,s)=>{const n=t?t.parameter1:NaN;return e(t,i,s,n,6)})),t("Ellipse",((t,e,i)=>{const s="e"+e+","+i;let n=k.pr[s];return void 0!==n||(n=new N(3),n.endX=e,n.endY=i,n.spot1=v.vP,n.spot2=v.FP,k.yr<k.am&&(k.pr[s]=n,k.yr++)),n})),t("Circle",((t,e,i)=>{const s="c"+e+","+i;let n=k.pr[s];return void 0!==n||(n=new N(3),n.endX=e,n.endY=i,n.spot1=v.vP,n.spot2=v.FP,n.defaultStretch=6,k.yr<k.am&&(k.pr[s]=n,k.yr++)),n})),t("TriangleRight",((t,e,i)=>(new N).add(new T(0,0).add(new A(2,e,.5*i)).add(new A(2,0,i).close())).setSpots(0,.25,.5,.75))),t("TriangleDown",((t,e,i)=>(new N).add(new T(0,0).add(new A(2,e,0)).add(new A(2,.5*e,i).close())).setSpots(.25,0,.75,.5))),t("TriangleLeft",((t,e,i)=>(new N).add(new T(e,i).add(new A(2,0,.5*i)).add(new A(2,e,0).close())).setSpots(.5,.25,1,.75))),t("TriangleUp",((t,e,i)=>(new N).add(new T(e,i).add(new A(2,0,i)).add(new A(2,.5*e,0).close())).setSpots(.25,.5,.75,1))),t("Triangle","TriangleUp"),t("Diamond",((t,e,i)=>(new N).add(new T(.5*e,0).add(new A(2,0,.5*i)).add(new A(2,.5*e,i)).add(new A(2,e,.5*i).close())).setSpots(.25,.25,.75,.75))),t("LineH",((t,e,i)=>{const s=new N(1);return s.startX=0,s.startY=i/2,s.endX=e,s.endY=i/2,s})),t("LineV",((t,e,i)=>{const s=new N(1);return s.startX=e/2,s.startY=0,s.endX=e/2,s.endY=i,s})),t("None","Rectangle"),t("BarH","Rectangle"),t("BarV","Rectangle"),t("MinusLine","LineH"),t("PlusLine",((t,e,i)=>(new N).add(new T(0,i/2,!1).add(new A(2,e,i/2)).add(new A(1,e/2,0)).add(new A(2,e/2,i))))),t("XLine",((t,e,i)=>(new N).add(new T(0,i,!1).add(new A(2,e,0)).add(new A(1,0,0)).add(new A(2,e,i))))),t("LineRight",((t,e,i)=>(new N).add(new T(.25*e,0,!1).add(new A(2,.75*e,.5*i)).add(new A(2,.25*e,i))))),t("LineDown",((t,e,i)=>(new N).add(new T(0,.25*i,!1).add(new A(2,.5*e,.75*i)).add(new A(2,e,.25*i))))),t("LineLeft",((t,e,i)=>(new N).add(new T(.75*e,0,!1).add(new A(2,.25*e,.5*i)).add(new A(2,.75*e,i))))),t("LineUp",((t,e,i)=>(new N).add(new T(0,.75*i,!1).add(new A(2,.5*e,.25*i)).add(new A(2,e,.75*i))))),t("Capsule",((t,e,i)=>{const s=new N;if(e<i){const n=e/2,o=new T(0,n,!0);s.add(o),o.add(new A(5,180,180,n,n,n,n)),o.add(new A(2,e,i-n)),o.add(new A(5,0,180,n,i-n,n,n)),o.add(new A(2,0,n));const r=isFinite(t.parameter1)?t.parameter1:.156*e;return s.setSpots(0,0,1,1,0,r,0,-r),s}if(e>i){const n=i/2,o=new T(n,0,!0);s.add(o),o.add(new A(2,e-n,0)),o.add(new A(5,270,180,e-n,n,n,n)),o.add(new A(2,n,i)),o.add(new A(5,90,180,n,n,n,n));const r=isFinite(t.parameter1)?t.parameter1:.156*i;return s.setSpots(0,0,1,1,r,0,-r,0),s}return s.type=3,s.endX=e,s.endY=i,s.spot1=v.vP,s.spot2=v.FP,s}));const i=(t,e)=>new T(t,e,!1,!1),s=(t,e,i)=>t.add(new A(2,e,i)),n=(t,e,i)=>t.add(new A(1,e,i));t("Borders",((t,e,o)=>{let r=t?t.parameter1:NaN;isNaN(r)?r=10:r&=15;const a=new N;let h;return 10===r?(h=i(e,0),s(h,e,o),n(h,0,o),s(h,0,0)):5===r?(h=i(0,0),s(h,e,0),n(h,e,o),s(h,0,o)):1===r?(h=i(0,0),s(h,e,0),n(h,e,o)):2===r?(h=i(e,0),s(h,e,o)):4===r?(h=i(e,o),s(h,0,o)):8===r?(h=i(0,o),s(h,0,0),n(h,e,o)):3===r?(h=i(0,0),s(h,e,0),s(h,e,o)):6===r?(h=i(e,0),s(h,e,o),s(h,0,o)):12===r?(h=i(e,o),s(h,0,o),s(h,0,0)):9===r?(h=i(0,o),s(h,0,0),s(h,e,0)):7===r?(h=i(0,0),s(h,e,0),s(h,e,o),s(h,0,o)):14===r?(h=i(e,0),s(h,e,o),s(h,0,o),s(h,0,0)):13===r?(h=i(e,o),s(h,0,o),s(h,0,0),s(h,e,0)):11===r?(h=i(0,o),s(h,0,0),s(h,e,0),s(h,e,o)):15===r?(h=i(0,0),s(h,e,0),s(h,e,o),s(h,0,o),h.add(new A(2,0,0).close())):(h=i(0,0),n(h,e,o)),a.add(h),a}))}k.lm={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var ue=(t=>(t[t.None=0]="None",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Shown=4]="Shown",t[t.Hidden=8]="Hidden",t[t.NodeSized=16]="NodeSized",t[t.GroupLayout=32]="GroupLayout",t[t.NodeReplaced=64]="NodeReplaced",t[t.Standard=127]="Standard",t[t.All=16777215]="All",t))(ue||{});class ce extends Yt{b;Qo;H;ul;dl;_o;ue;gl;Da;sn;tr;jd;VM;OD;xy;ky;constructor(t,e){let i;void 0===t||t instanceof jt||"string"==typeof t?i=t:t&&(e=t),super(i),this.b=2408959,this.Qo="",this.H=null,this.ul="",this.dl=null,this._o=null,this.ue="",this.gl=null,this.Da=null,this.sn=new y(NaN,NaN).k(),this.tr=null,this.jd=NaN,this.VM=-1,this.OD=new w,this.xy=null,this.ky=NaN,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.b=49152|-4097&this.b,t.Qo=this.Qo,null!==this.H&&(this.H.me?t.H=this.H:t.H=this.H.copy()),t.ul=this.ul,t._o=null,t.ue=this.ue,t.sn.h(this.sn),t.jd=this.jd}Ho(t){super.Ho(t),t.Sa(),t.dl=null,t.tr=null,t.xy=null}toString(){let t=e.Kn(this.constructor)+"#"+u.xs(this);return null!==this.data&&(t+="("+e.toString(this.data)+")"),t}static LayoutNone=0;static LayoutAdded=1;static LayoutRemoved=2;static LayoutShown=4;static LayoutHidden=8;static LayoutNodeSized=16;static LayoutGroupLayout=32;static LayoutNodeReplaced=64;static LayoutStandard=127;static LayoutAll=16777215;_e(){return null===this.H?this.H=new de:this.H.me&&(this.H=this.H.copy()),this.H}ba(){super.ba(),null!==this.H&&(this.H.me=!0)}df(t,e,i,s,n,o,r){const a=this.diagram;null!==a&&(3===t&&"elements"===e?n instanceof Yt?n.Pn((t=>{a.partManager.C2(t,a)})):n instanceof re&&a.R2(n):4===t&&"elements"===e&&(n instanceof Yt?n.Pn((t=>a.partManager.L2(t,a))):n instanceof re&&a.O2(n)),a.raiseChangedEvent(t,e,i,s,n,o,r))}updateTargetBindings(t){if(super.updateTargetBindings(t),null===this.data)return;const e=this.D.r,i=e.length;for(let s=0;s<i;s++){const i=e[s];i instanceof Yt&&i.Pn((e=>{null!==e.data&&e.JI(t)}))}const s=this.adornments;for(;s.next();)s.value.updateTargetBindings(t)}Go(){if(super.Go(),this.ON()){const t=this.D.r,e=t.length;for(let i=0;i<e;i++){const e=t[i];e instanceof Yt&&e.Pn((t=>t.Go()))}}const t=this.adornments;for(;t.next();)t.value.Go()}updateRelationshipsFromData(){null!==this.data&&this.diagram?.partManager.updateRelationshipsFromData(this)}get key(){const t=this.diagram;if(null!==t)return t.model.getKeyForNodeData(this.data)}get adornments(){return null===this._o?n.instance:this._o.iteratorValues}findAdornment(t){const e=this._o;return null===e?null:e.get(t)}addAdornment(t,e){if(null===e)return;let i=null,s=this._o;if(null!==s&&(i=s.get(t)),i!==e){if(null!==i){const t=i.diagram;null!==t&&t.remove(i)}null===s&&(s=new p,this._o=s),e.Qo!==t&&(e.category=t),s.set(t,e);const n=this.diagram;if(null!==n){n.add(e);const t=e.adornedObject;if(null!==t){const i=t.findBindingPanel();null!==i&&(e.data=i.data)}}}}removeAdornment(t){const e=this._o;if(null===e)return;const i=e.get(t);if(null!==i){const t=i.diagram;null!==t&&(t.remove(i),i.data=null)}e.delete(t),0===e.count&&(this._o=null)}clearAdornments(){const t=this._o;if(null===t)return;const i=e.nt(),s=t.iterator;for(;s.next();){const t=s.key;i.push(t)}const n=i.length;for(let t=0;t<n;t++)this.removeAdornment(i[t]);e.Z(i)}updateAdornments(){const t=this.diagram;if(null===t)return;this.pE(t),this.yE(t);let e=this.adornments;for(;e.next();){const t=e.value;t.f(),t.hasPlaceholder()&&t.placeholder.f()}for(e=this.adornments;e.next();)e.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;null!==t&&(t.ha(),!0!==this.ID()&&this.ED(!0))}BM(){!1!==this.ID()&&(this.updateAdornments(),this.ED(!1))}pE(t){const e="Selection";if(this.isSelected&&this.selectionAdorned){const i=this.selectionObject;if(null!==i&&this.actualBounds.isReal()&&this.isVisible()&&i.isVisibleObject()&&i.actualBounds.isReal()){let s=this.findAdornment(e);if(null===s){let e=this.selectionAdornmentTemplate;null===e&&(e=this.Lr()?t.linkSelectionAdornmentTemplate:this instanceof Ne?t.groupSelectionAdornmentTemplate:t.nodeSelectionAdornmentTemplate),s=e.copy(),null!==s&&(this.Lr()&&this.selectionObject===this.path&&(s.type=Yt.Link),s.adornedObject=i)}if(null!==s)return s.type===Yt.Link&&s.f(),void this.addAdornment(e,s)}}this.removeAdornment(e)}yE(t){const e=this;t.toolManager.mouseDownTools.each((t=>{t.isEnabled&&t.updateAdornments(e)})),t.toolManager.updateAdornments(e)}EM(t){this.gl=t,null===t&&this.dI()}get layer(){return this.gl}get diagram(){const t=this.gl;return null==t?null:t.diagram}get layerName(){return this.ul}set layerName(t){const e=this.ul;if(e===t)return;let i=this.diagram;if(null!==i&&(null===i.findLayer(t)||i.partManager.addsToTemporaryLayer))return;this.ul=t,null!==i&&i.invalidateDocumentBounds(),this.t("layerName",e,t);const s=this.layer;if(null===s||s.name===t||(i=s.diagram,null===i))return;const n=i.findLayer(t);if(null===n||n===s)return;let o=s.ri(-1,this,!0);o>=0&&i.raiseChangedEvent(4,"parts",s,this,null,o,!0),o=n.ch(99999999,this,!0),s.visible!==n.visible&&this.Xe(n.visible),o>=0&&i.raiseChangedEvent(3,"parts",n,null,this,!0,o);const r=this.layerChanged;if(null===r)return;const a=i.G;i.G=!0,r(this,s,n),i.G=a}get layerChanged(){return null!==this.H?this.H.Py:null}set layerChanged(t){const i=this.layerChanged;i!==t&&(null!==t&&e.S(t,ce,"layerChanged"),this._e().Py=t,this.t("layerChanged",i,t))}get zOrder(){return this.jd}set zOrder(t){const e=this.jd;if(e===t)return;this.jd=t;const i=this.layer;null!==i&&i.rb(-1,this),this.t("zOrder",e,t);const s=this.diagram;null!==s&&s.C()}wE(){const t=this.layer;null!==t&&t.rb(-1,this)}hk(){if(!1!==this.fa())return;this.cC(!0),this.pf();const t=this.diagram;null!==t&&(t.Cp(this),t.requestUpdate())}UD(){if(this.b|=2097152,!1===this.fa())return;const t=this.position,e=this.location;(!e.isReal()||!t.isReal())&&this.VD(t,e);const i=this.De,s=w.l().h(i);i.ce(),i.x=t.x,i.y=t.y,i.k(),this.kd(s,i),w.i(s),this.cC(!1),this.pf()}ro(t,e,i,s){const n=this.hi;n.e(t,e,i,s),null===this.Se&&(this.Se=new P);const o=this.Se;o.Ue(),this.Kp(o,t,e,i,s),this.Se=o,o.RP()||o.sm(n)}Kp(t,e,i,s,n){if(1!==this.it&&t.it(this.it),0===this.Xt)return;let o=v.Center;this.locationSpot.isSpot()&&(o=this.locationSpot);const r=y.l();if(this.locationObject!==this){const t=this.locationObject,e=t.naturalBounds;r.setSpot(e.x,e.y,e.width,e.height,o),null!==t.Se&&t.Se.gt(r),r.offset(-t.measuredBounds.x,-t.measuredBounds.y);let i=t.panel;for(;null!==i&&i!==this;)null!==i.Se&&i.Se.gt(r),r.offset(-i.measuredBounds.x,-i.measuredBounds.y),i=i.panel}else r.setSpot(e,i,s,n,o);t.ks(this.Xt,r.x,r.y),y.i(r)}get locationObject(){if(null===this.tr)if(this instanceof ge&&this.type!==Yt.Link&&this.hasPlaceholder())this.tr=this.placeholder;else{const t=this.locationObjectName;if(""!==t){const e=this.findObject(t);this.tr=null!==e?e:this}else this.tr=this}return this.tr?.visible?this.tr:this}get minLocation(){return null!==this.H?this.H.Sy:y.FL}set minLocation(t){const e=this.minLocation;e.equals(t)||(t=t.N(),this._e().Sy=t,this.t("minLocation",e,t))}get maxLocation(){return null!==this.H?this.H.My:y.RL}set maxLocation(t){const e=this.maxLocation;e.equals(t)||(t=t.N(),this._e().My=t,this.t("maxLocation",e,t))}get locationObjectName(){return null!==this.H?this.H.Ny:""}set locationObjectName(t){const e=this.locationObjectName;e!==t&&(this._e().Ny=t,this.tr=null,this.f(),this.t("locationObjectName",e,t))}get locationSpot(){return null!==this.H?this.H.Cy:v.TopLeft}set locationSpot(t){const e=this.locationSpot;e.equals(t)||(t=t.N(),this._e().Cy=t,this.f(),this.t("locationSpot",e,t))}move(t,e){!0===e?this.location=t:this.position=t}moveTo(t,e,i){const s=y.z(t,e);this.move(s,i),y.i(s)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(null!==t){if(!t.visible)return!1;const e=t.diagram;if(null!==e&&e.animationManager.Wx(this))return!0}const e=this.containingGroup;return!!(null===e||e.isSubGraphExpanded&&e.isVisible())}Xe(t){const e=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),null!==e&&e.Cp(this)):(this.invalidateLayout(8),this.clearAdornments()),this.Sa(),null!==e&&(e.invalidateDocumentBounds(),this instanceof me&&this.canAvoid()&&e.fd(this),e.C())}findObject(t){if(this.name===t)return this;let e=this.xy;if(null===e&&(this.xy=e=new p),null!==e.get(t))return e.get(t);const i=super.findObject(t);return null!==i?(e.set(t,i),i):(e.set(t,null),null)}s0(){this.xy=null}getRelativePoint(t,e,i){void 0===i&&(i=new y);const s=e.isNoSpot()?v.Center:e,n=t.naturalBounds;if(i.e(n.width*s.x+s.offsetX,n.height*s.y+s.offsetY),null===t||t===this)return i;t.v.gt(i);let o=t.panel;for(;null!==o&&o!==this;)o.v.gt(i),o=o.panel;return null!==this.Se&&this.Se.gt(i),i.offset(-this.hi.x,-this.hi.y),i}getDocumentBounds(t){return void 0===t&&(t=new w),t.h(this.actualBounds)}ensureBounds(){this.ht(1/0,1/0),this.Ut()}uD(t){const e=this.locationSpot,i=this.locationObject;let s=i.naturalBounds;s.isReal()||(s=w.em);const n=i instanceof $t?i.strokeWidth:0;if(t.setSpot(0,0,s.width+n,s.height+n,e),i!==this){t.offset(-n/2,-n/2),i.v.gt(t);let e=i.panel;for(;null!==e&&e!==this;)e.v.gt(t),e=e.panel}return null!==this.Se&&this.Se.gt(t),t.offset(-this.hi.x,-this.hi.y),t}hh(t,e){const i=void 0===e?this.OD:e,s=this.xE(),n=2*s;if(!this.isShadowed)return i.e(t.x-1-s,t.y-1-s,t.width+2+n,t.height+2+n),i;let o=t.x,r=t.y,a=t.width,h=t.height;const l=this.shadowBlur,u=this.shadowOffset;return a+=l,h+=l,o-=l/2,r-=l/2,u.x>0?a+=u.x:(o+=u.x,a-=u.x),u.y>0?h+=u.y:(r+=u.y,h-=u.y),i.e(o-1,r-1,a+2,h+2),i}eE(){return this.type===Yt.Link&&this instanceof ge&&"Selection"===this.category&&this.adornedObject instanceof $t&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}xE(){return isNaN(this.ky)&&(this.ky=this.xD()),this.ky}Tf(){this.ky=NaN}Ut(){if(!1===this.as())return void this.UD();this.lo(!1);const t=this.De,e=w.l();e.h(t);const i=this.Ul();this.Pa(0,0,this.hi.width,this.hi.height);const s=this.position;this.VD(s,this.location),t.ce(),t.x=s.x,t.y=s.y,t.k(),this.kd(e,t),e.equals(t)?this.rs(i):this.Di()&&(!k.c(e.width,t.width)||!k.c(e.height,t.height))&&this.VM>=0&&this.invalidateLayout(16),w.i(e),this.cC(!1)}kd(t,e){const i=this.diagram;if(null===i)return;let s=!1;if(!1===i.mh&&t.isReal()){const n=w.l();n.h(i.documentBounds),n.subtractMargin(i.padding),t.x>n.x&&t.y>n.y&&t.right<n.right&&t.bottom<n.bottom&&e.x>n.x&&e.y>n.y&&e.right<n.right&&e.bottom<n.bottom&&(s=!0),w.i(n)}(!0===this.bE()||!t.equals(e))&&this.mT(s,i),i.C(),(t.isReal()||e.isReal())&&!t.equalsApproxClose(e)&&(this instanceof me&&!i.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.Sa())}get location(){return this.sn}set location(t){const e=t.x,i=t.y,s=this.sn;(s.x!==e&&(!isNaN(s.x)||!isNaN(e))||s.y!==i&&(!isNaN(s.y)||!isNaN(i)))&&(t=t.copy(),this.kE(t,s)&&this.t("location",s,t.copy()))}kE(t,e){if(this.Lr())return!1;if(this.sn=t,this.b|=2097152,!1===this.as()){this.hk();const i=this.ct;if(i.isReal()){const s=this.diagram;if(null===s||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing){const n=i.copy();i.e(i.x+(t.x-e.x),i.y+(t.y-e.y)),this.BD(s,i,n.x,n.y),this.t("position",n,i.copy())}}}return!0}vN(t,e,i){if(this.Lr()||!t.isReal())return!1;const s=this.diagram;if(null!==s&&this.BD(s,t,e,i),this.ct=t,this.b&=-2097153,this.sn.isReal()&&(null===s||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing)){const s=this.sn;this.sn=new y(s.x+(t.x-e),s.y+(t.y-i)).k(),this.t("location",s,this.sn.copy())}return!1===this.fa()&&!1===this.as()&&(this.hk(),this.UD()),!0}BD(t,e,i,s){if(null===t||this instanceof ge)return;const n=t.animationManager;n.ke&&n.RA(this,new y(i,s),e,!1)}Ec(t,e,i){const s=this.sn,n=this.ct;if(i){if(s.x===t&&s.y===e)return;this.fa()||this.as()?n.e(NaN,NaN):n.e(n.x+t-s.x,n.y+e-s.y),s.e(t,e)}else{if(n.x===t&&n.y===e)return;s.e(s.x+t-n.x,s.y+e-n.y),n.e(t,e)}this.hk()}FN(){this.b&=-2097153,this.hk()}VD(t,e){const i=this.uD(y.l()),s=this.diagram,n=e.isReal(),o=t.isReal();n&&o?2097152&this.b?this.zD(t,e,s,i):this.XD(t,e,s,i):n?this.zD(t,e,s,i):o&&this.XD(t,e,s,i),this.b|=2097152,y.i(i),this.pf()}zD(t,e,i,s){const n=t.x,o=t.y;if(t.e(e.x-s.x,e.y-s.y),null!==i){const e=i.animationManager,s=e.defaultAnimation.isAnimating;!s&&e.ke&&!(this instanceof ge)&&e.RA(this,new y(n,o),t,!1),!s&&(t.x!==n||t.y!==o)&&this.t("position",new y(n,o),t.copy())}}XD(t,e,i,s){const n=e.copy();e.e(t.x+s.x,t.y+s.y),!e.equals(n)&&null!==i&&this.t("location",n,e.copy())}mT(t,e){this.CN(!1),this instanceof me&&e.fd(this),!this.layer.isTemporary&&!t&&e.invalidateDocumentBounds();const i=this.De,s=e.viewportBounds;s.isReal()?this.Ul()?(i.BL(s,10)||this.rs(!1),this.updateAdornments()):this.isVisible()&&i.intersectsRect(s)?(this.rs(!0),this.updateAdornments()):this.invalidateAdornments():e._c=!0}Qr(){return!0}Di(){return!0}Lr(){return!1}Qs(){return!0}hasPlaceholder(){return!1}get category(){return this.Qo}set category(t){const e=this.Qo;if(e===t)return;null!==this.svg&&(this.svg.remove(),this.Ji(!0));const i=this.diagram,s=this.data;let n=null;if(null!==i&&null!==s&&!(this instanceof ge)){const t=i.model.undoManager;t.isEnabled&&!t.isUndoingRedoing&&(n=this.clone(),n.D.addAll(this.D))}if(this.Qo=t,this.t("category",e,t),null===i||null===s||this instanceof ge){if(this instanceof ge){const t=this.adornedPart;if(null!==t){const i=t._o;null!==i&&i.delete(e),t.addAdornment(this.category,this)}}}else{const o=i.model;if(o.undoManager.isUndoingRedoing)return;if(this.Lr()){i.partManager.setLinkCategoryForData(s,t);const n=i.partManager.findLinkTemplateForCategory(t);if(null!==n){n.It();const i=n.copy();null!==i&&this.fC(i,e,t)}}else{null!==o&&o.setCategoryForNodeData(s,t);const n=i.partManager.findTemplateForNodeData(s,t);if(null!==n){n.It();const i=n.copy();if(null!==i&&!(i instanceof be)){const s=this.location.copy();this.fC(i,e,t),this.location.isReal()||(this.location=s)}}}if(null!==n){const t=this.clone();t.D.addAll(this.D),this.t("self",n,t)}}}get self(){return this}set self(t){this.fC(t,this.category,t.category)}static GD=!1;fC(t,i,s){t.constructor!==this.constructor&&(ce.GD||(ce.GD=!0,e.ne('Should not change the class of the Part when changing category from "'+i+'" to "'+s+'"'),e.ne("  Old class: "+e.Kn(this.constructor)+", new class: "+e.Kn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const n=this.data,o=this.layerName,r=this.isSelected,a=this.isHighlighted;let h=!0,l=!0,u=!1;this instanceof me&&(h=this.isTreeLeaf,l=this.isTreeExpanded,u=this.wasTreeExpanded),t.Ho(this),t.cloneProtected(this),this.Qo=s,null!==this.svg&&(this.svg.remove(),this.jc(),this.Ji(!0)),this.f(),this.C();const c=this.diagram;let d=!0;null!==c&&(d=c.skipsUndoManager,c.skipsUndoManager=!0),this.te=n,this.b=r?4096|this.b:-4097&this.b,this.b=a?524288|this.b:-524289&this.b,this instanceof me&&(this.E=h?4|this.E:-5&this.E,this.E=l?1|this.E:-2&this.E,this.E=u?2|this.E:-3&this.E),null!==n&&this.updateTargetBindings();const g=this.layerName;g!==o&&(this.ul=o,this.layerName=g),null!==c&&(c.skipsUndoManager=d),this.Di()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowCopy)return!1;const e=t.diagram;return null===e||!!e.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowDelete)return!1;const e=t.diagram;return null===e||!!e.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowTextEdit)return!1;const e=t.diagram;return null===e||!!e.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowGroup)return!1;const e=t.diagram;return null===e||!!e.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowMove)return!1;const e=t.diagram;return null===e||!!e.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowReshape)return!1;const e=t.diagram;return null===e||!!e.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowResize)return!1;const e=t.diagram;return null===e||!!e.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowRotate)return!1;const e=t.diagram;return null===e||!!e.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowSelect)return!1;const e=t.diagram;return null===e||!!e.allowSelect}get copyable(){return!!(1&this.b)}set copyable(t){const e=!!(1&this.b);e!==t&&(this.b=1^this.b,this.t("copyable",e,t))}get deletable(){return!!(2&this.b)}set deletable(t){const e=!!(2&this.b);e!==t&&(this.b=2^this.b,this.t("deletable",e,t))}get textEditable(){return!!(4&this.b)}set textEditable(t){const e=!!(4&this.b);e!==t&&(this.b=4^this.b,this.t("textEditable",e,t),this.invalidateAdornments())}get groupable(){return!!(8&this.b)}set groupable(t){const e=!!(8&this.b);e!==t&&(this.b=8^this.b,this.t("groupable",e,t))}get movable(){return!!(16&this.b)}set movable(t){const e=!!(16&this.b);e!==t&&(this.b=16^this.b,this.t("movable",e,t))}get selectionAdorned(){return!!(32&this.b)}set selectionAdorned(t){const e=!!(32&this.b);e!==t&&(this.b=32^this.b,this.t("selectionAdorned",e,t),this.invalidateAdornments())}get isInDocumentBounds(){return!!(64&this.b)}set isInDocumentBounds(t){const e=!!(64&this.b);if(e!==t){this.b=64^this.b;const i=this.diagram;null!==i&&i.invalidateDocumentBounds(),this.t("isInDocumentBounds",e,t)}}get isLayoutPositioned(){return!!(128&this.b)}set isLayoutPositioned(t){const e=!!(128&this.b);e!==t&&(this.b=128^this.b,this.t("isLayoutPositioned",e,t),this.invalidateLayout(t?4:8))}get selectable(){return!!(256&this.b)}set selectable(t){const e=!!(256&this.b);e!==t&&(this.b=256^this.b,this.t("selectable",e,t),this.invalidateAdornments())}get reshapable(){return!!(512&this.b)}set reshapable(t){const e=!!(512&this.b);e!==t&&(this.b=512^this.b,this.t("reshapable",e,t),this.invalidateAdornments())}get resizable(){return!!(1024&this.b)}set resizable(t){const e=!!(1024&this.b);e!==t&&(this.b=1024^this.b,this.t("resizable",e,t),this.invalidateAdornments())}get rotatable(){return!!(2048&this.b)}set rotatable(t){const e=!!(2048&this.b);e!==t&&(this.b=2048^this.b,this.t("rotatable",e,t),this.invalidateAdornments())}get isSelected(){return!!(4096&this.b)}set isSelected(t){const e=!!(4096&this.b);if(e!==t){const i=this.diagram;if(t){if(!this.canSelect())return;if(null!==i){const t=i.maxSelectionCount;if(i.selection.count>=t)return}}this.b=4096^this.b;let s=!1;if(null!==i){s=i.skipsUndoManager,i.skipsUndoManager=!0;const e=i.selection;e.ce(),t?e.add(this):e.delete(this),e.k()}this.t("isSelected",e,t),this.invalidateAdornments();const n=this.selectionChanged;null!==n&&n(this),null!==i&&(i.requestUpdate(),i.skipsUndoManager=s)}}get isHighlighted(){return!!(524288&this.b)}set isHighlighted(t){const e=!!(524288&this.b);if(e!==t){this.b=524288^this.b;const i=this.diagram;if(null!==i){const e=i.highlighteds;e.ce(),t?e.add(this):e.delete(this),e.k()}this.t("isHighlighted",e,t),this.C();const s=this.highlightedChanged;null!==s&&s(this)}}get isShadowed(){return!!(8192&this.b)}set isShadowed(t){const e=!!(8192&this.b);e!==t&&(this.b=8192^this.b,this.Ji(!0),this.t("isShadowed",e,t),this.C())}ID(){return!!(16384&this.b)}ED(t){t?this.b|=16384:this.b&=-16385}fa(){return!!(32768&this.b)}cC(t){t?this.b|=32768:this.b&=-32769}bE(){return!!(65536&this.b)}CN(t){t?this.b|=65536:this.b&=-65537}Ul(){return!!(131072&this.b)}rs(t){t?this.b|=131072:this.b&=-131073}YD(){return!!(1048576&this.b)}ck(t){t?this.b|=1048576:this.b&=-1048577}get isAnimated(){return!!(262144&this.b)}set isAnimated(t){const e=!!(262144&this.b);e!==t&&(this.b=262144^this.b,this.t("isAnimated",e,t))}get highlightedChanged(){return null!==this.H?this.H.Ly:null}set highlightedChanged(t){const i=this.highlightedChanged;i!==t&&(null!==t&&e.S(t,ce,"highlightedChanged"),this._e().Ly=t,this.t("highlightedChanged",i,t))}get selectionObjectName(){return null!==this.H?this.H.Ay:""}set selectionObjectName(t){const e=this.selectionObjectName;e!==t&&(this._e().Ay=t,this.dl=null,this.t("selectionObjectName",e,t))}get selectionAdornmentTemplate(){return null!==this.H?this.H.Ty:null}set selectionAdornmentTemplate(t){const e=this.selectionAdornmentTemplate;e!==t&&(null!==t&&t.It(),this._e().Ty=t,this.t("selectionAdornmentTemplate",e,t))}get selectionObject(){if(null===this.dl){const t=this.selectionObjectName;if(null!==t&&""!==t){const e=this.findObject(t);this.dl=null!==e?e:this}else if(this instanceof be){const t=this.path;this.dl=null!==t?t:this}else this.dl=this}return this.dl}get selectionChanged(){return null!==this.H?this.H.Dy:null}set selectionChanged(t){const i=this.selectionChanged;i!==t&&(null!==t&&e.S(t,ce,"selectionChanged"),this._e().Dy=t,this.t("selectionChanged",i,t))}get resizeAdornmentTemplate(){return null!==this.H?this.H.vy:null}set resizeAdornmentTemplate(t){const e=this.resizeAdornmentTemplate;e!==t&&(this._e().vy=null!==t?t.It():null,this.t("resizeAdornmentTemplate",e,t))}get resizeObjectName(){return null!==this.H?this.H.Fy:""}set resizeObjectName(t){const e=this.resizeObjectName;e!==t&&(this._e().Fy=t,this.t("resizeObjectName",e,t))}get resizeObject(){const t=this.resizeObjectName;if(""!==t){const e=this.findObject(t);if(null!==e)return e}return this}get resizeCellSize(){return null!==this.H?this.H.Ry:x.Zw}set resizeCellSize(t){const e=this.resizeCellSize;e.equals(t)||(t=t.N(),this._e().Ry=t,this.t("resizeCellSize",e,t))}get rotateAdornmentTemplate(){return null!==this.H?this.H.Oy:null}set rotateAdornmentTemplate(t){const e=this.rotateAdornmentTemplate;e!==t&&(this._e().Oy=null!==t?t.It():null,this.t("rotateAdornmentTemplate",e,t))}get rotateObjectName(){return null!==this.H?this.H.Iy:""}set rotateObjectName(t){const e=this.rotateObjectName;e!==t&&(this._e().Iy=t,this.t("rotateObjectName",e,t))}get rotateObject(){const t=this.rotateObjectName;if(""!==t){const e=this.findObject(t);if(null!==e)return e}return this}get rotationSpot(){return null!==this.H?this.H.Ey:v.Default}set rotationSpot(t){const e=this.rotationSpot;e.equals(t)||(t=t.N(),this._e().Ey=t,this.t("rotationSpot",e,t))}get text(){return this.ue}set text(t){const e=this.ue;e!==t&&(this.ue=t,this.t("text",e,t))}get containingGroup(){return this.Da}set containingGroup(t){if(this.Di()){const i=this.Da;if(i!==t){null!==t&&(this===t||t.isMemberOf(this))&&(this===t&&e.o("Cannot make a Group a member of itself: "+this.toString()),e.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const s=this.diagram;if(null!==i?i.uC(this):this instanceof Ne&&null!==s&&s.$r.delete(this),this.Da=t,null!==t?t.dC(this):this instanceof Ne&&null!==s&&s.$r.add(this),this.invalidateLayout(1),null!==s&&s.G){const e=this.data,i=s.model;if(null!==e&&i.ff()){const s=null!==t?t.data:null;i.setGroupForData(e,i.getKeyForNodeData(s))}}const n=this.containingGroupChanged;if(null!==n){let e=!0;null!==s&&(e=s.G,s.G=!0),n(this,i,t),null!==s&&(s.G=e)}if(this instanceof Ne){const t=new u;ce.ga(t,this,!0,0,!0);const e=t.iterator;for(;e.next();){const t=e.value;if(t instanceof me){const e=t.linksConnected;for(;e.next();)e.value.Wd()}}}if(this instanceof me){const t=this.linksConnected;for(;t.next();)t.value.Wd();const e=this.labeledLink;null!==e&&e.Wd()}this.t("containingGroup",i,t),null!==t&&t.wE()}}else e.o("cannot set the Part.containingGroup of a Link or Adornment")}Sa(){const t=this.containingGroup;null!==t&&(t.hasPlaceholder()&&t.placeholder.f(),t.f(),t.invalidateConnectedLinks())}C(){const t=this.diagram;null!==t&&!this.as()&&!this.fa()&&this.isVisible()&&this.De.isReal()&&t.C(this.hh(this.De))}f(){if(this.Xo())return;super.f();const t=this.diagram;null!==t&&(t.Cp(this),this instanceof me&&null!==this.labeledLink&&this.labeledLink.kf(),t.requestUpdate(!0))}kf(t){if(this.as())return;const e=this.diagram;null!==e&&(e.Cp(this),this instanceof me&&this.invalidateConnectedLinks(),e.requestUpdate()),this.lo(!0)}tp(t){if(!t){const t=this.Da;null!==t&&t.dC(this)}}ep(t){if(!t){const t=this.Da;null!==t&&t.uC(this)}}rf(){const t=this.data;if(null!==t){const e=this.diagram;if(null!==e){const i=e.model;null!==i&&i.removeNodeData(t)}}}get containingGroupChanged(){return null!==this.H?this.H.Uy:null}set containingGroupChanged(t){const i=this.containingGroupChanged;i!==t&&(null!==t&&e.S(t,ce,"containingGroupChanged"),this._e().Uy=t,this.t("containingGroupChanged",i,t))}findSubGraphLevel(){return this.gC(this)}gC(t){const e=t.containingGroup;if(null!==e)return 1+this.gC(e);if(t instanceof me){const e=t.labeledLink;if(null!==e)return this.gC(e)}return 0}findTopLevelPart(){return this.mC(this)}mC(t){const e=t.containingGroup;if(null!==e)return this.mC(e);if(t instanceof me){const e=t.labeledLink;if(null!==e)return this.mC(e)}return t}get isTopLevel(){return!(null!==this.containingGroup||this instanceof me&&null!==this.labeledLink)}isMemberOf(t){return t instanceof Ne&&this.pC(this,t)}pC(t,e){if(t===e||null===e)return!1;const i=t.containingGroup;if(null!==i&&(i===e||this.pC(i,e)))return!0;if(t instanceof me){const i=t.labeledLink;if(null!==i)return this.pC(i,e)}return!1}findCommonContainingGroup(t){if(null===t)return null;if(this===t)return this.containingGroup;let e=this;for(;null!==e;){if(e instanceof Ne&&e.ck(!0),e instanceof me){const t=e.labeledLink;null!==t&&(e=t)}e=e.containingGroup}let i=null;for(e=t;null!==e;){if(e.YD()){i=e;break}if(e instanceof me){const t=e.labeledLink;null!==t&&(e=t)}e=e.containingGroup}for(e=this;null!==e;){if(e instanceof Ne&&e.ck(!1),e instanceof me){const t=e.labeledLink;null!==t&&(e=t)}e=e.containingGroup}return i}get layoutConditions(){return null!==this.H?this.H.Vy:127}set layoutConditions(t){const e=this.layoutConditions;e!==t&&(this._e().Vy=t,this.t("layoutConditions",e,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(null!==t&&t.isTemporary||this instanceof me&&this.isLinkLabel)}PE(t){if(!(this.isLayoutPositioned&&t&this.layoutConditions))return!1;const e=this.layer;if(null!==e&&e.isTemporary||this instanceof me&&this.isLinkLabel)return!1;const i=this.diagram;return!(null!==i&&i.undoManager.isUndoingRedoing)}invalidateLayout(t){if(void 0===t&&(t=16777215),!this.PE(t))return;const e=this.Da;if(null!==e){const i=e.layout;null!==i?i.p():e.invalidateLayout(t)}else{const t=this.diagram;if(null!==t){const e=t.layout;null!==e&&e.p()}}}pT(){if(!this.isVisible())return!1;const t=this.layer;return!(null!==t&&t.isTemporary)}static ga(t,e,i,s,n,o){if(void 0===o&&(o=null),!t.has(e)&&(null===o||o(e))&&!(e instanceof ge))if(t.add(e),e instanceof me){if(i&&e instanceof Ne){const r=e.memberParts;for(;r.next();){const e=r.value;ce.ga(t,e,i,s,n,o)}}if(!1!==n){const r=e.linksConnected;for(;r.next();){const e=r.value;if(t.has(e))continue;const a=e.fromNode,h=e.toNode,l=null===a||t.has(a),u=null===h||t.has(h);(n?l&&u:l||u)&&ce.ga(t,e,i,s,n,o)}}if(s>1){const r=e.findTreeChildrenNodes();for(;r.next();){const e=r.value;ce.ga(t,e,i,s-1,n,o)}}}else if(e instanceof be){const r=e.labelNodes;for(;r.next();){const e=r.value;ce.ga(t,e,i,s,n,o)}}}get dragComputation(){return null!==this.H?this.H.By:null}set dragComputation(t){const i=this.dragComputation;i!==t&&(null!==t&&e.S(t,ce,"dragComputation"),this._e().By=t,this.t("dragComputation",i,t))}get shadowOffset(){return null!==this.H?this.H.zy:y.OL}set shadowOffset(t){const e=this.shadowOffset;e.equals(t)||(t=t.N(),this._e().zy=t,this.C(),this.t("shadowOffset",e,t))}get shadowColor(){return null!==this.H?this.H.Xy:"gray"}set shadowColor(t){const e=this.shadowColor;e!==t&&(this._e().Xy=t,this.C(),this.t("shadowColor",e,t))}get shadowBlur(){return null!==this.H?this.H.Ln:4}set shadowBlur(t){const e=this.shadowBlur;e!==t&&(this._e().Ln=t,this.C(),this.t("shadowBlur",e,t))}}class de{me;Py;Uy;Ty;Ay;Dy;Ly;vy;Fy;Ry;Oy;Iy;Ey;Ny;Cy;Sy;My;By;Vy;zy;Xy;Ln;constructor(){this.me=!1,this.Py=null,this.Uy=null,this.Ty=null,this.Ay="",this.Dy=null,this.Ly=null,this.vy=null,this.Fy="",this.Ry=x.Zw,this.Oy=null,this.Iy="",this.Ey=v.Default,this.Ny="",this.Cy=v.TopLeft,this.Sy=y.FL,this.My=y.RL,this.By=null,this.Vy=127,this.zy=y.OL,this.Xy="gray",this.Ln=4}copy(){const t=new de;return t.Py=this.Py,t.Uy=this.Uy,t.Ty=this.Ty,t.Ay=this.Ay,t.Dy=this.Dy,t.Ly=this.Ly,t.vy=this.vy,t.Fy=this.Fy,t.Ry=this.Ry.N(),t.Oy=this.Oy,t.Iy=this.Iy,t.Ey=this.Ey.N(),t.Ny=this.Ny,t.Cy=this.Cy.N(),t.Sy=this.Sy.N(),t.My=this.My.N(),t.By=this.By,t.Vy=this.Vy,t.zy=this.zy.N(),t.Xy=this.Xy,t.Ln=this.Ln,t}}class ge extends ce{Ms;Dt;WS;JS;Lf;constructor(t,e){let i;void 0===t||t instanceof jt||"string"==typeof t?i=t:t&&(e=t),super(i),this.b&=-257,this.ul="Adornment",this.Ms=null,this.WS=0,this.JS=!1,this.Dt=null,this.Lf=null,e&&Object.assign(this,e)}toString(){const t=this.adornedPart;return"Adornment("+this.category+")"+(null!==t?t.toString():"")}updateRelationshipsFromData(){}Td(t){const e=this.adornedObject;if(!(e instanceof $t))return;const i=e.part;if(!(i instanceof be))return;const s=i.path;let n=s.geometry;i.Td(t),n=s.geometry;const o=this.D.r,r=o.length;for(let t=0;t<r;t++){const e=o[t];e.isPanelMain&&e instanceof $t&&(e.ut=n)}}hasPlaceholder(){return null!==this.Dt&&this.Dt.isVisibleObject()}get placeholder(){return this.Dt}get adornedObject(){return this.Ms}set adornedObject(t){const e=this.adornedPart;let i=null;null!==t&&(i=t.part),null!==e&&(null===t||e!==i)&&e.removeAdornment(this.category),this.Ms=t,null!==i&&i.addAdornment(this.category,this)}get adornedPart(){const t=this.Ms;return null!==t?t.part:null}Qr(){const t=this.Ms;if(null===t)return!0;const e=t.part;return null===e||!e.as()}Di(){return!1}get containingGroup(){return null}df(t,e,i,s,n,o,r){if(3===t&&"elements"===e){if(n instanceof Te)null===this.Dt&&(this.Dt=n);else if(n instanceof Yt){const t=n.findInVisualTree((t=>t instanceof Te));t instanceof Te&&null===this.Dt&&(this.Dt=t)}}else 4===t&&"elements"===e&&null!==this.Dt&&(s===this.Dt||s instanceof Yt&&this.Dt.isContainedBy(s))&&(this.Dt=null);super.df(t,e,i,s,n,o,r)}updateAdornments(){}rf(){}}var fe=(t=>(t[t.None=0]="None",t[t.Evenly=1]="Evenly",t[t.Packed=2]="Packed",t))(fe||{});class me extends ce{E;vt;zf;pl;va;ci;ee;constructor(t,e){let i;void 0===t||t instanceof jt||"string"==typeof t?i=t:t&&(e=t),super(i),this.E=13,this.vt=null,this.ee=new h,this.zf=null,this.pl=null,this.ci=null,this.va=!1,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.E=this.E,null!==this.vt&&(this.vt.me?t.vt=this.vt:t.vt=this.vt.copy())}Ho(t){super.Ho(t),t.invalidateConnectedLinks(),t.pl=this.pl,t.ci=null}static SpreadingNone=0;static SpreadingEvenly=1;static SpreadingPacked=2;yl(){return null===this.vt?this.vt=new pe:this.vt.me&&(this.vt=this.vt.copy()),this.vt}ba(){super.ba(),null!==this.vt&&(this.vt.me=!0)}KD(t){null!==t&&(null===this.pl&&(this.pl=new u),this.pl.add(t))}HD(t){null!==t&&null!==this.pl&&this.pl.delete(t)}qD(t,e,i){if(null===t||null===this.pl)return null;const s=this.pl.iterator;for(;s.next();){const n=s.value;if(n.Gy===this&&n.fk===t&&n.yC===e&&n.wC===i||n.Gy===t&&n.fk===this&&n.yC===i&&n.wC===e)return n}return null}invalidateLinkBundle(t,e,i){null==e&&(e=""),null==i&&(i="");const s=this.qD(t,e,i);null!==s&&s.Jd()}df(t,e,i,s,n,o,r){(3===t&&"elements"===e||4===t&&"elements"===e)&&(this.ci=null),super.df(t,e,i,s,n,o,r)}invalidateConnectedLinks(t,e){const i=this.linksConnected;for(;i.next();){const s=i.value;t&&t.has(s)||e&&s.fromPort!==e&&s.toPort!==e||(this.Ze(s.fromPort),this.Ze(s.toPort),s.$t())}}Ze(t){if(null===t)return;const e=t.yd;null!==e&&e.Jd();const i=t.part,s=i.containingGroup;null!==s&&!i.isVisible()&&s.Ze(s.port)}Qr(){return!0}get portSpreading(){return null!==this.vt?this.vt.Yy:1}set portSpreading(t){const e=this.portSpreading;if(e!==t){this.yl().Yy=t,this.t("portSpreading",e,t);const i=this.diagram;if(null!==i&&i.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return!!(8&this.E)}set avoidable(t){const e=!!(8&this.E);if(e!==t){this.E=8^this.E;const i=this.diagram;null!==i&&i.fd(this),this.t("avoidable",e,t)}}get avoidableMargin(){return null!==this.vt?this.vt.Ky:b.XL}set avoidableMargin(t){"number"==typeof t&&(t=new b(t));const e=this.avoidableMargin;if(!e.equals(t)){t=t.N(),this.yl().Ky=t;const i=this.diagram;null!==i&&i.fd(this),this.t("avoidableMargin",e,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;null!==t&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,e=1;const i=this.diagram;if(null!==i){if(i.animationManager.Wx(this))return!0;t=i.isTreePathToChildren,e=i.treeCollapsePolicy}if(1===e){const t=this.findTreeParentNode();if(null!==t&&!t.isTreeExpanded)return!1}else if(2===e){const e=t?this.findLinksInto():this.findLinksOutOf();let i=!1,s=!1;for(;e.next();){const n=e.value;if(n.isTreeLink){i=!0;const e=t?n.fromNode:n.toNode;if(e&&e.isTreeExpanded){s=!0;break}}}if(i&&!s)return!1}else if(3===e){const e=t?this.findLinksInto():this.findLinksOutOf();let i=!1,s=!1;for(;e.next();){const n=e.value;if(n.isTreeLink){i=!0;const e=t?n.fromNode:n.toNode;if(e&&!e.isTreeExpanded){s=!0;break}}}if(i&&s)return!1}const s=this.labeledLink;return null===s||s.isVisible()}Xe(t){super.Xe(t);const e=this.linksConnected;for(;e.next();){const i=e.value;if(t&&null!==this.containingGroup){const t=i.getOtherNode(this);null!==t&&!t.isMemberOf(this.containingGroup)&&i.$t()}i.Xe(t)}}get linksConnected(){return this.ee.iterator}findExternalTreeLinksConnected(){const t=new u,e=new u;return this.jD(this,t,e),e.iterator}jD(t,e,i){if(null===t||e.has(t))return;e.add(t);let s=!0;const n=this.diagram;null!==n&&(s=n.isTreePathToChildren),t.linksConnected.each((n=>{n.isTreeLink?(s?n.fromNode===t:n.toNode===t)&&this.jD(s?n.toNode:n.fromNode,e,i):i.add(n)}))}findLinksConnected(t){if(void 0===t&&(t=null),null===t)return this.ee.iterator;const e=new r(this.ee),i=this;return e.predicate=e=>e.fromNode===i&&e.fromPortId===t||e.toNode===i&&e.toPortId===t,e}findLinksOutOf(t){void 0===t&&(t=null);const e=new r(this.ee),i=this;return e.predicate=e=>e.fromNode===i&&(null===t||e.fromPortId===t),e}findLinksInto(t){void 0===t&&(t=null);const e=new r(this.ee),i=this;return e.predicate=e=>e.toNode===i&&(null===t||e.toPortId===t),e}findNodesConnected(t){void 0===t&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.fromNode===this){if(null===t||n.fromPortId===t){const t=n.toNode;null!==e?e.add(t):null!==i&&i!==t?(e=new u,e.add(i),e.add(t)):i=t}}else if(n.toNode===this&&(null===t||n.toPortId===t)){const t=n.fromNode;null!==e?e.add(t):null!==i&&i!==t?(e=new u,e.add(i),e.add(t)):i=t}}return null!==e?e.iterator:null!==i?new o(i):n.instance}findNodesOutOf(t){void 0===t&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.fromNode===this&&(null===t||n.fromPortId===t)){const t=n.toNode;null!==e?e.add(t):null!==i&&i!==t?(e=new u,e.add(i),e.add(t)):i=t}}return null!==e?e.iterator:null!==i?new o(i):n.instance}findNodesInto(t){void 0===t&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.toNode===this&&(null===t||n.toPortId===t)){const t=n.fromNode;null!==e?e.add(t):null!==i&&i!==t?(e=new u,e.add(i),e.add(t)):i=t}}return null!==e?e.iterator:null!==i?new o(i):n.instance}findLinksBetween(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);const s=new r(this.ee),n=this;return s.predicate=s=>!((s.fromNode!==n||s.toNode!==t||null!==e&&s.fromPortId!==e||null!==i&&s.toPortId!==i)&&(s.fromNode!==t||s.toNode!==n||null!==i&&s.fromPortId!==i||null!==e&&s.toPortId!==e)),s}findLinksTo(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);const s=new r(this.ee),n=this;return s.predicate=s=>!(s.fromNode!==n||s.toNode!==t||null!==e&&s.fromPortId!==e||null!==i&&s.toPortId!==i),s}findSuccessorParts(t){return void 0===t&&(t=new u),this.WD(this,t),t.remove(this),t}WD(t,e){null!==t&&(e.has(t)||(e.add(t),t.findLinksOutOf().each((t=>{if(e.has(t))return;e.add(t);const i=t.toNode;null!==i&&this.WD(i,e)}))))}findPredecessorParts(t){return void 0===t&&(t=new u),this.JD(this,t),t.remove(this),t}JD(t,e){null!==t&&(e.has(t)||(e.add(t),t.findLinksInto().each((t=>{if(e.has(t))return;e.add(t);const i=t.fromNode;null!==i&&this.JD(i,e)}))))}get linkConnected(){return null!==this.vt?this.vt.Hy:null}set linkConnected(t){const i=this.linkConnected;i!==t&&(null!==t&&e.S(t,me,"linkConnected"),this.yl().Hy=t,this.t("linkConnected",i,t))}get linkDisconnected(){return null!==this.vt?this.vt.qy:null}set linkDisconnected(t){const i=this.linkDisconnected;i!==t&&(null!==t&&e.S(t,me,"linkDisconnected"),this.yl().qy=t,this.t("linkDisconnected",i,t))}get linkValidation(){return null!==this.vt?this.vt.El:null}set linkValidation(t){const i=this.linkValidation;i!==t&&(null!==t&&e.S(t,me,"linkValidation"),this.yl().El=t,this.t("linkValidation",i,t))}uk(t,e){this.Ze(e);const i=this.ee.has(t);if(i||this.ee.add(t),!i||t.fromNode===t.toNode){const i=this.linkConnected;if(null!==i){let s=!0;const n=this.diagram;null!==n&&(s=n.G,n.G=!0),i(this,t,e),null!==n&&(n.G=s)}}if(!i){if(!t.isTreeLink)return;const e=t.fromNode,i=t.toNode;if(null!==e&&null!==i&&e!==i){let t=!0;const s=this.diagram;null!==s&&(t=s.isTreePathToChildren);const n=t?i:e,o=t?e:i;if(n.va||(n.va=o),o.isTreeLeaf){if(null!==s&&s.undoManager.isUndoingRedoing)return;t?e===o&&(o.isTreeLeaf=!1):i===o&&(o.isTreeLeaf=!1)}}}}dk(t,e){this.Ze(e);const i=this.ee.delete(t);let s=null;if(i||t.toNode===t.fromNode){const i=this.linkDisconnected;if(s=this.diagram,null!==i){let n=!0;null!==s&&(n=s.G,s.G=!0),i(this,t,e),null!==s&&(s.G=n)}}if(i){if(!t.isTreeLink)return;let e=!0;null!==s&&(e=s.isTreePathToChildren);const i=e?t.toNode:t.fromNode,n=e?t.fromNode:t.toNode;if(null!==i&&(i.va=!1),null!==n&&!n.isTreeLeaf)if(0===n.ee.count){if(n.va=null,null!==s&&s.undoManager.isUndoingRedoing)return;n.isTreeLeaf=!0}else n.vp()}}vp(){if(this.va=!1,0===this.ee.count)return;let t=!0;const e=this.diagram;if(null!==e&&e.undoManager.isUndoingRedoing)return;null!==e&&(t=e.isTreePathToChildren);const i=this.ee.iterator;for(;i.next();){const e=i.value;if(e.isTreeLink)if(t){if(e.fromNode===this)return void(this.isTreeLeaf=!1)}else if(e.toNode===this)return void(this.isTreeLeaf=!1)}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;null!==t&&t.partManager.updateRelationshipsFromData(this)}tp(t){if(super.tp(t),!t){this.vp();const t=this.zf;null!==t&&t.$D(this)}}ep(t){if(super.ep(t),!t){const t=this.zf;null!==t&&t.ZD(this)}}rf(){if(this.ee.count>0){const t=this.diagram;if(null!==t){const e=null===t.commandHandler||t.commandHandler.deletesConnectedLinks,i=this.ee.copy().iterator;for(;i.next();){const s=i.value;e?t.remove(s):(s.fromNode===this&&(s.fromNode=null),s.toNode===this&&(s.toNode=null))}}}this.labeledLink=null,super.rf()}get isLinkLabel(){return null!==this.zf}get labeledLink(){return this.zf}set labeledLink(t){const e=this.zf;if(e!==t){const i=this.diagram,s=this.data;if(null!==e){if(e.ZD(this),null!==i&&null!==s&&!i.undoManager.isUndoingRedoing){const t=e.data,n=i.model;if(null!==t&&n.jh()){const e=n.getKeyForNodeData(s);void 0!==e&&n.removeLabelKeyForLinkData(t,e)}}this.containingGroup=null}if(this.zf=t,null!==t){if(t.$D(this),null!==i&&null!==s&&!i.undoManager.isUndoingRedoing){const e=t.data,n=i.model;if(null!==e&&n.jh()){const t=n.getKeyForNodeData(s);void 0!==t&&n.addLabelKeyForLinkData(e,t)}}this.containingGroup=t.containingGroup}this.kf(),this.t("labeledLink",e,t)}}findVisiblePort(t){let e=t;for(;!(null===e||e.actualBounds.isReal()&&e.isVisibleObject());)e=e.panel;return null===e?this.port:e}findPort(t){if(null===this.ci){if(""===t&&!1===this.Cn)return this;this.QD()}let e=this.ci.get(t);return null!==e||""!==t&&(e=this.ci.get(""),null!==e)?e:this}get port(){return this.findPort("")}get ports(){return null===this.ci&&this.QD(),this.ci.iteratorValues}QD(){null===this.ci?this.ci=new p:this.ci.clear(),this.walkVisualTreeFrom(this,((t,e)=>t.oD(e))),0===this.ci.count&&this.ci.set("",this)}oD(t){const e=t.portId;null!==e&&null!==this.ci&&this.ci.set(e,t)}RN(t,i){const s=t.portId;if(null!==s){null!==this.ci&&this.ci.delete(s);const t=this.diagram;if(null!==t&&i){let i=null;const n=this.findLinksConnected(s);for(;n.next();){const t=n.value;null===i&&(i=e.nt()),i.push(t)}if(null!==i){for(let e=0;e<i.length;e++){const s=i[e];t.remove(s)}e.Z(i)}}}}isInTreeOf(t){if(null===t||t===this)return!1;let e=!0;const i=this.diagram;null!==i&&(e=i.isTreePathToChildren);let s=this;const n=t;let o;if(e)for(;s!==n;){o=null;const t=s.ee.iterator;for(;t.next();){const e=t.value;if(e.isTreeLink&&(o=e.fromNode,o!==s&&o!==this))break}if(o===this||null===o||o===s)return!1;s=o}else for(;s!==n;){o=null;const t=s.ee.iterator;for(;t.next();){const e=t.value;if(e.isTreeLink&&(o=e.toNode,o!==s&&o!==this))break}if(o===this||null===o||o===s)return!1;s=o}return!0}findTreeRoot(){let t=!0;const e=this.diagram;null!==e&&(t=e.isTreePathToChildren);let i,s=this;if(t)for(;;){i=null;const t=s.ee.iterator;for(;t.next();){const e=t.value;if(e.isTreeLink&&(i=e.fromNode,i!==s&&i!==this))break}if(i===this)return this;if(null===i||i===s)return s;s=i}else for(;;){i=null;const t=s.ee.iterator;for(;t.next();){const e=t.value;if(e.isTreeLink&&(i=e.toNode,i!==s&&i!==this))break}if(i===this)return this;if(null===i||i===s)return s;s=i}}findCommonTreeParent(t){if(null===t)return null;if(this===t)return this;let e=this;for(;null!==e;)e.ck(!0),e=e.findTreeParentNode();let i=null;for(e=t;null!==e;){if(e.YD()){i=e;break}e=e.findTreeParentNode()}for(e=this;null!==e;)e.ck(!1),e=e.findTreeParentNode();return i}findTreeParentLink(){let t=!0;const e=this.diagram;null!==e&&(t=e.isTreePathToChildren);const i=this.ee.iterator;if(t)for(;i.next();){const t=i.value;if(t.isTreeLink&&t.fromNode!==this)return t}else for(;i.next();){const t=i.value;if(t.isTreeLink&&t.toNode!==this)return t}return null}findTreeParentNode(){const t=this.va;if(null===t)return null;if(t instanceof me)return t;const e=this.diagram,i=null===e||e.isTreePathToChildren,s=this.ee.iterator;for(;s.next();){const t=s.value;if(!t.isTreeLink)continue;const e=i?t.fromNode:t.toNode;if(e!==this)return this.va=e,e}return this.va=null,null}findTreeParentChain(t){return void 0===t&&(t=new u),function t(e,i){i.add(e);const s=e.findTreeParentLink();if(null!==s){i.add(s);const n=e.findTreeParentNode();if(null===n)return;t(n,i)}}(this,t),t}findTreeLevel(){return this.SE(this)}SE(t){let e=0,i=t.findTreeParentNode();for(;null!==i&&i!==t;)i=i.findTreeParentNode(),e++;return e}findTreeChildrenLinks(){let t=!0;const e=this.diagram;null!==e&&(t=e.isTreePathToChildren);const i=new r(this.ee),s=this;return i.predicate=t?t=>!(!t.isTreeLink||t.fromNode!==s):t=>!(!t.isTreeLink||t.toNode!==s),i}findTreeChildrenNodes(){let t=!0;const e=this.diagram;null!==e&&(t=e.isTreePathToChildren);let i=null,s=null;const r=this.ee.iterator;if(t)for(;r.next();){const t=r.value;if(t.isTreeLink&&t.fromNode===this){const e=t.toNode;null!==i?i.add(e):null!==s&&s!==e?(i=new h,i.add(s),i.add(e)):s=e}}else for(;r.next();){const t=r.value;if(t.isTreeLink&&t.toNode===this){const e=t.fromNode;null!==i?i.add(e):null!==s&&s!==e?(i=new h,i.add(s),i.add(e)):s=e}}return null!==i?i.iterator:null!==s?new o(s):n.instance}findTreeParts(t,i){return void 0===t&&(t=1/0),e.s(t,"number",me,"findTreeParts:level"),void 0===i&&(i=new u),ce.ga(i,this,!1,t,!0),i}collapseTree(t){void 0===t&&(t=1),t<1&&(t=1);const e=this.diagram;if(null===e||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;const i=new u;i.add(this),this._D(i,e.isTreePathToChildren,t,e,this,1===e.treeCollapsePolicy),e.isCollapsingExpanding=!1}_D(t,e,i,s,n,o){if(i>1){const r=e?this.findLinksOutOf():this.findLinksInto();for(;r.next();){const a=r.value;if(!a.isTreeLink)continue;const h=a.getOtherNode(this);null!==h&&h!==this&&!t.has(h)&&(t.add(h),h._D(t,e,i-1,s,n,o))}}else this.tv(t,e,s,n,o)}tv(t,e,i,s,n){const o=s===this||this.isTreeExpanded,r=e?this.findLinksOutOf():this.findLinksInto();for(;r.next();){const a=r.value;if(!a.isTreeLink)continue;const h=a.getOtherNode(this);if(null!==h&&h!==this){const r=t.has(h);if(r||t.add(h),o){const t=e?h.findNodesInto():h.findNodesOutOf(),n=this;t.all((t=>t===n||!t.isTreeExpanded))&&i.Yc(h,s),h.Sa(),h.Xe(!1)}h.isTreeExpanded&&(h.wasTreeExpanded=h.isTreeExpanded,r||h.tv(t,e,i,s,n))}}this.isTreeExpanded=!1}expandTree(t){void 0===t&&(t=2),t<2&&(t=2);const e=this.diagram;if(null===e||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;const i=new u;i.add(this),this.ev(i,e.isTreePathToChildren,t,e,this,1===e.treeCollapsePolicy),e.isCollapsingExpanding=!1}ev(t,e,i,s,n,o){const r=n!==this&&this.isTreeExpanded,a=e?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const h=a.value;if(!h.isTreeLink)continue;r||h.Fi||h.$t();const l=h.getOtherNode(this);if(null!==l&&l!==this&&!t.has(l)){if(t.add(l),!r){l.Xe(!0),l.Sa();const t=e?l.findNodesInto():l.findNodesOutOf(),i=this;t.all((t=>t===i||!t.isTreeExpanded))&&s.Gc(l,n)}(i>2||l.wasTreeExpanded)&&(l.wasTreeExpanded=!1,l.ev(t,e,i-1,s,n,o))}}this.isTreeExpanded=!0}get isTreeExpanded(){return!!(1&this.E)}set isTreeExpanded(t){const e=!!(1&this.E);if(e!==t){this.E=1^this.E;const i=this.diagram;this.t("isTreeExpanded",e,t);const s=this.treeExpandedChanged;if(null!==s){let t=!0;null!==i&&(t=i.G,i.G=!0),s(this),null!==i&&(i.G=t)}if(null!==i&&i.undoManager.isUndoingRedoing)return void this.Xe(t);t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return!!(2&this.E)}set wasTreeExpanded(t){const e=!!(2&this.E);e!==t&&(this.E=2^this.E,this.t("wasTreeExpanded",e,t))}get treeExpandedChanged(){return null!==this.vt?this.vt.jy:null}set treeExpandedChanged(t){const i=this.treeExpandedChanged;i!==t&&(null!==t&&e.S(t,me,"treeExpandedChanged"),this.yl().jy=t,this.t("treeExpandedChanged",i,t))}get isTreeLeaf(){return!!(4&this.E)}set isTreeLeaf(t){const e=!!(4&this.E);e!==t&&(this.E=4^this.E,this.t("isTreeLeaf",e,t))}get isTreeRoot(){return null===this.findTreeParentLink()}}class pe{me;Hy;qy;El;jy;Ky;Yy;Wy;Jy;da;$y;constructor(){this.me=!1,this.Hy=null,this.qy=null,this.El=null,this.jy=null,this.Ky=b.XL,this.Yy=1,this.Wy=null,this.Jy=null,this.da=null,this.$y=null}copy(){const t=new pe;return t.Hy=this.Hy,t.qy=this.qy,t.El=this.El,t.jy=this.jy,t.Ky=this.Ky.N(),t.Yy=this.Yy,t.Wy=this.Wy,t.Jy=this.Jy,t.da=this.da,t.$y=this.$y,t}}var ye=(t=>(t[t.None=0]="None",t[t.End=17]="End",t[t.Scale=18]="Scale",t[t.Stretch=19]="Stretch",t))(ye||{}),xe=(t=>(t[t.Normal=1]="Normal",t[t.Orthogonal=2]="Orthogonal",t[t.AvoidsNodes=6]="AvoidsNodes",t[t.AvoidsNodesStraight=7]="AvoidsNodesStraight",t))(xe||{}),we=(t=>(t[t.None=0]="None",t[t.Bezier=9]="Bezier",t[t.JumpGap=10]="JumpGap",t[t.JumpOver=11]="JumpOver",t))(we||{});class be extends ce{Mt;mo;po;$d;yo;wo;Zd;Xf;Qd;_d;tg;Wh;eg;nn;Me;wl;Dr;xl;er;xC;bC;gk;kC;PC;Jh;mk;ut;ir;static $h=null;static Zh=null;Lf;SC;MC;constructor(t){super(Yt.Link),this.Mt=8,this.mo=null,this.po="",this.$d=null,this.yo=null,this.wo="",this.Zd=null,this.Xf=0,this.Qd=0,this._d=0,this.tg=NaN,this.Wh=1,this.eg=.5,this.nn=null,this.Me=(new h).k(),this.wl=null,this.Dr=null,this.xl=new w,this.ut=new N,this.er=null,this.ir=null,this.xC=y.gn,this.bC=y.gn,this.SC=0,this.MC=0,this.gk=new y,this.kC=null,this.PC=null,this.Jh=null,this.mk=NaN,this.ft=null,this.Lf=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Mt=-113&this.Mt,t.po=this.po,t.$d=this.$d,t.wo=this.wo,t.Zd=this.Zd,t.Xf=this.Xf,t.Qd=this.Qd,t._d=this._d,t.tg=this.tg,t.Wh=this.Wh,t.eg=this.eg,null!==this.ft&&(t.ft=this.ft.copy())}Ho(t){super.Ho(t),this.po=t.po,this.wo=t.wo,t.wl=null,t.$t(),t.ir=this.ir;const e=t.fromPort;null!==e&&t.fromNode.Ze(e);const i=t.toPort;null!==i&&t.toNode.Ze(i)}fe(t){t in xe||t in we||t in ye?be.NC(t)?this.routing=t:9===t||10===t||11===t?this.curve=t:17===t||18===t||19===t?this.adjusting=t:1===t||0===t||e.o("Unknown Link enum value for a Link property: "+t):super.fe(t)}static Normal=1;static Orthogonal=2;static AvoidsNodes=6;static AvoidsNodesStraight=7;static None=0;static Bezier=9;static JumpGap=10;static JumpOver=11;static End=17;static Scale=18;static Stretch=19;static OrientAlong=21;static OrientPlus90=22;static OrientMinus90=23;static OrientOpposite=24;static OrientUpright=25;static OrientPlus90Upright=26;static OrientMinus90Upright=27;static OrientUpright45=28;static iv=8;static sv=16;static Fa=8;static J1=3;static nv=3;static ov=1.333;static CC=1;static LC=0;static rv=10;static Gf=9999;static lv=30;static av=30;static AC=10;static hv=10;static cv=14;static fv=30;static uv=14;static eT=8;static iT=8;static dv=11;static setRoutingParameter(t,e){switch(t){case 1:be.iv=e;break;case 2:be.sv=e;break;case 3:be.Fa=e;break;case 4:be.J1=e;break;case 5:be.nv=e;break;case 6:be.ov=e;break;case 7:be.CC=e;break;case 8:be.LC=e;break;case 9:be.rv=e;break;case 10:be.Gf=e;break;case 11:be.lv=e;break;case 12:be.av=e;break;case 13:be.AC=e;break;case 14:be.hv=e;break;case 15:be.cv=e;break;case 16:be.fv=e;break;case 17:be.uv=e;break;case 18:be.eT=e;break;case 19:be.iT=e;break;case 20:be.dv=e}t>29&&t<71&&(be.UT=t+parseInt(e.toString().slice(0,-1)))}static UT;Wi(){return null===this.ft&&(this.ft=new Me),this.ft}EI(t,i,s){const n=t.segmentIndex,o=t.segmentFraction;let r=t.alignmentFocus;const a=t.segmentOrientation,h=t.segmentOffset;let l=0,u=0,c=0,d=0;if(isNaN(n)){const i=this.ut,s=e.nt();i.getPointAndAngleAlongPath(o,s);const n=y.z(s[0],s[1]);if(d=s[2],n.add(this.getPoint(0)),1===i.type)n.offset(-i.startX,-i.startY);else{const t=i.figures.first();n.offset(-t.startX,-t.startY)}0!==a&&(c=this.computeAngle(t,a,d),t.angle=c),l=n.x,u=n.y,y.i(n),e.Z(s)}else if(n<-i||n>=i){const e=y.l();this.qN(e),d=this.midAngle,0!==a&&(c=this.computeAngle(t,a,d),t.angle=c),l=e.x,u=e.y,y.i(e)}else{let e,r,h=0;if(n>=0?(e=s.r[n],r=n<i-1?s.r[n+1]:e):(h=i+n,e=s.r[h],r=h>0?s.r[h-1]:e),e.equalsApprox(r)){let t,o;n>=0?(t=n>0?s.r[n-1]:e,o=n<i-2?s.r[n+2]:r):(t=h<i-1?s.r[h+1]:e,o=h>1?s.r[h-2]:r);const a=t.distanceSquaredPoint(e),l=r.distanceSquaredPoint(o);d=a>l+10?n>=0?t.directionPoint(e):e.directionPoint(t):l>a+10?n>=0?r.directionPoint(o):o.directionPoint(r):n>=0?t.directionPoint(o):o.directionPoint(t)}else d=n>=0?e.directionPoint(r):r.directionPoint(e);0!==a&&(c=this.computeAngle(t,a,d),t.angle=c),l=e.x+(r.x-e.x)*o,u=e.y+(r.y-e.y)*o}if(r.isNone())return void t.moveTo(l,u,!0);r.isNoSpot()&&(r=v.Center);const g=P.l();g.Ue(),g.it(t.scale,t.scale),g.ks(t.angle,0,0);const f=t.naturalBounds,m=w.z(0,0,f.width,f.height),p=y.l();p.setRectSpot(m,r),g.gt(p);let x=-p.x,b=-p.y;const k=f.width,S=f.height,M=y.bs(h),C=isNaN(h.x),N=isNaN(h.y);if(C||N){const t=k/2+be.J1,e=S/2+be.nv,i=d>=45&&d<=135,s=d>=225&&d<=315;0===a&&(i||s)?(M.x=N?t:h.y,M.y=C?e:h.x,i?n>=0||isNaN(n)&&o<.5||C&&(M.y=-e):s&&((n>=0||isNaN(n)&&o<.5)&&C&&(M.y=-e),N&&(M.x=-t))):(C&&(n>=0||isNaN(n)&&o<.5?M.x=t:M.x=-t),N&&(M.y=-e),M.rotate(d))}else M.rotate(d);l+=M.x,u+=M.y,g.sm(m),x+=m.x,b+=m.y;const T=y.z(l+x,u+b);t.move(T),y.i(T),y.i(M),y.i(p),w.i(m),P.i(g)}Qr(){let t=this.fromNode;if(null!==t){const e=t.findVisibleNode();if(null!==e&&(t=e),t.as()||t.fa())return!1}let e=this.toNode;if(null!==e){const t=e.findVisibleNode();if(null!==t&&(e=t),e.as()||e.fa())return!1}return!0}vN(t,e,i){return!1}FN(){}Di(){return!1}computeAngle(t,e,i){return be.computeAngle(e,i)}static computeAngle(t,e){let i=0;switch(t){default:case 0:i=0;break;case 21:i=e;break;case 22:i=e+90;break;case 23:i=e-90;break;case 24:i=e+180;break;case 25:i=k.Ee(e),i>90&&i<270&&(i-=180);break;case 26:i=k.Ee(e+90),i>90&&i<270&&(i-=180);break;case 27:i=k.Ee(e-90),i>90&&i<270&&(i-=180);break;case 28:if(i=k.Ee(e),i>45&&i<135||i>225&&i<315)return 0;i>90&&i<270&&(i-=180)}return k.Ee(i)}get fromNode(){return this.mo}set fromNode(t){const e=this.mo;if(e!==t){const i=this.fromPort;null!==e&&(this.yo!==e&&e.dk(this,i),this.Zy(),this.invalidateLayout(2)),this.mo=t,null!==t&&this.Xe(t.isVisible()),this.er=null,this.$t();const s=this.diagram;null!==s&&s.G&&s.partManager.setFromNodeForLink(this,t,e);const n=this.fromPort,o=this.fromPortChanged;if(null!==o){let t=!0;null!==s&&(t=s.G,s.G=!0),o(this,i,n),null!==s&&(s.G=t)}null!==t&&(this.yo!==t&&t.uk(this,n),this.Qy(),this.invalidateLayout(1)),this.t("fromNode",e,t),this.Wd()}}get fromPortId(){return this.po}set fromPortId(t){const e=this.po;if(e!==t){const i=this.fromPort;null!==i&&this.fromNode?.Ze(i),this.Zy(),this.po=t;const s=this.fromPort;null!==s&&this.fromNode?.Ze(s);const n=this.diagram;if(null!==n){const e=this.data,i=n.model;null!==e&&i.jh()&&i.setFromPortIdForLinkData(e,t)}if(i!==s){this.er=null,this.$t();const t=this.fromPortChanged;if(null!==t){let e=!0;null!==n&&(e=n.G,n.G=!0),t(this,i,s),null!==n&&(n.G=e)}}this.Qy(),this.t("fromPortId",e,t)}}get fromPort(){const t=this.mo;if(null===t)return null;const e=this.po;return t.findPort(e)}get fromPortChanged(){return this.$d}set fromPortChanged(t){const i=this.$d;i!==t&&(null!==t&&e.S(t,be,"fromPortChanged"),this.$d=t,this.t("fromPortChanged",i,t))}get toNode(){return this.yo}set toNode(t){const e=this.yo;if(e!==t){const i=this.toPort;null!==e&&(this.mo!==e&&e.dk(this,i),this.Zy(),this.invalidateLayout(2)),this.yo=t,null!==t&&this.Xe(t.isVisible()),this.er=null,this.$t();const s=this.diagram;null!==s&&s.G&&s.partManager.setToNodeForLink(this,t,e);const n=this.toPort,o=this.toPortChanged;if(null!==o){let t=!0;null!==s&&(t=s.G,s.G=!0),o(this,i,n),null!==s&&(s.G=t)}null!==t&&(this.mo!==t&&t.uk(this,n),this.Qy(),this.invalidateLayout(1)),this.t("toNode",e,t),this.Wd()}}get toPortId(){return this.wo}set toPortId(t){const e=this.wo;if(e!==t){const i=this.toPort;null!==i&&this.toNode?.Ze(i),this.Zy(),this.wo=t;const s=this.toPort;null!==s&&this.toNode?.Ze(s);const n=this.diagram;if(null!==n){const e=this.data,i=n.model;null!==e&&i.jh()&&i.setToPortIdForLinkData(e,t)}if(i!==s){this.er=null,this.$t();const t=this.toPortChanged;if(null!==t){let e=!0;null!==n&&(e=n.G,n.G=!0),t(this,i,s),null!==n&&(n.G=e)}}this.Qy(),this.t("toPortId",e,t)}}get toPort(){const t=this.yo;if(null===t)return null;const e=this.wo;return t.findPort(e)}get toPortChanged(){return this.Zd}set toPortChanged(t){const i=this.Zd;i!==t&&(null!==t&&e.S(t,be,"toPortChanged"),this.Zd=t,this.t("toPortChanged",i,t))}get fromSpot(){return null!==this.ft?this.ft.Dh:v.Default}set fromSpot(t){const e=this.fromSpot;if(!e.equals(t)){if(t=t.N(),this.Wi().Dh=t,this.t("fromSpot",e,t),e.isSide()||t.isSide()){const t=this.fromNode;null!==t&&t.Ze(this.fromPort)}this.$t()}}get fromEndSegmentLength(){return null!==this.ft?this.ft.Fh:NaN}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;if(i!==t){if(t<0&&e.J(t,">= 0",be,"fromEndSegmentLength"),this.Wi().Fh=t,this.t("fromEndSegmentLength",i,t),this.computeSpot(!0,this.fromPort).isSide()){const t=this.fromNode;null!==t&&t.Ze(this.fromPort)}this.$t()}}get fromShortLength(){return null!==this.ft?this.ft.Oh:NaN}set fromShortLength(t){const e=this.fromShortLength;e!==t&&(this.Wi().Oh=t,this.ai(),this.t("fromShortLength",e,t))}get toSpot(){return null!==this.ft?this.ft.vh:v.Default}set toSpot(t){const e=this.toSpot;if(!e.equals(t)){if(t=t.N(),this.Wi().vh=t,this.t("toSpot",e,t),e.isSide()||t.isSide()){const t=this.toNode;null!==t&&t.Ze(this.toPort)}this.$t()}}get toEndSegmentLength(){return null!==this.ft?this.ft.Rh:NaN}set toEndSegmentLength(t){const i=this.toEndSegmentLength;if(i!==t){if(t<0&&e.J(t,">= 0",be,"toEndSegmentLength"),this.Wi().Rh=t,this.t("toEndSegmentLength",i,t),this.computeSpot(!1,this.toPort).isSide()){const t=this.toNode;null!==t&&t.Ze(this.toPort)}this.$t()}}get toShortLength(){return null!==this.ft?this.ft.Ih:NaN}set toShortLength(t){const e=this.toShortLength;e!==t&&(this.Wi().Ih=t,this.ai(),this.t("toShortLength",e,t))}Wd(){const t=this.fromNode,e=this.toNode;let i=null;if(i=null!==t?null!==e?t.findCommonContainingGroup(e):t.containingGroup:null!==e?e.containingGroup:null,this.ME(i),this.isLabeledLink){const t=this.labelNodes;for(;t.next();){t.value.containingGroup=i}}}ME(t){const e=this.Da;if(e!==t){null!==e&&e.uC(this),this.Da=t,null!==t&&t.dC(this);const i=this.containingGroupChanged;if(null!==i){let s=!0;const n=this.diagram;null!==n&&(s=n.G,n.G=!0),i(this,e,t),null!==n&&(n.G=s)}this.Fi&&(this.kC===e||this.PC===e)&&this.$t()}}Sa(){const t=this.containingGroup;null!==t&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.Sa()}getOtherNode(t){const e=this.fromNode;return t===e?this.toNode:e}getOtherPort(t){const e=this.fromPort;return t===e?this.toPort:e}get isLabeledLink(){return null!==this.nn&&this.nn.count>0}get labelNodes(){return null===this.nn?n.instance:this.nn.iterator}$D(t){null===this.nn&&(this.nn=new u),this.nn.add(t),this.f()}ZD(t){null!==this.nn&&(this.nn.delete(t),this.f())}tp(t){if(super.tp(t),this.Qh()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const t=this.mo;let e=null;null!==t&&(e=this.fromPort,t.uk(this,e));const i=this.yo;let s=null;null!==i&&(s=this.toPort,(i!==t||s!==e)&&i.uk(this,s)),this.Qy()}}ep(t){if(super.ep(t),this.Qh()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const t=this.mo;let e=null;null!==t&&(e=this.fromPort,t.dk(this,e));const i=this.yo;let s=null;null!==i&&(s=this.toPort,(i!==t||s!==e)&&i.dk(this,s)),this.Zy()}}rf(){if(this.Fi=!0,null!==this.nn){const t=this.diagram;if(null!==t){const e=this.nn.copy().iterator;for(;e.next();){const i=e.value;t.remove(i)}}}if(null!==this.data){const t=this.diagram;null!==t&&t.partManager.TC(this)}}updateRelationshipsFromData(){if(null===this.data)return;const t=this.diagram;null!==t&&t.partManager.updateRelationshipsFromData(this)}move(t,e){const i=e?this.location:this.position;let s=i.x;isNaN(s)&&(s=0);let n=i.y;isNaN(n)&&(n=0);const o=t.x-s,r=t.y-n;if(!0===e)super.move(t,!1);else{const t=y.z(i.x+o,i.y+r);super.move(t,!1),y.i(t)}this.kr(o,r);const a=this.labelNodes;for(;a.next();){const t=a.value,e=t.position;t.moveTo(e.x+o,e.y+r)}}get relinkableFrom(){return!!(1&this.Mt)}set relinkableFrom(t){const e=!!(1&this.Mt);e!==t&&(this.Mt=1^this.Mt,this.t("relinkableFrom",e,t),this.invalidateAdornments())}get relinkableTo(){return!!(2&this.Mt)}set relinkableTo(t){const e=!!(2&this.Mt);e!==t&&(this.Mt=2^this.Mt,this.t("relinkableTo",e,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowRelink)return!1;const e=t.diagram;return!(null!==e&&!e.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(null===t)return!0;if(!t.allowRelink)return!1;const e=t.diagram;return!(null!==e&&!e.allowRelink)}get resegmentable(){return!!(4&this.Mt)}set resegmentable(t){const e=!!(4&this.Mt);e!==t&&(this.Mt=4^this.Mt,this.t("resegmentable",e,t),this.invalidateAdornments())}get isTreeLink(){return!!(8&this.Mt)}set isTreeLink(t){const e=!!(8&this.Mt);e!==t&&(this.Mt=8^this.Mt,this.t("isTreeLink",e,t),null!==this.fromNode&&this.fromNode.vp(),null!==this.toNode&&this.toNode.vp())}get path(){const t=this.findMainElement();return t instanceof $t?t:null}get routeBounds(){return this.updateRoute(),this.xl}DC(t){let e=1/0,i=1/0;const s=this.pointsCount;if(0===s)return t.e(NaN,NaN,0,0),t;if(1===s){const s=this.getPoint(0);e=Math.min(s.x,e),i=Math.min(s.y,i),t.e(s.x,s.y,0,0)}else if(2===s){const s=this.getPoint(0),n=this.getPoint(1);e=Math.min(s.x,n.x),i=Math.min(s.y,n.y),t.e(s.x,s.y,0,0),t.unionPoint(n)}else if(9===this.computeCurve()&&s>=3&&!this.isOrthogonal){let n=this.getPoint(0);if(e=n.x,i=n.y,t.e(e,i,0,0),3===s){const s=this.getPoint(1);e=Math.min(s.x,e),i=Math.min(s.y,i);const o=this.getPoint(2);e=Math.min(o.x,e),i=Math.min(o.y,i),k.Mu(n.x,n.y,s.x,s.y,s.x,s.y,o.x,o.y,.5,t)}else for(let o=3;o<s;o+=3){const r=this.getPoint(o-2);o+3>=s&&(o=s-1);const a=this.getPoint(o-1),h=this.getPoint(o);k.Mu(n.x,n.y,r.x,r.y,a.x,a.y,h.x,h.y,.5,t),e=Math.min(h.x,e),i=Math.min(h.y,i),n=h}}else{const n=this.getPoint(0),o=this.getPoint(1);e=Math.min(n.x,o.x),i=Math.min(n.y,o.y),t.e(n.x,n.y,0,0),t.unionPoint(o);for(let n=2;n<s;n++){const s=this.getPoint(n);e=Math.min(s.x,e),i=Math.min(s.y,i),t.unionPoint(s)}}return this.gk.e(e-t.x,i-t.y),t}get midPoint(){return this.qN(new y)}qN(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const e=this.pointsCount;if(0===e)return t.h(y.gn),t;if(1===e)return t.h(this.getPoint(0)),t;if(2===e){const e=this.getPoint(0),i=this.getPoint(1);return t.e((e.x+i.x)/2,(e.y+i.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||9===this.computeCurve())){this.ut.getPointAlongPath(.5,t),t.add(this.getPoint(0));const e=this.ut.figures.first();return t.offset(-e.startX,-e.startY),t}if(9===this.computeCurve()){if(3===e){const e=this.getPoint(0),i=this.getPoint(1),s=this.getPoint(2);return k.HL(e.x,e.y,i.x,i.y,i.x,i.y,s.x,s.y,t),t}const i=(e-1)/3|0,s=3*(i/2|0);if(i%2==1){const e=this.getPoint(s),i=this.getPoint(s+1),n=this.getPoint(s+2),o=this.getPoint(s+3);return k.HL(e.x,e.y,i.x,i.y,n.x,n.y,o.x,o.y,t),t}return t.h(this.getPoint(s)),t}const i=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,r=0;for(;n<s/2&&o<e&&(r=i[o],!(n+r>s/2));)n+=r,o++;const a=this.getPoint(o),h=this.getPoint(o+1);if(Math.abs(a.x-h.x)<1)a.y>h.y?t.e(a.x,a.y-(s/2-n)):t.e(a.x,a.y+(s/2-n));else if(Math.abs(a.y-h.y)<1)a.x>h.x?t.e(a.x-(s/2-n),a.y):t.e(a.x+(s/2-n),a.y);else{const e=(s/2-n)/r,i=e*(h.x-a.x),o=e*(h.y-a.y);t.e(a.x+i,a.y+o)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(2===t){const t=this.getPoint(0),e=this.getPoint(1);return t.directionPoint(e)}if(this.isOrthogonal&&(this.computeCorner()>=15||9===this.computeCurve()))return this.ut.getAngleAlongPath(.5);if(9===this.computeCurve()&&t>=4){const e=(t-1)/3|0;let i=3*(e/2|0);if(e%2==1){i=Math.floor(i);const t=this.getPoint(i),e=this.getPoint(i+1),s=this.getPoint(i+2),n=this.getPoint(i+3);return k.qF(t.x,t.y,e.x,e.y,s.x,s.y,n.x,n.y)}if(i>0&&i+1<t){const t=this.getPoint(i-1),e=this.getPoint(i+1);return t.directionPoint(e)}}const e=this.flattenedLengths,i=this.flattenedTotalLength;let s=0,n=0,o=0;for(;s<i/2&&n<t&&(o=e[n],!(s+o>i/2));)s+=o,n++;const r=this.getPoint(n),a=this.getPoint(n+1);if(Math.abs(r.x-a.x)<.5&&Math.abs(r.y-a.y)<be.CC){if(n>0&&n<t-2){const t=this.getPoint(n-1),e=this.getPoint(n+2);return t.x<e.x?0:t.x>e.x?180:t.y<e.y?90:270}}else if(Math.abs(r.y-a.y)<.5&&Math.abs(r.x-a.x)<be.CC&&n>0&&n<t-2){const t=this.getPoint(n-1),e=this.getPoint(n+2);return t.y<e.y?90:t.y>e.y?270:t.x<e.x?0:180}return r.directionPoint(a)}get flattenedLengths(){return null!==this.Jh?this.Jh:(this.Fi||this.pk(),this.NE())}get flattenedTotalLength(){let t=this.mk;if(isNaN(t)){const e=this.flattenedLengths,i=e.length;t=0;for(let s=0;s<i;s++)t+=e[s];this.mk=t}return t}NE(){null===this.Jh?this.Jh=[]:this.Jh.length=0;const t=this.Jh,e=this.pointsCount;for(let i=0;i<e-1;i++){let e=0;const s=this.getPoint(i),n=this.getPoint(i+1);k.X(s.x,n.x)?(e=n.y-s.y,e<0&&(e=-e),t.push(e)):k.X(s.y,n.y)?(e=n.x-s.x,e<0&&(e=-e),t.push(e)):(e=Math.sqrt(s.distanceSquaredPoint(n)),t.push(e))}return t}get points(){return this.Me}set points(t){const i=this.Me;if(i===t)return;let s=null;if(Array.isArray(t))s=this.convertPointsArrayToList(t);else if(t instanceof h){s=t.copy();const e=s.iterator;for(;e.next();)e.value.k()}else e.o("Link.points value is not an instance of List or Array: "+t);if(null===s)return;s.k(),this.Me=s,this.ai(),this.pk();const n=this.diagram;null!==n&&(!n.Qa&&!n.undoManager.isUndoingRedoing&&n.nb.add(this),n.animationManager.ke&&n.animationManager.TM(this,s)),this.t("points",i,s)}convertPointsArrayToList(t){let i=null,s=t.length%2==0;if(s)for(let e=0;e<t.length;e++)if("number"!=typeof t[e]||isNaN(t[e])){s=!1;break}if(s){i=new h;for(let e=0;e<t.length/2;e++)i.add(new y(t[2*e],t[2*e+1]).k())}else{let s=!0;for(let i=0;i<t.length;i++){const n=t[i];if(!e.$(n)||"number"!=typeof n.x||isNaN(n.x)||"number"!=typeof n.y||isNaN(n.y)){s=!1;break}}if(s){i=new h;for(let e=0;e<t.length;e++){const s=t[e];i.add(new y(s.x,s.y).k())}}}return i}get pointsCount(){return this.Me.count}getPoint(t){return this.Me.r[t]}setPoint(t,e){this.Me.setElt(t,e)}setPointAt(t,e,i){this.Me.setElt(t,new y(e,i))}insertPoint(t,e){this.Me.insertAt(t,e)}insertPointAt(t,e,i){this.Me.insertAt(t,new y(e,i))}addPoint(t){this.Me.add(t)}addPointAt(t,e){this.Me.add(new y(t,e))}removePoint(t){this.Me.removeAt(t)}clearPoints(){this.Me.clear()}kr(t,e){if(0===t&&0===e)return;if(0===this.pointsCount)return this.defaultFromPoint.isReal()&&this.defaultFromPoint.offset(t,e),void(this.defaultToPoint.isReal()&&this.defaultToPoint.offset(t,e));const i=this.Fi,s=new h,n=this.Me.iterator;for(;n.next();){const i=n.value;s.add(new y(i.x+t,i.y+e).k())}s.k();const o=this.Me;this.Me=s;const r=this.diagram;isNaN(t)||isNaN(e)||null!==r&&r.animationManager.ke?this.f():(this.sn.e(this.sn.x+t,this.sn.y+e),this.ct.e(this.ct.x+t,this.ct.y+e),this.kf()),i?this.pk():(this.defaultFromPoint.isReal()&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint.isReal()&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),null!==r&&r.animationManager.ke&&r.animationManager.TM(this,s),this.t("points",o,s)}startRoute(){null===this.wl&&(this.wl=this.Me,this.Me=this.Me.copy())}commitRoute(){if(null===this.wl)return;const t=this.wl,e=this.Me;this.wl=null;const i=this.diagram;null!==i&&i.animationManager.ke&&i.animationManager.TM(this,e),this.ai(),this.pk(),this.t("points",t,e)}rollbackRoute(){null!==this.wl&&(this.Me=this.wl,this.wl=null,this.DC(this.xl))}vR(){null!==this.Dr&&(this.points=this.Dr,this.Dr=null)}pk(){0!==this.Me.count?(this.Fi=!0,this.DC(this.xl),this.Jh=null,this.mk=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.yk(!1)):this.Fi=!1}invalidateRoute(){this.$t()}$t(){if(this.suspendsRouting)return;const t=this.path;if(null===t)return;const e=this.diagram;if(e){if(e.nb.has(this)||e.undoManager.isUndoingRedoing)return;const t=e.animationManager;if(t.isTicking&&!t.isAnimating)return;null!==this.Dr&&!t.isTicking&&(this.Dr=null)}this.Fi=!1,this.f(),t.f()}get Fi(){return!!(16&this.Mt)}set Fi(t){!!(16&this.Mt)!==t&&(this.Mt=16^this.Mt)}get suspendsRouting(){return!!(32&this.Mt)}set suspendsRouting(t){!!(32&this.Mt)!==t&&(this.Mt=32^this.Mt)}get _y(){return!!(64&this.Mt)}set _y(t){!!(64&this.Mt)!==t&&(this.Mt=64^this.Mt)}get vC(){return!!(512&this.Mt)}set vC(t){!!(512&this.Mt)!==t&&(this.Mt=512^this.Mt)}get defaultFromPoint(){return this.xC}set defaultFromPoint(t){this.xC=t&&t.isReal()?t.copy():y.gn}get defaultToPoint(){return this.bC}set defaultToPoint(t){this.bC=t&&t.isReal()?t.copy():y.gn}updateRoute(){if(this.Fi||this._y)return;let t=!0;try{this._y=!0,this.startRoute(),t=this.computePoints()}catch{this._y=!1,this.rollbackRoute()}finally{this._y=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(null===t)return!1;let e=this.fromNode,i=null;if(null===e?(be.$h||(be.$h=new me,be.$h.desiredSize=x.xc,be.$h.ensureBounds()),this.defaultFromPoint.isReal()&&(be.$h.location=this.defaultFromPoint,be.$h.ensureBounds(),e=be.$h,i=be.$h)):i=this.fromPort,null!==i&&!e.isVisible()){const t=e.findVisibleNode();null!==t&&t!==e?(e=t,i=t.port):e=t}if(this.kC=e,null===e||!e.location.isReal()||null===i||(i=e.findVisiblePort(i),null===i))return!1;let s=this.toNode,n=null;if(null===s?(be.Zh||(be.Zh=new me,be.Zh.desiredSize=x.xc,be.Zh.ensureBounds()),this.defaultToPoint.isReal()&&(be.Zh.location=this.defaultToPoint,be.Zh.ensureBounds(),s=be.Zh,n=be.Zh)):n=this.toPort,null!==n&&!s.isVisible()){const t=s.findVisibleNode();null!==t&&t!==s?(s=t,n=t.port):s=t}if(this.PC=s,null===s||!s.location.isReal()||null===n||(n=s.findVisiblePort(n),null===n))return!1;const o=this.pointsCount,r=this.computeSpot(!0,i),a=this.computeSpot(!1,n),h=this.bl(r),l=this.bl(a),u=i===n&&null!==i,c=this.isOrthogonal;let d=9===this.curve;u&&!c?(d=!0,this.er=!0):this.er=!1;const g=0===this.computeAdjusting()||u;if(!c&&!u&&h&&l){let t=!1;if(!g&&o>=3){let h=this.getLinkPoint(e,i,r,!0,!1,s,n),l=this.getLinkPoint(s,n,a,!1,!1,e,i);t=this.adjustPoints(0,h,o-1,l),t&&(h=this.getLinkPoint(e,i,r,!0,!1,s,n),l=this.getLinkPoint(s,n,a,!1,!1,e,i),this.adjustPoints(0,h,o-1,l))}t||(this.clearPoints(),d?this.CE(e,i,r,s,n,a):this.LE(e,i,r,s,n,a))}else{const t=u?this.computeCurviness():0;g&&(c&&this.isAvoiding||u)&&this.clearPoints();const d=this.getLinkPoint(e,i,r,!0,c,s,n),f=this.getLinkPoint(s,n,a,!1,c,e,i);let m=0,p=0,x=0;if(c||!h||u){x=this.getLinkDirection(e,i,d,r,!0,c,s,n);let o=this.wk(e,i,r,!0,x);if(u&&(h||r.equals(a)||!c&&r.x+a.x===1&&r.y+a.y===1)&&(x-=c?90:be.lv,t<0&&(x-=180)),x=k.Ee(x),u&&(o+=Math.abs(t)*(c?1:2)),0===x?m=o:90===x?p=o:180===x?m=-o:270===x?p=-o:(m=o*Math.cos(x*Math.PI/180),p=o*Math.sin(x*Math.PI/180)),r.isNoSpot()&&u){const t=i.getDocumentPoint(v.Center,y.l()),s=y.z(t.x+m*be.Gf,t.y+p*be.Gf);this.getLinkPointFromPoint(e,i,t,s,!0,d),y.i(t),y.i(s)}}let w=0,b=0,P=0;if(c||!l||u){P=this.getLinkDirection(s,n,f,a,!1,c,e,i);let o=this.wk(s,n,a,!1,P);if(u&&(l||r.equals(a)||!c&&r.x+a.x===1&&r.y+a.y===1)&&(P+=c?0:be.av,t<0&&(P+=180)),P=k.Ee(P),u&&(o+=Math.abs(t)*(c?1:2)),0===P?w=o:90===P?b=o:180===P?w=-o:270===P?b=-o:(w=o*Math.cos(P*Math.PI/180),b=o*Math.sin(P*Math.PI/180)),a.isNoSpot()&&u){const t=n.getDocumentPoint(v.Center,y.l()),e=y.z(t.x+w*be.Gf,t.y+b*be.Gf);this.getLinkPointFromPoint(s,n,t,e,!1,f),y.i(t),y.i(e)}}let S=d;(c||!h||u)&&(S=new y(d.x+m,d.y+p));let M=f;(c||!l||u)&&(M=new y(f.x+w,f.y+b)),!g&&!c&&h&&o>3&&this.adjustPoints(0,d,o-2,M)?this.setPoint(o-1,f):!g&&!c&&l&&o>3&&this.adjustPoints(1,S,o-1,f)?this.setPoint(0,d):!g&&(c?o>=6:o>4)&&this.adjustPoints(1,S,o-2,M)?(this.setPoint(0,d),this.setPoint(o-1,f)):(this.clearPoints(),this.addPoint(d),(c||!h||u)&&this.addPoint(S),c&&this.addOrthoPoints(S,x,M,P,e,s),(c||!l||u)&&this.addPoint(M),this.addPoint(f))}return t.addInvalidRoute(this),!0}FC(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?(e.x>=t.x?e.x=t.x+9e9:e.x=t.x-9e9,e.y=t.y):(e.y>=t.y?e.y=t.y+9e9:e.y=t.y-9e9,e.x=t.x),e}getLinkPointFromPoint(t,e,i,s,n,o){if(void 0===o&&(o=new y),null===t||null===e)return o.h(i),o;if(!t.isVisible()){const i=t.findVisibleNode();null!==i&&i!==t&&(e=(t=i).port)}let r=0,a=0,h=0,l=0,u=null,c=e.panel;if(null!==c&&!c.Mn()&&(c=c.panel),null===c)r=s.x,a=s.y,h=i.x,l=i.y;else{u=c.Ws;const t=1/(u.m11*u.m22-u.m12*u.m21),e=u.m22*t,n=-u.m12*t,o=-u.m21*t,d=u.m11*t,g=t*(u.m21*u.dy-u.m22*u.dx),f=t*(u.m12*u.dx-u.m11*u.dy);r=s.x*e+s.y*o+g,a=s.x*n+s.y*d+f,h=i.x*e+i.y*o+g,l=i.x*n+i.y*d+f}return e.mf(r,a,h,l,o),null!==u&&o.v(u),o}AE(t,e){const i=t.yd;return null!==i?i.gv(e):null}xk(t){if(null===t)return null;let e=t.yd;return null===e&&(e=new ke(t.part,t),t.yd=e),e.gv(this)}getLinkPoint(t,e,i,s,n,o,r,a){if(void 0===a&&(a=new y),i.isSpot()&&!this.bl(i))return e.getDocumentPoint(i,a),a;if(i.isSide()){const h=this.xk(e);if(null!==h){const l=h._h;if(a.h(l),n&&7===this.routing){const l=this.xk(r);if(null!==l&&h.Yf<l.Yf){const h=y.l(),l=y.l(),u=w.l();e.getDocumentPoint(v.TopLeft,h),e.getDocumentPoint(v.BottomRight,l);const c=h.x,d=h.y,g=l.x,f=l.y;u.x=Math.min(c,g),u.y=Math.min(d,f),u.width=Math.abs(c-g),u.height=Math.abs(d-f);const m=this.computeSpot(!s,r),p=this.getLinkPoint(o,r,m,!s,n,t,e,l);(i.includesSide(v.LeftSide)||i.includesSide(v.RightSide))&&p.y>=u.y&&p.y<=u.y+u.height?a.y=p.y:(i.includesSide(v.TopSide)||i.includesSide(v.BottomSide))&&p.x>=u.x&&p.x<=u.x+u.width&&(a.x=p.x),w.i(u),y.i(h),y.i(l)}}return a}}const h=e.getDocumentPoint(this.ig(i,s),y.l()),l=y.l();if(this.pointsCount>(n?6:2))l.h(s?this.getPoint(1):this.getPoint(this.pointsCount-2)),n&&this.FC(h,l);else if(t?.isMemberOf(o)||o?.isMemberOf(t)){const t=e.getDocumentBounds(w.l()),i=r.getDocumentBounds(w.l());t.isReal()&&i.isReal()?i.containsRect(t)?(l.h(h),this.RC(i,h.x,h.y,0,this.computeSpot(r===this.toPort,r),l)):t.containsRect(i)?(r.getDocumentPoint(v.Center,l),this.RC(t,l.x,l.y,0,this.computeSpot(e===this.toPort,e),l)):this.OC(r,h,s,n,l):this.OC(r,h,s,n,l),w.i(t),w.i(i)}else this.OC(r,h,s,n,l);return this.getLinkPointFromPoint(t,e,h,l,s,a),y.i(l),y.i(h),a}OC(t,e,i,s,n){const o=this.computeSpot(!i,t);t.getDocumentPoint(this.ig(o,!i),n),s&&this.FC(e,n)}getLinkDirection(t,e,i,s,n,o,r,a){let h=this.TE(t,e,i,s,n,o,r,a);if(t&&r){const i=w.l(),n=w.l();if(s.isNone()&&t.isMemberOf(r)&&e&&a){if(e.getDocumentBounds(i),a.getDocumentBounds(n),i.isReal()&&n.isReal()&&n.containsRect(i)){const t=this.computeSpot(a===this.toPort,a);h=t.equals(v.Left)||t.equals(v.LeftSide)?180:t.equals(v.Right)||t.equals(v.RightSide)?0:t.equals(v.Top)||t.equals(v.TopSide)?270:t.equals(v.Bottom)||t.equals(v.BottomSide)?90:k.Ee(h+180)}}else r?.isMemberOf(t)&&e&&a&&(e.getDocumentBounds(i),a.getDocumentBounds(n),i.isReal()&&n.isReal()&&i.containsRect(n)&&(h=k.Ee(h+180)));w.i(i),w.i(n)}if(this.bl(s)||null===e)return h;const l=e.getDocumentAngle();return 0===l?h:(45<=l&&l<135?h+=90:135<=l&&l<225?h+=180:225<=l&&l<315&&(h+=270),k.Ee(h))}TE(t,e,i,s,n,o,r,a){if(s.isSpot())return k._w(null,s.x,s.y);if(s.isSide()){const t=this.xk(e);if(null===t)return s.includesSide(v.TopSide)?270:s.includesSide(v.BottomSide)?90:s.includesSide(v.LeftSide)?180:0;switch(t.fi){case 1:return 270;case 8:return 90;case 2:return 180;default:return 0}}if(null===e||null===a)return 0;const h=e.getDocumentPoint(v.Center,y.l()),l=y.l();this.pointsCount>(o?6:2)?o?(l.h(n?this.getPoint(1):this.getPoint(this.pointsCount-2)),this.FC(h,l)):l.h(i):a.getDocumentPoint(v.Center,l);let u=0;return u=Math.abs(l.x-h.x)>Math.abs(l.y-h.y)?l.x>=h.x?0:180:l.y>=h.y?90:270,y.i(l),y.i(h),u}computeEndSegmentLength(t,e,i,s){return this.wk(t,e,i,s,NaN)}wk(t,e,i,s,n){if(null!==e&&i.isSide()){const t=this.xk(e);if(null!==t)return t.bk}let o=NaN;if(o=s?this.fromEndSegmentLength:this.toEndSegmentLength,null!==e&&isNaN(o))if(void 0===n&&(n=NaN),be.LC>0&&9===this.computeCurve()&&!isNaN(n)&&i.isSpot()){const t=this.getOtherPort(e);if(t){const s=y.l(),o=y.l(),r=e.getDocumentPoint(i,s),a=t.getDocumentPoint(i.opposite(),o),h=n>=315||n<=45||n>=135&&n<=225;let l=Math.abs(h?r.x-a.x:r.y-a.y)/be.LC;return l=Math.max(l,be.AC),y.i(s),y.i(o),l}}else o=s?e.fromEndSegmentLength:e.toEndSegmentLength;return isNaN(o)&&(o=be.AC),o}computeSpot(t,e){return void 0===e&&(e=null),t?this.DE(e||this.fromPort):this.vE(e||this.toPort)}DE(t){if(null===t)return v.Center;let e=this.fromSpot;return e.isDefault()&&(e=t.fromSpot),e===v.Default?v.None:e}vE(t){if(null===t)return v.Center;let e=this.toSpot;return e.isDefault()&&(e=t.toSpot),e===v.Default?v.None:e}bl(t){return t===v.None||.5===t.x&&.5===t.y}ig(t,e){return.5===t.x&&.5===t.y?t:v.Center}computeOtherPoint(t,e){if(0!==this.computeAdjusting()&&this.pointsCount>4)return this.computeMidPoint(new y);{const i=this.AE(e,this);if(null!==i)return i._h;if(t instanceof Ne){let i=this.fromNode,s=this.fromPort;s===e&&(i=this.toNode,s=this.toPort);const n=w.l(),o=w.l();if(s&&i?.isMemberOf(t)){const t=this.computeSpot(s===e,e);if(e.getDocumentBounds(n),s.getDocumentBounds(o),n.isReal()&&o.isReal()&&n.containsRect(o)){const e=s.getDocumentPoint(v.Center);return this.RC(n,e.x,e.y,0,t,e),w.i(n),w.i(o),e}}w.i(n),w.i(o)}return e.getDocumentPoint(v.Center)}}computeShortLength(t){if(t){let t=this.fromShortLength;if(isNaN(t)){const e=this.fromPort;null!==e&&(t=e.fromShortLength)}return isNaN(t)?0:t}{let t=this.toShortLength;if(isNaN(t)){const e=this.toPort;null!==e&&(t=e.toShortLength)}return isNaN(t)?0:t}}Zm(t,e,i,s,n,o){if(!1===this.pickable)return!1;let r;if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===o?(r=P.l(),r.Ue()):r=o,r.bc(this.v),this.containedInRect(t,r))return this.$N(e,i,n),void 0===o&&P.i(r),!0;if(this.intersectsRect(t,r)){let a=!1;if(!this.Af){const o=this.D.r;for(let h=o.length;h--;){const l=o[h];if(!l.visible&&l!==this.locationObject)continue;const u=l.actualBounds,c=this.naturalBounds;if(u.x>c.width||u.y>c.height||u.x+u.width<0||u.y+u.height<0)continue;const d=l,g=P.l();if(g.set(r),d instanceof Yt?a=d.Zm(t,e,i,s,n,g):this.path===d?d instanceof $t&&(a=d.nE(t,s,g)):a=d.ZT(t,s,g),a){let t=d;null!==e&&(t=e(d)),t&&(null===i||i(t))&&n.add(t)}P.i(g)}}return void 0===o&&P.i(r),a||null!==this.background}return void 0===o&&P.i(r),!1}get isOrthogonal(){return!(2&~this.Wh)}static NC(t){return!(2&~t)}get isAvoiding(){return!(4&~this.Wh)}computeCurve(){if(null===this.er){const t=this.fromPort,e=null!==t&&t===this.toPort,i=this.isOrthogonal;this.er=e&&!i}return this.er?9:this.curve}computeCorner(){if(9===this.curve)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=be.hv),t}findMidLabel(){const t=this.path,e=this.D.r,i=e.length;for(let s=0;s<i;s++){const i=e[s];if(i!==t&&!i.isPanelMain&&(i.segmentIndex===-1/0||isNaN(i.segmentIndex)))return i}const s=this.labelNodes;for(;s.next();){const t=s.value;if(t.segmentIndex===-1/0||isNaN(t.segmentIndex))return t}return null}computeSpacing(){if(!this.isVisible())return 0;let t=be.cv;t=Math.max(t,this.computeThickness());const e=this.fromPort,i=this.toPort;if(null!==e&&null!==i){const s=this.findMidLabel();if(null!==s){const n=s.naturalBounds,o=s.margin,r=isNaN(n.width)?be.fv:n.width*s.scale+o.left+o.right,a=isNaN(n.height)?be.uv:n.height*s.scale+o.top+o.bottom,h=s.segmentOrientation;if(21===h||25===h||24===h)t=Math.max(t,a);else if(23===h||27===h||22===h||26===h)t=Math.max(t,r);else{const s=e.getDocumentPoint(v.Center).directionPoint(i.getDocumentPoint(v.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(s)*r)+Math.abs(Math.cos(s)*a)+1)}9===this.curve&&(t*=be.ov)}}return t}arrangeBundledLinks(t,e){if(e)for(let e=0;e<t.length;e++){const i=t[e];0===i.computeAdjusting()&&i.$t()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=be.sv;const i=this.ir;if(null!==i){const s=e.nt();let n=0;const o=i.on;for(let t=0;t<o.length;t++){const e=o[t].computeSpacing();s.push(e),n+=e}let r=-n/2;for(let e=0;e<o.length;e++){if(o[e]===this){t=r+s[e]/2;break}r+=s[e]}i.Gy===this.fromNode&&(t=-t),e.Z(s)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return null!==t?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||null!==this.ir}LE(t,e,i,s,n,o){let r=this.getLinkPoint(t,e,i,!0,!1,s,n),a=this.getLinkPoint(s,n,o,!1,!1,t,e);if(this.mv(t,e,i,r,s,n,o,a),this.addPoint(r),this.addPoint(a),this.hasCurviness()){const t=a.x-r.x,e=a.y-r.y,i=this.computeCurviness(),s=i,n=r.x+t/2,o=r.y+e/2;let h=n,l=o;if(k.c(e,0))t>0?l-=s:l+=s;else{const r=-t/e;let a=Math.sqrt(s*s/(r*r+1));i<0&&(a=-a),h=(e<0?-1:1)*a+n,l=r*(h-n)+o}this.insertPointAt(1,h,l)}}mv(t,e,i,s,n,o,r,a){const h=o.getDocumentBounds(w.l()),l=e.getDocumentBounds(w.l());if(!h.intersectsRect(l)||h.containsRect(l)||l.containsRect(h)){if(h.containsPoint(s)){const r=y.l();e.getDocumentPoint(this.ig(i,!0),r),a.h(r),this.IC(h,r.x,r.y,be.Gf,a),this.getLinkPointFromPoint(n,o,h.containsPoint(r)?r:s,a,!1,a),this.getLinkPointFromPoint(t,e,r,a,!0,s),y.i(r)}else if(l.containsPoint(a)){const i=y.l();o.getDocumentPoint(this.ig(r,!1),i),s.h(i),this.IC(l,i.x,i.y,be.Gf,s),this.getLinkPointFromPoint(t,e,l.containsPoint(i)?i:a,s,!0,s),this.getLinkPointFromPoint(n,o,i,s,!1,a),y.i(i)}}else{const u=y.l();e.getDocumentPoint(this.ig(i,!0),u);const c=y.l();o.getDocumentPoint(this.ig(r,!1),c);const d=l.width*l.height,g=h.width*h.height;d>g?(s.h(u),this.getLinkPointFromPoint(n,o,c,u,!1,c),a.h(c)):d<g?(this.getLinkPointFromPoint(t,e,u,c,!0,u),s.h(u),a.h(c)):(s.h(u),a.h(c)),y.i(u),y.i(c)}w.i(l),w.i(h)}RC(t,e,i,s,n,o){let r=-1;return n.equals(v.Left)||n.equals(v.LeftSide)?r=180:n.equals(v.Right)||n.equals(v.RightSide)?r=0:n.equals(v.Top)||n.equals(v.TopSide)?r=270:(n.equals(v.Bottom)||n.equals(v.BottomSide))&&(r=90),-1===r?this.IC(t,e,i,0,o):this.pv(t,e,i,0,r,o)}IC(t,e,i,s,n){const o=k._w(t,e,i);return this.pv(t,e,i,s,o,n)}pv(t,e,i,s,n,o){return 0===n?o.x=t.right+s:90===n?o.y=t.bottom+s:180===n?o.x=t.x-s:270===n?o.y=t.y-s:45===n?(o.x=t.right+s,o.y=t.bottom+s):135===n?(o.x=t.x-s,o.y=t.bottom+s):225===n?(o.x=t.x-s,o.y=t.y-s):315===n&&(o.x=t.right+s,o.y=t.y-s),o}CE(t,e,i,s,n,o){let r=this.getLinkPoint(t,e,i,!0,!1,s,n),a=this.getLinkPoint(s,n,o,!1,!1,t,e);this.mv(t,e,i,r,s,n,o,a),this.addPoint(r),this.addPoint(a);const h=a.x-r.x,l=a.y-r.y,u=this.computeCurviness();let c=0,d=0,g=r.x+h/3,f=r.y+l/3,m=g,p=f;k.c(l,0)?h>0?p-=u:p+=u:(c=-h/l,d=Math.sqrt(u*u/(c*c+1)),u<0&&(d=-d),m=(l<0?-1:1)*d+g,p=c*(m-g)+f),g=r.x+2*h/3,f=r.y+2*l/3;let y=g,x=f;k.c(l,0)?h>0?x-=u:x+=u:(y=(l<0?-1:1)*d+g,x=c*(y-g)+f),this.insertPointAt(1,m,p),this.insertPointAt(2,y,x),this.setPoint(0,this.getLinkPoint(t,e,i,!0,!1,s,n)),this.setPoint(3,this.getLinkPoint(s,n,o,!1,!1,t,e))}adjustPoints(t,e,i,s){let n=this.computeAdjusting();if(this.isOrthogonal){if(18===n)return!1;19===n&&(n=17)}switch(n){case 18:return this.FE(t,e,i,s);case 19:return this.RE(t,e,i,s);case 17:return this.OE(t,e,i,s);default:return!1}}FE(t,e,i,s){const n=this.getPoint(t),o=this.getPoint(i);if(n.equalsApprox(e)&&o.equalsApprox(s))return!0;const r=n.x,a=n.y;let h=o.x-r,l=o.y-a;const u=Math.sqrt(h*h+l*l);if(k.X(u,0))return!0;let c=0;k.X(h,0)?c=l<0?-Math.PI/2:Math.PI/2:(c=Math.atan(l/Math.abs(h)),h<0&&(c=Math.PI-c));const d=e.x,g=e.y,f=s.x-d,m=s.y-g,p=Math.sqrt(f*f+m*m);let y=0;k.X(f,0)?y=m<0?-Math.PI/2:Math.PI/2:(y=Math.atan(m/Math.abs(f)),f<0&&(y=Math.PI-y));const x=p/u,w=y-c;this.setPoint(t,e);for(let e=t+1;e<i;e++){const t=this.getPoint(e);h=t.x-r,l=t.y-a;const i=Math.sqrt(h*h+l*l);if(k.X(i,0))continue;let s=0;k.X(h,0)?s=l<0?-Math.PI/2:Math.PI/2:(s=Math.atan(l/Math.abs(h)),h<0&&(s=Math.PI-s));const n=s+w,o=i*x,u=d+o*Math.cos(n),c=g+o*Math.sin(n);this.setPointAt(e,u,c)}return this.setPoint(i,s),!0}RE(t,e,i,s){const n=this.getPoint(t),o=this.getPoint(i);if(n.equalsApprox(e)&&o.equalsApprox(s))return!0;const r=n.x,a=n.y,h=o.x,l=o.y,u=(h-r)**2+(l-a)**2,c=e.x,d=e.y,g=s.x,f=s.y;let m=0,p=1;g-c!=0?(m=(f-d)/(g-c),p=Math.sqrt(1+1/(m*m))):m=9e9,this.setPoint(t,e);for(let e=t+1;e<i;e++){const t=this.getPoint(e),i=t.x,s=t.y;let n=.5;0!==u&&(n=((r-i)*(r-h)+(a-s)*(a-l))/u);const o=r+n*(h-r),y=a+n*(l-a);let x=Math.sqrt((i-o)**2+(s-y)**2);s<m*(i-o)+y&&(x=-x),m>0&&(x=-x);const w=c+n*(g-c),b=d+n*(f-d);if(0!==m){const t=w+x/p,i=b-(t-w)/m;this.setPointAt(e,t,i)}else this.setPointAt(e,w,b+x)}return this.setPoint(i,s),!0}OE(t,e,i,s){if(this.isOrthogonal){let n=this.getPoint(t),o=this.getPoint(t+1),r=this.getPoint(t+2),a=o.x,h=o.y;const l=a,u=h;k.c(n.y,o.y)?k.c(o.x,r.x)?h=e.y:k.c(o.y,r.y)&&(a=e.x):k.c(n.x,o.x)&&(k.c(o.y,r.y)?a=e.x:k.c(o.x,r.x)&&(h=e.y)),this.setPointAt(t+1,a,h),n=this.getPoint(i),o=this.getPoint(i-1),r=this.getPoint(i-2);let c=o.x,d=o.y;const g=c,f=d;if(k.c(n.y,o.y)?k.c(o.x,r.x)?d=s.y:k.c(o.y,r.y)&&(c=s.x):k.c(n.x,o.x)&&(k.c(o.y,r.y)?c=s.x:k.c(o.x,r.x)&&(d=s.y)),this.setPointAt(i-1,c,d),this.xT())return this.setPointAt(t+1,l,u),this.setPointAt(i-1,g,f),!1}return this.setPoint(t,e),this.setPoint(i,s),!0}addOrthoPoints(t,e,i,s,n,o){e=k.Ee(e);const r=s=k.Ee(s);e=e>=315||e<45?0:45<=e&&e<135?90:135<=e&&e<225?180:270,s=s>=315||s<45?0:45<=s&&s<135?90:135<=s&&s<225?180:270;const a=t,h=i,l=w.bs(n.actualBounds),u=w.bs(o.actualBounds);l.inflate(be.Fa,be.Fa),u.inflate(be.Fa,be.Fa),l.unionPoint(t),u.unionPoint(i);const c=y.l(),d=y.l();0===e?h.x>a.x||270===s&&h.y<a.y&&u.right>a.x||90===s&&h.y>a.y&&u.right>a.x?(c.e(h.x,a.y),d.e(h.x,(a.y+h.y)/2),180===s?(c.x=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!1),d.x=c.x,d.y=h.y):270===s&&h.y<a.y||90===s&&h.y>a.y?(a.x<u.left?c.x=this.computeMidOrthoPosition(a.x,a.y,u.left,h.y,!1):a.x<u.right&&(270===s&&a.y<u.top||90===s&&a.y>u.bottom)?c.x=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!1):c.x=u.right,d.x=c.x,d.y=h.y):0===s&&a.x<u.left&&a.y>u.top&&a.y<u.bottom&&(c.x=a.x,a.y<h.y?c.y=Math.min(h.y,u.top):c.y=Math.max(h.y,u.bottom),d.y=c.y)):(c.e(a.x,h.y),d.e((a.x+h.x)/2,h.y),(180===s||90===s&&h.y<l.top||270===s&&h.y>l.bottom)&&(180===s&&(u.containsPoint(a)||l.containsPoint(h))?c.y=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!0):h.y<a.y&&(180===s||90===s)?c.y=this.computeMidOrthoPosition(a.x,l.top,h.x,Math.min(h.y,u.bottom),!0):h.y>a.y&&(180===s||270===s)&&(c.y=this.computeMidOrthoPosition(a.x,l.bottom,h.x,Math.max(h.y,u.top),!0)),d.x=h.x,d.y=c.y),c.y>l.top&&c.y<l.bottom&&(h.x>=l.left&&h.x<=a.x||a.x<=u.right&&a.x>=h.x?(90===s||270===s)&&(c.e(Math.max((a.x+h.x)/2,a.x),a.y),d.e(c.x,h.y)):(270===s||(0===s||180===s)&&h.y<a.y?c.y=Math.min(h.y,0===s?l.top:Math.min(l.top,u.top)):c.y=Math.max(h.y,0===s?l.bottom:Math.max(l.bottom,u.bottom)),d.x=h.x,d.y=c.y))):180===e?h.x<a.x||270===s&&h.y<a.y&&u.left<a.x||90===s&&h.y>a.y&&u.left<a.x?(c.e(h.x,a.y),d.e(h.x,(a.y+h.y)/2),0===s?(c.x=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!1),d.x=c.x,d.y=h.y):270===s&&h.y<a.y||90===s&&h.y>a.y?(a.x>u.right?c.x=this.computeMidOrthoPosition(a.x,a.y,u.right,h.y,!1):a.x>u.left&&(270===s&&a.y<u.top||90===s&&a.y>u.bottom)?c.x=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!1):c.x=u.left,d.x=c.x,d.y=h.y):180===s&&a.x>u.right&&a.y>u.top&&a.y<u.bottom&&(c.x=a.x,a.y<h.y?c.y=Math.min(h.y,u.top):c.y=Math.max(h.y,u.bottom),d.y=c.y)):(c.e(a.x,h.y),d.e((a.x+h.x)/2,h.y),(0===s||90===s&&h.y<l.top||270===s&&h.y>l.bottom)&&(0===s&&(u.containsPoint(a)||l.containsPoint(h))?c.y=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!0):h.y<a.y&&(0===s||90===s)?c.y=this.computeMidOrthoPosition(a.x,l.top,h.x,Math.min(h.y,u.bottom),!0):h.y>a.y&&(0===s||270===s)&&(c.y=this.computeMidOrthoPosition(a.x,l.bottom,h.x,Math.max(h.y,u.top),!0)),d.x=h.x,d.y=c.y),c.y>l.top&&c.y<l.bottom&&(h.x<=l.right&&h.x>=a.x||a.x>=u.left&&a.x<=h.x?(90===s||270===s)&&(c.e(Math.min((a.x+h.x)/2,a.x),a.y),d.e(c.x,h.y)):(270===s||(0===s||180===s)&&h.y<a.y?c.y=Math.min(h.y,180===s?l.top:Math.min(l.top,u.top)):c.y=Math.max(h.y,180===s?l.bottom:Math.max(l.bottom,u.bottom)),d.x=h.x,d.y=c.y))):90===e?h.y>a.y||180===s&&h.x<a.x&&u.bottom>a.y||0===s&&h.x>a.x&&u.bottom>a.y?(c.e(a.x,h.y),d.e((a.x+h.x)/2,h.y),270===s?(c.y=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!0),d.x=h.x,d.y=c.y):180===s&&h.x<a.x||0===s&&h.x>a.x?(a.y<u.top?c.y=this.computeMidOrthoPosition(a.x,a.y,h.x,u.top,!0):a.y<u.bottom&&(180===s&&a.x<u.left||0===s&&a.x>u.right)?c.y=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!0):c.y=u.bottom,d.x=h.x,d.y=c.y):90===s&&a.y<u.top&&a.x>u.left&&a.x<u.right&&(a.x<h.x?c.x=Math.min(h.x,u.left):c.x=Math.max(h.x,u.right),c.y=a.y,d.x=c.x)):(c.e(h.x,a.y),d.e(h.x,(a.y+h.y)/2),(270===s||0===s&&h.x<l.left||180===s&&h.x>l.right)&&(270===s&&(u.containsPoint(a)||l.containsPoint(h))?c.x=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!1):h.x<a.x&&(270===s||0===s)?c.x=this.computeMidOrthoPosition(l.left,a.y,Math.min(h.x,u.right),h.y,!1):h.x>a.x&&(270===s||180===s)&&(c.x=this.computeMidOrthoPosition(l.right,a.y,Math.max(h.x,u.left),h.y,!1)),d.x=c.x,d.y=h.y),c.x>l.left&&c.x<l.right&&(h.y>=l.top&&h.y<=a.y||a.y<=u.bottom&&a.y>=h.y?(0===s||180===s)&&(c.e(a.x,Math.max((a.y+h.y)/2,a.y)),d.e(h.x,c.y)):(180===s||(90===s||270===s)&&h.x<a.x?c.x=Math.min(h.x,90===s?l.left:Math.min(l.left,u.left)):c.x=Math.max(h.x,90===s?l.right:Math.max(l.right,u.right)),d.x=c.x,d.y=h.y))):h.y<a.y||180===s&&h.x<a.x&&u.top<a.y||0===s&&h.x>a.x&&u.top<a.y?(c.e(a.x,h.y),d.e((a.x+h.x)/2,h.y),90===s?(c.y=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!0),d.x=h.x,d.y=c.y):180===s&&h.x<a.x||0===s&&h.x>=a.x?(a.y>u.bottom?c.y=this.computeMidOrthoPosition(a.x,a.y,h.x,u.bottom,!0):a.y>u.top&&(180===s&&a.x<u.left||0===s&&a.x>u.right)?c.y=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!0):c.y=u.top,d.x=h.x,d.y=c.y):270===s&&a.y>u.bottom&&a.x>u.left&&a.x<u.right&&(a.x<h.x?c.x=Math.min(h.x,u.left):c.x=Math.max(h.x,u.right),c.y=a.y,d.x=c.x)):(c.e(h.x,a.y),d.e(h.x,(a.y+h.y)/2),(90===s||0===s&&h.x<l.left||180===s&&h.x>l.right)&&(90===s&&(u.containsPoint(a)||l.containsPoint(h))?c.x=this.computeMidOrthoPosition(a.x,a.y,h.x,h.y,!1):h.x<a.x&&(90===s||0===s)?c.x=this.computeMidOrthoPosition(l.left,a.y,Math.min(h.x,u.right),h.y,!1):h.x>a.x&&(90===s||180===s)&&(c.x=this.computeMidOrthoPosition(l.right,a.y,Math.max(h.x,u.left),h.y,!1)),d.x=c.x,d.y=h.y),c.x>l.left&&c.x<l.right&&(h.y<=l.bottom&&h.y>=a.y||a.y>=u.top&&a.y<=h.y?(0===s||180===s)&&(c.e(a.x,Math.min((a.y+h.y)/2,a.y)),d.e(h.x,c.y)):(180===s||(90===s||270===s)&&h.x<a.x?c.x=Math.min(h.x,270===s?l.left:Math.min(l.left,u.left)):c.x=Math.max(h.x,270===s?l.right:Math.max(l.right,u.right)),d.x=c.x,d.y=h.y))),this.vC=s!==r,this.SC=e,this.MC=s,this.addPoint(c.copy()),this.addPoint(d.copy()),y.i(c),y.i(d),w.i(l),w.i(u)}computeMidOrthoPosition(t,e,i,s,n){let o=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(o=this.computeCurviness()),n?(e+s)/2+o:(t+i)/2+o}xT(){if(null===this.diagram||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,e=t.length;if(e<4)return!1;const i=this.diagram.getPositions(!1,this.containingGroup,null);for(let s=1;s<e-2;s++){const e=t[s],n=t[s+1];if(!i.isUnoccupied(Math.min(e.x,n.x),Math.min(e.y,n.y),Math.abs(e.x-n.x),Math.abs(e.y-n.y)))return!0}return!1}findClosestSegment(t){const e=t.x,i=t.y;let s=this.getPoint(0),n=this.getPoint(1),o=y.distanceLineSegmentSquared(e,i,s.x,s.y,n.x,n.y),r=0;for(let t=1;t<this.pointsCount-1;t++){s=this.getPoint(t+1);const a=y.distanceLineSegmentSquared(e,i,n.x,n.y,s.x,s.y);n=s,a<o&&(r=t,o=a)}return r}invalidateGeometry(){this.ai()}ai(){this.Ra&&(this.Ra=!1,this.f())}get Ra(){return!!(128&this.Mt)}set Ra(t){!!(128&this.Mt)!==t&&(this.Mt=128^this.Mt)}get geometry(){if(!this.Ra){if(this.updateRoute(),this.pointsCount<2)return this.Ra=!0,this.ut;this.ut=this.makeGeometry(),this.Ra=!0}return this.ut}Td(t){if(!t){if(!1===this.Fi)return;const t=this.findMainElement();if(this.Ra&&(null===t||null!==t.geometry))return}this.pointsCount>=2&&(this.ut=this.makeGeometry()),this.Ra=!0;const e=this.path;if(null===e)return;e.ut=this.ut;const i=this.D.r,s=i.length;for(let t=0;t<s;t++){const s=i[t];s!==e&&s.isPanelMain&&s instanceof $t&&(s.ut=this.ut)}}IE(t){return this.Qh()&&t.ra.has(this)&&(0!==this.xl.width||0!==this.xl.height)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ut,e=this.pointsCount;let i=!1;const s=this.diagram;null!==s&&this.IE(s)&&(i=!0);let n=0,o=0,r=y.bs(this.getPoint(0));const a=y.bs(r),h=this.Me.r,l=this.computeCurve();if(9===l&&e>=3&&!k.X(this.smoothness,0))if(3===e){let t=this.getPoint(1);n=Math.min(r.x,t.x),o=Math.min(r.y,t.y),t=this.getPoint(2),n=Math.min(n,t.x),o=Math.min(o,t.y)}else if(this.isOrthogonal){for(let t=0;t<e;t++){const e=h[t];a.x=Math.min(e.x,a.x),a.y=Math.min(e.y,a.y)}n=a.x,o=a.y}else{for(let t=3;t<e;t+=3){t+3>=e&&(t=e-1);const i=this.getPoint(t);a.x=Math.min(i.x,a.x),a.y=Math.min(i.y,a.y)}n=a.x,o=a.y}else{for(let t=0;t<e;t++){const e=h[t];a.x=Math.min(e.x,a.x),a.y=Math.min(e.y,a.y)}n=a.x,o=a.y}if(n-=this.gk.x,o-=this.gk.y,r.x-=n,r.y-=o,0!==this.computeShortLength(!0)&&(r=this.tc(r,!0,a)),2!==e||this.Qh()){t.type=4;const s=le.JL(t);if(s.Lu(r.x,r.y,!1,!1),9===l&&e>=3&&!k.X(this.smoothness,0))if(3===e){const t=this.getPoint(1),e=t.x-n,i=t.y-o,r=y.bs(this.getPoint(2));r.x-=n,r.y-=o,0!==this.computeShortLength(!1)&&this.tc(r,!1,a),s.wr(e,i,e,i,r.x,r.y),y.i(r)}else if(this.isOrthogonal){const t=y.z(n,o),e=y.bs(this.getPoint(1)),i=y.z(n,o),r=y.z(n,o);let a,h=this.getPoint(0);const l=this.smoothness/3;for(let u=1;u<this.pointsCount-1;u++){a=this.getPoint(u);const c=h,d=a,g=this.getPoint(this.EC(a,u,!1));k.X(c.x,d.x)&&k.X(d.x,g.x)||k.X(c.y,d.y)&&k.X(d.y,g.y)||(this.EE(c,d,g,l,i,r),(1===u||2===u&&k.X(h.x,this.getPoint(0).x)&&k.X(h.y,this.getPoint(0).y))&&(e.x=.5*(h.x+a.x),e.y=.5*(h.y+a.y)),s.wr(e.x-n,e.y-o,i.x-n,i.y-o,a.x-n,a.y-o),t.h(i),e.h(r),h=a)}let u=h.x,c=h.y;const d=y.bs(this.getPoint(this.pointsCount-1));0!==this.computeShortLength(!1)&&this.tc(d,!1,y.dn),u=.5*(u+d.x),c=.5*(c+d.y),s.wr(r.x-n,r.y-o,u-n,c-o,d.x-n,d.y-o),y.i(d),y.i(t),y.i(e),y.i(i),y.i(r)}else for(let t=3;t<e;t+=3){const i=this.getPoint(t-2);t+3>=e&&(t=e-1);const r=this.getPoint(t-1),a=y.bs(this.getPoint(t));t===e-1&&0!==this.computeShortLength(!1)&&this.tc(a,!1,y.dn),s.wr(i.x-n,i.y-o,r.x-n,r.y-o,a.x-n,a.y-o),y.i(a)}else if(this.isOrthogonal||2===e){const t=y.bs(this.getPoint(0)),r=y.l(),a=y.bs(t),h=this.computeCorner();let l=1,u=0;for(;l<e;){if(l=this.EC(t,l,l>1),r.h(this.getPoint(l)),l>=e-1){if(t.equals(r)){if(0===u)for(l=1;l<e;)a.h(t),r.h(this.getPoint(l++)),this.Rn(s,-n,-o,t,r,i),t.h(r)}else 0!==this.computeShortLength(!1)&&this.tc(r,!1,y.dn),this.Rn(s,-n,-o,t,r,i);break}u=this.EC(r,l+1,l<e-3);const c=this.getPoint(u);this.UE(s,-n,-o,t,r,c,t,a,h,i),a.h(r),l=u}y.i(t),y.i(r),y.i(a)}else{const t=this.computeCorner();if(e>2&&t>=.5){const i=y.bs(h[e-1]);0!==this.computeShortLength(!1)&&this.tc(i,!1,y.dn),r.x+=n,r.y+=o;for(let a=1;a<e;a++){const l=1===a?r:h[a-1],u=a===e-1?i:h[a],c=t/Math.sqrt(l.distanceSquaredPoint(u));if(c<.5){if(a>1){const t=l.x+(u.x-l.x)*c,e=l.y+(u.y-l.y)*c;s.Au(l.x-n,l.y-o,t-n,e-o)}s.Ys(u.x+(l.x-u.x)*c-n,u.y+(l.y-u.y)*c-o)}else a>1&&s.Au(l.x-n,l.y-o,(l.x+u.x)/2-n,(l.y+u.y)/2-o);a===e-1&&s.Ys(i.x-n,i.y-o)}y.i(i)}else if(e>=2){const t=y.bs(h[e-1]);0!==this.computeShortLength(!1)&&this.tc(t,!1,y.dn);for(let t=1;t<e-1;t++)s.Ys(h[t].x-n,h[t].y-o);s.Ys(t.x-n,t.y-o),y.i(t)}}return le.$L(s),y.i(r),y.i(a),t}{let e=y.bs(this.getPoint(1));return e.x-=n,e.y-=o,0!==this.computeShortLength(!1)&&(e=this.tc(e,!1,a)),t.type=1,t.startX=r.x,t.startY=r.y,t.endX=e.x,t.endY=e.y,y.i(e),y.i(r),y.i(a),t}}kk(t,e,i,s){let n=i-t;if(isNaN(n)||n===1/0||n===-1/0)return NaN;n<0&&(n=-n);let o=s-e;return isNaN(o)||o===1/0||o===-1/0?NaN:(o<0&&(o=-o),k.X(n,0)?o:k.X(o,0)?n:Math.sqrt(n*n+o*o))}EE(t,e,i,s,n,o){isNaN(s)&&(s=this.smoothness/3);const r=t.x,a=t.y,h=e.x,l=e.y,u=i.x,c=i.y,d=s*this.kk(r,a,h,l),g=s*this.kk(h,l,u,c);if(k.X(a,l)&&k.X(h,u)&&(h>r?c>l?(n.x=h-d,n.y=l-d,o.x=h+g,o.y=l+g):(n.x=h-d,n.y=l+d,o.x=h+g,o.y=l-g):c>l?(n.x=h+d,n.y=l-d,o.x=h-g,o.y=l+g):(n.x=h+d,n.y=l+d,o.x=h-g,o.y=l-g)),k.X(r,h)&&k.X(l,c)&&(l>a?u>h?(n.x=h-d,n.y=l-d,o.x=h+g,o.y=l+g):(n.x=h+d,n.y=l-d,o.x=h-g,o.y=l+g):u>h?(n.x=h-d,n.y=l+d,o.x=h+g,o.y=l-g):(n.x=h+d,n.y=l+d,o.x=h-g,o.y=l-g)),k.X(r,h)&&k.X(h,u)||k.X(a,l)&&k.X(l,c)){const t=.5*(r+u),e=.5*(a+c);n.x=t,n.y=e,o.x=t,o.y=e}}tc(t,e,i){const s=this.pointsCount;if(s<2)return t;if(e){const e=this.getPoint(1),n=e.x-i.x,o=e.y-i.y,r=this.kk(t.x,t.y,n,o);if(0===r)return t;const a=2===s?.5*r:r;let h=this.computeShortLength(!0);h>a&&(h=a);const l=h*(n-t.x)/r,u=h*(o-t.y)/r;t.x+=l,t.y+=u}else{const e=this.getPoint(s-2),n=e.x-i.x,o=e.y-i.y,r=this.kk(t.x,t.y,n,o);if(0===r)return t;const a=2===s?.5*r:r;let h=this.computeShortLength(!1);h>a&&(h=a);const l=h*(t.x-n)/r,u=h*(t.y-o)/r;t.x-=l,t.y-=u}return t}EC(t,e,i){const s=this.pointsCount;let n=t;for(;k.X(t.x,n.x)&&k.X(t.y,n.y);){if(e>=s)return s-1;n=this.getPoint(e++)}if(!k.X(t.x,n.x)&&!k.X(t.y,n.y))return e-1;let o=n;for(;k.X(t.x,n.x)&&k.X(n.x,o.x)&&(!i||(t.y>=n.y?n.y>=o.y:n.y<=o.y))||k.X(t.y,n.y)&&k.X(n.y,o.y)&&(!i||(t.x>=n.x?n.x>=o.x:n.x<=o.x));){if(e>=s)return s-1;o=this.getPoint(e++)}return e-2}UE(t,e,i,s,n,o,r,a,h,l){if(k.c(s.y,n.y)&&k.c(n.x,o.x)){let u=Math.min(h,Math.abs(n.x-a.x)/2);const c=Math.min(u,Math.abs(o.y-n.y)/2);if(u=c,k.c(u,0))return this.Rn(t,e,i,s,n,l),void r.h(n);let d=n.x;const g=n.y,f=d;let m=g;n.x>s.x?(d=n.x-u,m=o.y>n.y?n.y+c:n.y-c):(d=n.x+u,m=o.y>n.y?n.y+c:n.y-c);const p=y.z(d,g);this.Rn(t,e,i,s,p,l),y.i(p),t.Au(n.x+e,n.y+i,f+e,m+i),r.e(f,m)}else if(k.c(s.x,n.x)&&k.c(n.y,o.y)){let u=Math.min(h,Math.abs(n.y-a.y)/2);const c=Math.min(u,Math.abs(o.x-n.x)/2);if(u=c,k.c(c,0))return this.Rn(t,e,i,s,n,l),void r.h(n);const d=n.x;let g=n.y,f=d;const m=g;n.y>s.y?(g=n.y-u,f=o.x>n.x?n.x+c:n.x-c):(g=n.y+u,f=o.x>n.x?n.x+c:n.x-c);const p=y.z(d,g);this.Rn(t,e,i,s,p,l),y.i(p),t.Au(n.x+e,n.y+i,f+e,m+i),r.e(f,m)}else this.Rn(t,e,i,s,n,l),r.h(n)}Rn(t,e,i,s,n,o){if(o||!this.Qh())t.Ys(n.x+e,n.y+i);else{const o=be.rv,r=o/2,a=[];let h=0;this.isVisible()&&(h=this.VE(s,n,a));let l=s.x,u=s.y;if(h>0)if(k.c(s.y,n.y))if(s.x<n.x){let c=0;for(;c<h;){const d=Math.max(s.x,Math.min(a[c++]-r,n.x-o));t.Ys(d+e,n.y+i),l=d+e,u=n.y+i;let g=Math.min(d+o,n.x);for(;c<h;){const t=a[c];if(!(t<g+o))break;c++,g=Math.min(t+r,n.x)}const f=n.y-o+i,m=g+e,p=n.y+i;10===this.curve?t.Lu(m,p,!1,!1):t.wr(l,f,m,f,m,p),l=m,u=p}}else{let c=h-1;for(;c>=0;){const h=Math.min(s.x,Math.max(a[c--]+r,n.x+o));t.Ys(h+e,n.y+i),l=h+e,u=n.y+i;let d=Math.max(h-o,n.x);for(;c>=0;){const t=a[c];if(!(t>d-o))break;c--,d=Math.max(t-r,n.x)}const g=n.y-o+i,f=d+e,m=n.y+i;10===this.curve?t.Lu(f,m,!1,!1):t.wr(l,g,f,g,f,m),l=f,u=m}}else if(k.c(s.x,n.x))if(s.y<n.y){let c=0;for(;c<h;){const d=Math.max(s.y,Math.min(a[c++]-r,n.y-o));t.Ys(n.x+e,d+i),l=n.x+e,u=d+i;let g=Math.min(d+o,n.y);for(;c<h;){const t=a[c];if(!(t<g+o))break;c++,g=Math.min(t+r,n.y)}const f=n.x-o+e,m=n.x+e,p=g+i;10===this.curve?t.Lu(m,p,!1,!1):t.wr(f,u,f,p,m,p),l=m,u=p}}else{let c=h-1;for(;c>=0;){const h=Math.min(s.y,Math.max(a[c--]+r,n.y+o));t.Ys(n.x+e,h+i),l=n.x+e,u=h+i;let d=Math.max(h-o,n.y);for(;c>=0;){const t=a[c];if(!(t>d-o))break;c--,d=Math.max(t-r,n.y)}const g=n.x-o+e,f=n.x+e,m=d+i;10===this.curve?t.Lu(f,m,!1,!1):t.wr(g,u,g,m,f,m),l=f,u=m}}t.Ys(n.x+e,n.y+i)}}VE(t,e,i){const s=this.diagram;if(null===s||t.equals(e))return 0;const n=s.layers;for(;n.next();){const s=n.value;if(null!==s&&s.visible){const n=s.UM(),o=n.length;for(let s=0;s<o;s++){const o=n[s];if(!(o instanceof be))continue;if(o===this)return i.length>0&&i.sort(((t,e)=>t-e)),i.length;if(!o.isVisible()||!o.Qh())continue;const r=o.routeBounds;if(!r.isReal()||!this.routeBounds.intersectsRect(r)||this.usesSamePort(o))continue;const a=o.path;null!==a&&a.isVisibleObject()&&this.BE(t,e,i,o)}}}return i.length>0&&i.sort(((t,e)=>t-e)),i.length}BE(t,e,i,s){const n=k.c(t.y,e.y),o=s.pointsCount;let r=s.getPoint(0);const a=y.l();for(let h=1;h<o;h++){const l=s.getPoint(h);if(h<o-1){const t=s.getPoint(h+1);if(r.y===l.y&&l.y===t.y){if(l.x>r.x&&t.x>=l.x||l.x<r.x&&t.x<=l.x)continue}else if(r.x===l.x&&l.x===t.x&&(l.y>r.y&&t.y>=l.y||l.y<r.y&&t.y<=l.y))continue}this.zE(t,e,r,l,a)&&(n?i.push(a.x):i.push(a.y)),r=l}y.i(a)}zE(t,e,i,s,n){const o=t.x,r=t.y,a=e.x,h=e.y,l=i.x,u=i.y,c=s.x,d=s.y;if(k.c(o,a)){if(!k.c(r,h)&&k.c(u,d)&&Math.min(r,h)<u&&Math.max(r,h)>u&&Math.min(l,c)<o&&Math.max(l,c)>o&&!k.c(l,c))return n.x=o,n.y=u,!0}else if(k.c(r,h)&&k.c(l,c)&&Math.min(o,a)<l&&Math.max(o,a)>l&&Math.min(u,d)<r&&Math.max(u,d)>r&&!k.c(u,d))return n.x=l,n.y=r,!0;return n.x=0,n.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.bl(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return 0===t?0:t<=2?t-1:this.isOrthogonal||!this.bl(this.computeSpot(!1))?t-2:t-1}Qh(){const t=this.curve;return 11===t||10===t}yk(t){if(t||this.Qh()){const t=this.diagram;null!==t&&!t.animationManager.isTicking&&!t.ra.has(this)&&(0!==this.xl.width||0!==this.xl.height)&&t.ra.set(this,this.xl.copy())}}invalidateOtherJumpOvers(t){const e=this.layer;if(null===e||!e.visible||e.isTemporary)return;const i=e.diagram;if(null===i||i.animationManager.isTicking)return;let s=!1;const n=i.layers;for(;n.next();){const i=n.value;if(i.visible)if(i===e){s=!0;let e=!1;const n=i.UM(),o=n.length;for(let i=0;i<o;i++){const s=n[i];s instanceof be&&(s===this?e=!0:e&&this.yv(s,t))}}else if(s){const e=i.UM(),s=e.length;for(let i=0;i<s;i++){const s=e[i];s instanceof be&&this.yv(s,t)}}}}yv(t,e){if(null===t||!t.Ra||!t.Fi||!t.Qh())return;const i=t.routeBounds;i.isReal()&&(!this.routeBounds.intersectsRect(i)&&!e.intersectsRect(i)||this.usesSamePort(t)||t.ai())}usesSamePort(t){const e=this.pointsCount,i=t.pointsCount;if(e>0&&i>0){const s=this.getPoint(0),n=t.getPoint(0);if(s.equalsApprox(n))return!0;const o=this.getPoint(e-1),r=t.getPoint(i-1);if(o.equalsApprox(r)||s.equalsApprox(r)||o.equalsApprox(n))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let e=!0;const i=this.diagram;null!==i&&(e=i.isTreePathToChildren);const s=this.fromNode;if(null!==s){if(this.isTreeLink&&e&&!s.isTreeExpanded)return!1;if(s===t)return!0;let i=s;for(;null!==i;){if(i.labeledLink===this)return!0;i=i.containingGroup}const n=s.findVisibleNode();if(null===n||n===t)return!1}const n=this.toNode;if(null!==n){if(this.isTreeLink&&!e&&!n.isTreeExpanded)return!1;if(n===t)return!0;let i=n;for(;null!==i;){if(i.labeledLink===this)return!0;i=i.containingGroup}const s=n.findVisibleNode();if(null===s||s===t)return!1}return!0}Xe(t){if(super.Xe(t),t&&this.yk(!1),null!==this.ir&&this.ir.Jd(),null!==this.nn){const e=this.nn.iterator;for(;e.next();)e.value.Xe(t)}}get adjusting(){return this.Xf}set adjusting(t){const e=this.Xf;e!==t&&(this.Xf=t,this.t("adjusting",e,t))}computeAdjusting(){return this.isAvoiding&&null!==this.diagram&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Xf}get corner(){return this.Qd}set corner(t){const e=this.Qd;e!==t&&(this.Qd=t,this.ai(),this.t("corner",e,t))}get curve(){return this._d}set curve(t){const e=this._d;e!==t&&(this._d=t,(9===e||9===t)&&this.DC(this.xl),this.$t(),this.ai(),this.yk(10===e||11===e||10===t||11===t),this.t("curve",e,t))}get curviness(){return this.tg}set curviness(t){const e=this.tg;e!==t&&(this.tg=t,this.$t(),this.ai(),this.t("curviness",e,t))}get routing(){return this.Wh}set routing(t){const e=this.Wh;e!==t&&(this.Wh=t,this.isAvoiding&&null!==this.diagram&&(this.diagram.lp=!0),this.er=null,this.$t(),this.yk(be.NC(e)||be.NC(t)),this.t("routing",e,t))}get smoothness(){return this.eg}set smoothness(t){const e=this.eg;e!==t&&(this.eg=t,this.ai(),this.t("smoothness",e,t))}Qy(){const t=this.mo;if(null===t)return;const e=this.yo;if(null===e||!isNaN(this.curviness))return;const i=this.po,s=this.wo;let n=null,o=null;const r=t.ee.r,a=r.length;for(let h=0;h<a;h++){const a=r[h];(a.mo!==t||a.po!==i||a.yo!==e||a.wo!==s)&&(a.mo!==e||a.po!==s||a.yo!==t||a.wo!==i)||(null===o?o=a:(null===n&&(n=[],n.push(o)),n.push(a)))}if(null!==n){let o=t.qD(e,i,s);null===o&&(o=new ve(t,i,e,s),t.KD(o),e.KD(o)),o.on=n;for(let t=0;t<n.length;t++){n[t].ir=o}o.Jd()}}Zy(){const t=this.ir;if(null!==t){if(!isNaN(this.curviness))return;this.ir=null;const e=t.on.indexOf(this);e>=0&&(t.on.splice(e,1),t.Jd())}}Lr(){return!0}get key(){const t=this.diagram;if(null!==t&&t.model.jh())return t.model.getKeyForLinkData(this.data)}}class ve{Yo;qs;Gy;yC;fk;wC;on;constructor(t,e,i,s){u.Je(this),this.Yo=!1,this.qs=!1,this.Gy=t,this.yC=e,this.fk=i,this.wC=s,this.on=[]}Jd(){if(!this.Yo){const t=this.on;if(t.length>0){const e=t[0].diagram;null!==e&&(e.l2.add(this),this.qs=e.undoManager.isUndoingRedoing)}}this.Yo=!0}S2(){if(this.Yo){this.Yo=!1;const t=this.on;if(t.length>0){const e=t[0],i=e.diagram,s=null===i||i.Qa&&!this.qs;this.qs=!1,e.arrangeBundledLinks(t,s),1===t.length&&(e.ir=null,t.length=0)}0===t.length&&(this.Gy.HD(this),this.fk.HD(this))}}}class Pe{ui;di;ec;ic;we;xe;Bt;Oa;Ia;Ah;E2;Yo;tw;af;U2;V2;constructor(t){u.Je(this),this.Ah=null,this.E2=null,this.Yo=!0,this.tw=!1,this.ui=1,this.di=1,this.ec=-1,this.ic=-1,this.we=t.width,this.xe=t.height,this.Bt=[],this.Oa=0,this.Ia=0,this.af=be.dv,this.U2=2*this.af,this.V2=2*this.af}static rn=0;static sc=1;static sg=999999;static UC=Pe.sg+1;static VC=Pe.sg+2;f1(t){if(t.width<=0||t.height<=0)return;const e=t.x,i=t.y,s=t.x+t.width,n=t.y+t.height;this.ui=Math.floor((e-this.we)/this.we)*this.we,this.di=Math.floor((i-this.xe)/this.xe)*this.xe,this.ec=Math.ceil((s+2*this.we)/this.we)*this.we,this.ic=Math.ceil((n+2*this.xe)/this.xe)*this.xe;const o=1+(0|Math.ceil((this.ec-this.ui)/this.we)),r=1+(0|Math.ceil((this.ic-this.di)/this.xe));if(0===this.Bt.length||this.Oa<o-1||this.Ia<r-1){const t=[];for(let e=0;e<=o;e++)t[e]=new Uint32Array(r);this.Bt=t,this.Oa=o-1,this.Ia=r-1}this.XE(Pe.UC)}get bounds(){return new w(this.ui,this.di,this.ec-this.ui,this.ic-this.di)}get cellWidth(){return this.we}set cellWidth(t){t>0&&t!==this.we&&(this.we=t,this.f1(this.bounds))}get cellHeight(){return this.xe}set cellHeight(t){t>0&&t!==this.xe&&(this.xe=t,this.f1(this.bounds))}ng(t,e){return this.ui<=t&&t<=this.ec&&this.di<=e&&e<=this.ic}xo(t,e){if(!this.ng(t,e))return Pe.UC;t-=this.ui,t/=this.we,e-=this.di;const i=0|t,s=0|(e/=this.xe);return this.Bt[i][s]}FO(t,e,i,s){if(!this.ng(t,e))return;const n=(t-this.ui)/this.we|0,o=(e-this.di)/this.xe|0,r=(t+i-this.ui)/this.we|0,a=(e+s-this.di)/this.xe|0,h=Math.min(r,this.Oa),l=Math.min(a,this.Ia);for(let t=n;t<=h;t++){const e=this.Bt[t];if(e.fill)e.fill(Pe.rn,o,l+1);else for(let t=o;t<=l;t++)e[t]=Pe.rn}}XE(t){for(let e=0;e<=this.Oa;e++){const i=this.Bt[e];if(i.fill)i.fill(t);else for(let e=0;e<=this.Ia;e++)i[e]=t}}vT(){for(let t=0;t<=this.Oa;t++){const e=this.Bt[t];for(let t=0;t<=this.Ia;t++)e[t]>=Pe.sc&&(e[t]=Pe.UC)}}GE(t,e){return this.xo(t,e)===Pe.rn}isUnoccupied(t,e,i,s){if(t>this.ec||t+i<this.ui||e>this.ic||e+s<this.di)return!0;let n=(t-this.ui)/this.we|0,o=(e-this.di)/this.xe|0,r=Math.max(0,i)/this.we+1|0,a=Math.max(0,s)/this.xe+1|0;if(n<0&&(r+=n,n=0),o<0&&(a+=o,o=0),r<0||a<0)return!0;const h=0|Math.min(n+r-1,this.Oa),l=0|Math.min(o+a-1,this.Ia);for(let t=n;t<=h;t++){const e=this.Bt[t];for(let t=o;t<=l;t++)if(e[t]===Pe.rn)return!1}return!0}maxAvoidsLinksSpaceH(t,e,i,s){if(t>this.ec||e<this.ui||i>this.ic||i<this.di)return 0;const n=(t-this.ui)/this.we|0,o=(e-this.ui)/this.we|0,r=(i-this.di)/this.xe|0,a=s/this.xe+1|0;let h;for(h=0;h<a/2;h++){let t=!1;for(let e=n;e<=o;e++)if(this.Bt[e][r+h]===Pe.rn||this.Bt[e][r-h]===Pe.rn){t=!0;break}if(t)return Math.max(0,(2*h-1)*this.xe)}return s}maxAvoidsLinksSpaceV(t,e,i,s){if(t>this.ic||e<this.di||i>this.ec||i<this.ui)return 0;const n=(t-this.di)/this.xe|0,o=(e-this.di)/this.xe|0,r=(i-this.ui)/this.we|0,a=s/this.we+1|0;let h;for(h=0;h<a/2;h++){let t=!1;for(let e=n;e<=o;e++)if(this.Bt[r+h][e]===Pe.rn||this.Bt[r-h][e]===Pe.rn){t=!0;break}if(t)return Math.max(0,(2*h-1)*this.we)}return s}YE(t,e,i,s,n,o,r,a){t|=0,e|=0;let h=this.Bt[t][e];if(h>=Pe.sc&&h<Pe.sg)for(s?e+=i:t+=i,h+=1;n<=t&&t<=o&&r<=e&&e<=a;){if(h>=this.Bt[t][e])break;this.Bt[t][e]=h,h+=1,s?e+=i:t+=i}return s?e:t}bo(t,e,i,s,n,o,r,a){if(t<n||t>o||e<r||e>a)return;const h=this.YE(t,e,i,s,n,o,r,a);if(s)if(i>0)for(let l=e+i;l<h;l+=i)this.bo(t,l,1,!s,n,o,r,a),this.bo(t,l,-1,!s,n,o,r,a);else for(let l=e+i;l>h;l+=i)this.bo(t,l,1,!s,n,o,r,a),this.bo(t,l,-1,!s,n,o,r,a);else if(i>0)for(let l=t+i;l<h;l+=i)this.bo(l,e,1,!s,n,o,r,a),this.bo(l,e,-1,!s,n,o,r,a);else for(let l=t+i;l>h;l+=i)this.bo(l,e,1,!s,n,o,r,a),this.bo(l,e,-1,!s,n,o,r,a)}Pk(t,e,i,s,n,o,r,a,h,l){let u=0|t,c=0|e,d=Pe.rn,g=Pe.sc;for(this.Bt[u][c]=g;d===Pe.rn&&u>r&&u<a&&c>h&&c<l;)g+=1,this.Bt[u][c]=g,o?c+=n:u+=n,d=this.Bt[u][c];return o?c:u}Sk(t,e,i,s,n,o,r,a,h,l){let u=0|i,c=0|s,d=Pe.rn;const g=Pe.sg;for(this.Bt[u][c]=g;d===Pe.rn&&u>r&&u<a&&c>h&&c<l;)this.Bt[u][c]=g,o?c+=n:u+=n,d=this.Bt[u][c]}wv(t,i,s,n,o,r){this.tw=!1;let a=t.x,h=t.y;if(!this.ng(a,h))return;a-=this.ui,a/=this.we,h-=this.di,h/=this.xe;let l=s.x,u=s.y;if(!this.ng(l,u))return;if(l-=this.ui,l/=this.we,u-=this.di,u/=this.xe,Math.abs(a-l)<=1&&Math.abs(h-u)<=1)return void(this.tw=!0);let c=o.x,d=o.y,g=o.x+o.width,f=o.y+o.height;c-=this.ui,c/=this.we,d-=this.di,d/=this.xe,g-=this.ui,g/=this.we,f-=this.di,f/=this.xe;const m=Math.max(0,Math.min(this.Oa,0|c)),p=Math.min(this.Oa,Math.max(0,0|g)),y=Math.max(0,Math.min(this.Ia,0|d)),x=Math.min(this.Ia,Math.max(0,0|f)),w=90,b=270,v=this.Bt,P=0|a,k=0|h,S=0|l,M=0|u,C=0===i||i===w?1:-1,N=i===w||i===b;v[P][k]===Pe.rn?(this.Pk(P,k,S,M,C,N,m,p,y,x),this.Pk(P,k,S,M,1,!N,m,p,y,x),this.Pk(P,k,S,M,-1,!N,m,p,y,x)):this.Pk(P,k,S,M,C,N,P,k,P,k),v[S][M]===Pe.rn?(this.Sk(P,k,S,M,0===n||n===w?1:-1,n===w||n===b,m,p,y,x),this.Sk(P,k,S,M,1,!(n===w||n===b),m,p,y,x),this.Sk(P,k,S,M,-1,!(n===w||n===b),m,p,y,x)):this.Sk(P,k,S,M,C,N,S,M,S,M);const T=e.nt();if(r&&this.xv(S,M,n,P,k,T)){(T[0]!==S||T[1]!==M)&&(T.unshift(M),T.unshift(S)),(T[T.length-2]!==P||T[T.length-1]!==k)&&(T.push(P),T.push(k));let t=Pe.sc,e=T[T.length-2],i=T[T.length-1];v[e][i]=t++;for(let s=T.length-4;s>=0;s-=2){e=T[s+2],i=T[s+3];const n=T[s],o=T[s+1];for(;n>e?e++:n<e?e--:o>i?i++:o<i&&i--,v[e][i]=t++,e!==n||i!==o;);}}else this.bo(P,k,1,!1,m,p,y,x),this.bo(P,k,-1,!1,m,p,y,x),this.bo(P,k,1,!0,m,p,y,x),this.bo(P,k,-1,!0,m,p,y,x);e.Z(T)}xv(t,e,i,s,n,o){const r=this.Bt;let a=t,h=e;for(;;){if(a===s&&h===n)return!0;let t=a,e=h;if(0===i){if(!(t<s))break;t++}else if(90===i){if(!(e<n))break;e++}else if(180===i){if(!(t>s))break;t--}else{if(!(e>n))break;e--}const o=r[t][e];if(0===o||o===Pe.VC)break;a=t,h=e}for(;;){let l=i,u=a,c=h;0===i?c<n?(l=90,c++):c>n&&(l=270,c--):90===i?u<s?(l=0,u++):u>s&&(l=180,u--):180===i?c<n?(l=90,c++):c>n&&(l=270,c--):u<s?(l=0,u++):u>s&&(l=180,u--);const d=r[u][c];if(l!==i&&0!==d&&d!==Pe.VC){if(o.push(a),o.push(h),this.xv(a,h,l,s,n,o))return!0;o.pop(),o.pop()}if(r[a][h]=Pe.VC,0===i){if(a===t)return!1;a--}else if(90===i){if(h===e)return!1;h--}else if(180===i){if(a===t)return!1;a++}else{if(h===e)return!1;h++}}}}class ke{Ri;kl;Ei;og;constructor(t,e){u.Je(this),this.Ri=t,this.kl=e,this.Ei=[],this.og=!1}toString(){const t=this.Ei;let e=this.Ri.toString()+" "+t.length.toString()+":";for(let i=0;i<t.length;i++){const s=t[i];null!==s&&(e+="\n  "+s.toString())}return e}KE(t,e,i,s){const n=e.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=i;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const r=180*Math.atan2(t.height,t.width)/Math.PI;switch(n){case 3:return o>r&&o<=180+r?180:270;case 5:return o>180-r&&o<=360-r?270:0;case 12:return o>r&&o<=180+r?90:0;case 10:return o>180-r&&o<=360-r?180:90;case 7:return o>90&&o<=180+r?180:o>180+r&&o<=360-r?270:0;case 13:return o>180&&o<=360-r?270:o>r&&o<=180?90:0;case 14:return o>r&&o<=180-r?90:o>180-r&&o<=270?180:0;case 11:return o>180-r&&o<=180+r?180:o>180+r?270:90}return s&&15!==n&&(o-=15,o<0&&(o+=360)),o>r&&o<180-r?90:o>=180-r&&o<=180+r?180:o>180+r&&o<360-r?270:0}Jd(){this.Ei.length=0}gv(t){let e=this.Ei;0===e.length&&(this.HE(),e=this.Ei);for(let i=0;i<e.length;i++){const s=e[i];if(null!==s&&s.ts===t)return s}return null}HE(){if(!this.og){const t=this.og;this.og=!0;let e,i=null;const s=this.Ri,n=s instanceof Ne?s:null;if(null===n||n.isSubGraphExpanded)e=s.isTreeExpanded?s.findLinksConnected(this.kl.portId):s.findExternalTreeLinksConnected();else{if(!n.actualBounds.isReal())return this.og=t,this.Ei;i=n,e=i.findExternalLinksConnected()}this.Ei.length=0;let o=0;const r=this.kl.getDocumentPoint(v.TopLeft,y.l()),a=this.kl.getDocumentPoint(v.BottomRight,y.l()),h=w.z(r.x,r.y,0,0);h.unionPoint(a),y.i(r),y.i(a);const l=y.z(h.x+h.width/2,h.y+h.height/2),u=this.kl.getDocumentAngle(),c=e.iterator;for(;c.next();){const t=c.value;if(!t.isVisible()||t.fromPort===t.toPort)continue;const e=t.fromPort===this.kl||null!==i&&null!==t.fromNode&&t.fromNode.isMemberOf(i),s=t.computeSpot(e,this.kl);if(!s.isSide())continue;let n;if(n=e?t.toPort:t.fromPort,null===n)continue;let r=n.part;if(null===r)continue;const a=r.findVisibleNode();null!==a&&a!==r&&(r=a,n=r.port);const d=t.computeOtherPoint(r,n);let g=l.directionPoint(d);0!==u&&(g=k.Ee(g-u));const f=this.KE(h,s,g,t.isOrthogonal);let m=0;0===f?(m=4,g>180&&(g-=360)):90===f?(m=8,g>270&&(g-=360)):180===f?m=2:(m=1,g<90&&(g+=360));let p=this.Ei[o];void 0===p?(p=new Se(t,g,m),this.Ei[o]=p):(p.ts=t,p.Xt=g,p.fi=m),p.Mk.h(d),o++}y.i(l),this.qE();const d=this.Ei.length;let g=-1,f=0;for(o=0;o<d;o++){const t=this.Ei[o];void 0!==t&&(t.fi!==g&&(g=t.fi,f=0),t.rg=f,f++)}for(g=-1,f=0,o=d-1;o>=0;o--){const t=this.Ei[o];void 0!==t&&(t.fi!==g&&(g=t.fi,f=t.rg+1),t.Yf=f)}this.jE(this.Ei),this.WE(this.Ei),this.og=t,w.i(h)}return this.Ei}JE(t,e){return t===e?0:null===t?-1:null===e?1:t.fi<e.fi?-1:t.fi>e.fi?1:t.Xt<e.Xt?-1:t.Xt>e.Xt?1:0}qE(){this.Ei.sort(ke.prototype.JE)}jE(t){const e=this.kl,i=this.Ri.portSpreading,s=y.l(),n=y.l(),o=y.l(),r=y.l();e.getDocumentPoint(v.TopLeft,s),e.getDocumentPoint(v.TopRight,n),e.getDocumentPoint(v.BottomRight,o),e.getDocumentPoint(v.BottomLeft,r);let a=0,h=0,l=0,u=0;if(2===i)for(let e=0;e<t.length;e++){const i=t[e];if(null===i)continue;const s=i.ts.computeThickness();switch(i.fi){case 8:l+=s;break;case 2:u+=s;break;case 1:a+=s;break;default:h+=s}}let c=0,d=0,g=1,f=n,m=o,p=0,x=0;for(let e=0;e<t.length;e++){const y=t[e];if(null===y)continue;if(c!==y.fi){switch(c=y.fi,c){case 8:f=o,m=r;break;case 2:f=r,m=s;break;case 1:f=s,m=n;break;default:f=n,m=o}switch(p=m.x-f.x,x=m.y-f.y,c){case 8:l>Math.abs(p)?(g=Math.abs(p)/l,l=Math.abs(p)):g=1;break;case 2:u>Math.abs(x)?(g=Math.abs(x)/u,u=Math.abs(x)):g=1;break;case 1:a>Math.abs(p)?(g=Math.abs(p)/a,a=Math.abs(p)):g=1;break;default:h>Math.abs(x)?(g=Math.abs(x)/h,h=Math.abs(x)):g=1}d=0}const w=y._h;if(2===i){let t=y.ts.computeThickness();switch(t*=g,w.h(f),c){case 8:w.x=f.x+p/2+l/2-d-t/2;break;case 2:w.y=f.y+x/2+u/2-d-t/2;break;case 1:w.x=f.x+p/2-a/2+d+t/2;break;default:w.y=f.y+x/2-h/2+d+t/2}d+=t}else{let t=.5;1===i&&(t=(y.rg+1)/(y.Yf+1)),w.x=f.x+p*t,w.y=f.y+x*t}}y.i(s),y.i(n),y.i(o),y.i(r)}WE(t){for(let e=0;e<t.length;e++){const i=t[e];null!==i&&(i.bk=this.$E(i,e))}}$E(t,e){const i=t.ts,s=i.fromPort===this.kl;let n=0;switch(t.fi){case 1:n=270;break;case 2:n=180;break;case 4:n=0;break;case 8:n=90}const o=i.wk(this.Ri,this.kl,v.None,s,n);let r=t.rg;if(r<0)return o;const a=t.Yf;if(a<=1||!i.isOrthogonal)return o;const h=t.Mk,l=t._h,u=2===t.fi||8===t.fi;u&&(r=a-1-r);const c=be.iv,d=2===t.fi||4===t.fi,g=r<=0?l:this.Ei[u?e+1:e-1]._h,f=r>=a-1?l:this.Ei[u?e-1:e+1]._h;return(d?h.y>=g.y&&h.y<=f.y:h.x>=g.x&&h.x<=f.x)?o:(d?h.y<l.y:h.x<l.x)?o+r*c:o+(a-1-r)*c}}class Se{ts;Xt;fi;Mk;rg;Yf;_h;bk;constructor(t,e,i){this.ts=t,this.Xt=e,this.fi=i,this.Mk=new y,this.rg=0,this.Yf=0,this._h=new y,this.bk=0}toString(){return this.ts.toString()+" "+this.Xt.toString()+" "+this.fi.toString()+":"+this.rg.toString()+"/"+this.Yf.toString()+" "+this._h.toString()+" "+this.bk.toString()+" "+this.Mk.toString()}}class Me{Dh;vh;Fh;Rh;Oh;Ih;c0;a0;f0;h0;constructor(){this.Dh=v.Default,this.vh=v.Default,this.Fh=NaN,this.Rh=NaN,this.Oh=NaN,this.Ih=NaN,this.c0=null,this.a0=null,this.f0=1/0,this.h0=1/0}copy(){const t=new Me;return t.Dh=this.Dh.N(),t.vh=this.vh.N(),t.Fh=this.Fh,t.Rh=this.Rh,t.Oh=this.Oh,t.Ih=this.Ih,t.c0=this.c0,t.a0=this.a0,t.f0=this.f0,t.h0=this.h0,t}}class Ce{t0;e0;i0;_p;q0;j0;constructor(){this.t0=-1/0,this.e0=0,this.i0=y.dn,this._p=0,this.q0="None",this.j0="None"}copy(){const t=new Ce;return t.t0=this.t0,t.e0=this.e0,t.i0=this.i0.N(),t._p=this._p,t.q0=this.q0,t.j0=this.j0,t}}class Ne extends me{lg;Dt;Ch;Fp;he;li;constructor(t,e){let i;void 0===t||t instanceof jt||"string"==typeof t?i=t:t&&(e=t),super(i),this.E=4608|this.E,this.lg=new u,this.Dt=null,this.li=new Le,this.li.group=this,this.Ch=new u,this.Fp=null,this.he=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),this.E=-32769&this.E;const e=t.findInVisualTree((t=>t instanceof Te));t.Dt=e instanceof Te?e:null,null!==this.li?(t.li=this.li.copy(),t.li.group=t):(null!==t.li&&(t.li.group=null),t.li=null),null!==this.he&&(t.he=this.he.copy())}Ho(t){super.Ho(t);const e=t.findSubGraphParts(),i=t.memberParts;for(;i.next();){const t=i.value;if(t.f(),t.invalidateLayout(8),t.clearAdornments(),t instanceof me)t.invalidateConnectedLinks(e);else if(t instanceof be){const i=t.labelNodes;for(;i.next();)i.value.invalidateConnectedLinks(e)}}}df(t,i,s,n,o,r,a){if(3===t&&"elements"===i){if(o instanceof Te)null===this.Dt?this.Dt=o:this.Dt!==o&&e.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(o instanceof Yt){const t=o.findInVisualTree((t=>t instanceof Te));t instanceof Te&&(null===this.Dt?this.Dt=t:this.Dt!==t&&e.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else 4===t&&"elements"===i&&null!==this.Dt&&(n===this.Dt||n instanceof Yt&&this.Dt.isContainedBy(n))&&(this.Dt=null);super.df(t,i,s,n,o,r,a)}kd(t,e){if(super.kd(t,e),this.isClipping&&this.type!==Yt.Spot&&this.isSubGraphExpanded){let t=this.resizeObject;t instanceof Yt&&(t=t.findMainElement()),null===this.he&&(this.he=new w),t.getDocumentBounds(this.he),t instanceof $t&&this.he.inflate(-t.strokeWidth,-t.strokeWidth)}}Pa(t,e,i,s){this.hasPlaceholder()&&(this.tr=this.placeholder),super.Pa(t,e,i,s)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each((t=>{t.ensureBounds()})),super.ensureBounds()}Qr(){if(!super.Qr())return!1;const t=this.memberParts;for(;t.next();){const e=t.value;if(e instanceof me){if(!e.isVisible())continue;if(e.as())return!1}else if(e instanceof be){if(!e.isVisible())continue;if(e.as()&&e.fromNode!==this&&e.toNode!==this)return!1}}return!0}hasPlaceholder(){return null!==this.Dt&&this.Dt.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.Dt}get computesBoundsAfterDrag(){return!!(2048&this.E)}set computesBoundsAfterDrag(t){const e=!!(2048&this.E);e!==t&&(this.E=2048^this.E,this.t("computesBoundsAfterDrag",e,t))}get computesBoundsIncludingLinks(){return!!(4096&this.E)}set computesBoundsIncludingLinks(t){const e=!!(4096&this.E);e!==t&&(this.E=4096^this.E,this.t("computesBoundsIncludingLinks",e,t))}get computesBoundsIncludingLocation(){return!!(8192&this.E)}set computesBoundsIncludingLocation(t){const e=!!(8192&this.E);e!==t&&(this.E=8192^this.E,this.t("computesBoundsIncludingLocation",e,t))}get handlesDragDropForMembers(){return!!(16384&this.E)}set handlesDragDropForMembers(t){const e=!!(16384&this.E);e!==t&&(this.E=16384^this.E,this.t("handlesDragDropForMembers",e,t))}get avoidableMembers(){return!!(131072&this.E)}set avoidableMembers(t){const e=!!(131072&this.E);e!==t&&(this.E=131072^this.E,this.t("avoidableMembers",e,t))}get memberParts(){return this.lg.iterator}dC(t){if(this.lg.add(t)){t instanceof Ne&&this.Ch.add(t);const e=this.memberAdded;if(null!==e){let i=!0;const s=this.diagram;null!==s&&(i=s.G,s.G=!0),e(this,t),null!==s&&(s.G=i)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Xe(!1)}if(t instanceof be&&!this.computesBoundsIncludingLinks)return;let e=this.Dt;null===e&&(e=this),e.f()}uC(t){if(this.lg.delete(t)){t instanceof Ne&&this.Ch.delete(t);const e=this.memberRemoved;if(null!==e){let i=!0;const s=this.diagram;null!==s&&(i=s.G,s.G=!0),e(this,t),null!==s&&(s.G=i)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Xe(!0)}if(t instanceof be&&!this.computesBoundsIncludingLinks)return;let e=this.Dt;null===e&&(e=this),e.f()}rf(){if(this.lg.count>0){const t=this.diagram;if(null!==t){const e=this.lg.copy().iterator;for(;e.next();){const i=e.value;t.remove(i)}}}super.rf()}get layout(){return this.li}set layout(t){const i=this.li;if(i!==t){null!==t&&null!==t.diagram&&t.diagram.layout===t&&e.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),null!==i&&(i.diagram=null,i.group=null),this.li=t;const s=this.diagram;null!==t&&(t.diagram=s,t.group=this),null!==s&&(s.Jr=!0),this.t("layout",i,t),null!==s&&s.requestUpdate()}}get memberAdded(){return null!==this.vt?this.vt.Wy:null}set memberAdded(t){const i=this.memberAdded;i!==t&&(null!==t&&e.S(t,Ne,"memberAdded"),this.yl().Wy=t,this.t("memberAdded",i,t))}get memberRemoved(){return null!==this.vt?this.vt.Jy:null}set memberRemoved(t){const i=this.memberRemoved;i!==t&&(null!==t&&e.S(t,Ne,"memberRemoved"),this.yl().Jy=t,this.t("memberRemoved",i,t))}get memberValidation(){return null!==this.vt?this.vt.da:null}set memberValidation(t){const i=this.memberValidation;i!==t&&(null!==t&&e.S(t,Ne,"memberValidation"),this.yl().da=t,this.t("memberValidation",i,t))}canAddMembers(t){const e=this.diagram;if(null===e)return!1;const i=e.commandHandler,s=i.xN(t).iterator;for(;s.next();){const t=s.value;if(!i.isValidMember(this,t))return!1}return!0}addMembers(t,e){const i=this.diagram;if(null===i)return!1;const s=i.commandHandler;let n=!0;const o=s.xN(t).iterator;for(;o.next();){const t=o.value;!e||s.isValidMember(this,t)?t.containingGroup=this:n=!1}return n}get ungroupable(){return!!(256&this.E)}set ungroupable(t){const e=!!(256&this.E);e!==t&&(this.E=256^this.E,this.t("ungroupable",e,t))}canUngroup(){if(!this.ungroupable)return!1;const t=this.layer;if(null===t||!t.allowUngroup)return!1;const e=t.diagram;return!(null!==e&&!e.allowUngroup)}invalidateConnectedLinks(t){const e=this.ZE();if(super.invalidateConnectedLinks(t),e)return;this.uT(!0);const i=this.findExternalLinksConnected();for(;i.next();){const e=i.value;if(void 0!==t&&t.has(e))continue;const s=e.fromNode;if(null!==s&&s!==this&&s.isMemberOf(this)&&!s.isVisible())s.Ze(e.fromPort),s.Ze(e.toPort),e.$t();else{const t=e.toNode;null!==t&&t!==this&&t.isMemberOf(this)&&!t.isVisible()&&(t.Ze(e.fromPort),t.Ze(e.toPort),e.$t())}}}findExternalLinksConnected(){const t=null!==this.diagram&&this.diagram.d2;if(t&&null!==this.Fp)return this.Fp.iterator;const e=this.findSubGraphParts();e.add(this);const i=new u,s=e.iterator;for(;s.next();){const t=s.value;if(!(t instanceof me))continue;const n=t.linksConnected;for(;n.next();){const t=n.value;e.has(t)||i.add(t)}}return t&&(this.Fp=i),i.iterator}findExternalNodesConnected(){const t=this.findSubGraphParts();t.add(this);const e=new u,i=t.iterator;for(;i.next();){const s=i.value;if(!(s instanceof me))continue;const n=s.linksConnected;for(;n.next();){const i=n.value,s=i.fromNode;null!==s&&(!t.has(s)||s===this)&&e.add(s);const o=i.toNode;null!==o&&(!t.has(o)||o===this)&&e.add(o)}}return e.iterator}XU(){const t=new u;return function t(e,i){null!==e&&(i.add(e),t(e.containingGroup,i))}(this,t),t}findSubGraphParts(){const t=new u;return ce.ga(t,this,!0,0,!0),t.delete(this),t}Xe(t){super.Xe(t);const e=this.memberParts;for(;e.next();)e.value.Xe(t)}collapseSubGraph(){const t=this.diagram;if(null===t||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const e=this.findSubGraphParts();this.bv(e,t,this),t.isCollapsingExpanding=!1}bv(t,e,i){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Xe(!1),n instanceof Ne&&n.isSubGraphExpanded&&(n.wasSubGraphExpanded=n.isSubGraphExpanded,n.bv(t,e,i)),n instanceof me)n.invalidateConnectedLinks(t),e.Yc(n,i);else if(n instanceof be){const e=n.labelNodes;for(;e.next();)e.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){const t=this.diagram;if(null===t||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const e=this.findSubGraphParts();this.kv(e,t,this),t.isCollapsingExpanding=!1}kv(t,e,i){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Xe(!0),n instanceof Ne&&n.wasSubGraphExpanded&&(n.wasSubGraphExpanded=!1,n.kv(t,e,i)),n instanceof me)n.invalidateConnectedLinks(t);else if(n instanceof be){const e=n.labelNodes;for(;e.next();)e.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return!!(512&this.E)}set isSubGraphExpanded(t){const e=!!(512&this.E);if(e!==t){this.E=512^this.E;const i=this.diagram;this.t("isSubGraphExpanded",e,t);const s=this.subGraphExpandedChanged;if(null!==s){let t=!0;null!==i&&(t=i.G,i.G=!0),s(this),null!==i&&(i.G=t)}if(null!==i&&i.undoManager.isUndoingRedoing)return null!==this.Dt&&this.Dt.f(),void this.memberParts.each((t=>t.updateAdornments()));t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return!!(1024&this.E)}set wasSubGraphExpanded(t){const e=!!(1024&this.E);e!==t&&(this.E=1024^this.E,this.t("wasSubGraphExpanded",e,t))}get subGraphExpandedChanged(){return null!==this.vt?this.vt.$y:null}set subGraphExpandedChanged(t){const i=this.subGraphExpandedChanged;i!==t&&(null!==t&&e.S(t,Ne,"subGraphExpandedChanged"),this.yl().$y=t,this.t("subGraphExpandedChanged",i,t))}move(t,e){void 0===e&&(e=!1);const i=e?this.location:this.position,s=i.x,n=i.y,o=t.x,r=t.y;if((s===o||isNaN(s)&&isNaN(o))&&(n===r||isNaN(n)&&isNaN(r)))return;const a=o-(isNaN(s)?0:s),h=r-(isNaN(n)?0:n),l=y.l();super.move(t,e);const c=new u,d=this.findSubGraphParts().iterator;for(;d.next();){const t=d.value;t instanceof be&&(t.suspendsRouting&&c.add(t),(t.Fi||t.fromNode!==this&&t.toNode!==this)&&(t.suspendsRouting=!0))}for(d.reset();d.next();){const t=d.value;if(t.Lr()||t instanceof me&&t.isLinkLabel)continue;const e=t.position,i=t.location;e.isReal()?(l.x=e.x+a,l.y=e.y+h,t.position=l):i.isReal()&&(l.x=i.x+a,l.y=i.y+h,t.location=l)}for(d.reset();d.next();){const t=d.value;if(!(t instanceof be&&(t.suspendsRouting=c.has(t),t.Fi||t.fromNode!==this&&t.toNode!==this)))continue;const e=t.position;l.x=e.x+a,l.y=e.y+h,l.isReal()?t.move(l):t.$t()}y.i(l)}ZE(){return!!(65536&this.E)}uT(t){!!(65536&this.E)!==t&&(this.E=65536^this.E)}get Lh(){return!!(32768&this.E)}set Lh(t){!!(32768&this.E)!==t&&(this.E=32768^this.E)}}class Te extends At{Qt;ag;constructor(t){super(),this.Qt=b.im,this.ag=new w(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Qt=this.Qt.N(),t.ag=this.ag.copy()}ka(t){if(null===this.background)return!1;const e=this.naturalBounds;return w.contains(0,0,e.width,e.height,t.x,t.y)}bd(t,i,s,n){const o=this.part;if((null===o||!(o instanceof Ne)&&!(o instanceof ge))&&e.o("Placeholder is not inside a Group or Adornment."),o instanceof Ne){const t=this.computeBorder(this.ag),e=this.minSize,i=isFinite(e.width)?Math.max(e.width,t.width):t.width,s=isFinite(e.height)?Math.max(e.height,t.height):t.height,n=this.Ke;n.Hn(i||0,s||0),this.ro(0,0,n.width,n.height);const r=o.memberParts;let a=!1;for(;r.next();)if(r.value.isVisible()){a=!0;break}const h=o.diagram;if(a&&null!==h&&!h.animationManager.LM(o)&&!isNaN(t.x)&&!isNaN(t.y)){const e=y.l();e.setRectSpot(t,o.locationSpot),o.location=e,y.i(e)}}else{const t=o,e=this.Ke,i=this.Qt,s=i.left+i.right,n=i.top+i.bottom,r=t.adornedObject,a=r.getDocumentAngle();t.angle=a;let h=0;r instanceof $t&&(h=r.strokeWidth);const l=r.getDocumentScale(),u=r.naturalBounds,c=(u.width+h)*l,d=(u.height+h)*l;if(t.type!==Yt.Link){const e="Selection"===t.category?v.TopLeft:t.locationSpot,i=r.getDocumentPoint(e,y.l());t.location=i,y.i(i)}if(isNaN(c)||isNaN(d)){const t=r.getDocumentPoint(v.TopLeft,y.l()),o=w.z(t.x,t.y,0,0);o.unionPoint(r.getDocumentPoint(v.BottomRight,t)),o.unionPoint(r.getDocumentPoint(v.TopRight,t)),o.unionPoint(r.getDocumentPoint(v.BottomLeft,t)),e.Hn(o.width+s||0,o.height+n||0),this.ro(-i.left,-i.top,e.width,e.height),y.i(t),w.i(o)}else e.Hn(c+s||0,d+n||0),this.ro(-i.left,-i.top,e.width,e.height)}}Pa(t,e,i,s){this.actualBounds.e(t,e,i,s)}computeBorder(t){const e=this.part,i=e.diagram;if(null===i||i.animationManager.isAnimating)return t;if(e instanceof Ne&&!e.layer.isTemporary&&e.computesBoundsAfterDrag&&this.ag.isReal()){const s=i.toolManager.findTool("Dragging");if(s===i.currentTool&&s.pR(e,this.ag,t))return t}const s=w.l(),n=this.computeMemberBounds(s),o=this.Qt;return e instanceof Ne&&!e.isSubGraphExpanded?t.e(n.x-o.left,n.y-o.top,0,0):t.e(n.x-o.left,n.y-o.top,Math.max(n.width+o.left+o.right,0),Math.max(n.height+o.top+o.bottom,0)),w.i(s),e instanceof Ne&&e.computesBoundsIncludingLocation&&e.location.isReal()&&t.unionPoint(e.location),t}computeMemberBounds(t){if(!(this.part instanceof Ne))return t.e(0,0,0,0),t;const e=this.part;let i=1/0,s=1/0,n=-1/0,o=-1/0;const r=e.memberParts;for(;r.next();){const t=r.value;if(!t.isVisible()||t instanceof be&&(!e.computesBoundsIncludingLinks||t.Xo()||t.fromNode===e||t.toNode===e))continue;const a=t.actualBounds;a.left<i&&(i=a.left),a.top<s&&(s=a.top),a.right>n&&(n=a.right),a.bottom>o&&(o=a.bottom)}if(isFinite(i)&&isFinite(s))t.e(i,s,n-i,o-s);else{const i=e.location;t.e(i.x,i.y,0,0)}return t}get padding(){return this.Qt}set padding(t){"number"==typeof t&&(t=new b(t));const e=this.Qt;e.equals(t)||(t=t.N(),this.Qt=t,this.t("padding",e,t),this.f())}}class Le{a;Ah;hg;Ar;cg;fg;Uo;Pl;ug;dg;ko;constructor(t){u.Je(this),this.a=null,this.Ah=null,this.hg=!0,this.Ar=!0,this.cg=!1,this.fg=new y(0,0),this.Uo=!0,this.Pl=null,this.ug=null,this.dg=!1,this.ko=null,t&&Object.assign(this,t)}cloneProtected(t){t.hg=this.hg,t.Ar=this.Ar,t.cg=this.cg,t.fg.h(this.fg),t.Uo=this.Uo,t.Pl=this.Pl,t.ug=this.ug,t.dg=!0}copy(){const t=new this.constructor;return this.cloneProtected(t),t}fe(t){e.ur(this,t)}toString(){let t=e.Kn(this.constructor);return t+="(",null!==this.group&&(t+=" in "+this.group),null!==this.diagram&&(t+=" for "+this.diagram),t+=")",t}get diagram(){return this.a}set diagram(t){this.a=t}get group(){return this.Ah}set group(t){this.Ah!==t&&(this.Ah=t,null!==t&&(this.a=t.diagram))}get isOngoing(){return this.hg}set isOngoing(t){this.hg!==t&&(e.s(t,"boolean",Le,"isOngoing"),this.hg=t)}get isInitial(){return this.Ar}set isInitial(t){e.s(t,"boolean",Le,"isInitial"),this.Ar=t,t||(this.dg=!0)}get isViewportSized(){return this.cg}set isViewportSized(t){this.cg!==t&&(e.s(t,"boolean",Le,"isViewportSized"),this.cg=t,t&&this.p())}get isRouting(){return this.Uo}set isRouting(t){this.Uo!==t&&(e.s(t,"boolean",Le,"isRouting"),this.Uo=t)}get isRealtime(){return this.Pl}set isRealtime(t){this.Pl!==t&&(null!==t&&e.s(t,"boolean",Le,"isRealtime"),this.Pl=t)}get isValidLayout(){return this.dg}set isValidLayout(t){if(this.dg!==t&&(e.s(t,"boolean",Le,"isValidLayout"),this.dg=t,!t)){const t=this.diagram;null!==t&&(t.Jr=!0)}}invalidateLayout(){if(!this.isValidLayout)return;const t=this.diagram;if(null===t||t.undoManager.isUndoingRedoing)return;const e=t.animationManager;e.isTicking||(e.defaultAnimation.isAnimating&&e.stopAnimation(),(this.isOngoing&&t.Qa||this.isInitial&&!t.Qa)&&(this.isValidLayout=!1,t.requestUpdate()))}p(){this.invalidateLayout()}get network(){return this.ko}set network(t){this.ko!==t&&(this.ko=t,null!==t&&(t.layout=this))}createNetwork(){return new Ae(this)}makeNetwork(t){const e=this.createNetwork();return t instanceof wt?(e.addParts(t.nodes,!0),e.addParts(t.links,!0)):t instanceof Ne?e.addParts(t.memberParts):e.addParts(t.iterator),e}updateParts(){this.isValidLayout=!0;let t=this.diagram;if(null===t&&null!==this.network){const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value.node;if(null!==i&&(t=i.diagram,null!==t))break}}try{null!==t&&t.startTransaction("Layout"),this.commitLayout()}finally{null!==t&&t.commitTransaction("Layout")}}commitLayout(){if(null===this.network)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();if(this.isRouting){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}doLayout(t){const e=new u;if(t instanceof wt?(this.Ea(e,t.nodes,!0,this.Lh,!0,!1,!0),this.Ea(e,t.parts,!0,this.Lh,!0,!1,!0)):t instanceof Ne?this.Ea(e,t.memberParts,!1,this.Lh,!0,!1,!0):e.addAll(t.iterator),e.count>0){const t=this.diagram;null!==t&&t.startTransaction("Layout"),this.doMinimalNoNetworkLayout(e),null!==t&&t.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(t){const e=t.count,i=Math.ceil(Math.sqrt(e));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x;let n=s,o=this.arrangementOrigin.y,r=0,a=0;const h=t.iterator;for(;h.next();){const t=h.value;t.ensureBounds();const e=t.measuredBounds,l=e.width,u=e.height;t.moveTo(n,o),t instanceof Ne&&(t.Lh=!1),n+=Math.max(l,50)+20,a=Math.max(a,Math.max(u,50)),r>=i-1?(r=0,n=s,o+=a+20,a=0):r++}}Lh(t){return!!(!t.location.isReal()&&!t.position.isReal()||t instanceof Ne&&t.Lh)}Ea(t,e,i,s,n,o,r){const a=e.iterator;for(;a.next();){const e=a.value;if((!i||e.isTopLevel)&&(null===s||s(e))&&e.canLayout())if(n&&e instanceof me){if(e.isLinkLabel)continue;e instanceof Ne&&null===e.layout?this.Ea(t,e.memberParts,!1,s,n,o,r):(e.ensureBounds(),t.add(e))}else o&&e instanceof be?t.add(e):r&&e.Di()&&!(e instanceof me)&&(e.ensureBounds(),t.add(e))}}getLayoutBounds(t,e){const i=this.boundsComputation;return null!==i?(e||(e=new w),i(t,this,e)):!e&&t.margin.equalTo(0,0,0,0)?t.actualBounds:(e||(e=new w),e.set(t.actualBounds),e.addMargin(t.margin),e)}get boundsComputation(){return this.ug}set boundsComputation(t){this.ug!==t&&(null!==t&&e.S(t,Le,"boundsComputation"),this.ug=t,this.p())}collectParts(t){const e=new u;return t instanceof wt?(this.Ea(e,t.nodes,!0,null,!0,!0,!0),this.Ea(e,t.links,!0,null,!0,!0,!0),this.Ea(e,t.parts,!0,null,!0,!0,!0)):t instanceof Ne?this.Ea(e,t.memberParts,!1,null,!0,!0,!0):this.Ea(e,t.iterator,!1,null,!0,!0,!0),e}get arrangementOrigin(){return this.fg}set arrangementOrigin(t){this.fg.equals(t)||(this.fg.h(t),this.p())}initialOrigin(t){const e=this.group;if(null!==e){if(e.hasPlaceholder()){const i=e.placeholder,s=i.getDocumentPoint(v.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(t);const n=i.padding;return s.x+=n.left,s.y+=n.top,s}{const i=e.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(t),i}}return t}}class Ae{li;Po;On;ew;iw;constructor(t){u.Je(this),this.li=t,this.Po=new u,this.On=new u,this.ew=new p,this.iw=new p}clear(){if(this.Po){const t=this.Po.iterator;for(;t.next();)t.value.clear()}if(this.On){const t=this.On.iterator;for(;t.next();)t.value.clear()}this.Po=new u,this.On=new u,this.ew=new p,this.iw=new p}toString(t){void 0===t&&(t=0);let e="LayoutNetwork"+(null!==this.layout?"("+this.layout.toString()+")":"");if(t<=0)return e;if(e+=" vertexes: "+this.Po.count+" edges: "+this.On.count,t>1){const i=this.Po.iterator;for(;i.next();){e+="\n    "+i.value.toString(t-1)}const s=this.On.iterator;for(;s.next();){e+="\n    "+s.value.toString(t-1)}}return e}get layout(){return this.li}set layout(t){null!==t&&(this.li=t)}get vertexes(){return this.Po}get edges(){return this.On}createVertex(){return new De(this)}createEdge(){return new Fe(this)}addParts(t,i,s){if(null===t)return;void 0===i&&(i=!1),e.s(i,"boolean",Ae,"addParts:toplevelonly"),void 0===s&&(s=null),null===s&&(s=t=>{if(t instanceof me)return!t.isLinkLabel;if(t instanceof be){const e=t.fromNode;if(null===e||e.isLinkLabel)return!1;const i=t.toNode;return!(null===i||i.isLinkLabel)}return!1});const n=t.iterator;for(;n.next();){const t=n.value;if(t instanceof me&&(!i||t.isTopLevel)&&t.canLayout()&&s(t))if(t instanceof Ne&&null===t.layout)this.addParts(t.memberParts,!1);else{if(null!==this.findVertex(t))continue;const e=this.createVertex();e.node=t,this.addVertex(e)}}for(n.reset();n.next();){const t=n.value;if(!(t instanceof be)||i&&!t.isTopLevel||!t.canLayout()||!s(t)||null!==this.findEdge(t))continue;const e=t.fromNode,o=t.toNode;if(null===e||null===o||e===o)continue;const r=this.findGroupVertex(e),a=this.findGroupVertex(o);this.linkVertexes(r,a,t)}}findGroupVertex(t){const e=t.findVisibleNode();if(null===e)return null;let i=this.findVertex(e);if(null!==i)return i;let s=e.containingGroup;for(;null!==s;){if(i=this.findVertex(s),null!==i)return i;s=s.containingGroup}return null}addVertex(t){this.Po.add(t);const e=t.node;null!==e&&this.ew.set(e,t),t.network=this}addNode(t){let e=this.findVertex(t);return null===e&&(e=this.createVertex(),e.node=t,this.addVertex(e)),e}deleteVertex(t){if(this.Pv(t)){let e=t.sr;for(let t=e.count-1;t>=0;t--){const i=e.elt(t);this.deleteEdge(i)}e=t.nr;for(let t=e.count-1;t>=0;t--){const i=e.elt(t);this.deleteEdge(i)}}}Pv(t){const e=this.Po.delete(t);if(e){const e=t.node;null!==e&&this.ew.delete(e)}return e}deleteNode(t){const e=this.findVertex(t);null!==e&&this.deleteVertex(e)}findVertex(t){return this.ew.get(t)}addEdge(t){this.BC(t);const e=t.toVertex;null!==e&&e.addSourceEdge(t);const i=t.fromVertex;null!==i&&i.addDestinationEdge(t)}BC(t){this.On.add(t);const e=t.link;null!==e&&null===this.findEdge(e)&&this.iw.set(e,t),t.network=this}addLink(t){const e=t.fromNode,i=t.toNode;let s=this.findEdge(t);return null===s?(s=this.createEdge(),s.link=t,null!==e&&(s.fromVertex=this.addNode(e)),null!==i&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(s.fromVertex=null!==e?this.addNode(e):null,s.toVertex=null!==i?this.addNode(i):null),s}deleteEdge(t){const e=t.toVertex;null!==e&&e.deleteSourceEdge(t);const i=t.fromVertex;null!==i&&i.deleteDestinationEdge(t),this.zC(t)}zC(t){const e=this.On.delete(t);if(e){const e=t.link;null!==e&&this.iw.delete(e)}return e}deleteLink(t){const e=this.findEdge(t);null!==e&&this.deleteEdge(e)}findEdge(t){return this.iw.get(t)}linkVertexes(t,e,i){if(null===t||null===e)return null;if(t.network===this&&e.network===this){const s=this.createEdge();return s.link=i,s.fromVertex=t,s.toVertex=e,this.addEdge(s),s}return null}reverseEdge(t){const e=t.fromVertex,i=t.toVertex;null===e||null===i||(e.deleteDestinationEdge(t),i.deleteSourceEdge(t),t.reverseEdge(),e.addSourceEdge(t),i.addDestinationEdge(t))}deleteSelfEdges(){const t=e.nt(),i=this.On.iterator;for(;i.next();){const e=i.value;e.fromVertex===e.toVertex&&t.push(e)}const s=t.length;for(let e=0;e<s;e++)this.deleteEdge(t[e]);e.Z(t)}deleteArtificialVertexes(){const t=e.nt(),i=this.Po.iterator;for(;i.next();){const e=i.value;null===e.node&&null===e.data&&t.push(e)}let s=t.length;for(let e=0;e<s;e++)this.deleteVertex(t[e]);const n=e.nt(),o=this.On.iterator;for(;o.next();){const t=o.value;null===t.link&&null===t.data&&n.push(t)}s=n.length;for(let t=0;t<s;t++)this.deleteEdge(n[t]);e.Z(t),e.Z(n)}deleteUselessEdges(){const t=e.nt(),i=this.On.iterator;for(;i.next();){const e=i.value;(null===e.fromVertex||null===e.toVertex)&&t.push(e)}const s=t.length;for(let e=0;e<s;e++)this.deleteEdge(t[e]);e.Z(t)}isSingleton(t){return!(t.sr.count>0||t.nr.count>0)}splitIntoSubNetworks(t){void 0===t&&(t=!0),t&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const e=new h;let i=!0;for(;i;){i=!1;const t=this.Po.iterator;for(;t.next();){const s=t.value;if(this.isSingleton(s))continue;const n=this.layout.createNetwork();e.add(n),this.QE(n,s),i=!0;break}}return e.sort(((t,e)=>null===t||null===e||t===e?0:e.vertexes.count-t.vertexes.count)),e}QE(t,e){if(null===e)return;const i=new h;for(i.add(e);i.count>0;){const e=i.first();if(i.removeAt(0),!e||e.network===t)continue;this.Pv(e),t.addVertex(e);let s=e.sourceEdges;for(;s.next();){const e=s.value;e.network!==t&&(this.zC(e),t.BC(e),e.fromVertex&&i.add(e.fromVertex))}for(s=e.destinationEdges;s.next();){const e=s.value;e.network!==t&&(this.zC(e),t.BC(e),e.toVertex&&i.add(e.toVertex))}}}findAllParts(){const t=new u,e=this.Po.iterator;for(;e.next();){const i=e.value;i.node&&t.add(i.node)}const i=this.On.iterator;for(;i.next();){const e=i.value;e.link&&t.add(e.link)}return t}}class De{ko;te;Ri;Ui;es;sr;nr;constructor(t){u.Je(this),this.ko=t,this.Ui=new w(0,0,10,10),this.es=new y(5,5),this.te=null,this.Ri=null,this.sr=new h,this.nr=new h}clear(){this.te=null,this.Ri=null,this.sr=new h,this.nr=new h}toString(t){void 0===t&&(t=0);let e="LayoutVertex#"+u.xs(this);if(t>0&&(e+=null!==this.node?"("+this.node.toString()+")":"",t>1)){let t="",i=!0,s=this.sr.iterator;for(;s.next();){i?i=!1:t+=",",t+=s.value.toString(0)}let n="";for(i=!0,s=this.nr.iterator;s.next();){i?i=!1:n+=",",n+=s.value.toString(0)}e+=" sources: "+t+" destinations: "+n}return e}get So(){return this.sr.DL}get or(){return this.nr.DL}get data(){return this.te}set data(t){if(this.te=t,null!==t&&t.bounds){const e=t.bounds,i=e.x,s=e.y,n=e.width,o=e.height;this.es.e(n/2,o/2),this.Ui.e(i,s,n,o)}}get node(){return this.Ri}set node(t){if(this.Ri!==t){if(this.Ri=t,null===t)return;t.ensureBounds();const e=this.network.layout,i=w.l(),s=e.getLayoutBounds(t,i);let n=s.x,o=s.y;const r=s.width,a=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Ui.e(n,o,r,a),w.i(i),!(t instanceof Ne)){const e=t.locationObject.getDocumentPoint(v.Center);if(e.isReal())return void this.es.e(e.x-n,e.y-o)}this.es.e(r/2,a/2)}}get bounds(){return this.Ui}set bounds(t){this.Ui.equals(t)||this.Ui.h(t)}get focus(){return this.es}set focus(t){this.es.equals(t)||this.es.h(t)}get centerX(){return this.Ui.x+this.es.x}set centerX(t){const e=this.Ui;e.x+this.es.x!==t&&(e.x=t-this.es.x)}get centerY(){return this.Ui.y+this.es.y}set centerY(t){const e=this.Ui;e.y+this.es.y!==t&&(e.y=t-this.es.y)}get focusX(){return this.es.x}set focusX(t){const e=this.es;e.x!==t&&(e.x=t)}get focusY(){return this.es.y}set focusY(t){const e=this.es;e.y!==t&&(e.y=t)}get x(){return this.Ui.x}set x(t){const e=this.Ui;e.x!==t&&(e.x=t)}get y(){return this.Ui.y}set y(t){const e=this.Ui;e.y!==t&&(e.y=t)}get width(){return this.Ui.width}set width(t){const e=this.Ui;e.width!==t&&(e.width=t)}get height(){return this.Ui.height}set height(t){const e=this.Ui;e.height!==t&&(e.height=t)}commit(){const t=this.te;if(null!==t){const i=this.bounds,s=t.bounds;return void(e.$(s)?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):t.bounds=i.copy())}const i=this.node;if(null!==i){const t=this.bounds;if(!(i instanceof Ne)){const e=w.l();i.ensureBounds();const s=this.network.layout.getLayoutBounds(i,e),n=i.locationObject.getDocumentPoint(v.Center);if(s.isReal()&&n.isReal())return i.moveTo(t.x+this.focusX-(n.x-s.x)+i.margin.left,t.y+this.focusY-(n.y-s.y+i.margin.top)),void w.i(e);w.i(e)}i.moveTo(t.x+i.margin.left,t.y+i.margin.top)}}addSourceEdge(t){null!==t&&(this.sr.has(t)||this.sr.add(t))}deleteSourceEdge(t){null!==t&&this.sr.delete(t)}addDestinationEdge(t){null!==t&&(this.nr.has(t)||this.nr.add(t))}deleteDestinationEdge(t){null!==t&&this.nr.delete(t)}get network(){return this.ko}set network(t){this.ko=t}get sourceVertexes(){const t=new u,e=this.sourceEdges;for(;e.next();){const i=e.value;i.fromVertex&&t.add(i.fromVertex)}return t.iterator}get destinationVertexes(){const t=new u,e=this.destinationEdges;for(;e.next();){const i=e.value;i.toVertex&&t.add(i.toVertex)}return t.iterator}get vertexes(){const t=new u;let e=this.sourceEdges;for(;e.next();){const i=e.value;i.fromVertex&&t.add(i.fromVertex)}for(e=this.destinationEdges;e.next();){const i=e.value;i.toVertex&&t.add(i.toVertex)}return t.iterator}get sourceEdges(){return this.sr.iterator}get destinationEdges(){return this.nr.iterator}get edges(){const t=new h;let e=this.sourceEdges;for(;e.next();){const i=e.value;t.add(i)}for(e=this.destinationEdges;e.next();){const i=e.value;t.add(i)}return t.iterator}get edgesCount(){return this.sr.count+this.nr.count}static standardComparer(t,e){const i=t.Ri,s=e.Ri;if(i){if(s){const t=i.text,e=s.text;return t<e?-1:t>e?1:0}return 1}return null!==s?-1:0}static smartComparer(t,e){if(null!==t){if(null!==e){const i=t.Ri,s=e.Ri;if(null!==i){if(null!==s){const t=i.text.toLocaleLowerCase(),e=s.text.toLocaleLowerCase(),n=t.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),o=e.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let r=0;for(;r<n.length;r++){if(""!==o[r]&&void 0!==o[r]){const t=parseFloat(n[r]),e=parseFloat(o[r]);if(isNaN(t)){if(isNaN(e)){if(0!==n[r].localeCompare(o[r]))return n[r].localeCompare(o[r]);continue}return 1}if(isNaN(e))return-1;if(t-e!=0)return t-e;continue}if(""===n[r])continue;return 1}return""!==o[r]&&void 0!==o[r]?-1:0}return 1}return null!==s?-1:0}return 1}return null!==e?-1:0}}class Fe{ko;te;ts;is;ss;constructor(t){u.Je(this),this.ko=t,this.te=null,this.ts=null,this.is=null,this.ss=null}clear(){this.te=null,this.ts=null,this.is=null,this.ss=null}toString(t){void 0===t&&(t=0);let e="LayoutEdge#"+u.xs(this);return t>0&&(e+=null!==this.ts?"("+this.ts.toString()+")":"",t>1&&(e+=" "+(this.is?this.is.toString():"null")+" --\x3e "+(this.ss?this.ss.toString():"null"))),e}reverseEdge(){const t=this.is;this.is=this.ss,this.ss=t}commit(){}getOtherVertex(t){return this.ss===t?this.is:this.is===t?this.ss:null}get network(){return this.ko}set network(t){this.ko=t}get data(){return this.te}set data(t){this.te!==t&&(this.te=t)}get link(){return this.ts}set link(t){this.ts!==t&&(this.ts=t)}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(this.is=t)}get toVertex(){return this.ss}set toVertex(t){this.ss!==t&&(this.ss=t)}}var Oe=(t=>(t[t.Position=0]="Position",t[t.Location=1]="Location",t))(Oe||{}),Re=(t=>(t[t.LeftToRight=10]="LeftToRight",t[t.RightToLeft=11]="RightToLeft",t))(Re||{}),Be=(t=>(t[t.Forwards=20]="Forwards",t[t.Reverse=21]="Reverse",t[t.Ascending=22]="Ascending",t[t.Descending=23]="Descending",t))(Be||{});class Ee extends Le{gg;mg;Ro;In;de;He;Si;Mi;constructor(t){super(),this.isViewportSized=!0,this.gg=NaN,this.mg=NaN,this.Ro=new x(NaN,NaN).k(),this.In=new x(10,10).k(),this.de=1,this.He=10,this.Si=22,this.Mi=Ee.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.gg=this.gg,t.mg=this.mg,t.Ro.h(this.Ro),t.In.h(this.In),t.de=this.de,t.He=this.He,t.Si=this.Si,t.Mi=this.Mi}fe(t){t in Be?this.sorting=t:t in Re?this.arrangement=t:t in Oe?this.alignment=t:super.fe(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const e=this.collectParts(t),i=this.diagram,s=e.copy().iterator;for(;s.next();){const t=s.value;if(!t.Lr()||null===t.fromNode&&null===t.toNode){if(t.ensureBounds(),t instanceof Ne){const i=t.memberParts;for(;i.next();){const t=i.value;e.delete(t)}}}else e.delete(t)}const n=e.toArray();if(0===n.length)return;switch(this.sorting){case 20:break;case 21:n.reverse();break;case 22:n.sort(this.comparer);break;case 23:n.sort(this.comparer),n.reverse()}let o=this.wrappingColumn;isNaN(o)&&(o=0);let r=this.wrappingWidth;if(isNaN(r)&&null!==i){const t=i.viewportBounds,e=i.padding;r=Math.max(t.width-e.left-e.right,0)}else r=Math.max(this.wrappingWidth,0);o<=0&&r<=0&&(o=1);let a=this.spacing.width;isFinite(a)||(a=0);let h=this.spacing.height;isFinite(h)||(h=0),null!==i&&i.startTransaction("Layout");const l=[];switch(this.alignment){case 0:this._E(n,r,o,a,h,l);break;case 1:this.t3(n,r,o,a,h,l)}let u=0,c=0,d=0;for(let t=0;t<l.length;t++){const e=l[t];u=Math.min(u,e.x),c=Math.min(c,e.y),d=Math.max(d,e.x+e.width)}11===this.arrangement?this.commitLayers(l,new y(u+a/2-(d+u),c-h/2)):this.commitLayers(l,new y(u-a/2,c-h/2)),null!==i&&i.commitTransaction("Layout"),this.isValidLayout=!0}_E(t,e,i,s,n,o){const r=w.l();let a=Math.max(this.cellSize.width,1);if(!isFinite(a)){a=0;for(let e=0;e<t.length;e++){const i=t[e],s=this.getLayoutBounds(i,r);a=Math.max(a,s.width)}}a+=s,a=Math.max(a,1);let h=Math.max(this.cellSize.height,1);if(!isFinite(h)){h=0;for(let e=0;e<t.length;e++){const i=t[e],s=this.getLayoutBounds(i,r);h=Math.max(h,s.height)}}h+=n,h=Math.max(h,1);const l=this.arrangement,u=this.arrangementOrigin.x;let c=u,d=this.arrangementOrigin.y,g=0,f=0;for(let m=0;m<t.length;m++){const p=t[m],y=this.getLayoutBounds(p,r),x=Math.ceil((y.width+s)/a)*a,b=Math.ceil((y.height+n)/h)*h;let v=0;if(11===l)v=Math.abs(c-y.width);else v=c+y.width;(i>0&&g>i-1||e>0&&g>0&&v-u>e)&&(o.push(new w(0,d,e+s,f)),g=0,c=u,d+=f,f=0),f=Math.max(f,b);let P=0;if(11===l)P=-y.width;else P=0;if(11===(p.moveTo(c+P+p.margin.left,d+p.margin.top),l))c-=x;else c+=x;g++}o.push(new w(0,d,e+s,f)),w.i(r)}t3(t,e,i,s,n,o){const r=w.l();let a=Math.max(this.cellSize.width,1),h=0,l=0,u=0;const c=y.l();for(let e=0;e<t.length;e++){const i=t[e],s=this.getLayoutBounds(i,r),n=i.getRelativePoint(i.locationObject,i.locationSpot,c);h=Math.max(h,n.x),l=Math.max(l,s.width-n.x),u=Math.max(u,n.y)}const d=this.arrangement;if(11===d)h+=s;else l+=s;a=isFinite(a)?Math.max(a+s,1):Math.max(h+l,1);const g=this.arrangementOrigin.x;let f=g,m=this.arrangementOrigin.y,p=0;e>=h&&(e-=h);let x=0,b=0;const v=Math.max(this.cellSize.height,1);u=0;let P=0,S=!0;const M=y.l();for(let h=0;h<t.length;h++){const l=t[h],y=this.getLayoutBounds(l,r),C=l.getRelativePoint(l.locationObject,l.locationSpot,c);if(p>0)switch(d){case 11:{let t=(f-g-(y.width-C.x))/a;t=k.X(Math.round(t),t)?Math.round(t):Math.floor(t),f=t*a+g;break}default:{let t=(f-g+C.x)/a;t=k.X(Math.round(t),t)?Math.round(t):Math.ceil(t),f=t*a+g;break}}else if(11===d)x=f+C.x+y.width;else x=f-C.x;let N=0;if(11===d)N=-(f+C.x)+x;else N=f+y.width-C.x-x;if(i>0&&p>i-1||e>0&&p>0&&N>e){o.push(new w(0,S?m-u:m,e+s,P+u+n));for(let e=0;e<p&&h!==p;e++){const i=t[h-p+e],s=i.getRelativePoint(i.locationObject,i.locationSpot,M);i.moveTo(i.position.x,i.position.y+u-s.y)}P+=n,m+=S?P:P+u,u=0,P=0,p=0,f=g,S=!1}if(11===(f===g&&(b=11===d?Math.max(b,y.width-C.x):Math.min(b,-C.x)),u=Math.max(u,C.y),P=Math.max(P,y.height-C.y),isFinite(v)&&(P=Math.max(P,Math.max(y.height,v)-C.y)),S?l.moveTo(f-C.x,m-C.y):l.moveTo(f-C.x,m),d))f-=C.x+s;else f+=y.width-C.x+s;p++}if(o.push(new w(0,m,e+s,(S?P:P+u)+n)),t.length!==p)for(let e=0;e<p;e++){const i=t[t.length-p+e],s=i.getRelativePoint(i.locationObject,i.locationSpot,c);i.moveTo(i.position.x,i.position.y+u-s.y)}if(y.i(c),y.i(M),11===d)for(let t=0;t<o.length;t++){const e=o[t];e.width+=b,e.x-=b}else for(let t=0;t<o.length;t++){const e=o[t];e.x>b&&(e.width+=e.x-b,e.x=b)}w.i(r)}commitLayers(t,e){}get wrappingWidth(){return this.gg}set wrappingWidth(t){this.gg!==t&&(e.s(t,"number",Ee,"wrappingWidth"),(t>0||isNaN(t))&&(this.gg=t,this.isViewportSized=isNaN(t),this.p()))}get wrappingColumn(){return this.mg}set wrappingColumn(t){this.mg!==t&&(e.s(t,"number",Ee,"wrappingColumn"),(t>0||isNaN(t))&&(this.mg=t,this.p()))}get cellSize(){return this.Ro}set cellSize(t){this.Ro.equals(t)||(this.Ro.h(t),this.p())}get spacing(){return this.In}set spacing(t){this.In.equals(t)||(this.In.h(t),this.p())}get alignment(){return this.de}set alignment(t){this.de!==t&&(1===t||0===t)&&(this.de=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(10===t||11===t)&&(this.He=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(20===t||21===t||22===t||23===t)&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(e.S(t,Ee,"comparer"),this.Mi=t,this.p())}static standardComparer(t,e){const i=t.text,s=e.text;return i<s?-1:i>s?1:0}static smartComparer(t,e){if(null!==t){if(null!==e){const i=t.text.toLocaleLowerCase(),s=e.text.toLocaleLowerCase(),n=i.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let r=0;for(;r<n.length;r++){if(""!==o[r]&&void 0!==o[r]){const t=parseFloat(n[r]),e=parseFloat(o[r]);if(isNaN(t)){if(isNaN(e)){if(0!==n[r].localeCompare(o[r]))return n[r].localeCompare(o[r]);continue}return 1}if(isNaN(e))return-1;if(t-e!=0)return t-e;continue}if(""===n[r])continue;return 1}return""!==o[r]&&void 0!==o[r]?-1:0}return 1}return null!==e?-1:0}static Position=0;static Location=1;static LeftToRight=10;static RightToLeft=11;static Forward=20;static Reverse=21;static Ascending=22;static Descending=23}class Ie{pg;on;Ct;Mo;yg;wg;a;XC;constructor(){this.pg=new u,this.on=new u,this.Ct=new u,this.Mo=new p,this.yg=new p,this.wg=new p,this.a=null,this.XC=!1}clear(){this.pg.clear(),this.on.clear(),this.Ct.clear(),this.Mo.clear(),this.yg.clear(),this.wg.clear()}Io(t){this.a=t}ch(t){if(t instanceof me){if(this.pg.add(t),t instanceof Ne){const e=t.containingGroup;null===e?this.diagram.$r.add(t):e.Ch.add(t);const i=t.layout;null!==i&&(i.diagram=this.diagram)}}else t instanceof be?(this.on.add(t),t.isAvoiding&&(this.diagram.lp=!0)):t instanceof ge||this.Ct.add(t);const e=t.data;null!==e&&(t instanceof ge||(t instanceof be?this.Sv(e,t):this.Mo.set(e,t)))}ri(t){if(t.clearAdornments(),t instanceof me){if(this.pg.delete(t),t instanceof Ne){const e=t.containingGroup;null===e?this.diagram.$r.delete(t):e.Ch.delete(t);const i=t.layout;null!==i&&(i.diagram=null)}}else t instanceof be?this.on.delete(t):t instanceof ge||this.Ct.delete(t);const e=t.data;null!==e&&(t instanceof ge||(t instanceof be?this.Mv(e,t):this.Mo.delete(e)))}Sv(t,e){this.yg.set(t,e)}Mv(t,e){this.yg.delete(t)}rebuildParts(){const t=this.diagram;if(null===t)return;const i=t.nodeTemplateMap.iterator;for(;i.next();){const t=i.value,s=i.key;(!t.Di()||t instanceof Ne)&&e.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${s}" must be a Node or a simple Part, not a Group or Link: ${t}`)}const s=t.groupTemplateMap.iterator;for(;s.next();){const t=s.value,i=s.key;t instanceof Ne||e.o(`Invalid group template in Diagram.groupTemplateMap: template for "${i}" must be a Group, not a normal Node or Link: ${t}`)}const n=t.linkTemplateMap.iterator;for(;n.next();){const t=n.value,i=n.key;t instanceof be||e.o(`Invalid link template in Diagram.linkTemplateMap: template for "${i}" must be a Link, not a normal Node or simple Part: ${t}`)}const o=e.nt(),r=t.selection.iterator;for(;r.next();){const t=r.value.data;t&&o.push(t)}const a=e.nt(),h=t.highlighteds.iterator;for(;h.next();){const t=h.value.data;t&&a.push(t)}const l=e.nt(),u=this.nodes.iterator;for(;u.next();){const t=u.value;null!==t.data&&(l.push(t.data),l.push(t.location))}const c=this.links.iterator;for(;c.next();){const t=c.value;null!==t.data&&(l.push(t.data),l.push(t.location))}const d=this.parts.iterator;for(;d.next();){const t=d.value;null!==t.data&&(l.push(t.data),l.push(t.location))}this.Nv(),this.v2();for(let t=0;t<o.length;t++){const e=this.findPartForData(o[t]);null!==e&&(e.isSelected=!0)}for(let t=0;t<a.length;t++){const e=this.findPartForData(a[t]);null!==e&&(e.isHighlighted=!0)}for(let t=0;t<l.length;t+=2){const e=this.findPartForData(l[t]);null!==e&&(e.location=l[t+1])}e.Z(o),e.Z(a),e.Z(l)}v2(){const t=this.diagram.model;this.nw(t.nodeDataArray)}nw(t,e){const i=this.diagram.model;t.forEach((t=>{i.containsNodeData(t)&&this.Cv(t,!1)})),t.forEach((t=>{i.containsNodeData(t)&&this.Nk(t)})),!1!==e&&this.diagram.c1(!1)}Cv(t,e){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.Mo.has(t))return null;void 0===e&&(e=!0);const i=this.e3(t);return null!==i&&e&&this.Nk(t),i}e3(t){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.Mo.has(t))return null;const e=this.i3(t),i=this.findTemplateForNodeData(t,e);if(null!==i){i.It();const s=i.copy();if(null!==s){const i=this.diagram.wi;return this.diagram.wi=!0,s.Qo=e,s.te=t,this.addsToTemporaryLayer&&(s.ul="Tool"),this.diagram.add(s),s.te=null,s.data=t,this.diagram.wi=i,s}}return null}insertLink(t,e,i,s){return null}Nk(t){}i3(t){return this.diagram.model.getCategoryForNodeData(t)}static Lv=!1;static Av=!1;findTemplateForNodeData(t,i){const s=this.diagram,n=s.model;let o=null;return n.ff()&&n.isGroupForData(t)?(o=s.groupTemplateMap.get(i),null===o&&(o=s.groupTemplateMap.get(""),null===o&&(Ie.Av||(Ie.Av=!0,e.ne('No Group template found for category "'+i+'"'),e.ne("  Using default group template")),o=s.o2))):(o=s.nodeTemplateMap.get(i),null===o&&(o=s.nodeTemplateMap.get(""),null===o&&(Ie.Lv||(Ie.Lv=!0,e.ne('No Node template found for category "'+i+'"'),e.ne("  Using default node template")),o=s.e2))),o}getLinkCategoryForData(t){return""}setLinkCategoryForData(t,e){}setFromNodeForLink(t,e,i){}setToNodeForLink(t,e,i){}static Tv=!1;findLinkTemplateForCategory(t){const i=this.diagram;let s=i.linkTemplateMap.get(t);return null===s&&(s=i.linkTemplateMap.get(""),null===s&&(Ie.Tv||(Ie.Tv=!0,e.ne('No Link template found for category "'+t+'"'),e.ne("  Using default link template")),s=i.i2)),s}WI(t,e,i){t instanceof be?(null!==e&&this.Mv(e,t),null!==i&&this.Sv(i,t)):t instanceof ce&&(null!==e&&this.Mo.delete(e),null!==i&&this.Mo.set(i,t))}Nv(){const t=this.diagram.model;this.GC(t.nodeDataArray)}GC(t){t.forEach((t=>{this.Ck(t)}))}Ck(t){const e=this.findPartForData(t);null!==e&&(this.diagram.A2(e,!1),this.YC(e))}YC(t){}TC(t){}findPartForKey(t){if(null==t)return null;const e=this.diagram.model.findNodeDataForKey(t);return null!==e?this.Mo.get(e):null}findNodeForKey(t){if(null==t)return null;const e=this.diagram.model.findNodeDataForKey(t);if(null===e)return null;const i=this.Mo.get(e);return i instanceof me?i:null}findLinkForKey(t){return null}findPartForData(t){if(null===t)return null;let e=this.Mo.get(t);return null!==e||(e=this.yg.get(t)),e}findNodeForData(t){if(null===t)return null;const e=this.Mo.get(t);return e instanceof me?e:null}findLinkForData(t,e){return null===t?null:this.yg.get(t)}findNodesByExample(...t){const i=new u,s=this.pg.iterator;for(;s.next();){const t=s.value,n=t.data;if(null!==n)for(let s=0;s<arguments.length;s++){const o=arguments[s];if(e.$(o)&&this.KC(n,o)){i.add(t);break}}}return i.iterator}findLinksByExample(...t){const i=new u,s=this.on.iterator;for(;s.next();){const t=s.value,n=t.data;if(null!==n)for(let s=0;s<arguments.length;s++){const o=arguments[s];if(e.$(o)&&this.KC(n,o)){i.add(t);break}}}return i.iterator}KC(t,e){for(const i in e){const s=t[i],n=e[i];if(Array.isArray(n)){if(!Array.isArray(s))return!1;const t=s,e=n;if(t.length<e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],n=e[i];if(void 0!==n&&!this.Dv(s,n))return!1}}else if(!this.Dv(s,n))return!1}return!0}Dv(t,i){if(e.st(i)){if(!i(t))return!1}else if(i instanceof RegExp){if(!t||!i.test(t.toString()))return!1}else if(e.$(t)&&e.$(i)){if(!this.KC(t,i))return!1}else if(t!==i)return!1;return!0}doModelDataChanged(t){if(t.model===this.diagram.model&&this.diagram.G){this.diagram.G=!1;try{const e=t.change;""===t.modelChange&&null!==t.object&&2===e&&this.ow(t.object,t.propertyName)}finally{this.diagram.G=!0}}}doModelChanged(t){const i=this.diagram;if(!i||t.model!==i.model)return;const s=t.change;if(i.AO(t),i.G){i.G=!1;try{const n=t.modelChange;if(""!==n)if(2===s){if("nodeCategory"===n){const e=t.object;if(null!==e){const i=this.findPartForData(e),s=t.newValue;null!==i&&"string"==typeof s&&(i.category=s)}}else if("nodeDataArray"===n){const e=t.oldValue;this.GC(e);const i=t.newValue;this.nw(i)}i.isModified=!0}else if(3===s){const s=t.newValue;"nodeDataArray"===n&&e.$(s)&&this.Cv(s),i.isModified=!0}else if(4===s){const s=t.oldValue;"nodeDataArray"===n&&e.$(s)&&this.Ck(s),i.isModified=!0}else 1===s&&("SourceChanged"===n?null!==t.object?this.ow(t.object,t.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):"ModelDisplaced"===n&&this.rebuildParts());else if(2===s){const e=t.propertyName,s=t.object;s===i.model?("nodeKeyProperty"===e||"nodeCategoryProperty"===e)&&(i.undoManager.isUndoingRedoing||this.rebuildParts()):null!==s&&this.ow(s,e),i.isModified=!0}else(3===s||4===s)&&(this.s3(t,i.model),i.isModified=!0)}finally{i.G=!0}}}updateAllTargetBindings(t){void 0===t&&(t="");let e=this.parts.iterator;for(;e.next();)e.value.updateTargetBindings(t);for(e=this.nodes.iterator;e.next();)e.value.updateTargetBindings(t);for(e=this.links.iterator;e.next();)e.value.updateTargetBindings(t)}updateAllThemeBindings(){let t=this.parts.iterator;for(;t.next();)t.value.Go();for(t=this.nodes.iterator;t.next();)t.value.Go();for(t=this.links.iterator;t.next();)t.value.Go()}updateAllRelationshipsFromData(){const t=this.diagram.model,e=new u,i=t.nodeDataArray;for(let t=0;t<i.length;t++){const s=i[t];e.add(s)}const s=[];this.nodes.each((t=>{null!==t.data&&!e.has(t.data)&&s.push(t.data)})),this.parts.each((t=>{null!==t.data&&!e.has(t.data)&&s.push(t.data)})),s.forEach((e=>t.vv(e,!1)));for(let e=0;e<i.length;e++){const s=i[e];null===this.findPartForData(s)&&t.Fv(s,!1)}this.Rv();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}Rv(){}updateRelationshipsFromData(t){}ow(t,i){if("string"==typeof i){const s=this.findPartForData(t);if(null!==s)s.updateTargetBindings(i);else{const s=this.o3(t);if(null!==s&&s.length>0){for(let t=0;t<s.length;t++)s[t].updateTargetBindings(i);const t=s[0].part;if(null!==t){const e=t.adornments;for(;e.next();)e.value.updateTargetBindings(i)}e.Z(s)}}t===this.diagram.model.modelData&&this.updateAllTargetBindings(i)}}o3(t){let i=null;const s=this.wg.iterator;for(;s.next();){const n=s.value;for(let s=0;s<n.length;s++){const o=n[s].findItemPanelForData(t);null!==o&&(null===i&&(i=e.nt()),i.push(o))}if(null!==i)break}return i}HC(t){return this.wg.get(t)}s3(t,e){const i=t.object;if(!Array.isArray(i))return;const s=3===t.change,n=s?t.newParam:t.oldParam,o=s?t.newValue:t.oldValue,r=this.HC(i);if(Array.isArray(r))for(let t=0;t<r.length;t++){const e=r[t];s?e.Q1(o,n,!0):e.ZI(n)}}C2(t,e){null!==e&&t.Pn((t=>e.gT(t)));const i=t.Ta;if(Array.isArray(i)){const e=this.HC(i);if(null===e)this.wg.set(i,[t]);else{for(let i=0;i<e.length;i++)if(e[i]===t)return;e.push(t)}}}L2(t,e){t.Pn((t=>e.DO(t)));const i=t.Ta;if(Array.isArray(i)){const e=this.HC(i);if(null!==e)for(let s=0;s<e.length;s++)if(e[s]===t)return e.splice(s,1),void(0===e.length&&this.wg.delete(i))}}copyParts(t,e,i){void 0===i&&(i=!1);const s=new p;if(Array.isArray(t))for(let n=0;n<t.length;n++)this.Lk(t[n],e,s,i);else{const n=t.iterator;for(;n.next();)this.Lk(n.value,e,s,i)}if(null!==e){const t=e.model,i=e.Tp().dragsLink,n=new u,o=new p,r=s.iterator;for(;r.next();){const a=r.value;if(a instanceof be)!i&&(null===a.fromNode||null===a.toNode)&&n.add(a);else if(a instanceof me&&null!==a.data)if(t.Vm()){const i=a,n=r.key,h=n.findTreeParentNode();if(null!==h){const r=s.get(h);if(null!==r){t.setParentKeyForNodeData(i.data,t.getKeyForNodeData(r.data));const s=e.findLinkForData(i.data),a=n.findTreeParentLink();null!==a&&null!==s&&o.set(a,s)}}}else if(t.a1()){const i=a,n=r.key,h=t.isRelatedKeysPathTo?n.findNodesOutOf():n.findNodesInto();for(;h.next();){const r=h.value,a=s.get(r);if(null!==a){t.addRelatedKeyForNodeData(i.data,a.key);const s=e.partManager.findLinkForData(i.data,a.key),h=this.findLinkForData(n.data,r.key);null!==h&&null!==s&&o.set(h,s)}else t.removeRelatedKeyForNodeData(i.data,r.key)}}}if(n.count>0&&e.removeParts(n,!1),o.count>0){const t=o.iterator;for(;t.next();){const e=t.key,i=t.value;s.set(e,i)}}}if(null!==e&&null!==this.diagram){const t=e.model,i=t.afterCopyFunction;if(null!==i){const e=new p;s.each((t=>{null!==t.key.data&&e.set(t.key.data,t.value.data)}));const n=this.diagram.model;i(e,t,n)}}const n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}Lk(t,e,i,s){if(null===t||s&&!t.canCopy())return null;if(i.has(t))return i.get(t);const n=this.qC(t,e);if(!(n instanceof ce))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.set(t,n),t instanceof me){const o=t.linksConnected;for(;o.next();){const e=o.value;if(e.fromNode===t){const t=i.get(e);null!==t&&(t.fromNode=n)}if(e.toNode===t){const t=i.get(e);null!==t&&(t.toNode=n)}}if(t instanceof Ne&&n instanceof Ne){const o=t.memberParts;for(;o.next();){const t=o.value,r=this.Lk(t,e,i,s);r instanceof be||null!==r&&(r.containingGroup=n)}}}else if(t instanceof be&&n instanceof be){const o=t.fromNode;if(null!==o){const t=i.get(o);null!==t&&(n.fromNode=t)}const r=t.toNode;if(null!==r){const t=i.get(r);null!==t&&(n.toNode=t)}const a=t.labelNodes;for(;a.next();){const t=a.value,o=this.Lk(t,e,i,s);null!==o&&o instanceof me&&(o.labeledLink=n)}}return n}qC(t,e){let i=null;const s=t.data;if(null!==s&&null!==e){const n=e.model;if(!(t instanceof be)){const t=n.copyNodeData(s);n.addNodeData(t),i=e.findPartForData(t)}}else if(t.It(),i=t.copy(),null!==i){const t=this.diagram;if(null!==e)e.add(i);else if(null!==s&&null!==t&&null!==t.commandHandler&&t.commandHandler.copiesClipboardData){const e=t.model;let n=null;i instanceof be||(n=e.copyNodeData(s)),i.data=n}}return i}get nodes(){return this.pg}get links(){return this.on}get parts(){return this.Ct}get diagram(){return this.a}get addsToTemporaryLayer(){return this.XC}set addsToTemporaryLayer(t){this.XC=t}}var Ve=(t=>(t[t.OneWay=1]="OneWay",t[t.TwoWay=2]="TwoWay",t))(Ve||{});class ze{n;jC;nc;Kf;Va;Hf;qf;jf;Dk;Ti;Id;Df;constructor(t,i,s,n){u.Je(this),void 0===t?t="":e.s(t,"string",ze,"constructor:targetprop"),void 0===i?i=t:e.s(i,"string",ze,"constructor:sourceprop"),void 0===s?s=null:null!==s&&e.S(s,ze,"constructor:conv"),this.jC=-1,this.Ti=null,this.nc=t,this.Id=0,this.Df=0,this.Kf=null,this.Va=i,this.Hf=s,void 0===n?(this.qf=1,this.jf=null):(this.qf=2,this.jf=n),this.Dk=new u,this.n=2}copy(){const t=new this.constructor;return this.cloneProtected(t),t}cloneProtected(t){t.nc=this.nc,t.Id=this.Id,t.Df=this.Df,t.Kf=this.Kf,t.Va=this.Va,t.Hf=this.Hf,t.qf=this.qf,t.jf=this.jf,t.n=-2&this.n}static OneWay=1;static TwoWay=2;static parseEnum(t,i){return e.S(t,ze,"parseEnum:ctor"),s=>{let n=parseInt(s);return isNaN(n)&&(n=e.$a(t,s),null===n)?i:n}}fe(t){t in Ve?this.mode=t:e.ur(this,t)}static toString(t){return e.toString(t)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(-1!==this.targetId?" "+this.targetId:"")+" "+Ve[this.mode]+")"}k(){return this.n=1|this.n,this}get targetId(){return this.jC}set targetId(t){this.u&&e.L(this),this.jC=t}get targetProperty(){return this.nc}set targetProperty(t){this.u&&e.L(this),e.s(t,"string",ze,"targetProperty"),this.nc=t}get sourceProperty(){return this.Va}set sourceProperty(t){this.u&&e.L(this),e.s(t,"string",ze,"sourceProperty"),this.Va=t}get u(){return!!(1&this.n)}get isToData(){return!!(2&this.n)}get isToObject(){return!!(4&this.n)}get isToModel(){return!!(8&this.n)}get isToTheme(){return!!(16&this.n)}get WC(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}xd(){return!1}get sourceName(){return this.Kf}set sourceName(t){this.u&&e.L(this),null!==t&&e.s(t,"string",ze,"sourceName"),this.Kf=t,this.n=null!==t?-3&this.n|4:2|this.n}get converter(){return this.Hf}set converter(t){this.u&&e.L(this),null!==t&&e.S(t,ze,"converter"),this.Hf=t}get backConverter(){return this.jf}set backConverter(t){this.u&&e.L(this),null!==t&&e.S(t,ze,"backConverter"),this.jf=t}get mode(){return this.qf}set mode(t){this.u&&e.L(this),this.isToTheme&&2===t&&e.o("Theme Bindings cannot be TwoWay."),this.qf=t}makeTwoWay(t){return this.isToTheme&&e.o("Theme Bindings cannot be TwoWay."),this.mode=2,t&&(e.S(t,ze,"makeTwoWay"),this.backConverter=t),this}ofObject(t){return this.u&&e.L(this),void 0===t&&(t=""),this.sourceName=t,this}ofModel(){return this.u&&e.L(this),this.n=-3&this.n&-5|8,this.Kf=null,this}$T(t,e){const i=this.sourceName;let s=null;return s=null===i||""===i?t:"/"===i?e.part:"."===i?e:".."===i?e.panel:t.findObject(i),s}check(t){const i=this.nc,s=this.Va,n=this.Hf;(this.xd()&&null===n&&null===this.Ba&&""===i||null===n&&""===i)&&e.ne("Binding error: target property is the empty string: "+this.toString()),this.xd()&&this.WC&&""===s&&null===n&&null===this.Ba&&e.ne("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),t&&"string"==typeof i&&(!e.st(["setAttribute"])&&i.length>0&&"_"!==i[0]&&!e.qw(t,i)?e.ne("Binding error: undefined target property: "+i+" on "+t.toString()):"name"===i&&t instanceof At&&e.ne("Binding error: cannot modify GraphObject.name on "+t.toString()))}updateTarget(t,e,i,s){const n=this.Va;if(void 0!==i&&""!==n&&n!==i||this.isToTheme&&null===t.diagram)return;const o=this.nc,r=this.Hf;let a=e;if(""!==n&&!this.WC&&(a=Ue.St(e,n)),void 0!==a)if(null===r){if(""!==o){if(this.xd()){const e=t.diagram?.themeManager;if(a=this.Bv(e,a,t,o),void 0===a)return}s?s.et(t,o,a):(e instanceof At||e instanceof Jt)&&Ue.et(t,o,a)}}else try{if(""!==o){let i=r(a,t);if(this.xd()){const e=t.diagram?.themeManager;if(i=this.Bv(e,i,t,o),void 0===i)return}s?s.et(t,o,i):(e instanceof At||e instanceof Jt)&&Ue.et(t,o,i)}else r(a,t)}catch{}}updateSource(t,e,i,s){if(2!==this.qf)return;const n=this.nc;if(void 0!==i&&n!==i)return;const o=this.Va,r=this.jf,a=null!==s?s.diagram:null,h=null!==a?a.model:null;let l=t;if(""!==n&&(l=Ue.St(t,n)),void 0!==l&&!this.Dk.has(t))try{if(this.Dk.add(t),null===r){if(""!==o)null!==h?h.setDataProperty(e,o,l):(e instanceof At||e instanceof Jt)&&(e[o]=l);else if(null!==h&&null!==s&&s.itemIndex>=0&&null!==s.panel&&Array.isArray(s.panel.itemArray)){const t=s.itemIndex,e=s.panel.itemArray;h.removeArrayItem(e,t),h.insertArrayItem(e,t,l)}}else try{if(""!==o){const t=r(l,e,h);null!==h?h.setDataProperty(e,o,t):(e instanceof At||e instanceof Jt)&&(e[o]=t)}else{const t=r(l,e,h);if(void 0!==t&&null!==h&&null!==s&&s.itemIndex>=0&&null!==s.panel&&Array.isArray(s.panel.itemArray)){const e=s.itemIndex,i=s.panel.itemArray;h.removeArrayItem(i,e),h.insertArrayItem(i,e,t)}}}catch{}}finally{this.Dk.delete(t)}}}class Xe extends ze{aw;Ba;oc;constructor(t,e,i,s,n){super(t,e,s),null==i&&(i=""),void 0===n&&(n=null),this.aw=i,this.Ba=n,this.oc=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.aw=this.aw,t.Ba=this.Ba,t.oc=this.oc}xd(){return!0}get themeSource(){return this.aw}set themeSource(t){this.u&&e.L(this),null!==t&&e.s(t,"string",Xe,"themeSource"),this.aw=t,this.oc=null,this.n=null!==t?16|this.n:-17&this.n}get themeConverter(){return this.Ba}set themeConverter(t){this.u&&e.L(this),null!==t&&e.S(t,Xe,"themeConverter"),this.Ba=t}ofData(){return this.u&&e.L(this),this.n=2|this.n,this.Kf=null,this}Bv(i,s,n,o){if(!i||(this.WC&&(s=this.Va),!s&&0!==s))return;let r=this.themeSource;null!==this.oc?r=this.oc:"string"==typeof r&&r.includes(".")&&(this.oc=r.split("."),r=this.oc);let a=i.findValue(s,r,o);if(void 0===a&&e.ne(`Theme warning: ${s} could not be found when setting target property ${o}.`),i.readsCssVariables&&"string"==typeof a&&a.startsWith("var(")){const e=a.match(this.r3);e&&(a=getComputedStyle(t.document.documentElement).getPropertyValue(e[1]))}return e.st(this.Ba)&&(a=this.Ba(a,n)),a}r3=/var\((.*)\)/}class Ue{Pt;kg;Bo;JC;Bi;be;za;Wf;Jf;Pg;Sg;Mg;Ng;hw;rc;rr;cw;Vo;vk;constructor(t,e){if(u.Je(this),this.Pt="",this.kg="",this.Bo=!1,this.JC={},this.Bi=[],this.be=new p,this.za="key",this.Wf=null,this.Jf=null,this.Pg=!1,this.Sg=!1,this.Mg=!1,this.Ng=null,this.hw=100,this.rc="category",this.rr=new p,this.cw=[],this.Vo=!1,this.vk=null,this.undoManager=new E,void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);const t=e.Changed;t&&(delete this.Changed,this.addChangedListener(t))}}cloneProtected(t){t.Pt=this.Pt,t.kg=this.kg,t.Bo=this.Bo,t.za=this.za,t.Wf=this.Wf,t.Jf=this.Jf,t.Pg=this.Pg,t.Sg=this.Sg,t.Mg=this.Mg,t.Ng=this.Ng,t.hw=this.hw,t.rc=this.rc}copy(){const t=new this.constructor;return this.cloneProtected(t),t}clear(){this.Bi=[],this.be.clear(),this.rr.clear(),this.undoManager.clear()}toString(t){if(void 0===t&&(t=0),t>1)return this.toJson();{let i=(""!==this.name?this.name:"")+" Model";if(t>0){i+="\n node data:";const t=this.nodeDataArray,s=t.length;for(let n=0;n<s;n++){const s=t[n];i+=" "+this.getKeyForNodeData(s)+":"+e.toString(s)}}return i}}toIncrementalData(t){1!==t.change&&e.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+t.toString());const i=t.object;if(!(t.isTransactionFinished&&i instanceof B))return null;const s=this.zv(i);return this.$C(i,"FinishedUndo"===t.propertyName,s)}$C(t,e,i){const s=this;let n=!1;const o=new u,r=new u,a=new u;t.changes.each((t=>{if(t.model===s)if("nodeDataArray"===t.modelChange)3===t.change?o.add(t.newValue):4===t.change&&a.add(t.oldValue);else if(s.containsNodeData(t.object))null!==t.object&&r.add(t.object);else if(2!==t.change||s.modelData!==t.object&&"modelData"!==t.propertyName){if(null!==t.object)if(i.has(t.object)){const e=i.get(t.object);e&&e.each((t=>{s.containsNodeData(t)&&r.add(t)}))}else{if(t.object instanceof Ue||s.jh()&&s.containsLinkData(t.object))return;s.Xv(t.object).each((t=>{r.add(t)}))}}else n=!0}));const h=new u;o.each((t=>{const i=s.getKeyForNodeData(t);void 0!==i&&h.add(i),e||r.add(t)}));const l=new u;a.each((t=>{const i=s.getKeyForNodeData(t);void 0!==i&&l.add(i),e&&r.add(t)}));const c=s.cloneDeep(r.toArray());let d=null;return n&&(null===d&&(d={}),d.modelData=this.cloneDeep(this.modelData)),h.count>0&&(null===d&&(d={}),e?d.removedNodeKeys=h.toArray():d.insertedNodeKeys=h.toArray()),c.length>0&&(null===d&&(d={}),d.modifiedNodeData=c),l.count>0&&(null===d&&(d={}),e?d.insertedNodeKeys=l.toArray():d.removedNodeKeys=l.toArray()),d}cloneDeep(t){return this.Cg(t,!0)}Cg(t,i,s,n){if(!e.$(t))return t;s||(s=new p);const o=s.get(t);if(o)return o;let r;if(Array.isArray(t)){r=[],s.set(t,r);for(let e=0;e<t.length;e++){const i=t[e];r.push(this.Cg(i,!1,s,n))}}else if(t instanceof y||t instanceof x||t instanceof w||t instanceof b||t instanceof v)r=t.copy(),s.set(t,r);else{if(t instanceof Ut||t instanceof N)return t;if(t instanceof h)r=(new h).addAll(this.Cg(t.toArray(),!1,s,n)),s.set(t,r);else if(t instanceof u)r=(new u).addAll(this.Cg(t.toArray(),!1,s,n)),s.set(t,r);else if(t instanceof p)r=(new p).addAll(this.Cg(t.toArray(),!1,s,n)),s.set(t,r);else if(t instanceof Date)r=new Date(t),s.set(t,r);else if(t instanceof RegExp)r=new RegExp(t),s.set(t,r),r.lastIndex=t.lastIndex;else if(Ue.ZC(null,"",t))r=t;else if(e.st(t.copy))r=t.copy(),s.set(t,r);else{r={},s.set(t,r);for(const e in t){if("__gohashid"===e)continue;const i=t[e];r[e]=this.Cg(i,!1,s,n)}}}return r}quote(t){return JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,(t=>{const e="0000"+t.charCodeAt(0).toString(16);return"\\u"+e.substring(e.length-4)}))}Lg(){let t="";return""!==this.name&&(t+=',\n  "name": '+this.quote(this.name)),""!==this.dataFormat&&(t+=',\n  "dataFormat": '+this.quote(this.dataFormat)),this.isReadOnly&&(t+=',\n  "isReadOnly": '+this.isReadOnly),"key"!==this.nodeKeyProperty&&"string"==typeof this.nodeKeyProperty&&(t+=',\n  "nodeKeyProperty": '+this.quote(this.nodeKeyProperty)),this.copiesArrays&&(t+=',\n  "copiesArrays": true'),this.copiesArrayObjects&&(t+=',\n  "copiesArrayObjects": true'),this.copiesKey&&(t+=',\n  "copiesKey": true'),100!==this.pointsDigits&&(t+=',\n  "pointsDigits": '+this.pointsDigits.toString()),"category"!==this.nodeCategoryProperty&&"string"==typeof this.nodeCategoryProperty&&(t+=',\n  "nodeCategoryProperty": '+this.quote(this.nodeCategoryProperty)),t}fw(t){t.name&&(this.name=t.name),t.dataFormat&&(this.dataFormat=t.dataFormat),t.isReadOnly&&(this.isReadOnly=!0),t.nodeKeyProperty&&(this.nodeKeyProperty=t.nodeKeyProperty),t.copiesArrays&&(this.copiesArrays=!0),t.copiesArrayObjects&&(this.copiesArrayObjects=!0),void 0!==t.copiesKey&&(this.copiesKey=t.copiesKey),void 0!==t.pointsDigits&&(this.pointsDigits=parseInt(t.pointsDigits)),t.nodeCategoryProperty&&(this.nodeCategoryProperty=t.nodeCategoryProperty)}Gv(){const t=this.modelData;return',\n  "modelData": '+this.Yv(t)}Kv(t){const i=t.modelData;e.$(i)&&(this.replaceJsonObjects(i),this.modelData=i)}QC(){const t=this.modelData;let e=!1;for(const i in t)if(!this.Fk(t,i,t[i])){e=!0;break}let i="";return e&&(i=this.Gv()),i+',\n  "nodeDataArray": '+this.Xa(this.nodeDataArray,!0)}_C(t){this.Kv(t);const e=t.nodeDataArray;Array.isArray(e)&&(this.replaceJsonObjects(e),this.nodeDataArray=e)}tL(t,i,s){if(t===i)return!0;if(typeof t!=typeof i||e.st(t)||e.st(i))return!1;if(Array.isArray(t)&&Array.isArray(i)){if(s.get(t)===i)return!0;if(s.set(t,i),t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(!this.tL(t[e],i[e],s))return!1;return!0}if(e.$(t)&&e.$(i)){if(s.get(t)===i)return!0;s.set(t,i);for(const e in t){const n=t[e];if(this.Fk(t,e,n))continue;const o=i[e];if(void 0===o||!this.tL(n,o,s))return!1}for(const e in i){const n=i[e];if(this.Fk(i,e,n))continue;const o=t[e];if(void 0===o||!this.tL(o,n,s))return!1}return!0}return!1}static Hv=',\n  "insertedNodeKeys": ';static l3=',\n  "modifiedNodeData": ';static qv=',\n  "removedNodeKeys": ';zv(t){let e=new p;const i=(t,i)=>{const s=i.part;if(!s)return;const n=s.data;if(t===n)return;let o=e.get(t);null===o?(o=new u,o.add(n),e.set(t,o)):o.add(n)};return t.changes.each((t=>{if(null!==t.diagram){const e=t.change;if(2===e){if(null!==t.object){const e=t.object.panel;if(e){const t=e.data;t&&i(t,e)}}}else if(3===e||4===e){const e=t.object,s=e.itemArray;s&&i(s,e)}}})),e}Xv(t){const e=new u;for(let i=0;i<this.nodeDataArray.length;i++){const s=this.nodeDataArray[i];this.Rk(t,s,s,e)}return e}Rk(t,i,s,n){if(Array.isArray(i))for(let e=0;e<i.length;e++){const o=i[e];if(o===t)return n.add(s),!0;if(this.Rk(t,o,s,n))return!0}else if(e.$(i)&&Object.getPrototypeOf(i)===Object.prototype)for(const e in i){const o=i[e];if(o===t)return n.add(s),!0;if(this.Rk(t,o,s,n))return!0}return!1}eL(t,e,i){const s=this;let n=!1;const o=new u,r=new u,a=new u;t.changes.each((t=>{if(t.model===s)if("nodeDataArray"===t.modelChange)3===t.change?o.add(t.newValue):4===t.change&&a.add(t.oldValue);else if(s.containsNodeData(t.object))null!==t.object&&r.add(t.object);else if(2!==t.change||s.modelData!==t.object&&"modelData"!==t.propertyName){if(null!==t.object)if(i.has(t.object)){const e=i.get(t.object);e&&e.each((t=>{s.containsNodeData(t)&&r.add(t)}))}else{if(t.object instanceof Ue||s.jh()&&s.containsLinkData(t.object))return;s.Xv(t.object).each((t=>{r.add(t)}))}}else n=!0}));const h=new u;o.each((t=>{const i=s.getKeyForNodeData(t);void 0!==i&&h.add(i),e||r.add(t)}));const l=new u;a.each((t=>{const i=s.getKeyForNodeData(t);void 0!==i&&l.add(i),e&&r.add(t)}));let c="";return n&&(c+=this.Gv()),h.count>0&&(c+=(e?Ue.qv:Ue.Hv)+this.Xa(h.toArray(),!0)),r.count>0&&(c+=Ue.l3+this.Xa(r.toArray(),!0)),l.count>0&&(c+=(e?Ue.Hv:Ue.qv)+this.Xa(l.toArray(),!0)),c}uw(t){(void 0!==t.name&&t.name!==this.name||void 0!==t.dataFormat&&t.dataFormat!==this.dataFormat||void 0!==t.isReadOnly&&t.isReadOnly!==this.isReadOnly||void 0!==t.nodeKeyProperty&&t.nodeKeyProperty!==this.nodeKeyProperty||void 0!==t.copiesArrays&&t.copiesArrays!==this.copiesArrays||void 0!==t.copiesArrayObjects&&t.copiesArrayObjects!==this.copiesArrayObjects||void 0!==t.copiesKey&&t.copiesKey!==this.copiesKey||void 0!==t.nodeCategoryProperty&&t.nodeCategoryProperty!==this.nodeCategoryProperty)&&e.o("applyIncrementalJson cannot change Model properties"),this.Kv(t);const i=t.insertedNodeKeys,s=t.modifiedNodeData,n=new p;if(Array.isArray(s))for(let t=0;t<s.length;t++){const e=s[t],i=this.getKeyForNodeData(e);null!=i&&n.set(i,e)}if(Array.isArray(i)){const t=i.length;for(let e=0;e<t;e++){const t=i[e];let s=this.findNodeDataForKey(t);if(null===s){s=n.get(t)||this.copyNodeData({}),null!==s&&(this.setKeyForNodeData(s,t),this.addNodeData(s))}}}if(Array.isArray(s)){const t=s.length;for(let e=0;e<t;e++){const t=s[e],i=this.getKeyForNodeData(t),n=this.findNodeDataForKey(i);if(null!==n){for(const e in t)"__gohashid"===e||e===this.nodeKeyProperty||(this.Um()||this.a1())&&e===this.nodeIsGroupProperty||this.setDataProperty(n,e,t[e]);this.Ag(t,n)}}}const o=t.removedNodeKeys;if(Array.isArray(o)){const t=o.length;for(let e=0;e<t;e++){const t=o[e],i=this.findNodeDataForKey(t);null!==i&&this.removeNodeData(i)}}}toIncrementalJson(t,i){1!==t.change&&e.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+t.toString());const s=t.object;if(!(t.isTransactionFinished&&s instanceof B))return'{ "incremental": 0 }';void 0===i&&(i=e.Kn(this));const n=this.zv(s),o=this.eL(s,"FinishedUndo"===t.propertyName,n);return'{ "class": '+this.quote(i)+', "incremental": 1'+this.Lg()+o+"}"}toIncrementalJSON(t,e){return this.toIncrementalJson(t,e)}toJson(t){return void 0===t&&(t=e.Kn(this)),'{ "class": '+this.quote(t)+this.Lg()+this.QC()+"}"}toJSON(t){return this.toJson(t)}applyIncrementalJson(i){let s=null;if("string"==typeof i)try{s=t.JSON.parse(i)}catch{}else e.$(i)?s=i:e.o("Unable to modify a Model from: "+i);const n=s.incremental;"number"!=typeof n&&e.o("Unable to apply non-incremental changes to Model: "+i),0!==n&&(this.startTransaction("applyIncrementalJson"),this.uw(s),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(t){return this.applyIncrementalJson(t)}static fromJson(i,s){void 0===s&&(s=null),null!==s&&e.se(s,Ue,Ue,"fromJson:model");let n=null;if("string"==typeof i)try{n=t.JSON.parse(i)}catch{}else e.$(i)?n=i:e.o("Unable to construct a Model from: "+i);if(null===s){const t=Ue.a3(n);null===t||t instanceof Ue?s=t:e.o("Unable to construct a Model of declared class: "+n.class)}return null===s&&(s=Ue.jv()),s.fw(n),s._C(n),s}static fromJSON(t,e){return this.fromJson(t,e)}static jv(){return new Ue}static a3(i){let s=null,n=i.class;if("string"==typeof n)try{let i=null;0===n.indexOf("go.")?i=Ue.iL(n.substring(3)):(i=Ue.iL(n),null===i&&(i=t[n])),e.st(i)&&(s=new i)}catch{}return s}replaceJsonObjects(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++){const i=t[s];e.$(i)&&this.Wv(t,s,this.replaceJsonObjects(i))}}else if(e.$(t)){for(const i in t){const s=t[i];if(e.$(s)){const e=this.replaceJsonObjects(s);t[i]=e,this.replaceJsonPropertyValue(t,i,e)}}return this.h3(t)}return t}replaceJsonPropertyValue(t,e,i){if("points"===e&&Array.isArray(i)){let s=i.length%2==0;for(let t=0;t<i.length;t++)if("number"!=typeof i[t]){s=!1;break}if(s){const s=new h;for(let t=0;t<i.length/2;t++)s.add(new y(i[2*t],i[2*t+1]));t[e]=s}}}writeJsonValue(t){return void 0===t?"undefined":null===t?"null":!0===t?"true":!1===t?"false":"string"==typeof t?this.quote(t):"number"==typeof t?t===1/0?"9e9999":t===-1/0?"-9e9999":isNaN(t)?'{"class":"NaN"}':t.toString():t instanceof Boolean||t instanceof String||t instanceof Number?this.writeJsonValue(t.valueOf()):t instanceof Date?'{"class":"Date", "value":"'+t.toJSON()+'"}':Array.isArray(t)?this.Xa(t):e.$(t)?this.Yv(t):e.st(t)?"null":'"'+t.toString()+'"'}Xa(t,e){void 0===e&&(e=!1);const s=t.length;if(s<=0)return"[]";const n=new i;n.add("["),e&&s>1&&n.add("\n");for(let i=0;i<s;i++){const s=t[i];void 0!==s&&(i>0&&(n.add(","),e&&n.add("\n")),n.add(this.writeJsonValue(s)))}return e&&s>1&&n.add("\n"),n.add("]"),n.toString()}Fk(t,i,s){return!(void 0!==s&&"__gohashid"!==i&&"_"!==i[0]&&!e.st(s))}qe(t){return isNaN(t)?"NaN":t===1/0?"9e9999":t===-1/0?"-9e9999":t}Yv(t){const e=t;if(e instanceof y)t={class:"go.Point",x:this.qe(e.x),y:this.qe(e.y)};else if(e instanceof x)t={class:"go.Size",width:this.qe(e.width),height:this.qe(e.height)};else if(e instanceof w)t={class:"go.Rect",x:this.qe(e.x),y:this.qe(e.y),width:this.qe(e.width),height:this.qe(e.height)};else if(e instanceof b)t={class:"go.Margin",top:this.qe(e.top),right:this.qe(e.right),bottom:this.qe(e.bottom),left:this.qe(e.left)};else if(e instanceof v)t=e.isSpot()?{class:"go.Spot",x:this.qe(e.x),y:this.qe(e.y),offsetX:this.qe(e.offsetX),offsetY:this.qe(e.offsetY)}:{class:"go.Spot",enum:e.toString()};else if(e instanceof Ut){if(t={class:"go.Brush",type:Vt[e.type]},1===e.type?t.color=e.color:(2===e.type||3===e.type)&&(t.start=e.start,t.end=e.end,3===e.type&&(0!==e.startRadius&&(t.startRadius=this.qe(e.startRadius)),isNaN(e.endRadius)||(t.endRadius=this.qe(e.endRadius)))),null!==e.colorStops){const i={},s=e.colorStops.iterator;for(;s.next();){const t=s.key,e=s.value;i[t]=e}t.colorStops=i}}else if(e instanceof N)t={class:"go.Geometry",type:M[e.type]},0!==e.startX&&(t.startX=this.qe(e.startX)),0!==e.startY&&(t.startY=this.qe(e.startY)),0!==e.endX&&(t.endX=this.qe(e.endX)),0!==e.endY&&(t.endY=this.qe(e.endY)),e.spot1.equals(v.TopLeft)||(t.spot1=e.spot1),e.spot2.equals(v.BottomRight)||(t.spot2=e.spot2),4===e.type&&(t.path=N.stringify(e));else if(Ue.ZC(null,"",e))return"{}";let i="{",s=!0;for(const e in t){const n=this.St(t,e);this.Fk(t,e,n)||(s?s=!1:i+=",",i+=this.quote(e)+":"+this.writeJsonPropertyValue(e,n))}return i+="}",i}writeJsonPropertyValue(t,e){if("points"===t&&e instanceof h){let t="[";const i=e.iterator;for(;i.next();){const e=i.value;t.length>1&&(t+=","),t+=this.Jv(e.x),t+=",",t+=this.Jv(e.y)}return t+="]",t}return this.writeJsonValue(e)}Jv(t){if(t===1/0)return"9e9999";if(t===-1/0)return"-9e9999";if(isNaN(t))return"0";const e=this.pointsDigits;return e>16?t.toString():t.toFixed(e)}get pointsDigits(){return this.hw}set pointsDigits(t){t<0?t=0:t>100&&(t=100),this.hw=t}je(t){return"number"==typeof t?t:"NaN"===t?NaN:"9e9999"===t?1/0:"-9e9999"===t?-1/0:parseFloat(t)}h3(t){if(!e.$(t))return t;let i=t.class||"";if("string"!=typeof i||""===i)return t;if("NaN"===i)return NaN;if("Date"===i)return new Date(t.value);if(0!==i.indexOf("go."))return t;i=i.substring(3);let s=t;if("Point"===i)s=new y(this.je(t.x),this.je(t.y));else if("Size"===i)s=new x(this.je(t.width),this.je(t.height));else if("Rect"===i)s=new w(this.je(t.x),this.je(t.y),this.je(t.width),this.je(t.height));else if("Margin"===i)s=new b(this.je(t.top),this.je(t.right),this.je(t.bottom),this.je(t.left));else if("Spot"===i)s="string"==typeof t.enum?v.parse(t.enum):new v(this.je(t.x),this.je(t.y),this.je(t.offsetX),this.je(t.offsetY));else if("Brush"===i){const i=new Ut;i.type=e.$a(Vt,t.type)??1,"string"==typeof t.color&&(i.color=t.color),t.start instanceof v&&(i.start=t.start),t.end instanceof v&&(i.end=t.end),"number"==typeof t.startRadius&&(i.startRadius=this.je(t.startRadius)),"number"==typeof t.endRadius&&(i.endRadius=this.je(t.endRadius));const n=t.colorStops;if(e.$(n))for(const t in n){const e=parseFloat(t);i.addColorStop(e,n[t])}s=i}else if("Geometry"===i){let i=null;i="string"==typeof t.path?N.parse(t.path):new N,i.type=e.$a(M,t.type)??1,"number"==typeof t.startX&&(i.startX=this.je(t.startX)),"number"==typeof t.startY&&(i.startY=this.je(t.startY)),"number"==typeof t.endX&&(i.endX=this.je(t.endX)),"number"==typeof t.endY&&(i.endY=this.je(t.endY)),t.spot1 instanceof v&&(i.spot1=t.spot1),t.spot2 instanceof v&&(i.spot2=t.spot2),s=i}else if("EnumValue"===i){let i=t.classType;0===i.indexOf("go.")&&(i=i.substring(3));const n=Ue.iL(i);e.st(n)&&(s=e.$a(n,t.name))}return s}get name(){return this.Pt}set name(t){const i=this.Pt;i!==t&&(e.s(t,"string",Ue,"name"),this.Pt=t,this.t("name",i,t))}get dataFormat(){return this.kg}set dataFormat(t){const i=this.kg;i!==t&&(e.s(t,"string",Ue,"dataFormat"),this.kg=t,this.t("dataFormat",i,t))}get isReadOnly(){return this.Bo}set isReadOnly(t){const i=this.Bo;i!==t&&(e.s(t,"boolean",Ue,"isReadOnly"),this.Bo=t,this.t("isReadOnly",i,t))}get modelData(){return this.JC}set modelData(t){const i=this.modelData;i!==t&&(e.wc(t,Ue,"modelData"),this.containsNodeData(t)&&e.o("Model.modelData Object must not be used by the rest of the model: "+t),this.JC=t,this.t("modelData",i,t),this.updateTargetBindings(t))}addChangedListener(t){return e.S(t,Ue,"addChangedListener:listener"),this.cw.push(t),this}removeChangedListener(t){e.S(t,Ue,"removeChangedListener:listener");const i=this.cw.indexOf(t);i>=0&&this.cw.splice(i,1)}D2(t){this.skipsUndoManager||this.undoManager.handleChanged(t),this.$v(t)}$v(t){this.cw.forEach((e=>e(t)))}lR(t){this.$v(t)}raiseChangedEvent(t,e,i,s,n,o,r){this.Ft("",t,e,i,s,n,o,r)}raiseChanged(t,e,i,s,n){this.Ft("",2,t,this,e,i,s,n)}t(t,e,i,s,n){this.Ft("",2,t,this,e,i,s,n)}raiseDataChanged(t,e,i,s,n,o){this.Ft("",2,e,t,i,s,n,o)}Ft(t,e,i,s,n,o,r,a){void 0===r&&(r=null),void 0===a&&(a=null);const h=new R;h.model=this,h.change=e,h.modelChange=t,h.propertyName=i,h.object=s,h.oldValue=n,h.oldParam=r,h.newValue=o,h.newParam=a,this.D2(h)}get undoManager(){return this.vk}set undoManager(t){const e=this.vk;e!==t&&(e&&e.removeModel(this),this.vk=t,t.addModel(this))}get skipsUndoManager(){return this.Vo}set skipsUndoManager(t){e.s(t,"boolean",Ue,"skipsUndoManager"),this.Vo=t}changeState(t,i){if(null!==t&&t.model===this)if(2===t.change){const e=t.object,s=t.propertyName,n=t.getValue(i);if(null!==e&&s===this.nodeKeyProperty&&this.containsNodeData(e)){const s=t.getValue(!i);void 0!==s&&this.be.delete(s),void 0!==n&&this.be.set(n,e)}this.et(e,s,n)}else if(3===t.change){const s=t.newParam;if("nodeDataArray"===t.modelChange){const n=t.newValue;if(e.$(n)&&"number"==typeof s){const t=this.getKeyForNodeData(n);i?(this.Bi[s]===n&&this.No(this.Bi,s),void 0!==t&&this.be.delete(t)):(this.Bi[s]!==n&&this.lr(this.Bi,s,n),void 0!==t&&this.be.set(t,n))}}else if(""===t.modelChange){let e=t.object;if(e&&!Array.isArray(e)&&t.propertyName&&(e=this.St(e,t.propertyName)),Array.isArray(e)&&"number"==typeof s){const n=t.newValue;i?this.No(e,s):this.lr(e,s,n)}}else e.o("unknown ChangeType.Insert modelChange: "+t.toString())}else if(4===t.change){const s=t.oldParam;if("nodeDataArray"===t.modelChange){const n=t.oldValue;if(e.$(n)&&"number"==typeof s){const t=this.getKeyForNodeData(n);i?(this.Bi[s]!==n&&this.lr(this.Bi,s,n),void 0!==t&&this.be.set(t,n)):(this.Bi[s]===n&&this.No(this.Bi,s),void 0!==t&&this.be.delete(t))}}else if(""===t.modelChange){let e=t.object;if(e&&!Array.isArray(e)&&t.propertyName&&(e=this.St(e,t.propertyName)),Array.isArray(e)&&"number"==typeof s){const n=t.oldValue;i?this.lr(e,s,n):this.No(e,s)}}else e.o("unknown ChangeType.Remove modelChange: "+t.toString())}else 1===t.change||e.o("unknown ChangedEvent: "+t.toString())}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;void 0===i&&(i="");const s=this.skipsUndoManager;null===i&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(t,e){void 0===e&&(e=""),this.Ft("SourceChanged",1,e,t,null,null)}get nodeKeyProperty(){return this.za}set nodeKeyProperty(t){const i=this.za;i!==t&&(this.En(t,Ue,"nodeKeyProperty"),""===t&&e.o("Model.nodeKeyProperty may not be the empty string"),this.be.count>0&&e.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.za=t,this.t("nodeKeyProperty",i,t))}En(t,i,s){"string"!=typeof t&&!e.st(t)&&e.si(t,"string or function",i,s)}getKeyForNodeData(t){if(null===t)return;const i=this.za;if(""===i)return;const s=this.St(t,i);if(void 0!==s){if(this.isKeyType(s))return s;e.o("Key value for node data "+t+" is not a number or a string: "+s)}}setKeyForNodeData(t,i){if((null==i||!this.isKeyType(i))&&e.si(i,"number or string",Ue,"setKeyForNodeData:key"),null===t)return;const s=this.za;if(""===s)return;if(!this.containsNodeData(t))return void this.et(t,s,i);const n=this.St(t,s);if(n!==i){if(null!==this.findNodeDataForKey(i))return;this.et(t,s,i),void 0!==n&&this.be.delete(n),this.be.set(i,t),this.Ft("nodeKey",2,s,t,n,i),"string"==typeof s&&this.updateTargetBindings(t,s),this.dw(n,i)}}get makeUniqueKeyFunction(){return this.Wf}set makeUniqueKeyFunction(t){const i=this.Wf;i!==t&&(null!==t&&e.S(t,Ue,"makeUniqueKeyFunction"),this.Wf=t,this.t("makeUniqueKeyFunction",i,t))}isKeyType(t){return"number"==typeof t||"string"==typeof t}containsNodeData(t){if(null===t)return!1;const e=this.getKeyForNodeData(t);return void 0!==e&&this.be.get(e)===t}findNodeDataForKey(t){return null===t&&e.o("Model.findNodeDataForKey:key must not be null"),void 0!==t&&this.isKeyType(t)?this.be.get(t):null}get nodeDataArray(){return this.Bi}set nodeDataArray(t){const i=this.Bi;if(i!==t){this.sL(t,Ue,"nodeDataArray"),this.be.clear(),this.nL();const s=t.length;for(let i=0;i<s;i++){const s=t[i];e.$(s)||e.o("Model.nodeDataArray must only contain Objects, not: "+s),s===this.modelData&&e.o("nodeDataArray Objects must not be the shared Model.modelData")}this.Bi=t;const n=new h;for(let e=0;e<s;e++){const i=t[e],s=this.getKeyForNodeData(i);void 0===s||null!==this.be.get(s)?n.add(i):this.be.set(s,i)}const o=n.iterator;for(;o.next();){const t=o.value;this.makeNodeDataKeyUnique(t);const e=this.getKeyForNodeData(t);void 0!==e&&this.be.set(e,t)}this.Ft("nodeDataArray",2,"nodeDataArray",this,i,t);for(let e=0;e<s;e++){const i=t[e];this.Tg(i),this.Dg(i)}}}Ok(t){return void 0!==t&&this.be.has(t)}makeNodeDataKeyUnique(t){if(null===t)return;const e=this.za;if(""===e)return;let i=this.getKeyForNodeData(t);if(void 0!==i&&!this.Ok(i))return;const s=this.Wf;if(null===s||(i=s(this,t),null==i||this.Ok(i))){if("string"==typeof i){let s=2;for(;this.Ok(i+s);)s++;this.et(t,e,i+s)}else if(void 0===i||"number"==typeof i){let i=-this.be.count-1;for(;this.Ok(i);)i--;this.et(t,e,i)}}else this.et(t,e,i)}addNodeData(t){null!==t&&(t===this.modelData&&e.o("Model.addNodeData cannot add the shared Model.modelData Object"),this.containsNodeData(t)||this.Fv(t,!0))}Fv(t,i){let s=this.getKeyForNodeData(t);if(void 0===s)this.makeNodeDataKeyUnique(t),s=this.getKeyForNodeData(t);else{if(this.be.get(s)===t)return;this.makeNodeDataKeyUnique(t),s=this.getKeyForNodeData(t)}void 0===s&&e.o("Model.makeNodeDataKeyUnique failed on "+t+".  Data not added to Model."),this.be.set(s,t);let n=null;i&&(n=this.Bi.length,this.lr(this.Bi,n,t)),this.Ft("nodeDataArray",3,"nodeDataArray",this,null,t,null,n),this.Tg(t),this.Dg(t)}addNodeDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.addNodeData(t[i])}else{const e=t.iterator;for(;e.next();){const t=e.value;this.addNodeData(t)}}}removeNodeData(t){null!==t&&this.vv(t,!0)}vv(t,e){const i=this.getKeyForNodeData(t);void 0!==i&&this.be.delete(i);let s=null;if(e){if(s=this.Bi.indexOf(t),s<0)return;this.No(this.Bi,s)}this.Ft("nodeDataArray",4,"nodeDataArray",this,t,null,s,null),this.gw(t)}removeNodeDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.removeNodeData(t[i])}else{const e=t.iterator;for(;e.next();){const t=e.value;this.removeNodeData(t)}}}mergeNodeDataArray(t){if(t===this.nodeDataArray||!Array.isArray(t))return;const e=new u;e.addAll(this.be.iteratorKeys);const i=new u,s=t.length;for(let e=0;e<s;e++){const s=t[e],n=this.getKeyForNodeData(s);if(void 0!==n){i.add(n);const t=this.findNodeDataForKey(n);if(t===s)continue;if(null!==t)this.assignAllDataProperties(t,s),this.Ag(s,t);else{const t=this.cloneDeep(s);this.setKeyForNodeData(t,n),this.addNodeData(t)}}else{const t=this.cloneDeep(s);this.addNodeData(t);const e=this.getKeyForNodeData(t);void 0!==e&&i.add(e)}}const n=e.iterator;for(;n.next();){const t=n.value;if(!i.has(t)){const e=this.findNodeDataForKey(t);e&&this.removeNodeData(e)}}}dw(t,e){if(void 0===e)return;const i=this.lw(t);i instanceof u&&this.rr.set(e,i)}nL(){}Tg(t){}Dg(t){}gw(t){}an(t,e){if(void 0===t)return;let i=this.rr.get(t);null===i&&(i=new u,this.rr.set(t,i)),i.add(e)}ln(t,e){if(void 0===t)return;const i=this.rr.get(t);i instanceof u&&(null==e?this.rr.delete(t):(i.delete(e),0===i.count&&this.rr.delete(t)))}lw(t){if(void 0===t)return null;const e=this.rr.get(t);return e instanceof u?e:null}GU(t){void 0===t?this.rr.clear():this.rr.delete(t)}get copyNodeDataFunction(){return this.Jf}set copyNodeDataFunction(t){const i=this.Jf;i!==t&&(null!==t&&e.S(t,Ue,"copyNodeDataFunction"),this.Jf=t,this.t("copyNodeDataFunction",i,t))}get copiesArrays(){return this.Pg}set copiesArrays(t){const i=this.Pg;i!==t&&(null!==t&&e.s(t,"boolean",Ue,"copiesArrays"),this.Pg=t,this.t("copiesArrays",i,t))}get copiesArrayObjects(){return this.Sg}set copiesArrayObjects(t){const i=this.Sg;i!==t&&(null!==t&&e.s(t,"boolean",Ue,"copiesArrayObjects"),this.Sg=t,this.t("copiesArrayObjects",i,t))}get copiesKey(){return this.Mg}set copiesKey(t){const i=this.Mg;i!==t&&(null!==t&&e.s(t,"boolean",Ue,"copiesKey"),this.Mg=t,this.t("copiesKey",i,t))}copyNodeData(t){let e=null;const i=this.Jf;return e=null!==i?i(t,this):this.Ik(t,!0),e}Ik(t,i){if(e.$(t)){if(Array.isArray(t)){if(this.copiesArrays){const e=t,i=[];for(let t=0;t<e.length;t++){const s=e[t],n=this.Ik(s,this.copiesArrayObjects);i.push(n)}return i}return t}if(t instanceof y||t instanceof x||t instanceof w||t instanceof b||t instanceof v)return t.copy();if(i){const i=t,s=i.constructor,n=s?new s:{},o=this.copiesKey||"string"!=typeof this.nodeKeyProperty?null:this.nodeKeyProperty;for(const t in i){if("__gohashid"===t){n.__gohashid=void 0;continue}if(t===o){n[o]=void 0;continue}const s=this.St(i,t);if(e.$(s))if(Ue.ZC(i,t,s))this.et(n,t,s);else{const e=this.Ik(s,!1);this.et(n,t,e)}else n[t]=s}return n}return t}return t}get afterCopyFunction(){return this.Ng}set afterCopyFunction(t){const i=this.Ng;i!==t&&(null!==t&&e.S(t,Ue,"afterCopyFunction"),this.Ng=t,this.t("afterCopyFunction",i,t))}static ZC(t,i,s){const n=e.Kn(s);return s instanceof Ue||s instanceof E||s instanceof B||s instanceof R||s instanceof At||s instanceof Jt||s instanceof wt||s instanceof EventTarget||"Layer"===n||"RowColumnDefinition"===n||n.indexOf("Animation")>=0||n.indexOf("Tool")>=0||n.indexOf("CommandHandler")>=0||n.indexOf("Layout")>=0}static Zv=!1;setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty)return void this.setKeyForNodeData(t,s);if(i===this.nodeCategoryProperty)return void this.setCategoryForNodeData(t,s)}else!Ue.Zv&&t instanceof At&&(Ue.Zv=!0,e.ne('Model.setDataProperty is modifying a GraphObject, "'+t.toString()+'"'),e.ne("  Is that really your intent?"));const n=this.St(t,i);n!==s&&(this.et(t,i,s),this.raiseDataChanged(t,i,n,s))}set(t,e,i){this.setDataProperty(t,e,i)}assignAllDataProperties(t,e){if(!e)return;const i=this.containsNodeData(t);for(const s in e)"__gohashid"!==s&&(i&&s===this.nodeKeyProperty||this.setDataProperty(t,s,e[s]))}addArrayItem(t,e){this.insertArrayItem(t,-1,e)}insertArrayItem(t,e,i){e<0&&(e=t.length),t=this.lr(t,e,i),this.Ft("",3,"",t,null,i,null,e)}removeArrayItem(t,i){void 0===i&&(i=-1),t===this.Bi&&e.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),-1===i&&(i=t.length-1);const s=t[i];t=this.No(t,i),this.Ft("",4,"",t,s,null,i,null)}get nodeCategoryProperty(){return this.rc}set nodeCategoryProperty(t){const e=this.rc;e!==t&&(this.En(t,Ue,"nodeCategoryProperty"),this.rc=t,this.t("nodeCategoryProperty",e,t))}getCategoryForNodeData(t){if(null===t)return"";const i=this.rc;if(""===i)return"";const s=this.St(t,i);return void 0===s?"":"string"==typeof s?s:void e.o("getCategoryForNodeData found a non-string category for "+t+": "+s)}setCategoryForNodeData(t,i){if(e.s(i,"string",Ue,"setCategoryForNodeData:cat"),null===t)return;const s=this.rc;if(""===s)return;if(!this.containsNodeData(t))return void this.et(t,s,i);let n=this.St(t,s);void 0===n&&(n=""),n!==i&&(this.et(t,s,i),this.Ft("nodeCategory",2,s,t,n,i))}Ag(t,e){this.setCategoryForNodeData(e,this.getCategoryForNodeData(t))}get type(){return"Model"}Vm(){return!1}Um(){return!1}a1(){return!1}jh(){return!1}Ax(){return!1}ff(){return!1}static p2(){return new Ue}St(t,e){return Ue.St(t,e)}static St(t,i){if(!t||!i)return null;let s;try{e.st(i)?s=i(t):e.st(t.getAttribute)?(s=t.getAttribute(i),null===s&&(s=void 0)):s=t[i]}catch{}return s}et(t,e,i){Ue.et(t,e,i)}static et(t,i,s){if(t&&i){try{e.st(i)?i(t,s):e.st(t.setAttribute)?t.setAttribute(i,s):t[i]=s}catch{}return t}}sL(t,i,s){Array.isArray(t)||e.si(t,"Array",i,s)}Wv(t,e,i){return t[e]=i,t}lr(t,e,i){return e>=t.length?t.push(i):t.splice(e,0,i),t}No(t,e){return e>=t.length?t.pop():t.splice(e,1),t}static iL(e){return Ue.oL[e]?Ue.oL[e]:void 0!==t.go&&t.go[e]?t.go[e]:null}static Sl(t,e){Ue.oL[e]=t}static oL={}}Ue.fromJSON=Ue.fromJson=Ue.fromJson,Ue.Sl(Ut,"Brush"),Ue.Sl(N,"Geometry"),Ue.Sl(b,"Margin"),Ue.Sl(y,"Point"),Ue.Sl(w,"Rect"),Ue.Sl(x,"Size"),Ue.Sl(v,"Spot"),Ue.Sl(Ue,"Model");class je extends Ue{Os;ar;Oe;Ga;$f;Zf;Vl;Co;Lo;lc;ac;hc;hn;Qf;Un;vg;constructor(t,e,i){if(super(),this.Os=[],this.ar=new u,this.Oe=new p,this.Ga="",this.$f=null,this.Zf=null,this.Vl=null,this.Co="from",this.Lo="to",this.lc="",this.ac="",this.hc="category",this.hn="",this.Qf="isGroup",this.Un="group",this.vg=!1,void 0!==e&&(this.linkDataArray=e),void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const t=i.Changed;t&&(delete this.Changed,this.addChangedListener(t))}}cloneProtected(t){super.cloneProtected(t),t.Ga=this.Ga,t.$f=this.$f,t.Zf=this.Zf,t.Co=this.Co,t.Lo=this.Lo,t.lc=this.lc,t.ac=this.ac,t.hc=this.hc,t.hn=this.hn,t.Qf=this.Qf,t.Un=this.Un,t.vg=this.vg}clear(){this.Os=[],this.Oe.clear(),this.ar.clear(),super.clear()}toString(t){if(void 0===t&&(t=0),t>=2)return this.toJson();{let e=(""!==this.name?this.name:"")+" GraphLinksModel";if(t>0){e+="\n node data:";let t=this.nodeDataArray,i=t.length,s=0;for(s=0;s<i;s++){const i=t[s];e+=" "+this.getKeyForNodeData(i)+":"+ze.toString(i)}for(e+="\n link data:",t=this.linkDataArray,i=t.length,s=0;s<i;s++){const i=t[s];e+=" "+this.Vi(i,!0)+"--\x3e"+this.Vi(i,!1)}}return e}}$C(t,e,i){if(""===this.linkKeyProperty){const t=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=t}let s=super.$C(t,e,i);const n=this,o=new u,r=new u,a=new u;t.changes.each((t=>{if(t.model===n)if("linkDataArray"===t.modelChange)3===t.change?o.add(t.newValue):4===t.change&&a.add(t.oldValue);else if(n.containsLinkData(t.object))null!==t.object&&r.add(t.object);else if(null!==t.object)if(null!==t.object&&i.has(t.object)){const e=i.get(t.object);e&&e.each((t=>{n.containsLinkData(t)&&r.add(t)}))}else{if(t.object instanceof Ue||n.containsNodeData(t.object))return;n.Qv(t.object).each((t=>r.add(t)))}}));const h=new u;o.each((t=>{const i=n.getKeyForLinkData(t);void 0!==i&&h.add(i),e||r.add(t)}));const l=new u;a.each((t=>{const i=n.getKeyForLinkData(t);void 0!==i&&l.add(i),e&&r.add(t)}));const c=n.cloneDeep(r.toArray());return h.count>0&&(null===s&&(s={}),e?s.removedLinkKeys=h.toArray():s.insertedLinkKeys=h.toArray()),c.length>0&&(null===s&&(s={}),s.modifiedLinkData=c),l.count>0&&(null===s&&(s={}),e?s.insertedLinkKeys=l.toArray():s.removedLinkKeys=l.toArray()),s}Lg(){const t=super.Lg();let e="";return"category"!==this.linkCategoryProperty&&"string"==typeof this.linkCategoryProperty&&(e+=',\n  "linkCategoryProperty": '+this.quote(this.linkCategoryProperty)),""!==this.linkKeyProperty&&"string"==typeof this.linkKeyProperty&&(e+=',\n  "linkKeyProperty": '+this.quote(this.linkKeyProperty)),"from"!==this.linkFromKeyProperty&&"string"==typeof this.linkFromKeyProperty&&(e+=',\n  "linkFromKeyProperty": '+this.quote(this.linkFromKeyProperty)),"to"!==this.linkToKeyProperty&&"string"==typeof this.linkToKeyProperty&&(e+=',\n  "linkToKeyProperty": '+this.quote(this.linkToKeyProperty)),""!==this.linkFromPortIdProperty&&"string"==typeof this.linkFromPortIdProperty&&(e+=',\n  "linkFromPortIdProperty": '+this.quote(this.linkFromPortIdProperty)),""!==this.linkToPortIdProperty&&"string"==typeof this.linkToPortIdProperty&&(e+=',\n  "linkToPortIdProperty": '+this.quote(this.linkToPortIdProperty)),""!==this.linkLabelKeysProperty&&"string"==typeof this.linkLabelKeysProperty&&(e+=',\n  "linkLabelKeysProperty": '+this.quote(this.linkLabelKeysProperty)),"isGroup"!==this.nodeIsGroupProperty&&"string"==typeof this.nodeIsGroupProperty&&(e+=',\n  "nodeIsGroupProperty": '+this.quote(this.nodeIsGroupProperty)),"group"!==this.nodeGroupKeyProperty&&"string"==typeof this.nodeGroupKeyProperty&&(e+=',\n  "nodeGroupKeyProperty": '+this.quote(this.nodeGroupKeyProperty)),t+e}fw(t){super.fw(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}QC(){return super.QC()+(',\n  "linkDataArray": '+this.Xa(this.linkDataArray,!0))}_C(t){super._C(t);const e=t.linkDataArray;Array.isArray(e)&&(this.replaceJsonObjects(e),this.linkDataArray=e)}_v=',\n  "insertedLinkKeys": ';c3=',\n  "modifiedLinkData": ';tF=',\n  "removedLinkKeys": ';Qv(t){const e=new u;for(let i=0;i<this.linkDataArray.length;i++){const s=this.linkDataArray[i];this.Rk(t,s,s,e)}return e}eL(t,e,i){if(""===this.linkKeyProperty){const t=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=t}const s=super.eL(t,e,i),n=this,o=new u,r=new u,a=new u;t.changes.each((t=>{if(t.model===n)if("linkDataArray"===t.modelChange)3===t.change?o.add(t.newValue):4===t.change&&a.add(t.oldValue);else if(n.containsLinkData(t.object))null!==t.object&&r.add(t.object);else if(null!==t.object)if(null!==t.object&&i.has(t.object)){const e=i.get(t.object);e&&e.each((t=>{n.containsLinkData(t)&&r.add(t)}))}else{if(t.object instanceof Ue||n.containsNodeData(t.object))return;n.Qv(t.object).each((t=>r.add(t)))}}));const h=new u;o.each((t=>{const i=n.getKeyForLinkData(t);void 0!==i&&h.add(i),e||r.add(t)}));const l=new u;a.each((t=>{const i=n.getKeyForLinkData(t);void 0!==i&&l.add(i),e&&r.add(t)}));let c=s;return h.count>0&&(c+=(e?this.tF:this._v)+this.Xa(h.toArray(),!0)),r.count>0&&(c+=this.c3+this.Xa(r.toArray(),!0)),l.count>0&&(c+=(e?this._v:this.tF)+this.Xa(l.toArray(),!0)),c}uw(t){(void 0!==t.linkCategoryProperty&&t.linkCategoryProperty!==this.linkCategoryProperty||void 0!==t.linkKeyProperty&&t.linkKeyProperty!==this.linkKeyProperty||void 0!==t.linkFromKeyProperty&&t.linkFromKeyProperty!==this.linkFromKeyProperty||void 0!==t.linkToKeyProperty&&t.linkToKeyProperty!==this.linkToKeyProperty||void 0!==t.linkFromPortIdProperty&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||void 0!==t.linkToPortIdProperty&&t.linkToPortIdProperty!==this.linkToPortIdProperty||void 0!==t.linkLabelKeysProperty&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||void 0!==t.nodeIsGroupProperty&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||void 0!==t.nodeGroupKeyProperty&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&e.o("applyIncrementalJson cannot change Model properties"),super.uw(t);const i=t.insertedLinkKeys;if(Array.isArray(i)){const t=i.length;for(let e=0;e<t;e++){const t=i[e];let s=this.findLinkDataForKey(t);null===s&&(s=this.copyLinkData({}),this.setKeyForLinkData(s,t),this.addLinkData(s))}}const s=t.modifiedLinkData;if(Array.isArray(s)){const t=s.length;for(let e=0;e<t;e++){const t=s[e],i=this.getKeyForLinkData(t),n=this.findLinkDataForKey(i);if(null!==n){for(const e in t)"__gohashid"===e||e===this.linkKeyProperty||this.setDataProperty(n,e,t[e]);this.eF(t,n)}}}const n=t.removedLinkKeys;if(Array.isArray(n)){const t=n.length;for(let e=0;e<t;e++){const t=n[e],i=this.findLinkDataForKey(t);null!==i&&this.removeLinkData(i)}}}changeState(t,i){if(null!==t&&t.model===this){if(2===t.change){const e=t.object,s=t.propertyName;if(null!==e&&s===this.linkKeyProperty&&this.containsLinkData(e)){const n=t.getValue(i),o=t.getValue(!i);return void 0!==o&&this.Oe.delete(o),void 0!==n&&this.Oe.set(n,e),void this.et(e,s,n)}}else if(3===t.change){let s=t.newParam;if("linkDataArray"===t.modelChange){const n=t.newValue;if(e.$(n)&&"number"==typeof s){const t=this.getKeyForLinkData(n);i?(this.ar.delete(n),this.Os[s]===n&&this.No(this.linkDataArray,s),void 0!==t&&this.Oe.delete(t)):(this.ar.add(n),this.Os[s]!==n&&this.lr(this.Os,s,n),void 0!==t&&this.Oe.set(t,n))}return}if("linkLabelKeys"===t.modelChange){const e=t.object,n=null!==e?this.getLabelKeysForLinkData(e):null;return void(Array.isArray(n)&&"number"==typeof s&&(i?(s=n.indexOf(t.newValue),s>=0&&this.No(n,s)):n.indexOf(t.newValue)<0&&this.lr(n,s,t.newValue)))}}else if(4===t.change){let s=t.oldParam;if("linkDataArray"===t.modelChange){const n=t.oldValue;if(e.$(n)&&"number"==typeof s){const t=this.getKeyForLinkData(n);i?(this.ar.add(n),this.Os[s]!==n&&this.lr(this.Os,s,n),void 0!==t&&this.Oe.set(t,n)):(this.ar.delete(n),this.Os[s]===n&&this.No(this.linkDataArray,s),void 0!==t&&this.Oe.delete(t))}return}if("linkLabelKeys"===t.modelChange){const e=t.object,n=null!==e?this.getLabelKeysForLinkData(e):null;return void(Array.isArray(n)&&"number"==typeof s&&(i?n.indexOf(t.oldValue)<0&&this.lr(n,s,t.oldValue):(s=n.indexOf(t.oldValue),s>=0&&this.No(n,s))))}}super.changeState(t,i)}}get archetypeNodeData(){return this.Vl}set archetypeNodeData(t){const i=this.Vl;i!==t&&(null!==t&&e.wc(t,je,"archetypeNodeData"),this.Vl=t,this.t("archetypeNodeData",i,t))}rL(t){if(void 0===t)return;const e=this.Vl;if(null!==e){let i=this.findNodeDataForKey(t);null===i&&(i=this.copyNodeData(e),this.et(i,this.nodeKeyProperty,t),this.addNodeData(i))}return t}get linkFromKeyProperty(){return this.Co}set linkFromKeyProperty(t){const e=this.Co;e!==t&&(this.En(t,je,"linkFromKeyProperty"),this.Co=t,this.t("linkFromKeyProperty",e,t))}getFromKeyForLinkData(t){return this.Vi(t,!0)}setFromKeyForLinkData(t,e){this.xg(t,e,!0)}get linkToKeyProperty(){return this.Lo}set linkToKeyProperty(t){const e=this.Lo;e!==t&&(this.En(t,je,"linkToKeyProperty"),this.Lo=t,this.t("linkToKeyProperty",e,t))}getToKeyForLinkData(t){return this.Vi(t,!1)}setToKeyForLinkData(t,e){this.xg(t,e,!1)}Vi(t,i){if(null===t)return;const s=i?this.Co:this.Lo;if(""===s)return;const n=this.St(t,s);if(void 0!==n){if(this.isKeyType(n))return n;e.o((i?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+n)}}xg(t,i,s){if(null===i&&(i=void 0),void 0!==i&&!this.isKeyType(i)&&e.si(i,"number or string",je,s?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),null===t)return;const n=s?this.Co:this.Lo;if(""===n)return;if(i=this.rL(i),!this.containsLinkData(t))return void this.et(t,n,i);const o=this.St(t,n);o!==i&&(this.ln(o,t),this.et(t,n,i),null===this.findNodeDataForKey(i)&&this.an(i,t),this.Ft(s?"linkFromKey":"linkToKey",2,n,t,o,i),"string"==typeof n&&this.updateTargetBindings(t,n))}get linkFromPortIdProperty(){return this.lc}set linkFromPortIdProperty(t){const e=this.lc;e!==t&&(this.En(t,je,"linkFromPortIdProperty"),this.lc=t,this.t("linkFromPortIdProperty",e,t))}getFromPortIdForLinkData(t){return this.Ak(t,!0)}setFromPortIdForLinkData(t,e){this.bg(t,e,!0)}get linkToPortIdProperty(){return this.ac}set linkToPortIdProperty(t){const e=this.ac;e!==t&&(this.En(t,je,"linkToPortIdProperty"),this.ac=t,this.t("linkToPortIdProperty",e,t))}getToPortIdForLinkData(t){return this.Ak(t,!1)}setToPortIdForLinkData(t,e){this.bg(t,e,!1)}Ak(t,e){if(null===t)return"";const i=e?this.lc:this.ac;if(""===i)return"";const s=this.St(t,i);return void 0===s?"":s}bg(t,i,s){if(e.s(i,"string",je,s?"setFromPortIdForLinkData:portname":"setToPortIdForLinkData:portname"),null===t)return;const n=s?this.lc:this.ac;if(""===n)return;if(!this.containsLinkData(t))return void this.et(t,n,i);let o=this.St(t,n);void 0===o&&(o=""),o!==i&&(this.et(t,n,i),this.Ft(s?"linkFromPortId":"linkToPortId",2,n,t,o,i),"string"==typeof n&&this.updateTargetBindings(t,n))}get linkLabelKeysProperty(){return this.hn}set linkLabelKeysProperty(t){const e=this.hn;e!==t&&(this.En(t,je,"linkLabelKeysProperty"),this.hn=t,this.t("linkLabelKeysProperty",e,t))}getLabelKeysForLinkData(t){if(null===t)return je.EmptyArray;const e=this.hn;if(""===e)return je.EmptyArray;const i=this.St(t,e);return void 0===i?je.EmptyArray:i}setLabelKeysForLinkData(t,e){if(this.sL(e,je,"setLabelKeysForLinkData:arr"),null===t)return;const i=this.hn;if(""===i)return;if(!this.containsLinkData(t))return void this.et(t,i,e);let s=this.St(t,i);if(void 0===s&&(s=je.EmptyArray),s!==e){if(Array.isArray(s)){const e=s.length;for(let i=0;i<e;i++){const e=s[i];this.ln(e,t)}}this.et(t,i,e);const n=e.length;for(let i=0;i<n;i++){const s=e[i];null===this.findNodeDataForKey(s)&&this.an(s,t)}this.Ft("linkLabelKeys",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i)}}addLabelKeyForLinkData(t,i){if(null==i||(this.isKeyType(i)||e.si(i,"number or string",je,"addLabelKeyForLinkData:key"),null===t))return;const s=this.hn;if(""===s)return;const n=this.St(t,s);if(void 0===n){const e=[];e.push(i),this.setLabelKeysForLinkData(t,e)}else if(Array.isArray(n)){let e=n.indexOf(i);if(e>=0)return;e=n.length,n.push(i),this.containsLinkData(t)&&(null===this.findNodeDataForKey(i)&&this.an(i,t),this.Ft("linkLabelKeys",3,s,t,null,i,null,e))}else e.o(s+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,i){if(null==i||(this.isKeyType(i)||e.si(i,"number or string",je,"removeLabelKeyForLinkData:key"),null===t))return;const s=this.hn;if(""===s)return;const n=this.St(t,s);if(Array.isArray(n)){const e=n.indexOf(i);if(e<0)return;this.No(n,e),this.containsLinkData(t)&&(this.ln(i,t),this.Ft("linkLabelKeys",4,s,t,i,null,e,null))}else void 0!==n&&e.o(s+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.Os}set linkDataArray(t){const i=this.Os;if(i!==t){this.sL(t,je,"linkDataArray"),this.Oe.clear();const s=t.length;for(let i=0;i<s;i++){const s=t[i];e.$(s)||e.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+s)}if(this.Os=t,""!==this.linkKeyProperty){const e=new h;for(let i=0;i<s;i++){const s=t[i],n=this.getKeyForLinkData(s);void 0===n||null!==this.Oe.get(n)?e.add(s):this.Oe.set(n,s)}const i=e.iterator;for(;i.next();){const t=i.value;this.makeLinkDataKeyUnique(t);const e=this.getKeyForLinkData(t);void 0!==e&&this.Oe.set(e,t)}}const n=new u;for(let e=0;e<s;e++){const i=t[e];n.add(i)}this.ar=n,this.Ft("linkDataArray",2,"linkDataArray",this,i,t);for(let e=0;e<s;e++){const i=t[e];this.lL(i)}}}get linkKeyProperty(){return this.Ga}set linkKeyProperty(t){const e=this.Ga;if(e!==t){this.En(t,je,"linkKeyProperty"),this.Ga=t,this.Oe.clear();const i=this.linkDataArray.length;for(let t=0;t<i;t++){const e=this.linkDataArray[t];let i=this.getKeyForLinkData(e);void 0===i&&(this.makeLinkDataKeyUnique(e),i=this.getKeyForLinkData(e)),void 0!==i&&this.Oe.set(i,e)}this.t("linkKeyProperty",e,t)}}getKeyForLinkData(t){if(null===t)return;const i=this.Ga;if(""===i)return;const s=this.St(t,i);if(void 0!==s){if(this.isKeyType(s))return s;e.o("Key value for link data "+t+" is not a number or a string: "+s)}}setKeyForLinkData(t,i){if((null==i||!this.isKeyType(i))&&e.si(i,"number or string",je,"setKeyForLinkData:key"),null===t)return;const s=this.Ga;if(""===s)return;if(!this.containsLinkData(t))return void this.et(t,s,i);const n=this.St(t,s);if(n!==i){if(null!==this.findLinkDataForKey(i))return;this.et(t,s,i),void 0!==n&&this.Oe.delete(n),this.Oe.set(i,t),this.Ft("linkKey",2,s,t,n,i),"string"==typeof s&&this.updateTargetBindings(t,s)}}get makeUniqueLinkKeyFunction(){return this.$f}set makeUniqueLinkKeyFunction(t){const i=this.$f;i!==t&&(null!==t&&e.S(t,je,"makeUniqueLinkKeyFunction"),this.$f=t,this.t("makeUniqueLinkKeyFunction",i,t))}findLinkDataForKey(t){return null===t&&e.o("GraphLinksModel.findLinkDataForKey:key must not be null"),void 0!==t&&this.isKeyType(t)?this.Oe.get(t):null}Ek(t){return void 0!==t&&this.Oe.has(t)}makeLinkDataKeyUnique(t){if(null===t)return;const e=this.Ga;if(""===e)return;let i=this.getKeyForLinkData(t);if(void 0!==i&&!this.Ek(i))return;const s=this.$f;if(null===s||(i=s(this,t),null==i||this.Ek(i))){if("string"==typeof i){let s=2;for(;this.Ek(i+s);)s++;this.et(t,e,i+s)}else if(void 0===i||"number"==typeof i){let i=-this.Oe.count-1;for(;this.Ek(i);)i--;this.et(t,e,i)}}else this.et(t,e,i)}containsLinkData(t){return null!==t&&this.ar.has(t)}addLinkData(t){null!==t&&(this.containsLinkData(t)||this.Vv(t,!0))}Vv(t,i){if(""!==this.linkKeyProperty){let i=this.getKeyForLinkData(t);if(void 0===i)this.makeLinkDataKeyUnique(t),i=this.getKeyForLinkData(t);else{if(this.Oe.get(i)===t)return;this.makeLinkDataKeyUnique(t),i=this.getKeyForLinkData(t)}void 0===i&&e.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.Oe.set(i,t)}this.ar.add(t);let s=null;i&&(s=this.Os.length,this.lr(this.Os,s,t)),this.Ft("linkDataArray",3,"linkDataArray",this,null,t,null,s),this.lL(t)}addLinkDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.addLinkData(t[i])}else{const e=t.iterator;for(;e.next();){const t=e.value;this.addLinkData(t)}}}removeLinkData(t){null!==t&&this.Uv(t,!0)}Uv(t,e){this.ar.delete(t);const i=this.getKeyForLinkData(t);void 0!==i&&this.Oe.delete(i);let s=null;if(e){if(s=this.Os.indexOf(t),s<0)return;this.No(this.Os,s)}this.Ft("linkDataArray",4,"linkDataArray",this,t,null,s,null),this.f3(t)}removeLinkDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.removeLinkData(t[i])}else{const e=t.iterator;for(;e.next();){const t=e.value;this.removeLinkData(t)}}}mergeLinkDataArray(t){if(""===this.linkKeyProperty&&e.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t===this.linkDataArray||!Array.isArray(t))return;const i=new u;i.addAll(this.Oe.iteratorKeys);const s=new u,n=t.length;for(let e=0;e<n;e++){const i=t[e],n=this.getKeyForLinkData(i);if(void 0!==n){s.add(n);const t=this.findLinkDataForKey(n);if(t===i)continue;if(null!==t)this.assignAllDataProperties(t,i),this.eF(i,t);else{const t=this.cloneDeep(i);this.setKeyForLinkData(t,n),this.addLinkData(t)}}else{const t=this.cloneDeep(i);this.addLinkData(t);const e=this.getKeyForLinkData(t);void 0!==e&&s.add(e)}}const o=i.iterator;for(;o.next();){const t=o.value;if(!s.has(t)){const e=this.findLinkDataForKey(t);e&&this.removeLinkData(e)}}}lL(t){let e=this.Vi(t,!0);e=this.rL(e),null===this.findNodeDataForKey(e)&&this.an(e,t),e=this.Vi(t,!1),e=this.rL(e),null===this.findNodeDataForKey(e)&&this.an(e,t);const i=this.getLabelKeysForLinkData(t);if(Array.isArray(i)){const s=i.length;for(let n=0;n<s;n++)e=i[n],null===this.findNodeDataForKey(e)&&this.an(e,t)}}f3(t){let e=this.Vi(t,!0);this.ln(e,t),e=this.Vi(t,!1),this.ln(e,t);const i=this.getLabelKeysForLinkData(t);if(Array.isArray(i)){const s=i.length;for(let n=0;n<s;n++)e=i[n],this.ln(e,t)}}get copyLinkDataFunction(){return this.Zf}set copyLinkDataFunction(t){const i=this.Zf;i!==t&&(null!==t&&e.S(t,je,"copyLinkDataFunction"),this.Zf=t,this.t("copyLinkDataFunction",i,t))}copyLinkData(t){let i=null;const s=this.Zf;return i=null!==s?s(t,this):this.Ik(t,!0),e.$(i)&&(""!==this.Co&&this.et(i,this.Co,void 0),""!==this.Lo&&this.et(i,this.Lo,void 0),""!==this.hn&&this.et(i,this.hn,[])),i}get nodeIsGroupProperty(){return this.Qf}set nodeIsGroupProperty(t){const e=this.Qf;e!==t&&(this.En(t,je,"nodeIsGroupProperty"),this.Qf=t,this.t("nodeIsGroupProperty",e,t))}isGroupForNodeData(t){if(null===t)return!1;const e=this.Qf;return""!==e&&!!this.St(t,e)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Un}set nodeGroupKeyProperty(t){const e=this.Un;e!==t&&(this.En(t,je,"nodeGroupKeyProperty"),this.Un=t,this.t("nodeGroupKeyProperty",e,t))}get copiesGroupKeyOfNodeData(){return this.vg}set copiesGroupKeyOfNodeData(t){this.vg!==t&&(e.s(t,"boolean",je,"copiesGroupKeyOfNodeData"),this.vg=t)}getGroupKeyForNodeData(t){if(null===t)return;const i=this.Un;if(""===i)return;const s=this.St(t,i);if(void 0!==s){if(this.isKeyType(s))return s;e.o("GroupKey value for node data "+t+" is not a number or a string: "+s)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,i){if(null===i&&(i=void 0),void 0!==i&&!this.isKeyType(i)&&e.si(i,"number or string",je,"setGroupKeyForNodeData:key"),null===t)return;const s=this.Un;if(""===s)return;if(!this.containsNodeData(t))return void this.et(t,s,i);const n=this.St(t,s);n!==i&&(this.ln(n,t),this.et(t,s,i),null===this.findNodeDataForKey(i)&&this.an(i,t),this.Ft("nodeGroupKey",2,s,t,n,i),"string"==typeof s&&this.updateTargetBindings(t,s))}setGroupForData(t,e){this.setGroupKeyForNodeData(t,e)}copyNodeData(t){const e=super.copyNodeData(t);return!this.copiesGroupKeyOfNodeData&&""!==this.Un&&void 0!==this.St(e,this.Un)&&this.et(e,this.Un,void 0),e}setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty)return void this.setKeyForNodeData(t,i);if(e===this.nodeCategoryProperty)return void this.setCategoryForNodeData(t,i);if(e===this.nodeGroupKeyProperty)return void this.setGroupKeyForNodeData(t,i)}else if(this.containsLinkData(t)){if(e===this.linkFromKeyProperty)return void this.xg(t,i,!0);if(e===this.linkToKeyProperty)return void this.xg(t,i,!1);if(e===this.linkFromPortIdProperty)return void this.bg(t,i,!0);if(e===this.linkToPortIdProperty)return void this.bg(t,i,!1);if(e===this.linkKeyProperty)return void this.setKeyForLinkData(t,i);if(e===this.linkCategoryProperty)return void this.setCategoryForLinkData(t,i);if(e===this.linkLabelKeysProperty)return void this.setLabelKeysForLinkData(t,i)}const s=this.St(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}assignAllDataProperties(t,e){if(!e)return;const i=this.containsNodeData(t),s=this.containsLinkData(t);for(const n in e)if("__gohashid"!==n&&(!i||n!==this.nodeKeyProperty)){if(i&&n===this.nodeIsGroupProperty&&this.St(t,n)===e[n])continue;if(s&&n===this.linkKeyProperty)continue;this.setDataProperty(t,n,e[n])}}dw(t,e){super.dw(t,e);const i=this.be.iterator;for(;i.next();){const s=i.value;this.aL(s,t,e)}const s=this.ar.iterator;for(;s.next();){const i=s.value;this.u3(i,t,e)}}aL(t,e,i){if(this.getGroupKeyForNodeData(t)===e){const s=this.Un;this.et(t,s,i),this.Ft("nodeGroupKey",2,s,t,e,i),"string"==typeof s&&this.updateTargetBindings(t,s)}}u3(t,e,i){if(this.Vi(t,!0)===e){const s=this.Co;this.et(t,s,i),this.Ft("linkFromKey",2,s,t,e,i),"string"==typeof s&&this.updateTargetBindings(t,s)}if(this.Vi(t,!1)===e){const s=this.Lo;this.et(t,s,i),this.Ft("linkToKey",2,s,t,e,i),"string"==typeof s&&this.updateTargetBindings(t,s)}const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length,o=this.hn;for(let r=0;r<n;r++)s[r]===e&&(this.Wv(s,r,i),this.Ft("linkLabelKeys",3,o,t,e,i,r,r))}}nL(){super.nL();const t=this.linkDataArray,e=t.length;for(let i=0;i<e;i++){const e=t[i];this.lL(e)}}Tg(t){super.Tg(t);const i=this.getKeyForNodeData(t),s=this.lw(i);if(null!==s){const t=e.nt(),n=s.iterator;for(;n.next();){const e=n.value;if(this.containsNodeData(e)){if(this.getGroupKeyForNodeData(e)===i){const s=this.Un;this.Ft("nodeGroupKey",2,s,e,i,i),"string"==typeof s&&this.updateTargetBindings(e,s),t.push(e)}}else{if(this.Vi(e,!0)===i){const s=this.Co;this.Ft("linkFromKey",2,s,e,i,i),"string"==typeof s&&this.updateTargetBindings(e,s),t.push(e)}if(this.Vi(e,!1)===i){const s=this.Lo;this.Ft("linkToKey",2,s,e,i,i),"string"==typeof s&&this.updateTargetBindings(e,s),t.push(e)}const s=this.getLabelKeysForLinkData(e);if(Array.isArray(s)){const n=s.length,o=this.hn;for(let r=0;r<n;r++)s[r]===i&&(this.Ft("linkLabelKeys",3,o,e,i,i,r,r),t.push(e))}}}for(let e=0;e<t.length;e++)this.ln(i,t[e]);e.Z(t)}}Dg(t){super.Dg(t);const e=this.getGroupKeyForNodeData(t);null===this.findNodeDataForKey(e)&&this.an(e,t)}gw(t){super.gw(t);const e=this.getGroupKeyForNodeData(t);this.ln(e,t)}get linkCategoryProperty(){return this.hc}set linkCategoryProperty(t){const e=this.hc;e!==t&&(this.En(t,je,"linkCategoryProperty"),this.hc=t,this.t("linkCategoryProperty",e,t))}getCategoryForLinkData(t){if(null===t)return"";const i=this.hc;if(""===i)return"";const s=this.St(t,i);return void 0===s?"":"string"==typeof s?s:void e.o("getCategoryForLinkData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,i){if(e.s(i,"string",je,"setCategoryForLinkData:cat"),null===t)return;const s=this.hc;if(""===s)return;if(!this.containsLinkData(t))return void this.et(t,s,i);let n=this.St(t,s);void 0===n&&(n=""),n!==i&&(this.et(t,s,i),this.Ft("linkCategory",2,s,t,n,i),"string"==typeof s&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,e){this.setCategoryForLinkData(t,e)}Ag(t,e){super.Ag(t,e),this.setGroupKeyForNodeData(e,this.getGroupKeyForNodeData(t))}eF(t,e){this.setCategoryForLinkData(e,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(e,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(e,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(e,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(e,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(e,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}Um(){return!0}jh(){return!0}Ax(){return!0}ff(){return!0}static EmptyArray=Object.freeze([])}Ue.Sl(je,"GraphLinksModel"),Ue.jv=()=>new je,Ue.p2=()=>new je;class Ge extends Ue{Vn;Fg;cc;constructor(t,e){if(super(),this.Vn="parent",this.Fg=!1,this.cc="parentLinkCategory",void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);const t=e.Changed;t&&(delete this.Changed,this.addChangedListener(t))}}cloneProtected(t){super.cloneProtected(t),t.Vn=this.Vn,t.Fg=this.Fg,t.cc=this.cc}toString(t){if(void 0===t&&(t=0),t>=2)return this.toJson();{let e=(""!==this.name?this.name:"")+" TreeModel";if(t>0){e+="\n node data:";const t=this.nodeDataArray,i=t.length;for(let s=0;s<i;s++){const i=t[s];e+=" "+this.getKeyForNodeData(i)+":"+ze.toString(i)}}return e}}Lg(){const t=super.Lg();let e="";return"parent"!==this.nodeParentKeyProperty&&"string"==typeof this.nodeParentKeyProperty&&(e+=',\n  "nodeParentKeyProperty": '+this.quote(this.nodeParentKeyProperty)),t+e}fw(t){super.fw(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}uw(t){void 0!==t.nodeParentKeyProperty&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&e.o("applyIncrementalJson cannot change Model properties"),super.uw(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Vn}set nodeParentKeyProperty(t){const e=this.Vn;e!==t&&(this.En(t,Ge,"nodeParentKeyProperty"),this.Vn=t,this.t("nodeParentKeyProperty",e,t))}get copiesParentKeyOfNodeData(){return this.Fg}set copiesParentKeyOfNodeData(t){this.Fg!==t&&(e.s(t,"boolean",Ge,"copiesParentKeyOfNodeData"),this.Fg=t)}getParentKeyForNodeData(t){if(null===t)return;const i=this.Vn;if(""===i)return;const s=this.St(t,i);if(void 0!==s){if(this.isKeyType(s))return s;e.o("ParentKey value for node data "+t+" is not a number or a string: "+s)}}setParentKeyForNodeData(t,i){if(null===i&&(i=void 0),void 0!==i&&!this.isKeyType(i)&&e.si(i,"number or string",Ge,"setParentKeyForNodeData:key"),null===t)return;const s=this.Vn;if(""===s)return;if(i=this.maybeEnsureLinkReference(i),!this.containsNodeData(t))return void this.et(t,s,i);const n=this.St(t,s);n!==i&&(this.ln(n,t),this.et(t,s,i),null===this.findNodeDataForKey(i)&&this.an(i,t),this.Ft("nodeParentKey",2,s,t,n,i),"string"==typeof s&&this.updateTargetBindings(t,s))}get parentLinkCategoryProperty(){return this.cc}set parentLinkCategoryProperty(t){const e=this.cc;e!==t&&(this.En(t,Ge,"parentLinkCategoryProperty"),this.cc=t,this.t("parentLinkCategoryProperty",e,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(null===t)return"";const i=this.cc;if(""===i)return"";const s=this.St(t,i);return void 0===s?"":"string"==typeof s?s:void e.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,i){if(e.s(i,"string",Ge,"setParentLinkCategoryForNodeData:cat"),null===t)return;const s=this.cc;if(""===s)return;if(!this.containsNodeData(t))return void this.et(t,s,i);let n=this.St(t,s);void 0===n&&(n=""),n!==i&&(this.et(t,s,i),this.Ft("parentLinkCategory",2,s,t,n,i),"string"==typeof s&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,e){this.setParentLinkCategoryForNodeData(t,e)}copyNodeData(t){const e=super.copyNodeData(t);return!this.copiesParentKeyOfNodeData&&""!==this.Vn&&void 0!==this.St(e,this.Vn)&&this.et(e,this.Vn,void 0),e}setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty)return void this.setKeyForNodeData(t,i);if(e===this.nodeCategoryProperty)return void this.setCategoryForNodeData(t,i);if(e===this.nodeParentKeyProperty)return void this.setParentKeyForNodeData(t,i);if(e===this.parentLinkCategoryProperty)return void this.setParentLinkCategoryForNodeData(t,i)}const s=this.St(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}dw(t,e){super.dw(t,e);const i=this.be.iterator;for(;i.next();){const s=i.value;this.aL(s,t,e)}}aL(t,e,i){if(this.getParentKeyForNodeData(t)===e){const s=this.Vn;this.et(t,s,i),this.Ft("nodeParentKey",2,s,t,e,i),"string"==typeof s&&this.updateTargetBindings(t,s)}}Tg(t){super.Tg(t);const i=this.getKeyForNodeData(t),s=this.lw(i);if(null!==s){const t=e.nt(),n=s.iterator;for(;n.next();){const e=n.value;if(this.containsNodeData(e)&&this.getParentKeyForNodeData(e)===i){const s=this.Vn;this.Ft("nodeParentKey",2,s,e,i,i),"string"==typeof s&&this.updateTargetBindings(e,s),t.push(e)}}for(let e=0;e<t.length;e++)this.ln(i,t[e]);e.Z(t)}}Dg(t){super.Dg(t);let e=this.getParentKeyForNodeData(t);e=this.maybeEnsureLinkReference(e),null===this.findNodeDataForKey(e)&&this.an(e,t)}gw(t){super.gw(t);const e=this.getParentKeyForNodeData(t);this.ln(e,t)}Ag(t,e){super.Ag(t,e),this.setParentLinkCategoryForNodeData(e,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(e,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}Vm(){return!0}Ax(){return!0}}Ue.Sl(Ge,"TreeModel");var Ke=(t=>(t[t.ConstantSpacing=0]="ConstantSpacing",t[t.ConstantDistance=1]="ConstantDistance",t[t.ConstantAngle=2]="ConstantAngle",t[t.Packed=3]="Packed",t))(Ke||{}),Ye=(t=>(t[t.Clockwise=10]="Clockwise",t[t.Counterclockwise=11]="Counterclockwise",t[t.BidirectionalLeft=12]="BidirectionalLeft",t[t.BidirectionalRight=13]="BidirectionalRight",t))(Ye||{}),qe=(t=>(t[t.Forwards=20]="Forwards",t[t.Reverse=21]="Reverse",t[t.Ascending=22]="Ascending",t[t.Descending=23]="Descending",t[t.Optimized=24]="Optimized",t))(qe||{}),He=(t=>(t[t.Pythagorean=30]="Pythagorean",t[t.Circular=31]="Circular",t))(He||{});class We extends Le{gi;_f;Uk;Rg;Vk;Ya;hL;cL;fL;Is;mw;pw;fc;yw;iF;Og;Ig;Eg;tu;He;P;Si;Mi;In;Ug;constructor(t){super(),this.gi=0,this._f=0,this.Uk=0,this.Rg=360,this.Vk=0,this.Ya=0,this.hL=new y,this.cL=30,this.fL=0,this.Is=0,this.mw=0,this.pw=new _e,this.fc=0,this.yw=0,this.iF=600,this.Og=NaN,this.Ig=1,this.Eg=0,this.tu=360,this.He=0,this.P=10,this.Si=24,this.Mi=De.standardComparer,this.In=6,this.Ug=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Og=this.Og,t.Ig=this.Ig,t.Eg=this.Eg,t.tu=this.tu,t.He=this.He,t.P=this.P,t.Si=this.Si,t.Mi=this.Mi,t.In=this.In,t.Ug=this.Ug}fe(t){t in qe?this.sorting=t:t in Ye?this.direction=t:t in Ke?this.arrangement=t:t in He?this.nodeDiameterFormula=t:super.fe(t)}createNetwork(){return new Je(this)}d3(t,e,i){t=this.g3(t);let s=this.Vk,n=this.cL,o=this.gi,r=this._f,a=this.Uk,l=this.Rg,u=this.Ya,c=this.fL,d=this.Is,g=this.mw;if(s=this.arrangement,n=this.nodeDiameterFormula,o=this.radius,(!isFinite(o)||o<=0)&&(o=NaN),r=this.aspectRatio,(!isFinite(r)||r<=0)&&(r=1),a=this.startAngle,isFinite(a)||(a=0),l=this.sweepAngle,(!isFinite(l)||l>360||l<1)&&(l=360),u=this.spacing,isFinite(u)||(u=NaN),3===s&&31===n?s=0:3===s&&31!==n&&(n=31,s=this.arrangement),(12===this.direction||13===this.direction)&&24!==this.sorting){for(let s=0;!(s>=t.length||(e.add(t.elt(s)),s+1>=t.length));s+=2)i.add(t.elt(s+1));12===this.direction?(3===this.arrangement&&e.reverse(),(t=new h).addAll(e),t.addAll(i)):(3===this.arrangement&&i.reverse(),(t=new h).addAll(i),t.addAll(e))}const f=t.length;c=0;let m=0;for(let e=0;e<t.length;e++){const i=a+l*m*(10===this.direction?1:-1)/f;let s=t.elt(e).diameter;isNaN(s)&&(s=t.elt(e).Ka(i)),l<360&&(0===e||e===t.length-1)&&(s/=2),c+=s,m++}if(isNaN(o)||3===s){if(isNaN(u)&&(u=6),0!==s&&3!==s){let e=-1/0;for(let i=0;i<f;i++){const s=t.elt(i),n=t.elt(i===f-1?0:i+1);isNaN(s.diameter)&&s.Ka(0),isNaN(n.diameter)&&n.Ka(0),e=Math.max(e,(s.diameter+n.diameter)/2)}if(g=e+u,2===s){const t=(e+u)/(2*Math.PI/f);r>1?(o=t,d=o*r):(d=t,o=d)}else o=this.Bk(g*(l>=360?f:f-1),r,a*Math.PI/180,l*Math.PI/180)}else o=this.Bk(c+(l>=360?f:f-1)*(3!==s?u:1.6*u),r,a*Math.PI/180,l*Math.PI/180);d=o*r}else{d=o*r;const e=this.uL(o,d,a*Math.PI/180,l*Math.PI/180);if(isNaN(u))0===s&&(u=(e-c)/(l>=360?f:f-1));else if(0===s){const t=(e-c)/(l>=360?f:f-1);t<u?(o=this.Bk(c+u*(l>=360?f:f-1),r,a*Math.PI/180,l*Math.PI/180),d=o*r):u=t}else{let i=-1/0;for(let e=0;e<f;e++){const s=t.elt(e),n=t.elt(e===f-1?0:e+1);isNaN(s.diameter)&&s.Ka(0),isNaN(n.diameter)&&n.Ka(0),i=Math.max(i,(s.diameter+n.diameter)/2)}const s=i+u,n=this.Bk(s*(l>=360?f:f-1),r,a*Math.PI/180,l*Math.PI/180);n>o?(o=n,d=o*r,g=s):g=e/(l>=360?f:f-1)}}return this.Vk=s,this.cL=n,this.gi=o,this._f=r,this.Uk=a,this.Rg=l,this.Ya=u,this.fL=c,this.Is=d,this.mw=g,t}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const e=this.network.vertexes;if(e.count<=1){if(1===e.count){const t=e.first();t.centerX=0,t.centerY=0}return this.updateParts(),this.network=null,void(this.isValidLayout=!0)}let i=new h;i.addAll(e.iterator);const s=new h,n=new h;i=this.d3(i,s,n);const o=this.Vk,r=this.gi,a=this.Uk,l=this.Rg,u=this.Ya,c=this.Is,d=this.mw;if(12!==this.direction&&13!==this.direction||3!==o)if(12===this.direction||13===this.direction){let t=0;switch(o){case 1:t=180*this.zk(r,c,a,d)/Math.PI;break;case 0:{let e=0,i=0;const o=s.first();null!==o&&(e=o.Ka(Math.PI/2));const h=n.first();null!==h&&(i=h.Ka(Math.PI/2)),t=180*this.zk(r,c,a,u+(e+i)/2)/Math.PI;break}case 2:t=l/i.length}if(12===this.direction){switch(o){case 1:this.ww(s,l/2,a,11);break;case 0:this.xw(s,l/2,a,11);break;case 2:this.bw(s,l/2,a,11)}switch(o){case 1:this.ww(n,l/2,a+t,10);break;case 0:this.xw(n,l/2,a+t,10);break;case 2:this.bw(n,l/2,a+t,10)}}else{switch(o){case 1:this.ww(n,l/2,a,11);break;case 0:this.xw(n,l/2,a,11);break;case 2:this.bw(n,l/2,a,11)}switch(o){case 1:this.ww(s,l/2,a+t,10);break;case 0:this.xw(s,l/2,a+t,10);break;case 2:this.bw(s,l/2,a+t,10)}}}else switch(o){case 1:this.ww(i,l,a,this.direction);break;case 0:this.xw(i,l,a,this.direction);break;case 2:this.bw(i,l,a,this.direction);break;case 3:this.sF(i,l,a,this.direction)}else this.sF(i,l,a-l/2,10);this.updateParts(),this.network=null,this.isValidLayout=!0}bw(t,e,i,s){const n=this.Rg,o=this.gi,r=this.Is,a=i*Math.PI/180,h=e*Math.PI/180,l=t.length;for(let e=0;e<l;e++){const i=a+(10===s?e*h/(n>=360?l:l-1):-e*h/l),u=t.elt(e),c=o*Math.tan(i)/r,d=Math.sqrt((o*o+r*r*c*c)/(1+c*c));u.centerX=d*Math.cos(i),u.centerY=d*Math.sin(i),u.actualAngle=180*i/Math.PI}}xw(t,e,i,s){const n=this.gi,o=this.Is,r=this.Ya;let a=i*Math.PI/180;const h=t.length;for(let e=0;e<h;e++){const i=t.elt(e),l=t.elt(e===h-1?0:e+1),u=n*Math.cos(a),c=o*Math.sin(a);i.centerX=u,i.centerY=c,i.actualAngle=180*a/Math.PI,isNaN(i.diameter)&&i.Ka(0),isNaN(l.diameter)&&l.Ka(0);const d=(i.diameter+l.diameter)/2,g=this.zk(n,o,10===s?a:-a,d+r);a+=10===s?g:-g}}ww(t,e,i,s){const n=this.gi,o=this.Is,r=this.mw;let a=i*Math.PI/180;const h=t.length;for(let e=0;e<h;e++){const i=t.elt(e);i.centerX=n*Math.cos(a),i.centerY=o*Math.sin(a),i.actualAngle=180*a/Math.PI;const h=this.zk(n,o,10===s?a:-a,r);a+=10===s?h:-h}}sF(t,e,i,s){let n=this.yw;const o=this.Rg;if(this.fc=0,this.pw=new _e,e<360){for(n=i+(10===s?o:-o);n<0;)n+=360;n%=360,n>180&&(n-=360),n*=Math.PI/180,this.yw=n,this.nF(t,e,i,s)}else this.oF(t,e,i,s);this.pw.commit(t)}oF(t,e,i,s){const n=this.gi,o=this.Is,r=this.Ya,a=this._f;let h=n*Math.cos(i*Math.PI/180),l=o*Math.sin(i*Math.PI/180);const u=t.toArray();if(3===u.length)return u[0].centerX=n,u[0].centerY=0,u[1].centerX=u[0].centerX-u[0].width/2-u[1].width/2-r,u[1].y=u[0].y,u[2].centerX=(u[0].centerX+u[1].centerX)/2,void(u[2].y=u[0].y-u[2].height-r);if(4===u.length)return u[0].centerX=n,u[0].centerY=0,u[2].centerX=-u[0].centerX,u[2].centerY=u[0].centerY,u[1].centerX=0,u[1].y=Math.min(u[0].y,u[2].y)-u[1].height-r,u[3].centerX=0,void(u[3].y=Math.max(u[0].y+u[0].height+r,u[2].y+u[2].height+r));const c=y.l();for(let t=0;t<u.length&&(u[t].centerX=h,u[t].centerY=l,!(t>=u.length-1));t++)this.rF(h,l,u,t,s,c)||this.lF(h,l,u,t,s,c),h=c.x,l=c.y;if(y.i(c),this.fc++,this.fc>23)return;const d=u[0].centerX,g=u[0].centerY,f=u[u.length-1].centerX,m=u[u.length-1].centerY;let p=Math.abs(d-f)-((u[0].width+u[u.length-1].width)/2+r);const x=Math.abs(g-m)-((u[0].height+u[u.length-1].height)/2+r);let w=0;if(Math.abs(x)<1){const t=Math.abs(d-f),e=(u[0].width+u[u.length-1].width)/2;t<e&&(w=0),p=t-e}else w=x>0?x:Math.abs(p)<1?0:p;let b=!1;b=Math.abs(f)>Math.abs(m)?f>0!=g>m:m>0!=d<f,b=10===s?b:!b,b&&(w=-Math.abs(w),w=Math.min(w,-u[u.length-1].width),w=Math.min(w,-u[u.length-1].height)),this.pw.m3(w,u),Math.abs(w)>1&&(this.fc<8?this.gi-=w/(2*Math.PI):u.length<5&&w>10?this.gi/=2:this.gi-=w>0?1.7:-2.3,this.Is=this.gi*a,this.oF(t,e,i,s))}nF(t,e,i,s){const n=this.gi,o=this.Is,r=this._f;let a=n*Math.cos(i*Math.PI/180),h=o*Math.sin(i*Math.PI/180);const l=y.l(),u=t.toArray();for(let t=0;t<u.length&&(u[t].centerX=a,u[t].centerY=h,!(t>=u.length-1));t++)this.rF(a,h,u,t,s,l)||this.lF(a,h,u,t,s,l),a=l.x,h=l.y;if(y.i(l),this.fc++,this.fc>23)return;const c=Math.atan2(h,a);let d=10===s?this.yw-c:c-this.yw;d=Math.abs(d)<Math.abs(d-2*Math.PI)?d:d-2*Math.PI;const g=d*(n+o)/2;this.pw.p3(g,u),Math.abs(g)>1&&(this.fc<8?this.gi-=g/(2*Math.PI):this.gi-=g>0?1.7:-2.3,this.Is=this.gi*r,this.nF(t,e,i,s))}rF(t,e,i,s,n,o){const r=this.Ya,a=this.gi,h=this.Is;let l=0,u=0;const c=(i[s].width+i[s+1].width)/2+r;let d=!1;if(e>=0!=(10===n)){if(l=t+c,l>a){if(l=t-c,l<-a)return o.x=l,o.y=u,!1;d=!0}}else if(l=t-c,l<-a){if(l=t+c,l>a)return o.x=l,o.y=u,!1;d=!0}return u=Math.sqrt(1-Math.min(1,l*l/(a*a)))*h,e<0!==d&&(u=-u),Math.abs(e-u)>(i[s].height+i[s+1].height)/2?(o.x=l,o.y=u,!1):(o.x=l,o.y=u,!0)}lF(t,e,i,s,n,o){const r=this.Ya,a=this.gi,h=this.Is;let l=0,u=0;const c=(i[s].height+i[s+1].height)/2+r;let d=!1;if(t>=0!=(10===n)){if(u=e-c,u<-h){if(u=e+c,u>h)return o.x=l,o.y=u,!1;d=!0}}else if(u=e+c,u>h){if(u=e-c,u<-h)return o.x=l,o.y=u,!1;d=!0}return l=Math.sqrt(1-Math.min(1,u*u/(h*h)))*a,t<0!==d&&(l=-l),Math.abs(t-l)>(i[s].width+i[s+1].width)/2?(o.x=l,o.y=u,!1):(o.x=l,o.y=u,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=null!==this.group&&this.group.hasPlaceholder(),e=t?this.group.location.copy():null;let i=this.actualCenter;if(t?i=new y(0,0):(i.x=this.arrangementOrigin.x+this.gi,i.y=this.arrangementOrigin.y+this.Is),null!==this.network){const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;e.x+=i.x,e.y+=i.y,e.commit()}}if(t&&this.group&&e){this.group.ensureBounds();const t=this.group.position.copy(),i=this.group.location.copy(),s=e.subtract(i.subtract(t));this.group.move(s),this.hL=s.subtract(t)}}commitLinks(){if(null!==this.network){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}uL(t,e,i,s){const n=this.iF;if(Math.abs(this._f-1)<.001)return void 0!==i&&void 0!==s?s*t:2*Math.PI*t;const o=t>e?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e;let r=0,a=0;a=void 0!==i&&void 0!==s?s/(n+1):Math.PI/(2*(n+1));let h=0;for(let t=0;t<=n;t++){h=void 0!==i&&void 0!==s?i+t*s/n:t*Math.PI/(2*n);const e=Math.sin(h);r+=Math.sqrt(1-o*o*e*e)*a}return void 0!==i&&void 0!==s?(t>e?t:e)*r:4*(t>e?t:e)*r}Bk(t,e,i,s){let n=0;return n=void 0!==i&&void 0!==s?this.uL(1,e,i,s):this.uL(1,e),t/n}zk(t,e,i,s){if(Math.abs(this._f-1)<.001)return s/t;const n=t>e?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e;let o=0;const r=2*Math.PI/(700*this.network.vertexes.count);t>e&&(i+=Math.PI/2);for(let a=0;;a++){const h=i+a*r,l=Math.sin(h);if(o+=(t>e?t:e)*Math.sqrt(1-n*n*l*l)*r,o>=s)return a*r}}g3(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.y3(this.w3(t));default:e.o("Invalid sorting type.")}return t}w3(t){const e=[];for(let i=0;i<t.length;i++)e.push(0);const i=new h;for(let s=0;s<t.length;s++){let n=-1,o=-1;if(0===s)for(let e=0;e<t.length;e++){const i=t.elt(e).edgesCount;i>n&&(n=i,o=e)}else for(let i=0;i<t.length;i++){const t=e[i];t>n&&(n=t,o=i)}i.add(t.elt(o)),e[o]=-1;const r=t.elt(o);let a=0;const h=r.sourceEdges;for(;h.next();){const i=h.value.fromVertex;a=t.indexOf(i),!(a<0)&&e[a]>=0&&e[a]++}const l=r.destinationEdges;for(;l.next();){const i=l.value.toVertex;a=t.indexOf(i),!(a<0)&&e[a]>=0&&e[a]++}}return i}y3(t){const e=[];for(let i=0;i<t.length;i++){const s=t.elt(i);e[i]=[];let n=0;const o=s.destinationEdges;for(;o.next();){const s=o.value.toVertex;n=t.indexOf(s),n!==i&&e[i].indexOf(n)<0&&e[i].push(n)}const r=s.sourceEdges;for(;r.next();){const s=r.value.fromVertex;n=t.indexOf(s),n!==i&&e[i].indexOf(n)<0&&e[i].push(n)}}const i=[];for(let t=0;t<e.length;t++)i[t]=0;const s=[],n=[],o=[],r=[],a=new h;let l=0;for(let h=0;h<e.length;h++){const u=e[h].length;if(1===u){r.push(h);continue}if(0===u){a.add(t.elt(h));continue}if(0===l){s.push(h),l++;continue}let c=1/0,d=1/0,g=-1;const f=[];for(let t=0;t<s.length;t++)e[s[t]].indexOf(s[t===s.length-1?0:t+1])<0&&f.push(t===s.length-1?0:t+1);if(0===f.length)for(let t=0;t<s.length;t++)f.push(t);for(let t=0;t<f.length;t++){const r=f[t],a=this.x3(e[h],n,o,i,r,s);let l=0;for(let t=0;t<e[h].length;t++){const i=e[h][t],n=s.indexOf(i);if(n>=0){const t=Math.abs(r-(n>=r?n+1:n));l+=t<s.length+1-t?t:s.length+1-t}}for(let t=0;t<n.length;t++){let e=i[n[t]],a=i[o[t]];if(e>=r&&e++,a>=r&&a++,e>a){const t=a;a=e,e=t}a-e<(s.length+2)/2==(e<r&&r<=a)&&l++}(a<c||a===c&&l<d)&&(c=a,d=l,g=r)}s.splice(g,0,h);for(let t=0;t<s.length;t++)i[s[t]]=t;for(let t=0;t<e[h].length;t++){const i=e[h][t];s.indexOf(i)>=0&&(n.push(h),o.push(i))}l++}let u=!1;const c=s.length;for(;;){u=!0;for(let t=0;t<r.length;t++){const i=r[t],n=e[i][0],o=s.indexOf(n);if(o>=0){let a=0;for(let t=0;t<e[n].length;t++){const i=e[n][t],r=s.indexOf(i);if(r<0||r===o)continue;const h=r>o?r-o:o-r;a+=r<o!=h>c-h?1:-1}s.splice(a<0?o:o+1,0,i),r.splice(t,1),t--}else u=!1}if(u)break;s.push(r[0]),r.splice(0,1)}for(let e=0;e<s.length;e++){const i=s[e];a.add(t.elt(i))}return a}x3(t,e,i,s,n,o){let r=0;for(let a=0;a<e.length;a++){const h=e[a],l=i[a],u=s[h],c=s[l];let d=0,g=0;if(u<c?(d=u,g=c):(d=c,g=u),d<n&&n<=g)for(let e=0;e<t.length;e++){const i=t[e];o.indexOf(i)<0||d<s[i]&&s[i]<g||d===s[i]||g===s[i]||r++}else for(let e=0;e<t.length;e++){const i=t[e];o.indexOf(i)<0||!(d<s[i]&&s[i]<g)||d===s[i]||g===s[i]||r++}}return r}get radius(){return this.Og}set radius(t){this.Og!==t&&(e.s(t,"number",We,"radius"),(t>0||isNaN(t))&&(this.Og=t,this.p()))}get aspectRatio(){return this.Ig}set aspectRatio(t){this.Ig!==t&&(e.s(t,"number",We,"aspectRatio"),t>0&&(this.Ig=t,this.p()))}get startAngle(){return this.Eg}set startAngle(t){this.Eg!==t&&(e.s(t,"number",We,"startAngle"),this.Eg=t,this.p())}get sweepAngle(){return this.tu}set sweepAngle(t){this.tu!==t&&(e.s(t,"number",We,"sweepAngle"),this.tu=t>0&&t<=360?t:360,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(3===t||0===t||1===t||2===t)&&(this.He=t,this.p())}get direction(){return this.P}set direction(t){this.P!==t&&(10===t||11===t||12===t||13===t)&&(this.P=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(e.S(t,We,"comparer"),this.Mi=t,this.p())}get spacing(){return this.In}set spacing(t){this.In!==t&&(e.s(t,"number",We,"spacing"),this.In=t,this.p())}get nodeDiameterFormula(){return this.Ug}set nodeDiameterFormula(t){this.Ug!==t&&(30===t||31===t)&&(this.Ug=t,this.p())}get actualXRadius(){return this.gi}get actualYRadius(){return this.Is}get actualSpacing(){return this.Ya}get actualCenter(){return this.hL}static ConstantSpacing=0;static ConstantDistance=1;static ConstantAngle=2;static Packed=3;static Clockwise=10;static Counterclockwise=11;static BidirectionalLeft=12;static BidirectionalRight=13;static Forwards=20;static Reverse=21;static Ascending=22;static Descending=23;static Optimized=24;static Pythagorean=30;static Circular=31}class _e{eu;uc;iu;constructor(){this.eu=-1/0,this.uc=null,this.iu=null}m3(t,e){if(t>0&&this.eu<0||Math.abs(t)<Math.abs(this.eu)&&!(t<0&&this.eu>0)){this.eu=t,this.uc=[],this.iu=[];for(let t=0;t<e.length;t++)this.uc[t]=e[t].bounds.x,this.iu[t]=e[t].bounds.y}}p3(t,e){if(Math.abs(t)<Math.abs(this.eu)){this.eu=t,this.uc=[],this.iu=[];for(let t=0;t<e.length;t++)this.uc[t]=e[t].bounds.x,this.iu[t]=e[t].bounds.y}}commit(t){if(null!==this.uc&&null!==this.iu)for(let e=0;e<this.uc.length;e++){const i=t.elt(e);i.x=this.uc[e],i.y=this.iu[e]}}}class Je extends Ae{constructor(t){super(t)}createVertex(){return new $e(this)}createEdge(){return new Ze(this)}}class $e extends De{Ao;Xk;constructor(t){super(t),this.Ao=NaN,this.Xk=NaN}Ka(t){const e=this.network;if(null===e)return NaN;const i=e.layout;if(null===i)return NaN;if(3===i.arrangement){if(31===i.nodeDiameterFormula)return this.Ao=Math.max(this.width,this.height),this.Ao;{const e=Math.abs(Math.sin(t)),i=Math.abs(Math.cos(t));return 0===e?this.width:0===i?this.height:(this.Ao=Math.min(this.height/e,this.width/i),this.Ao)}}return 31===i.nodeDiameterFormula?(this.Ao=Math.max(this.width,this.height),this.Ao):(this.Ao=Math.sqrt(this.width*this.width+this.height*this.height),this.Ao)}get diameter(){return this.Ao}set diameter(t){this.Ao!==t&&(e.s(t,"number",$e,"diameter"),this.Ao=t)}get actualAngle(){return this.Xk}set actualAngle(t){this.Xk!==t&&(e.s(t,"number",$e,"actualAngle"),this.Xk=t)}}class Ze extends Fe{constructor(t){super(t)}}class Qe extends Le{kw;Ha;Es;Vg;Bn;zi;Bg;zg;Xg;su;Gg;Yg;nu;ou;ru;lu;Kg;Hg;au;dc;constructor(t){super(),this.kw=0,this.Ha=0,this.Es=new x(100,100).k(),this.Vg=!1,this.Bn=!0,this.zi=!1,this.Bg=100,this.zg=300,this.Xg=1,this.su=1e3,this.Gg=10,this.Yg=Math,this.nu=.05,this.ou=50,this.ru=150,this.lu=0,this.Kg=10,this.Hg=5,this.au=NaN,this.dc=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Es.h(this.Es),t.Vg=this.Vg,t.Bn=this.Bn,t.zi=this.zi,t.Bg=this.Bg,t.zg=this.zg,t.Xg=this.Xg,t.su=this.su,t.Gg=this.Gg,t.Yg=this.Yg,t.nu=this.nu,t.ou=this.ou,t.ru=this.ru,t.lu=this.lu,t.Kg=this.Kg,t.Hg=this.Hg,t.au=this.au,t.dc=this.dc}createNetwork(){return new ti(this)}doLayout(t){this.network=this.makeNetwork(t);let e=this.network.vertexes.iterator;const i=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),e=this.network.vertexes.iterator;e.next();){const t=e.value;t.charge=this.electricalCharge(t),t.mass=this.gravitationalMass(t)}const t=this.network.edges.iterator;for(;t.next();){const e=t.value;e.stiffness=this.springStiffness(e),e.length=this.springLength(e)}if(this.dL(),this.Ha=0,this.needsPrelayout()){const t=this.network,e=t.splitIntoSubNetworks(!1);let i=e.iterator;for(;i.next();){const t=i.value;this.doConnectedSubnetLayout(t)}for(i=e.iterator,this.b3(i,t),i=e.iterator;i.next();){const e=i.value,s=e.vertexes.iterator;for(;s.next();){const e=s.value;t.addVertex(e)}const n=e.edges.iterator;for(;n.next();){const e=n.value;t.addEdge(e)}}}else this.aF(this.network,this.maxIterations);this.updateParts()}this.maxIterations=i,this.isValidLayout=!0}needsPrelayout(){if(null===this.network||this.network.vertexes.count<3)return!1;let t=0,e=0;const i=this.network.vertexes.first().bounds,s=this.network.vertexes.iterator;for(;s.next();){const n=s.value,o=n.bounds;if(isNaN(n.x)||isNaN(n.y)||o.intersectsRect(i)&&(t++,t>2))return!0;if(e>10)return!1;e++}return!1}doConnectedSubnetLayout(t){let e=t.vertexes.iterator;for(;e.next();){const t=e.value;t.hierarchicalVertexes.add(t)}let i=t,s=this.au;if(isNaN(s)&&(s=t.edges.count/t.vertexes.count),s<t.vertexes.count)for(;i.vertexes.count>Math.max(100,Math.sqrt(s*t.vertexes.count));)i=this.coarsenNetwork(i);let n=0;e=i.vertexes.iterator;let o=this.randomNumberGenerator;for(null===o&&(this.randomNumberGenerator=o=new si(0));e.next();){e.value.idInCluster=n++;const t=10*(o.random()-.5),i=10*(o.random()-.5);this.isFixed(e.value)||(e.value.x=t,e.value.y=i);const s=e.value.hierarchicalVertexes.iterator;for(;s.next();)this.isFixed(s.value)||(s.value.x=t,s.value.y=i)}const r=this.computePairwiseDistances(i);this.k3(i,r,this.maxPrelayoutIterations,t.vertexes.count),this.aF(t,this.maxIterations)}computePairwiseDistances(t){const e=t.vertexes.count,i=new Array(e);for(let t=0;t<e;t++)i[t]=new Array(e).fill(-1),i[t][t]=0;const s=t.vertexes.iterator;let n=new Map,o=[];for(;s.next();){const t=s.value;for(o=[t],n=new Map,n.set(t.idInCluster,0);o.length>0;){const t=o.shift(),e=t.vertexes.iterator;for(;e.next();){const i=e.value;n.has(i.idInCluster)||(n.set(i.idInCluster,n.get(t.idInCluster)+1),o.push(i))}}for(let s=0;s<e;s++){const e=Math.min(i[t.idInCluster][s],i[s][t.idInCluster]),o=n.get(s);(e<0||o<e)&&(i[t.idInCluster][s]=o,i[s][t.idInCluster]=o)}}return i}coarsenNetwork(t){const e=this.createNetwork(),i=new Map;let s=0,n=t.vertexes.iterator;for(;n.next();)n.value.idInCluster=s++;for(n=t.vertexes.iterator;n.next();){const t=n.value;if(i.has(t.idInCluster))continue;let s=Number.MAX_SAFE_INTEGER,o=null;const r=t.vertexes.iterator;for(;r.next();){const t=r.value;i.has(t.idInCluster)||t.hierarchicalVertexes.length<s&&(s=t.hierarchicalVertexes.length,o=t)}const a=e.createVertex();a.hierarchicalVertexes.addAll(t.hierarchicalVertexes),null!=o&&a.hierarchicalVertexes.addAll(o.hierarchicalVertexes),i.set(t.idInCluster,a),null!=o&&i.set(o.idInCluster,a),e.addVertex(a)}const o=t.edges.iterator;for(;o.next();){const t=o.value,s=i.get(t.fromVertex.idInCluster),n=i.get(t.toVertex.idInCluster);if(s===n)continue;const r=e.createEdge();r.fromVertex=s||null,r.toVertex=n||null,e.addEdge(r)}return e}cx(t,e){let i=!0;const s=t.vertexes.iterator;for(;s.next();){const t=s.value;i?(i=!1,e.set(t.bounds)):e.unionRect(t.bounds)}return e}b3(t,i){const s=this.arrangementSpacing,n=t.count;let o=!0,r=0,a=0;const h=e.nt();for(let t=0;t<n+i.vertexes.count+2;t++)h[t]=null;let l=0;t.reset();const u=w.l();let c;for(;t.next();){const e=t.value;if(this.cx(e,u),o)o=!1,r=u.x+u.width/2,a=u.y+u.height/2,h[0]=new y(u.x+u.width+s.width,u.y),h[1]=new y(u.x,u.y+u.height+s.height),l=2;else{const t=this.hF(h,l,r,a,u.width,u.height,s),i=h[t],n=new y(i.x+u.width+s.width,i.y),o=new y(i.x,i.y+u.height+s.height);t+1<l&&h.splice(t+1,0,null),h[t]=n,h[t+1]=o,l++;const d=i.x-u.x,g=i.y-u.y;for(c=e.vertexes.iterator;c.next();){const t=c.value;this.isFixed(t)||(t.centerX+=d,t.centerY+=g)}}}for(w.i(u),c=i.vertexes.iterator;c.next();){const t=c.value,e=t.bounds;if(l<2){r=e.x+e.width/2,a=e.y+e.height/2,h[0]=new y(e.x+e.width+s.width,e.y),h[1]=new y(e.x,e.y+e.height+s.height),l=2;continue}const i=this.hF(h,l,r,a,e.width,e.height,s),n=h[i],o=new y(n.x+e.width+s.width,n.y),u=new y(n.x,n.y+e.height+s.height);i+1<l&&h.splice(i+1,0,null),h[i]=o,h[i+1]=u,l++,this.isFixed(t)||(t.centerX=n.x+t.width/2,t.centerY=n.y+t.height/2)}e.Z(h)}hF(t,e,i,s,n,o,r){let a=9e19,h=-1;t:for(let l=0;l<e;l++){const u=t[l],c=u.x-i,d=u.y-s,g=c*c+d*d;if(g<a){for(let e=l-1;e>=0;e--)if(t[e].y>u.y&&t[e].x-u.x<n+r.width)continue t;for(let i=l+1;i<e;i++)if(t[i].x>u.x&&t[i].y-u.y<o+r.height)continue t;h=l,a=g}}return h}dL(){if(null===this.network||!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;this.addComments(e)}}addComments(t){if(null===this.network)return;const e=t.node;if(null!==e){const i=e.findNodesConnected();for(;i.next();){const e=i.value;if("Comment"!==e.category||!e.isVisible())continue;let s=this.network.findVertex(e);null===s&&(s=this.network.addNode(e)),s.charge=this.defaultCommentElectricalCharge;let n=null;const o=s.destinationEdges;for(;o.next();){const e=o.value;if(e.toVertex===t){n=e;break}}if(null===n){const e=s.sourceEdges;for(;e.next();){const i=e.value;if(i.fromVertex===t){n=i;break}}}null===n&&(n=this.network.linkVertexes(t,s,null)),n.length=this.defaultCommentSpringLength}}}cF(t,e){const i=t.bounds,s=i.x,n=i.y,o=i.width,r=i.height,a=e.bounds,h=a.x,l=a.y,u=a.width,c=a.height;if(s+o<h){if(n>l+c){const t=s+o-h,e=n-l-c;return k.ix(t*t+e*e)}if(n+r<l){const t=s+o-h,e=n+r-l;return k.ix(t*t+e*e)}return h-(s+o)}if(s>h+u){if(n>l+c){const t=s-h-u,e=n-l-c;return k.ix(t*t+e*e)}if(n+r<l){const t=s-h-u,e=n+r-l;return k.ix(t*t+e*e)}return s-(h+u)}return n>l+c?n-(l+c):n+r<l?l-(n+r):.1}aF(t,e){const i=this.Ha+e;for(;this.Ha<i&&(this.Ha++,this.P3(t)););}P3(t){const e=t.vertexes.toArray();if(e.length<=0)return!1;const i=e[0];i.forceX=0,i.forceY=0;let s=i.centerX,n=s,o=i.centerY,r=o;for(let t=1;t<e.length;t++){const i=e[t];i.forceX=0,i.forceY=0;const a=i.centerX,h=i.centerY;s=Math.min(s,a),n=Math.max(n,a),o=Math.min(o,h),r=Math.max(r,h)}const a=n-s>r-o;a?e.sort(((t,e)=>null===t||null===e||t===e?0:t.centerX-e.centerX)):e.sort(((t,e)=>null===t||null===e||t===e?0:t.centerY-e.centerY));const h=this.su;let l=0,u=0,c=0;for(let t=0;t<e.length;t++){const i=e[t],s=i.bounds,n=i.focus,o=s.x+n.x,r=s.y+n.y;u=i.charge*this.electricalFieldX(o,r),c=i.charge*this.electricalFieldY(o,r),u+=i.mass*this.gravitationalFieldX(o,r),c+=i.mass*this.gravitationalFieldY(o,r),i.forceX+=u,i.forceY+=c;for(let s=t+1;s<e.length;s++){const n=e[s];if(!this.shouldInteract(i,n)||s===t)continue;const d=n.bounds,g=n.focus,f=d.x+g.x,m=d.y+g.y;if(o-f>h||f-o>h){if(a)break;continue}if(r-m>h||m-r>h){if(!a)break;continue}const p=this.cF(i,n),y=2*i.charge,x=2*n.charge;if(p>1)l=y*x/(p*p),u=l*(o-f)/p,c=l*(r-m)/p;else{let t=this.randomNumberGenerator;null===t&&(this.randomNumberGenerator=t=new si(0));const e=t.random(),s=t.random();if(o>f)u=Math.abs(n.bounds.right-i.bounds.x),u=y*x*(1+u)*e;else if(o<f)u=Math.abs(n.bounds.x-i.bounds.right),u=-y*x*(1+u)*e;else{const t=Math.max(n.width,i.width);u=y*x*((1+t)*e-t/2)}if(r>m)c=Math.abs(n.bounds.bottom-i.bounds.y),c=y*x*(1+c)*s;else if(o<f)c=Math.abs(n.bounds.y-i.bounds.bottom),c=-y*x*(1+c)*s;else{const t=Math.max(n.height,i.height);c=y*x*((1+t)*s-t/2)}}i.forceX+=u,i.forceY+=c,n.forceX-=u,n.forceY-=c}}const d=t.edges.iterator;for(;d.next();){const t=d.value,e=t.fromVertex,i=t.toVertex,s=e.bounds,n=e.focus,o=s.x+n.x,r=s.y+n.y,a=i.bounds,h=i.focus,g=a.x+h.x,f=a.y+h.y,m=this.cF(e,i);m>1&&(l=.1*t.stiffness*(m-t.length),u=.5*l*(e.width+i.height)*(o-g)/m,c=.5*l*(e.width+i.height)*(r-f)/m),e.forceX-=u,e.forceY-=c,i.forceX+=u,i.forceY+=c}let g=0;for(let t=0;t<e.length;t++){const i=e[t];this.isFixed(i)?this.moveFixedVertex(i):g=Math.max(g,this.moveVertex(i)||0)}return g>this.epsilonDistance*this.epsilonDistance}k3(t,e,i,s){const n=this.Ha+i,o=Math.sqrt(s);this.kw=this.dc*t.vertexes.count;const r=t.vertexes.toArray();let a=0,h=0,l=0;for(;this.Ha<n;){this.Ha++,h=a,a=0;for(let t=0;t<r.length;t++){r[t].forceX=0,r[t].forceY=0;for(let i=0;i<r.length;i++){if(t===i)continue;const s=Math.sqrt((r[t].centerX-r[i].centerX)**2+(r[t].centerY-r[i].centerY)**2),n=e[r[t].idInCluster][r[i].idInCluster],a=(s-this.dc*o*n)/s;r[t].forceX+=a*(r[i].x-r[t].x),r[t].forceY+=a*(r[i].y-r[t].y)}const i=Math.sqrt(r[t].forceX*r[t].forceX+r[t].forceY*r[t].forceY);if(i>0){r[t].forceX=this.kw*r[t].forceX/i,r[t].forceY=this.kw*r[t].forceY/i,this.isFixed(r[t])||(r[t].x+=r[t].forceX,r[t].y+=r[t].forceY);const e=r[t].hierarchicalVertexes.iterator;for(;e.next();){const i=e.value;this.isFixed(i)||(i.centerX+=r[t].forceX,i.centerY+=r[t].forceY)}}a+=i*i}if(a>=h){if(l++,l>=5)break}else l=0;this.kw*=.95}}moveVertex(t){let e=t.forceX,i=t.forceY;const s=this.moveLimit;return e<-s?e=-s:e>s&&(e=s),i<-s?i=-s:i>s&&(i=s),t.centerX+=e,t.centerY+=i,e*e+i*i}shouldInteract(t,e){return!0}moveFixedVertex(t){}commitLayout(){this.Pw(),this.commitNodes(),this.isRouting&&this.commitLinks()}Pw(){if(null===this.network||!this.setsPortSpots)return;const t=this.network.edges.iterator;for(;t.next();){const e=t.value.link;null!==e&&(e.fromSpot=v.Default,e.toSpot=v.Default)}}commitNodes(){if(!this.network)return;let t=0,e=0;if(this.arrangesToOrigin){const i=w.l();this.cx(this.network,i);const s=this.arrangementOrigin;t=s.x-i.x,e=s.y-i.y,w.i(i)}const i=w.l(),s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;(0!==t||0!==e)&&(i.h(n.bounds),i.x+=t,i.y+=e,n.bounds=i),n.commit()}w.i(i)}commitLinks(){if(!this.network)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){const e=t.stiffness;return isNaN(e)?this.nu:e}springLength(t){const e=t.length;return isNaN(e)?this.ou:e}electricalCharge(t){const e=t.charge;return isNaN(e)?this.ru:e}electricalFieldX(t,e){return 0}electricalFieldY(t,e){return 0}gravitationalMass(t){const e=t.mass;return isNaN(e)?this.lu:e}gravitationalFieldX(t,e){return 0}gravitationalFieldY(t,e){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.Ha}get arrangementSpacing(){return this.Es}set arrangementSpacing(t){this.Es.equals(t)||(this.Es.h(t),this.p())}get arrangesToOrigin(){return this.Vg}set arrangesToOrigin(t){this.Vg!==t&&(e.s(t,"boolean",Qe,"arrangesToOrigin"),this.Vg=t,this.p())}get setsPortSpots(){return this.Bn}set setsPortSpots(t){this.Bn!==t&&(e.s(t,"boolean",Qe,"setsPortSpots"),this.Bn=t,this.p())}get comments(){return this.zi}set comments(t){this.zi!==t&&(e.s(t,"boolean",Qe,"comments"),this.zi=t,this.p())}get maxPrelayoutIterations(){return this.Bg}set maxPrelayoutIterations(t){this.Bg!==t&&(e.s(t,"number",Qe,"maxPrelayoutIterations"),t>=0&&(this.Bg=t,this.p()))}get maxIterations(){return this.zg}set maxIterations(t){this.zg!==t&&(e.s(t,"number",Qe,"maxIterations"),t>=0&&(this.zg=t,this.p()))}get epsilonDistance(){return this.Xg}set epsilonDistance(t){this.Xg!==t&&(e.s(t,"number",Qe,"epsilonDistance"),t>0&&(this.Xg=t,this.p()))}get infinityDistance(){return this.su}set infinityDistance(t){this.su!==t&&(e.s(t,"number",Qe,"infinityDistance"),t>1&&(this.su=t,this.p()))}get moveLimit(){return this.Gg}set moveLimit(t){this.Gg!==t&&(e.s(t,"number",Qe,"moveLimit"),this.Gg=t,this.p())}get randomNumberGenerator(){return this.Yg}set randomNumberGenerator(t){this.Yg!==t&&(null!==t&&!e.st(t.random)&&e.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.Yg=t)}get defaultSpringStiffness(){return this.nu}set defaultSpringStiffness(t){this.nu!==t&&(e.s(t,"number",Qe,"defaultSpringStiffness"),this.nu=t,this.p())}get defaultSpringLength(){return this.ou}set defaultSpringLength(t){this.ou!==t&&(e.s(t,"number",Qe,"defaultSpringLength"),this.ou=t,this.p())}get defaultElectricalCharge(){return this.ru}set defaultElectricalCharge(t){this.ru!==t&&(e.s(t,"number",Qe,"defaultElectricalCharge"),this.ru=t,this.p())}get defaultGravitationalMass(){return this.lu}set defaultGravitationalMass(t){this.lu!==t&&(e.s(t,"number",Qe,"defaultGravitationalMass"),this.lu=t,this.p())}get defaultCommentSpringLength(){return this.Kg}set defaultCommentSpringLength(t){this.Kg!==t&&(e.s(t,"number",Qe,"defaultCommentSpringLength"),this.Kg=t,this.p())}get defaultCommentElectricalCharge(){return this.Hg}set defaultCommentElectricalCharge(t){this.Hg!==t&&(e.s(t,"number",Qe,"defaultCommentElectricalCharge"),this.Hg=t,this.p())}get prelayoutQuality(){return this.au}set prelayoutQuality(t){this.au!==t&&(e.s(t,"number",Qe,"prelayoutQuality"),this.au=t,this.p())}get prelayoutSpread(){return this.dc}set prelayoutSpread(t){this.dc!==t&&(e.s(t,"number",Qe,"prelayoutSpread"),this.dc=t,this.p())}}class ti extends Ae{constructor(t){super(t)}createVertex(){return new ei(this)}createEdge(){return new ii(this)}}class ei extends De{Gk;Yk;Kk;Hk;qk;hierarchicalVertexes;idInCluster;constructor(t){super(t),this.Gk=!1,this.Yk=NaN,this.Kk=NaN,this.Hk=0,this.qk=0,this.hierarchicalVertexes=new h,this.idInCluster=-1}get isFixed(){return this.Gk}set isFixed(t){this.Gk!==t&&(e.s(t,"boolean",ei,"isFixed"),this.Gk=t)}get charge(){return this.Yk}set charge(t){this.Yk!==t&&(e.s(t,"number",ei,"charge"),this.Yk=t)}get mass(){return this.Kk}set mass(t){this.Kk!==t&&(e.s(t,"number",ei,"mass"),this.Kk=t)}get forceX(){return this.Hk}set forceX(t){this.Hk!==t&&(e.s(t,"number",ei,"forceX"),this.Hk=t)}get forceY(){return this.qk}set forceY(t){this.qk!==t&&(e.s(t,"number",ei,"forceY"),this.qk=t)}}class ii extends Fe{jk;Wk;constructor(t){super(t),this.jk=NaN,this.Wk=NaN}get stiffness(){return this.jk}set stiffness(t){this.jk!==t&&(e.s(t,"number",ii,"stiffness"),this.jk=t)}get length(){return this.Wk}set length(t){this.Wk!==t&&(e.s(t,"number",ii,"length"),this.Wk=t)}}class si{I;R;Q;M;A;seed;constructor(t){void 0===t&&(t=42),this.seed=t,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const t=this.seed/this.Q,e=this.seed%this.Q,i=this.A*e-this.R*t;return this.seed=i>0?i:i+this.M,this.seed*this.I}}var ni=(t=>(t[t.DepthFirst=0]="DepthFirst",t[t.Greedy=1]="Greedy",t[t.FromLayers=2]="FromLayers",t))(ni||{}),oi=(t=>(t[t.OptimalLinkLength=10]="OptimalLinkLength",t[t.LongestPathSink=11]="LongestPathSink",t[t.LongestPathSource=12]="LongestPathSource",t))(oi||{}),ri=(t=>(t[t.DepthFirstOut=20]="DepthFirstOut",t[t.DepthFirstIn=21]="DepthFirstIn",t[t.Naive=22]="Naive",t))(ri||{}),ai=(t=>(t[t.None=30]="None",t[t.Less=31]="Less",t[t.More=32]="More",t))(ai||{}),hi=(t=>(t[t.None=0]="None",t[t.Expand=1]="Expand",t[t.Straighten=2]="Straighten",t[t.Median=4]="Median",t[t.MaybeExpand=8]="MaybeExpand",t[t.All=15]="All",t))(hi||{}),li=(t=>(t[t.None=0]="None",t[t.UpperLeft=1]="UpperLeft",t[t.UpperRight=2]="UpperRight",t[t.LowerLeft=4]="LowerLeft",t[t.LowerRight=8]="LowerRight",t[t.All=15]="All",t))(li||{});class ui extends Le{Us;ti;P;hu;cu;fu;gc;uu;hr;du;Bn;_;Sw;zt;qg;Vs;ie;Bs;ms;ps;Rt;jg;Wg;Jk;cn;gu;cr;zn;Xn;gL;qa;constructor(t){super(),this.Us=25,this.ti=25,this.P=0,this.hu=0,this.cu=10,this.fu=20,this.gc=4,this.uu=31,this.hr=15,this.du=10,this.Bn=!0,this._=-1,this.Sw=-1,this.zt=-1,this.qg=0,this.Vs=0,this.ie=new Int16Array(0),this.Bs=new Float32Array(0),this.ms=new Float32Array(0),this.ps=new Float32Array(0),this.Rt=new Float32Array(0),this.jg=0,this.Wg=new Int16Array(0),this.Jk=new Int16Array(0),this.cn=0,this.gu=null,this.cr=new y,this.zn=[],this.zn.length=100,this.Xn=15,this.gL=0,this.qa=!0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Us=this.Us,t.ti=this.ti,t.P=this.P,t.hu=this.hu,t.cu=this.cu,t.fu=this.fu,t.gc=this.gc,t.uu=this.uu,t.hr=this.hr,t.du=this.du,t.Bn=this.Bn,t.Xn=this.Xn,t.qa=this.qa}fe(t){t in ai?this.aggressiveOption=t:t in ni?this.cycleRemoveOption=t:t in ri?this.initializeOption=t:t in oi?this.layeringOption=t:super.fe(t)}createNetwork(){return new ci(this)}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.S3(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),2!==this.cycleRemoveOption&&this.removeCycles(),this.M3(),2===this.cycleRemoveOption&&this.removeCycles(),this.N3(),this.C3(),this.L3(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const e=t.fromVertex.node||t.fromVertex.data,i=t.toVertex.node||t.toVertex.data;return null===e&&null===i?8:null===e||null===i?4:1}nodeMinLayerSpace(t,e){return null===t.node&&null===t.data?0:90===this.P||270===this.P?e?t.focus.y+10:t.bounds.height-t.focus.y+10:e?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,e){if(null===t.node&&null===t.data)return 0;const i=e?t.$k:t.Zk;if(null!==i)return i;const s=this.P;return 90===s||270===s?e?t.$k=t.focus.x/this.ti+1|0:t.Zk=(t.bounds.width-t.focus.x)/this.ti+1|0:e?t.$k=t.focus.y/this.ti+1|0:t.Zk=(t.bounds.height-t.focus.y)/this.ti+1|0}ei(){const t=this.network.vertexes.count;this.Wg.length<2*t&&(this.Wg=new Int16Array(2*t));let e=0;const i=this.network.vertexes.iterator;for(;i.next();){const t=i.value;this.Wg[e]=t.column,e++,this.Wg[e]=t.index,e++}return this.Wg}ns(t){let e=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;s.column=t[e],e++,s.index=t[e],e++}}fF(t,e){const i=this.ja(t),s=this.ie[t];this.Jk.length<s*s&&(this.Jk=new Int16Array(s*s));const n=this.Jk;for(let o=0;o<s;o++){let r=0;const a=i[o],h=a.near;let l=0;null!==h&&h!==a&&h.layer===a.layer&&(r+=Math.max(0,Math.abs(h.index-a.index)-1));let u,c,d,g,f,m=0,p=0,y=0,x=0,w=0,b=0,v=0,P=0;if(e>=0)for(u=i[o].So,m=0;m<u.length;m++)if(c=u[m],c.valid&&c.fromVertex.layer!==t)for(p=c.fromVertex.index,y=c.portToPos,x=c.portFromPos,w=m+1;w<u.length;w++)g=u[w],g.valid&&g.fromVertex.layer!==t&&(b=g.fromVertex.index,v=g.portToPos,P=g.portFromPos,y<v&&(p>b||p===b&&x>P)&&r++,v<y&&(b>p||b===p&&P>x)&&r++);if(e<=0)for(u=i[o].or,m=0;m<u.length;m++)if(c=u[m],c.valid&&c.toVertex.layer!==t)for(p=c.toVertex.index,y=c.portToPos,x=c.portFromPos,w=m+1;w<u.length;w++)g=u[w],g.valid&&g.toVertex.layer!==t&&(b=g.toVertex.index,v=g.portToPos,P=g.portFromPos,x<P&&(p>b||p===b&&y>v)&&r++,P<x&&(b>p||b===p&&v>y)&&r++);for(n[o*s+o]=r,l=o+1;l<s;l++){let r=0,a=0;if(e>=0)for(d=i[o].So,f=i[l].So,m=0;m<d.length;m++)if(c=d[m],c.valid&&c.fromVertex.layer!==t)for(p=c.fromVertex.index,y=c.portToPos,x=c.portFromPos,w=0;w<f.length;w++)g=f[w],g.valid&&g.fromVertex.layer!==t&&(b=g.fromVertex.index,v=g.portToPos,P=g.portFromPos,(p<b||p===b&&x<P)&&a++,(b<p||b===p&&P<x)&&r++);if(e<=0)for(d=i[o].or,f=i[l].or,m=0;m<d.length;m++)if(c=d[m],c.valid&&c.toVertex.layer!==t)for(p=c.toVertex.index,y=c.portToPos,x=c.portFromPos,w=0;w<f.length;w++)g=f[w],g.valid&&g.toVertex.layer!==t&&(b=g.toVertex.index,v=g.portToPos,P=g.portFromPos,(p<b||p===b&&y<v)&&a++,(b<p||b===p&&v<y)&&r++);n[o*s+l]=r,n[l*s+o]=a}}return this.Wa(t,i),n}countCrossings(){let t=0;for(let e=0;e<=this._;e++){const i=this.fF(e,1),s=this.ie[e];for(let e=0;e<s;e++)for(let n=e;n<s;n++)t+=i[e*s+n]}return t}A3(t,e,i){const s=this.ja(t),n=this.ie[t];let o=0;for(let r=0;r<n;r++){let n=null;e<=0&&(n=s[r].So);let a=null;e>=0&&(a=s[r].or);let h,l=0,u=0;if(null!==n)for(let e=0;e<n.length;e++)h=n[e],h.valid&&h.fromVertex.layer!==t&&(l=h.fromVertex.column+h.portFromColOffset,u=h.toVertex.column+h.portToColOffset,o+=i?Math.abs(l-u)*this.linkStraightenWeight(h):Math.abs(l-u));if(null!==a)for(let e=0;e<a.length;e++)h=a[e],h.valid&&h.toVertex.layer!==t&&(l=h.fromVertex.column+h.portFromColOffset,u=h.toVertex.column+h.portToColOffset,o+=i?(Math.abs(l-u)+1)*this.linkStraightenWeight(h):Math.abs(l-u))}return this.Wa(t,s),o}Qk(t){let e=0;for(let i=0;i<=this._;i++)e+=this.A3(i,1,t);return e}Mw(){let t=1/0;this.zt=-1;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;t=Math.min(t,i.column-this.nodeMinColumnSpace(i,!0)),this.zt=Math.max(this.zt,i.column+this.nodeMinColumnSpace(i,!1))}for(e.reset();e.next();){e.value.column-=t}this.zt-=t}Nw(t,e){const i=this.ja(t),s=this.ie[t],n=new Float32Array(s);for(let o=0;o<s;o++){const s=i[o];let r=null;e<=0&&(r=s.So);let a=null;e>=0&&(a=s.or);let h=0,l=0;const u=s.near;let c;if(null!==u&&u.layer===s.layer&&(h+=u.column-1,l++),null!==r)for(let e=0;e<r.length;e++){c=r[e];const i=c.fromVertex;c.valid&&!c.rev&&i.layer!==t&&(h+=i.column,l++)}if(null!==a)for(let e=0;e<a.length;e++){c=a[e];const i=c.toVertex;c.valid&&!c.rev&&i.layer!==t&&(h+=i.column,l++)}n[o]=0===l?-1:h/l}return this.Wa(t,i),n}uF(t,e){const i=this.ja(t),s=this.ie[t],n=new Int16Array(s);for(let o=0;o<s;o++){const s=i[o];let r=null;e<=0&&(r=s.So);let a=null;e>=0&&(a=s.or);let h=0;const l=[],u=s.near;let c;if(null!==u&&u.layer===s.layer&&(l[h]=u.column-1,h++),null!==r)for(let e=0;e<r.length;e++){c=r[e];const i=c.fromVertex;c.valid&&!c.rev&&i.layer!==t&&(l[h]=i.column+c.portFromColOffset,h++)}if(null!==a)for(let e=0;e<a.length;e++){c=a[e];const i=c.toVertex;c.valid&&!c.rev&&i.layer!==t&&(l[h]=i.column+c.portToColOffset,h++)}if(0===h)n[o]=-1;else{l.sort(((t,e)=>t-e));const t=h>>1;n[o]=1&h?l[t]:l[t-1]+l[t]>>1}}return this.Wa(t,i),n}Cw(t,e,i,s,n){if(t.component===i){t.component=e;let o=0,r=0;if(s){const a=t.destinationEdges;for(;a.next();){const h=a.value,l=h.toVertex;o=t.layer-l.layer,r=this.linkMinLength(h),o===r&&this.Cw(l,e,i,s,n)}}if(n){const a=t.sourceEdges;for(;a.next();){const h=a.value,l=h.fromVertex;o=l.layer-t.layer,r=this.linkMinLength(h),o===r&&this.Cw(l,e,i,s,n)}}}}mL(t,e,i,s,n){if(t.component===i){if(t.component=e,s){const o=t.destinationEdges;for(;o.next();){const t=o.value.toVertex;this.mL(t,e,i,s,n)}}if(n){const o=t.sourceEdges;for(;o.next();){const t=o.value.fromVertex;this.mL(t,e,i,s,n)}}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();){t.value.rev=!1}switch(this.hu){default:case 1:this.T3();break;case 0:this.D3();break;case 2:this.v3()}}v3(){const t=this.network,e=t.vertexes.iterator;let i=1/0;for(;e.next();){const t=e.value;i=Math.min(i,t.layer)}if(i<1/0){if(i<0)for(e.reset();e.next();){e.value.layer-=i}const s=[];for(e.reset();e.next();){const t=e.value,i=s[t.layer];void 0===i?s[t.layer]=[t]:i.push(t)}let n=0;for(let t=0;t<s.length;t++){const e=s[t];if(e&&0!==e.length){if(t>0)for(let t=0;t<e.length;t++){e[t].layer-=n}}else n++}const o=t.edges.iterator;for(;o.next();){const e=o.value,i=e.fromVertex,s=e.toVertex;i.layer<s.layer&&(t.reverseEdge(e),e.rev=!0)}}}T3(){const t=this.network;let e=0,i=t.vertexes.count-1;const s=[];s.length=i+1;const n=t.vertexes.iterator;for(;n.next();){n.value.ii=!0}for(;null!==this.F3(t);){let n;for(n=this.dF(t);null!==n;)s[i]=n,i--,n.ii=!1,n=this.dF(t);for(n=this.gF(t);null!==n;)s[e]=n,e++,n.ii=!1,n=this.gF(t);n=this.R3(t),null!==n&&(s[e]=n,e++,n.ii=!1)}for(let e=0;e<t.vertexes.count;e++)s[e].index=e;const o=t.edges.iterator;for(;o.next();){const e=o.value,i=e.fromVertex,s=e.toVertex;i.index>s.index&&(t.reverseEdge(e),e.rev=!0)}}F3(t){const e=t.vertexes.iterator;for(;e.next();){const t=e.value;if(t.ii)return t}return null}dF(t){const e=t.vertexes.iterator;for(;e.next();){const t=e.value;if(t.ii){let e=!0;const i=t.destinationEdges;for(;i.next();)if(i.value.toVertex.ii){e=!1;break}if(e)return t}}return null}gF(t){const e=t.vertexes.iterator;for(;e.next();){const t=e.value;if(t.ii){let e=!0;const i=t.sourceEdges;for(;i.next();)if(i.value.fromVertex.ii){e=!1;break}if(e)return t}}return null}R3(t){let e=null,i=0;const s=this.network.vertexes.iterator;for(;s.next();){const t=s.value;if(t.ii){let s=0;const n=t.destinationEdges;for(;n.next();)n.value.toVertex.ii&&s++;let o=0;const r=t.sourceEdges;for(;r.next();)r.value.fromVertex.ii&&o++;(null===e||i<s-o)&&(e=t,i=s-o)}}return e}D3(){const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;e.mu=-1,e._n=-1}const e=this.network.edges.iterator;for(;e.next();){e.value.forest=!1}for(this.jg=0,t.reset();t.next();){const e=t.value;0===e.sourceEdges.count&&this.pL(e)}for(t.reset();t.next();){const e=t.value;-1===e.mu&&this.pL(e)}for(e.reset();e.next();){const t=e.value;if(!t.forest){const e=t.fromVertex,i=e.mu,s=e._n,n=t.toVertex,o=n.mu,r=n._n;o<i&&s<r&&(this.network.reverseEdge(t),t.rev=!0)}}}pL(t){t.mu=this.jg,this.jg++;const e=t.destinationEdges;for(;e.next();){const t=e.value,i=t.toVertex;-1===i.mu&&(t.forest=!0,this.pL(i))}t._n=this.jg,this.jg++}M3(){const t=this.network.vertexes.iterator;for(;t.next();){t.value.layer=-1}for(this._=-1,this.assignLayers(),t.reset();t.next();){const e=t.value;this._=Math.max(this._,e.layer)}this._>=9999&&e.o("LayeredDigraphLayout, too many layers: "+this._);const i=0==this.direction||180==this.direction,s=[];for(const t=this.network.vertexes.iterator;t.next();){const e=t.value;if(null===e.node||e.centered)continue;const n=e.layer;let o=s[n];void 0===o&&(o=0);const r=i?e.width:e.height;r>o&&(s[n]=r)}for(const t=this.network.vertexes.iterator;t.next();){const e=t.value;if(null===e.node||e.centered)continue;const n=s[e.layer];i?(e.focusX=n/2,e.focusY=e.focus.y,e.width=n):(e.focusX=e.focus.x,e.focusY=n/2,e.height=n)}}assignLayers(){switch(this.cu){case 11:this.mF();break;case 12:this.O3();break;default:this.I3()}}mF(){const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value,i=this.pF(e);this._=Math.max(i,this._)}}pF(t){let e=0;if(-1===t.layer){const i=t.destinationEdges;for(;i.next();){const t=i.value,s=t.toVertex,n=this.linkMinLength(t);e=Math.max(e,this.pF(s)+n)}t.layer=e}else e=t.layer;return e}O3(){let t=0;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;t=this.yF(i),this._=Math.max(t,this._)}for(e.reset();e.next();){const t=e.value;t.layer=this._-t.layer}}yF(t){let e=0;if(-1===t.layer){const i=t.sourceEdges;for(;i.next();){const t=i.value,s=t.fromVertex,n=this.linkMinLength(t);e=Math.max(e,this.yF(s)+n)}t.layer=e}else e=t.layer;return e}I3(){this.mF();const t=this.network.vertexes.iterator;for(;t.next();){t.value.ii=!1}for(t.reset();t.next();){const e=t.value;0===e.sourceEdges.count&&this.wF(e)}let e=1/0;for(t.reset();t.next();){const i=t.value;e=Math.min(e,i.layer)}for(this._=-1,t.reset();t.next();){const i=t.value;i.layer-=e,this._=Math.max(this._,i.layer)}}wF(t){if(!t.ii){t.ii=!0;const e=t.destinationEdges;for(;e.next();){const t=e.value.toVertex;this.wF(t)}this.E3(t),this.U3(t)}}E3(t){const e=this.network.vertexes.iterator;for(;e.next();){e.value.component=-1}const i=t.So;let s=i.length;for(let t=0;t<s;t++){const e=i[t],s=e.fromVertex,n=e.toVertex,o=this.linkMinLength(e);s.layer-n.layer>o&&this.Cw(s,0,-1,!0,!1)}for(this.Cw(t,1,-1,!0,!0);0!==t.component;){let i=0,n=1/0,o=0,r=null;const a=this.network.vertexes.iterator;for(;a.next();){const t=a.value;if(1===t.component){let e=0,a=!1;const h=t.So;s=h.length;for(let o=0;o<s;o++){const s=h[o],r=s.fromVertex;if(e+=this.linkLengthWeight(s),1!==r.component){i+=this.linkLengthWeight(s);const e=r.layer-t.layer,o=this.linkMinLength(s);n=Math.min(n,e-o)}}const l=t.or;s=l.length;for(let t=0;t<s;t++){const s=l[t],n=s.toVertex;e-=this.linkLengthWeight(s),1!==n.component?i-=this.linkLengthWeight(s):a=!0}(null===r||e<o)&&!a&&(r=t,o=e)}}if(i>0){for(e.reset();e.next();){const t=e.value;1===t.component&&(t.layer+=n)}t.component=0}else r.component=0}}U3(t){const e=this.network.vertexes.iterator;for(;e.next();){e.value.component=-1}for(this.Cw(t,1,-1,!0,!1);0!==t.component;){let i=0,s=1/0,n=0,o=null;const r=this.network.vertexes.iterator;for(;r.next();){const t=r.value;if(1===t.component){let e=0,r=!1;const a=t.So;let h=a.length;for(let t=0;t<h;t++){const s=a[t],n=s.fromVertex;e+=this.linkLengthWeight(s),1!==n.component?i+=this.linkLengthWeight(s):r=!0}const l=t.or;h=l.length;for(let n=0;n<h;n++){const o=l[n],r=o.toVertex;if(e-=this.linkLengthWeight(o),1!==r.component){i-=this.linkLengthWeight(o);const e=t.layer-r.layer,n=this.linkMinLength(o);s=Math.min(s,e-n)}}(null===o||e>n)&&!r&&(o=t,n=e)}}if(i<0){for(e.reset();e.next();){const t=e.value;1===t.component&&(t.layer-=s)}t.component=0}else o.component=0}}N3(){const t=this.network,e=[],i=t.edges.iterator;for(;i.next();){const t=i.value;t.valid=!1,e.push(t)}for(let i=0;i<e.length;i++){const s=e[i];let n=s.fromVertex;const o=s.toVertex;if(s.valid||(null===n.node&&null===n.data||null===o.node&&null===o.data)&&n.layer===o.layer)continue;let r=0,a=0,h=0,l=0;if(null!==s.link){const t=s.link;if(null===t)continue;const e=n.node,i=o.node;if(null===e||null===i)continue;let u=t.fromNode,c=t.toNode,d=t.fromPort;for(;null!==d&&!d.isVisibleObject();)d=d.panel;let g=t.toPort;for(;null!==g&&!g.isVisibleObject();)g=g.panel;if(s.rev){const t=u,e=d;u=c,d=g,c=t,g=e}const f=n.focus,m=o.focus,p=s.rev?o.bounds:n.bounds,x=y.l();e!==u?p.isReal()&&u.isVisible()?u.actualBounds.isReal()?(u.getRelativePoint(d,v.Center,x),x.x+=u.actualBounds.x-p.x,x.y+=u.actualBounds.y-p.y):(u.getRelativePoint(d,v.Center,x),x.isReal()||x.h(f)):x.h(f):p.isReal()?(u.getRelativePoint(d,v.Center,x),x.isReal()||x.h(f)):x.h(f);const w=s.rev?n.bounds:o.bounds,b=y.l();i!==c?w.isReal()&&c.isVisible()?c.actualBounds.isReal()?(c.getRelativePoint(g,v.Center,b),b.x+=c.actualBounds.x-w.x,b.y+=c.actualBounds.y-w.y):(c.getRelativePoint(g,v.Center,b),b.isReal()||b.h(m)):b.h(m):w.isReal()?(c.getRelativePoint(g,v.Center,b),b.isReal()||b.h(m)):b.h(m),90===this.P||270===this.P?(r=Math.round((x.x-f.x)/this.ti),h=x.x,a=Math.round((b.x-m.x)/this.ti),l=b.x):(r=Math.round((x.y-f.y)/this.ti),h=x.y,a=Math.round((b.y-m.y)/this.ti),l=b.y),y.i(x),y.i(b),s.portFromColOffset=r,s.portFromPos=h,s.portToColOffset=a,s.portToPos=l}else s.portFromColOffset=0,s.portFromPos=0,s.portToColOffset=0,s.portToPos=0;let u=n.layer;const c=o.layer,d=this.V3(s),g=1===d||3===d,f=2===d||3===d;let m,p,x,w=null;f&&(w=this.B3(n,o),x=1,p=t.createVertex(),p.node=null,p._k=1,p.layer=u,p.near=n,t.addVertex(p),m=t.linkVertexes(n,p,s.link),m.valid=!1,m.rev=s.rev,m.portFromColOffset=r,m.portToColOffset=0,m.portFromPos=h,m.portToPos=0,n=p);let b=1;if(g&&b--,u-c>b&&u>0){for(s.valid=!1,p=t.createVertex(),p.node=null,p._k=2,p.layer=u-1,w&&x<w.length&&p.layer===w[x].layer&&(p.near=w[x++]),t.addVertex(p),m=t.linkVertexes(n,p,s.link),m.valid=!0,m.rev=s.rev,m.portFromColOffset=f?0:r,m.portToColOffset=0,m.portFromPos=f?0:h,m.portToPos=0,n=p,u--;u-c>b&&u>0;)p=t.createVertex(),p.node=null,p._k=3,p.layer=u-1,w&&x<w.length&&p.layer===w[x].layer&&(p.near=w[x++]),t.addVertex(p),m=t.linkVertexes(n,p,s.link),m.valid=!0,m.rev=s.rev,m.portFromColOffset=0,m.portToColOffset=0,m.portFromPos=0,m.portToPos=0,n=p,u--;m=t.linkVertexes(p,o,s.link),m.valid=!g,g&&(p.near=o),m.rev=s.rev,m.portFromColOffset=0,m.portToColOffset=a,m.portFromPos=0,m.portToPos=l}else s.valid=!0}}V3(t){let e=0;const i=t.link;if(null!==i){const s=i.fromPort,n=i.toPort;if(null!==s&&null!==n){const o=i.fromNode,r=i.toNode;if(null!==o&&null!==r){const a=this.tP(!0),h=this.tP(!1),l=this.setsPortSpots?a:i.computeSpot(!0,s),u=this.setsPortSpots?h:i.computeSpot(!1,n),c=i.isOrthogonal;if(l.isSide()&&l.includesSide(h)&&u.isSide()&&u.includesSide(a))return 0;const d=i.getLinkPoint(o,s,l,!0,c,r,n,y.l()),g=i.getLinkDirection(o,s,d,l,!0,c,r,n);y.i(d),(!l.isNone()&&g===this.xF(t,!0)||this.setsPortSpots&&null!==o&&1===o.ports.count&&t.rev)&&(e+=1);const f=i.getLinkPoint(r,n,u,!1,c,o,s,y.l()),m=i.getLinkDirection(r,n,f,u,!1,c,o,s);y.i(f),(!u.isNone()&&m===this.xF(t,!1)||this.setsPortSpots&&null!==r&&1===r.ports.count&&t.rev)&&(e+=2)}}}return e}xF(t,e){return 90===this.P?e&&!t.rev||!e&&t.rev?270:90:180===this.P?e&&!t.rev||!e&&t.rev?0:180:270===this.P?e&&!t.rev||!e&&t.rev?90:270:e&&!t.rev||!e&&t.rev?180:0}B3(t,e){const i=[];return i.push(e),this.bF(t,i)?i.reverse():[]}bF(t,e){const i=e[e.length-1].sourceEdges.iterator;for(;i.next();){const s=i.value;if(s.rev||!s.valid)continue;const n=s.fromVertex;if(e.push(n),n===t||this.bF(t,e))return!0;e.pop()}return!1}C3(){this.ie.length!==this._+1&&(this.ie=new Int16Array(this._+1));const t=this.ie;for(let e=0;e<=this._;e++)t[e]=0;const e=this.network.vertexes.iterator;for(;e.next();){e.value.index=-1}this.initializeIndices(),this.Sw=-1,this.qg=0,this.Vs=0;for(let e=0;e<=this._;e++)t[e]>t[this.Vs]&&(this.Sw=t[e]-1,this.Vs=e),t[e]<t[this.qg]&&(this.qg=e);this.gu=[];for(let e=0;e<t.length;e++)this.gu[e]=[];for(e.reset();e.next();){const t=e.value,i=t.layer;this.gu[i][t.index]=t}}initializeIndices(){switch(this.fu){default:case 22:this.z3();break;case 20:this.X3();break;case 21:this.G3()}}z3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(null===t&&(t=new Map),i.layer===i.near.layer)){const e=t.get(i.near)||[];e.push(i),t.set(i.near,e)}}for(e.reset();e.next();){const i=e.value;if(i.near)continue;const s=i.layer;if(i.index=this.ie[s],this.ie[s]++,!t)continue;const n=t.get(i);Array.isArray(n)&&n.forEach((t=>{t.index=this.ie[s],this.ie[s]++}))}}X3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(null===t&&(t=new Map),i.layer===i.near.layer)){const e=t.get(i.near)||[];e.push(i),t.set(i.near,e)}}for(let i=this._;i>=0;i--)for(e.reset();e.next();){const s=e.value;s.layer===i&&-1===s.index&&this.kF(s,t)}}kF(t,e){if(t.near)return;const i=t.layer;if(t.index=this.ie[i],this.ie[i]++,e){const s=e.get(t);Array.isArray(s)&&s.forEach((t=>{t.index=this.ie[i],this.ie[i]++}))}const s=t.or;let n=!0;for(;n;){n=!1;for(let t=0;t<s.length-1;t++){const e=s[t],i=s[t+1];e.portFromColOffset>i.portFromColOffset&&(n=!0,s[t]=i,s[t+1]=e)}}for(let t=0;t<s.length;t++){const i=s[t];if(i.valid){const t=i.toVertex;-1===t.index&&this.kF(t,e)}}}G3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(null===t&&(t=new Map),i.layer===i.near.layer)){const e=t.get(i.near)||[];e.push(i),t.set(i.near,e)}}for(let i=0;i<=this._;i++)for(e.reset();e.next();){const s=e.value;s.layer===i&&-1===s.index&&this.PF(s,t)}}PF(t,e){if(t.near)return;const i=t.layer;if(t.index=this.ie[i],this.ie[i]++,e){const s=e.get(t);Array.isArray(s)&&s.forEach((t=>{t.index=this.ie[i],this.ie[i]++}))}const s=t.So;let n,o,r=!0,a=0;for(;r;)for(r=!1,a=0;a<s.length-1;a++){const t=s[a],e=s[a+1];t.portToColOffset>e.portToColOffset&&(r=!0,s[a]=e,s[a+1]=t)}for(a=0;a<s.length;a++)o=s[a],o.valid&&(n=o.fromVertex,-1===n.index&&this.PF(n,e))}L3(){this.zt=-1;for(let t=0;t<=this._;t++){const e=this.ja(t);let i=0;const s=this.ie[t];for(let t=0;t<s;t++){const s=e[t];i+=this.nodeMinColumnSpace(s,!0),s.column=i,i+=1,i+=this.nodeMinColumnSpace(s,!1)}this.zt=Math.max(this.zt,i-1),this.Wa(t,e)}}reduceCrossings(){let t=this.countCrossings(),e=this.ei(),i=0,s=0,n=0;for(i=0;i<this.gc;i++){for(s=0;s<=this._;s++)this.eP(s,1),this.ys(s,1,!1,1);for(n=this.countCrossings(),n<t&&(t=n,e=this.ei()),s=this._;s>=0;s--)this.eP(s,-1),this.ys(s,-1,!1,-1);n=this.countCrossings(),n<t&&(t=n,e=this.ei())}for(this.ns(e),i=0;i<this.gc;i++){for(s=0;s<=this._;s++)this.eP(s,0),this.ys(s,0,!1,0);for(n=this.countCrossings(),n<t&&(t=n,e=this.ei()),s=this._;s>=0;s--)this.eP(s,0),this.ys(s,0,!1,0);n=this.countCrossings(),n<t&&(t=n,e=this.ei())}this.ns(e);let o=!1,r=0,a=0,h=0,l=0;switch(this.uu){case 30:break;case 32:for(h=t+1;(l=this.countCrossings())<h;)for(h=l,r=this._;r>=0;r--)for(a=0;a<=r;a++){for(o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,-1,!1,-1)||o;for(n=this.countCrossings(),n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,1,!1,1)||o;for(n=this.countCrossings(),n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,1,!1,1)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,-1,!1,-1)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,0,!1,0)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,0,!1,0)||o;n>=t?this.ns(e):(t=n,e=this.ei())}break;default:for(r=this._,a=0,h=t+1;(l=this.countCrossings())<h;){for(h=l,o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,-1,!1,-1)||o;for(n=this.countCrossings(),n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,1,!1,1)||o;for(n=this.countCrossings(),n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,1,!1,1)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,-1,!1,-1)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=a;s--)o=this.ys(s,0,!1,0)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=a;s<=r;s++)o=this.ys(s,0,!1,0)||o;n>=t?this.ns(e):(t=n,e=this.ei())}}this.ns(e)}eP(t,e){let i=0,s=!1;const n=this.ja(t),o=this.ie[t],r=this.uF(t,e),a=this.Nw(t,e);for(i=0;i<o;i++)-1===a[i]&&(a[i]=n[i].column),-1===r[i]&&(r[i]=n[i].column);let h,l=!0;for(;l;)for(l=!1,i=0;i<o-1;i++)if(r[i+1]<r[i]||r[i+1]===r[i]&&a[i+1]<a[i]){s=!0,l=!0;const t=r[i];r[i]=r[i+1],r[i+1]=t;const e=a[i];a[i]=a[i+1],a[i+1]=e,h=n[i],n[i]=n[i+1],n[i+1]=h}let u=0;for(i=0;i<o;i++)h=n[i],h.index=i,u+=this.nodeMinColumnSpace(h,!0),h.column=u,u+=1,u+=this.nodeMinColumnSpace(h,!1);return this.Wa(t,n),s}ys(t,e,i,s){const n=this.ja(t),o=this.ie[t],r=this.fF(t,e);let a,h,l=0;if(!i||s>0)for(a=new Float32Array(o),l=0;l<o;l++)a[l]=-1;else a=this.Nw(t,-1);if(!i||s<0)for(h=new Float32Array(o),l=0;l<o;l++)h[l]=-1;else h=this.Nw(t,1);let u=!1,c=!0;for(;c;)for(c=!1,l=0;l<o-1;l++){const e=r[n[l].index*o+n[l+1].index],d=r[n[l+1].index*o+n[l].index];let g=0,f=0;const m=n[l].column,p=n[l+1].column,y=this.nodeMinColumnSpace(n[l],!0),x=this.nodeMinColumnSpace(n[l],!1),w=m-y+this.nodeMinColumnSpace(n[l+1],!0),b=p-x+this.nodeMinColumnSpace(n[l+1],!1);let v,P,k=0,S=0,M=0,C=0,N=0,T=0,L=0,A=0,D=0;const F=n[l].sourceEdges.iterator;if(i&&s<=0)for(;F.next();){const e=F.value;v=e.fromVertex,e.valid&&v.layer!==t&&(M=this.linkStraightenWeight(e),C=e.portFromColOffset,N=e.portToColOffset,T=v.column,k+=(Math.abs(m+N-(T+C))+1)*M,S+=(Math.abs(b+N-(T+C))+1)*M)}for(F.reset();F.next();){const e=F.value;if(v=e.fromVertex,e.valid&&v.layer===t){for(A=0;A<n.length&&n[A]!==v;)A++;A<l&&(g+=2*(l-A),f+=2*(l+1-A)),A===l+1&&(g+=1),A>l+1&&(g+=4*(A-l),f+=4*(A-(l+1)))}}const O=n[l].destinationEdges.iterator;if(i&&s>=0)for(;O.next();){const e=O.value;P=e.toVertex,e.valid&&P.layer!==t&&(M=this.linkStraightenWeight(e),C=e.portFromColOffset,N=e.portToColOffset,L=P.column,k+=(Math.abs(m+C-(L+N))+1)*M,S+=(Math.abs(b+C-(L+N))+1)*M)}for(O.reset();O.next();){const e=O.value;if(P=e.toVertex,e.valid&&P.layer===t){for(D=0;D<n.length&&n[D]!==P;)D++;D===l+1&&(f+=1)}}const R=n[l+1].sourceEdges.iterator;if(i&&s<=0)for(;R.next();){const e=R.value;v=e.fromVertex,e.valid&&v.layer!==t&&(M=this.linkStraightenWeight(e),C=e.portFromColOffset,N=e.portToColOffset,T=v.column,k+=(Math.abs(p+N-(T+C))+1)*M,S+=(Math.abs(w+N-(T+C))+1)*M)}for(R.reset();R.next();){const e=R.value;if(v=e.fromVertex,e.valid&&v.layer===t){for(A=0;A<n.length&&n[A]!==v;)A++;A<l&&(g+=2*(l+1-A),f+=2*(l-A)),A===l&&(f+=1),A>l+1&&(g+=4*(A-(l+1)),f+=4*(A-l))}}const B=n[l+1].destinationEdges.iterator;if(i&&s>=0)for(;B.next();){const e=B.value;P=e.toVertex,e.valid&&P.layer!==t&&(M=this.linkStraightenWeight(e),C=e.portFromColOffset,N=e.portToColOffset,L=P.column,k+=(Math.abs(p+C-(L+N))+1)*M,S+=(Math.abs(w+C-(L+N))+1)*M)}for(B.reset();B.next();){const e=B.value;if(P=e.toVertex,e.valid&&P.layer===t){for(D=0;D<n.length&&n[D]!==P;)D++;D===l&&(g+=1)}}let E=0,I=0;const V=a[n[l].index],z=h[n[l].index],X=a[n[l+1].index],U=h[n[l+1].index];if(-1!==V&&(E+=Math.abs(V-m),I+=Math.abs(V-b)),-1!==z&&(E+=Math.abs(z-m),I+=Math.abs(z-b)),-1!==X&&(E+=Math.abs(X-p),I+=Math.abs(X-w)),-1!==U&&(E+=Math.abs(U-p),I+=Math.abs(U-w)),f<g-.5||f===g&&d<e-.5||f===g&&d===e&&S<k-.5||f===g&&d===e&&S===k&&I<E-.5){u=!0,c=!0,n[l].column=b,n[l+1].column=w;const t=n[l];n[l]=n[l+1],n[l+1]=t}}for(l=0;l<o;l++)n[l].index=l;return this.Wa(t,n),u}straightenAndPack(){if(0!==this.Xn)return void this.Y3();let t=0,e=!1,i=!!(1&this.hr);const s=!!(8&this.hr);if(this.network.edges.count>1e3&&s&&(i=!1),i){const e=[];let i=0;for(i=0;i<=this._;i++)e[i]=0;let s=0;const n=this.network.vertexes.iterator;for(;n.next();){const i=n.value;t=i.layer,s=i.column;const o=this.nodeMinColumnSpace(i,!1);e[t]=Math.max(e[t],s+o)}const o=8;for(n.reset();n.next();){const i=n.value;t=i.layer,s=i.column,i.column=((this.zt-e[t])*o>>1)+s*o}this.zt*=o}if(2&this.hr){e=!0;let i=0;for(;e&&i<this.du;){for(e=!1,t=this.Vs+1;t<=this._;t++)e=this.Jg(t,1)||e;for(t=this.Vs-1;t>=0;t--)e=this.Jg(t,-1)||e;e=this.Jg(this.Vs,0)||e,i++}}if(4&this.hr){for(t=this.Vs+1;t<=this._;t++)this.yL(t,1);for(t=this.Vs-1;t>=0;t--)this.yL(t,-1);this.yL(this.Vs,0)}if(i&&(this.SF(-1),this.SF(1)),2&this.hr){e=!0;let i=0;for(;e&&i<this.du;){for(e=!1,e=this.Jg(this.Vs,0)||e,t=this.Vs+1;t<=this._;t++)e=this.Jg(t,0)||e;for(t=this.Vs-1;t>=0;t--)e=this.Jg(t,0)||e;i++}}}Jg(t,e){let i=!1;for(;this.K3(t,e);)i=!0;return i}K3(t,e){let i=0;const s=this.ja(t),n=this.ie[t],o=this.Nw(t,-1);if(e>0)for(i=0;i<n;i++)o[i]=-1;const r=this.Nw(t,1);if(e<0)for(i=0;i<n;i++)r[i]=-1;let a=!1,h=!0;for(;h;)for(h=!1,i=0;i<n;i++){const l=s[i].column,u=this.nodeMinColumnSpace(s[i],!0),c=this.nodeMinColumnSpace(s[i],!1);let d=0;d=i-1<0||l-s[i-1].column-1>u+this.nodeMinColumnSpace(s[i-1],!1)?l-1:l;let g=0;g=i+1>=n||s[i+1].column-l-1>c+this.nodeMinColumnSpace(s[i+1],!0)?l+1:l;let f=0,m=0,p=0,y=0,x=0,w=0;if(e<=0){const e=s[i].sourceEdges.iterator;for(;e.next();){const i=e.value,s=i.fromVertex;if(i.valid&&s.layer!==t){y=this.linkStraightenWeight(i),x=i.portFromColOffset,w=i.portToColOffset;const t=s.column;f+=(Math.abs(l+w-(t+x))+1)*y,m+=(Math.abs(d+w-(t+x))+1)*y,p+=(Math.abs(g+w-(t+x))+1)*y}}}if(e>=0){const e=s[i].destinationEdges.iterator;for(;e.next();){const i=e.value,s=i.toVertex;if(i.valid&&s.layer!==t){y=this.linkStraightenWeight(i),x=i.portFromColOffset,w=i.portToColOffset;const t=s.column;f+=(Math.abs(l+x-(t+w))+1)*y,m+=(Math.abs(d+x-(t+w))+1)*y,p+=(Math.abs(g+x-(t+w))+1)*y}}}let b=0,v=0,P=0;const k=o[s[i].index],S=r[s[i].index];-1!==k&&(b+=Math.abs(k-l),v+=Math.abs(k-d),P+=Math.abs(k-g)),-1!==S&&(b+=Math.abs(S-l),v+=Math.abs(S-d),P+=Math.abs(S-g)),m<f||m===f&&v<b?(a=!0,h=!0,s[i].column=d):(p<f||p===f&&P<b)&&(a=!0,h=!0,s[i].column=g)}return this.Wa(t,s),this.Mw(),a}yL(t,e){let i=0;const s=this.ja(t),n=this.ie[t],o=this.uF(t,e),r=new Int16Array(o);let a=!1,h=!0;for(;h;)for(h=!1,i=0;i<n;i++){const t=s[i].column,e=this.nodeMinColumnSpace(s[i],!0),o=this.nodeMinColumnSpace(s[i],!1);let l=0,u=0,c=0,d=0,g=0;-1===r[i]?0===i&&i===n-1?l=t:0===i?(u=s[i+1].column,l=u-t===o+this.nodeMinColumnSpace(s[i+1],!0)?t-1:t):i===n-1?(c=s[i-1].column,l=t-c===e+this.nodeMinColumnSpace(s[i-1],!1)?t+1:t):(c=s[i-1].column,g=c+this.nodeMinColumnSpace(s[i-1],!1)+e+1,u=s[i+1].column,d=u-this.nodeMinColumnSpace(s[i+1],!0)-o-1,l=(g+d)/2|0):0===i&&i===n-1?l=r[i]:0===i?(u=s[i+1].column,d=u-this.nodeMinColumnSpace(s[i+1],!0)-o-1,l=Math.min(r[i],d)):i===n-1?(c=s[i-1].column,g=c+this.nodeMinColumnSpace(s[i-1],!1)+e+1,l=Math.max(r[i],g)):(c=s[i-1].column,g=c+this.nodeMinColumnSpace(s[i-1],!1)+e+1,u=s[i+1].column,d=u-this.nodeMinColumnSpace(s[i+1],!0)-o-1,g<r[i]&&r[i]<d?l=r[i]:g>=r[i]?l=g:d<=r[i]&&(l=d)),l!==t&&(a=!0,h=!0,s[i].column=l)}return this.Wa(t,s),this.Mw(),a}H3(){for(let t=0;t<=this.zt;t++)for(;this.q3(t,1););this.Mw()}q3(t,e){let i=!0;const s=this.network.vertexes.iterator;for(;s.next();){const e=s.value,n=this.nodeMinColumnSpace(e,!0),o=this.nodeMinColumnSpace(e,!1);if(e.column-n<=t&&e.column+o>=t){i=!1;break}}let n=!1;if(i){if(e>0)for(s.reset();s.next();){const e=s.value;e.column>t&&(e.column-=1,n=!0)}if(e<0)for(s.reset();s.next();){const e=s.value;e.column<t&&(e.column+=1,n=!0)}}return n}j3(){this.H3();for(let t=0;t<this.zt;t++)for(;this.W3(t,1););this.Mw()}W3(t,e){let i=t;e>0&&(i=t+1),e<0&&(i=t-1);let s=0;const n=[],o=[];for(s=0;s<=this._;s++)n[s]=!1,o[s]=!1;const r=this.network.vertexes.iterator;for(;r.next();){const e=r.value,s=e.column-this.nodeMinColumnSpace(e,!0),a=e.column+this.nodeMinColumnSpace(e,!1);s<=t&&a>=t&&(n[e.layer]=!0),s<=i&&a>=i&&(o[e.layer]=!0)}let a=!0,h=!1;for(s=0;s<=this._;s++)a=a&&!(n[s]&&o[s]);if(a){if(e>0)for(r.reset();r.next();){const e=r.value;e.column>t&&(e.column-=1,h=!0)}if(e<0)for(r.reset();r.next();){const e=r.value;e.column<t&&(e.column+=1,h=!0)}}return h}SF(t){this.j3();let e,i=0,s=0,n=0,o=0;if(t>0)for(i=0;i<=this.zt;i++)for(e=this.ei(),s=this.Qk(!0),n=s+1;s<n;)n=s,this.MF(i,1),o=this.Qk(!0),o>s?this.ns(e):o<s&&(s=o,e=this.ei());if(t<0)for(i=this.zt;i>=0;i--)for(e=this.ei(),s=this.Qk(!0),n=s+1;s<n;)n=s,this.MF(i,-1),o=this.Qk(!0),o>s?this.ns(e):o<s&&(s=o,e=this.ei());this.Mw()}MF(t,e){this.cn=0;const i=this.network.vertexes.iterator;for(;i.next();){i.value.component=-1}if(e>0)for(i.reset();i.next();){const e=i.value;e.column-this.nodeMinColumnSpace(e,!0)<=t&&(e.component=this.cn)}if(e<0)for(i.reset();i.next();){const e=i.value;e.column+this.nodeMinColumnSpace(e,!1)>=t&&(e.component=this.cn)}for(this.cn++,i.reset();i.next();){const t=i.value;-1===t.component&&(this.mL(t,this.cn,-1,!0,!0),this.cn++)}let s=0;const n=[];for(s=0;s<this.cn*this.cn;s++)n[s]=!1;const o=[];for(s=0;s<(this._+1)*(this.zt+1);s++)o[s]=-1;for(i.reset();i.next();){const t=i.value,e=t.layer,s=Math.max(0,t.column-this.nodeMinColumnSpace(t,!0)),n=Math.min(this.zt,t.column+this.nodeMinColumnSpace(t,!1));for(let i=s;i<=n;i++)o[e*(this.zt+1)+i]=t.component}for(let t=0;t<=this._;t++){if(e>0)for(let e=0;e<this.zt;e++)-1!==o[t*(this.zt+1)+e]&&-1!==o[t*(this.zt+1)+e+1]&&o[t*(this.zt+1)+e]!==o[t*(this.zt+1)+e+1]&&(n[o[t*(this.zt+1)+e]*this.cn+o[t*(this.zt+1)+e+1]]=!0);if(e<0)for(let e=this.zt;e>0;e--)-1!==o[t*(this.zt+1)+e]&&-1!==o[t*(this.zt+1)+e-1]&&o[t*(this.zt+1)+e]!==o[t*(this.zt+1)+e-1]&&(n[o[t*(this.zt+1)+e]*this.cn+o[t*(this.zt+1)+e-1]]=!0)}const r=[];for(s=0;s<this.cn;s++)r[s]=!0;const a=[];a.push(0);let h=0;for(;0!==a.length;)if(h=a[a.length-1],a.pop(),r[h])for(r[h]=!1,s=0;s<this.cn;s++)n[h*this.cn+s]&&a.splice(0,0,s);let l=!1;if(e>0)for(i.reset();i.next();){const t=i.value;r[t.component]&&(t.column-=1,l=!0)}if(e<0)for(i.reset();i.next();){const t=i.value;r[t.component]&&(t.column+=1,l=!0)}return l}Y3(){const t=e.nt(),i=this.gu.length;for(let e=0;e<=i;e++)t[e]=[];const s=this.network.vertexes.iterator;for(;s.next();){const e=s.value;t[i-e.layer][e.index]=e}const n=new u;this.J3(t,n);let o=null,r=null,a=null,h=null;const l=!!(1&this.Xn),c=!!(2&this.Xn),d=!!(4&this.Xn),g=!!(8&this.Xn);l&&(this.al(t,n,!0),o=this.iP(t,!0,!1)),t.reverse(),d&&(this.al(t,n,!1),a=this.iP(t,!1,!1));for(const e of t)e.reverse();g&&(this.al(t,n,!1),h=this.iP(t,!1,!0)),t.reverse(),c&&(this.al(t,n,!0),r=this.iP(t,!0,!0)),e.Z(t),this.$3(o,r,a,h),this.network.vertexes.each((t=>{const i=t,s=e.nt();l&&s.push(o.get(i)),c&&s.push(r.get(i)),d&&s.push(a.get(i)),g&&s.push(h.get(i)),s.sort(((t,e)=>t-e));const n=s.length,u=Math.floor((n-1)/2),f=Math.ceil((n-1)/2),m=(s[u]+s[f])/2;e.Z(s),i.mi=m}))}J3(t,e){const i=t.length;for(let s=1;s<i-1;s++){let i=0,n=0;const o=t[s],r=t[s+1];for(let t=0;n<r.length;t++){const s=r[t],a=this.Z3(s);if(t===r.length-1||a){let h=o.length-1;for(a&&(h=s.getProperSourceVertexes()[0].index);n<=t;){const t=r[n].getProperSourceEdges();for(const s of t){const t=s.fromVertex.index;(t<i||t>h)&&e.add(s)}n++}i=h}}}}Z3(t){if(null===t.node){const e=t.getProperSourceVertexes();if(e.length>0)return null===e[0].node}return!1}al(t,e,i){this.Q3(t);for(const s of t){let t=-1;for(const n of s){const s=i?n.getProperSourceVertexes():n.getProperDestinationVertexes(),o=s.length;if(o>0){s.sort(((t,e)=>t.Ja-e.Ja));const r=(o-1)/2;for(let o=Math.floor(r),a=Math.ceil(r);o<=a;o++)if(n.Gn===n){const r=s[o];let a;a=i?r.getDestinationEdge(n):n.getDestinationEdge(r),!e.has(a)&&t<r.Ja&&(r.Gn=n,n.mc=r.mc,n.Gn=r.mc,t=r.Ja)}}}}}Q3(t){for(let e=0;e<t.length;e++){const i=t[e];for(let t=0;t<i.length;t++){const s=i[t];s.mc=s,s.Gn=s,s.NF=e,s.Ja=t}}}iP(t,e,i){const s=90===this.P||270===this.P;for(const e of t)for(const t of e)t.os=t,t.pu=1/0,t.mi=NaN,t.Yn=0;this._3(t,e,i);for(const e of t)for(const i of e)i.mc===i&&this.CF(i,t);for(let e=0;e<t.length;e++){if(t[e].length<=0)continue;const i=t[e][0];if(i.os===i){i.os.pu===1/0&&(i.os.pu=0);let n,o=e,r=0;do{for(n=t[o][r];n.Gn!==n.mc;)if(n=n.Gn,o++,n.Ja>0){const e=this.LF(n,t),i=s?e.width:e.height,o=n.os.pu+n.mi+n.Yn-(e.mi+e.Yn+i+this.columnSpacing);e.os.pu=Math.min(e.os.pu,o)}r=n.Ja+1}while(o<t.length&&r<t[o].length&&n.os===t[o][r].os)}}const n=new p;for(const e of t)for(const t of e){t.mi=t.mi+t.os.pu+t.Yn;const e=s?t.width:t.height;n.set(t,i?-t.mi-e:t.mi)}return n}_3(t,e,i){const s=90===this.P||270===this.P;for(const n of t)for(const t of n)if(t.mc===t){let n=0,o=t;for(;o.Gn!==t;){const t=o.Gn,r=s?o.width:o.height,a=s?t.width:t.height;let h,l,u,c;e?(u=o.getDestinationEdge(t),h=u.portFromPos,l=u.portToPos,null!==u.link&&(o.node&&o.node!==u.link.fromNode&&(h=s?o.focusX:o.focusY),t.node&&t.node!==u.link.toNode&&(l=s?t.focusX:t.focusY)),c=i?o.Yn+(r-h)-(a-l):o.Yn+h-l):(u=t.getDestinationEdge(o),h=u.portToPos,l=u.portFromPos,null!==u.link&&(o.node&&o.node!==u.link.toNode&&(h=s?o.focusX:o.focusY),t.node&&t.node!==u.link.fromNode&&(l=s?t.focusX:t.focusY)),c=i?o.Yn+(r-h)-(a-l):o.Yn+h-l),t.Yn=c,n=Math.min(n,c),o=o.Gn}o=t;do{o.Yn=o.Yn-n,o=o.Gn}while(o!==t)}}CF(t,e){if(!isNaN(t.mi))return;t.mi=0;let i=t;do{if(i.Ja>0){const s=this.LF(i,e),n=s.mc;this.CF(n,e),t.os===t&&(t.os=n.os);const o=90===this.P||270===this.P?s.width:s.height;if(t.os===n.os){const e=n.mi+s.Yn+o-i.Yn+this.columnSpacing;t.mi=Math.max(t.mi,e)}}i=i.Gn}while(i!==t);for(;i.Gn!==t;)i=i.Gn,i.mi=t.mi,i.os=t.os}LF(t,i){const s=t.NF,n=t.Ja;return n<1&&e.o("Could not determine previous vertex in layer"),i[s][n-1]}$3(...t){let i=-1;const s=e.nt(),n=e.nt();let o=1/0;for(let e=0;e<4;e++){if(!t[e])continue;const r=this.tU(t[e],s,n,e);r<o&&(i=e,o=r)}for(let e=0;e<4;e++){const o=t[e];if(!o)continue;const r=0===e||2===e?s[i]-s[e]:n[i]-n[e];0!==r&&o.each((t=>{o.set(t.key,t.value+r)}))}e.Z(s),e.Z(n)}tU(t,e,i,s){if(!t||0===t.count)return e[s]=0,i[s]=0,1/0;let n=1/0,o=-1/0;return t.each((t=>{const e=t.key,i=t.value,s=90===this.P||270===this.P?e.width:e.height;i<n&&(n=i),i+s>o&&(o=i+s)})),e[s]=n,i[s]=o,o-n}commitLayout(){this.Pw(),this.commitNodes(),this.wL(),this.isRouting&&this.commitLinks()}Pw(){if(!this.setsPortSpots)return;const t=this.tP(!0),e=this.tP(!1),i=this.network.edges.iterator;for(;i.next();){const s=i.value.link;null!==s&&(s.fromSpot=t,s.toSpot=e)}}tP(t){return 270===this.P?t?v.MiddleTop:v.MiddleBottom:90===this.P?t?v.MiddleBottom:v.MiddleTop:180===this.P?t?v.MiddleLeft:v.MiddleRight:t?v.MiddleRight:v.MiddleLeft}commitNodes(){this.Bs.length!==this._+1&&(this.Bs=new Float32Array(this._+1)),this.ms.length!==this._+1&&(this.ms=new Float32Array(this._+1)),this.ps.length!==this._+1&&(this.ps=new Float32Array(this._+1)),this.Rt.length!==this._+1&&(this.Rt=new Float32Array(this._+1));for(let t=0;t<=this._;t++)this.Bs[t]=0,this.ms[t]=0,this.ps[t]=0,this.Rt[t]=0;const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value,i=e.layer;this.Bs[i]=Math.max(this.Bs[i],this.nodeMinLayerSpace(e,!0)),this.ms[i]=Math.max(this.ms[i],this.nodeMinLayerSpace(e,!1))}let e=0;const i=this.Us;for(let t=0;t<=this._;t++){let s=i;this.Bs[t]+this.ms[t]<=0&&(s=0),t>0&&(e+=s/2),90===this.P||0===this.P?(e+=this.ms[t],this.ps[t]=e,e+=this.Bs[t]):(e+=this.Bs[t],this.ps[t]=e,e+=this.ms[t]),t<this._&&(e+=s/2),this.Rt[t]=e}const s=e,n=this.arrangementOrigin;for(let t=0;t<=this._;t++)270===this.P?this.ps[t]=n.y+this.ps[t]:90===this.P?(this.ps[t]=n.y+s-this.ps[t],this.Rt[t]=s-this.Rt[t]):180===this.P?this.ps[t]=n.x+this.ps[t]:(this.ps[t]=n.x+s-this.ps[t],this.Rt[t]=s-this.Rt[t]);const o=0!==this.Xn;t.reset();const r=270===this.P||90===this.P;let a=1/0,h=1/0,l=1/0,u=-1/0;for(;t.next();){const e=t.value,i=e.layer,s=0|e.column;let c=0,d=0;r?(c=n.x+this.ti*s,d=this.ps[i]):(c=this.ps[i],d=n.y+this.ti*s),e.centerX=c,e.centerY=d,o&&isFinite(e.mi)&&(r?e.node?e.x=n.x+e.mi:e.centerX=n.x+e.mi:e.node?e.y=n.y+e.mi:e.centerY=n.y+e.mi),a=Math.min(e.x,a),h=Math.min(e.y,h),r?(l=a,u=Math.max(u,e.bounds.right)):(l=h,u=Math.max(u,e.bounds.bottom))}this.gL=u-l;const c=n.x-a,d=n.y-h;for(this.cr=new y(o&&r?0:c,o&&!r?0:d),t.reset();t.next();){const e=t.value;e.x+=c,e.y+=d,e.commit()}}wL(){let t=0;const e=this.Us;for(let e=0;e<=this._;e++)t+=this.Bs[e],t+=this.ms[e];t+=this._*e;const i=[],s=0!==this.Xn?this.gL:this.ti*this.zt;for(let e=this.maxLayer;e>=0;e--)270===this.P?0===e?i.push(new w(0,0,s,Math.abs(this.Rt[0]))):i.push(new w(0,this.Rt[e-1],s,Math.abs(this.Rt[e-1]-this.Rt[e]))):90===this.P?0===e?i.push(new w(0,this.Rt[0],s,Math.abs(this.Rt[0]-t))):i.push(new w(0,this.Rt[e],s,Math.abs(this.Rt[e-1]-this.Rt[e]))):180===this.P?0===e?i.push(new w(0,0,Math.abs(this.Rt[0]),s)):i.push(new w(this.Rt[e-1],0,Math.abs(this.Rt[e-1]-this.Rt[e]),s)):0===e?i.push(new w(this.Rt[0],0,Math.abs(this.Rt[0]-t),s)):i.push(new w(this.Rt[e],0,Math.abs(this.Rt[e-1]-this.Rt[e]),s));this.commitLayers(i,this.cr)}commitLayers(t,e){}commitLinks(){const t=this.network.edges.iterator;let e=null;for(;t.next();)e=t.value.link,null!==e&&e.pointsCount>0&&(e.startRoute(),e.clearPoints(),e.commitRoute());for(t.reset();t.next();)e=t.value.link,null!==e&&e.updateRoute();for(t.reset();t.next();){const i=t.value;if(e=i.link,null===e||0===e.pointsCount)continue;e.startRoute();const s=e;let n=s.fromNode,o=s.toNode,r=s.fromPort,a=s.toPort;if(null!==n){const t=n.findVisibleNode();null!==t&&t!==n&&(n=t,r=t.port)}if(null!==o){const t=o.findVisibleNode();null!==t&&t!==o&&(o=t,a=t.port)}const h=e.computeSpot(!0,r),l=e.computeSpot(!1,a);let u=i.fromVertex,c=i.toVertex;if(i.valid){if(9===e.curve&&4===e.pointsCount)if(u.column===c.column&&0===this.alignOption){const t=e.getLinkPoint(n,r,h,!0,!1,o,a),i=e.getLinkPoint(o,a,l,!1,!1,n,r);t.isReal()||t.set(n.actualBounds.center),i.isReal()||i.set(o.actualBounds.center),e.clearPoints(),e.addPointAt(t.x,t.y),e.addPointAt((2*t.x+i.x)/3,(2*t.y+i.y)/3),e.addPointAt((t.x+2*i.x)/3,(t.y+2*i.y)/3),e.addPointAt(i.x,i.y)}else{let t=!1,i=!1;if(null!==r&&e.bl(h)&&(t=!0),null!==a&&e.bl(l)&&(i=!0),t||i){let s=null;t&&(s=e.getLinkPointFromPoint(n,r,r.getDocumentPoint(v.Center),e.getPoint(3),!0),s.isReal()||s.set(n.actualBounds.center),e.setPointAt(0,s.x,s.y));let h=null;if(i&&(h=e.getLinkPointFromPoint(o,a,a.getDocumentPoint(v.Center),e.getPoint(0),!1),h.isReal()||h.set(o.actualBounds.center),e.setPointAt(3,h.x,h.y)),s){const t=e.getPoint(2);e.setPointAt(1,(2*s.x+t.x)/3,(2*s.y+t.y)/3)}if(h){const t=e.getPoint(1);e.setPointAt(2,(2*h.x+t.x)/3,(2*h.y+t.y)/3)}}}e.commitRoute();continue}if(u.layer===c.layer){e.commitRoute();continue}let d=!1,g=!1;const f=this.Us;let m=0,p=e.firstPickIndex+1;if(e.isOrthogonal)g=!0,m=e.pointsCount,m>4&&e.points.removeRange(2,m-3);else if(9===e.curve)d=!0,m=e.pointsCount,m>4&&e.points.removeRange(2,m-3),4===m&&(p=2);else{m=e.pointsCount;const t=h===v.None,i=l===v.None;m>2&&t&&i?e.points.removeRange(1,m-2):m>3&&t&&!i?e.points.removeRange(1,m-3):m>3&&!t&&i?e.points.removeRange(2,m-2):m>4&&!t&&!i&&e.points.removeRange(2,m-3)}let y,x,w=0,b=0,P=0,k=0,S=0,M=0,C=0;if(i.rev){let t=0;for(;null!==c&&u!==c;){y=null,x=null;const s=c.sourceEdges.iterator;for(;s.next();){const t=s.value;if(t.link===i.link&&(y=t.fromVertex,x=t.toVertex,null===y.node))break}if(null===y)break;if(y!==u)if(w=e.getPoint(p-1).x,b=e.getPoint(p-1).y,P=y.centerX,k=y.centerY,g)180===this.P||0===this.P?p===e.firstPickIndex+1?(e.insertPointAt(p++,w,b),e.insertPointAt(p++,w,k)):(null!==x?x.centerY:b)!==k&&(S=this.Rt[y.layer-1]+this.cr.x,e.insertPointAt(p++,S,b),e.insertPointAt(p++,S,k)):p===e.firstPickIndex+1?(e.insertPointAt(p++,w,b),e.insertPointAt(p++,P,b)):(null!==x?x.centerX:w)!==P&&(S=this.Rt[y.layer-1]+this.cr.y,e.insertPointAt(p++,w,S),e.insertPointAt(p++,P,S));else if(p===e.firstPickIndex+1)if(M=Math.max(10,this.Bs[c.layer]),C=Math.max(10,this.ms[c.layer]),d)180===this.P?P<=c.bounds.x?(t=c.bounds.x,e.insertPointAt(p++,t-M,k),e.insertPointAt(p++,t,k),e.insertPointAt(p++,t+C,k)):(e.insertPointAt(p++,P-M,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P+C,k)):90===this.P?k>=c.bounds.bottom?(t=c.bounds.y+c.bounds.height,e.insertPointAt(p++,P,t+C),e.insertPointAt(p++,P,t),e.insertPointAt(p++,P,t-M)):(e.insertPointAt(p++,P,k+C),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k-M)):270===this.P?k<=c.bounds.y?(t=c.bounds.y,e.insertPointAt(p++,P,t-M),e.insertPointAt(p++,P,t),e.insertPointAt(p++,P,t+C)):(e.insertPointAt(p++,P,k-M),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k+C)):0===this.P&&(P>=c.bounds.right?(t=c.bounds.x+c.bounds.width,e.insertPointAt(p++,t+C,k),e.insertPointAt(p++,t,k),e.insertPointAt(p++,t-M,k)):(e.insertPointAt(p++,P+C,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P-M,k)));else{e.insertPointAt(p++,w,b);let t=0;180===this.P||0===this.P?((180===this.P?P>=c.bounds.right:P<=c.bounds.x)&&(t=(0===this.P?-M:C)/2),e.insertPointAt(p++,w+t,k)):((270===this.P?k>=c.bounds.bottom:k<=c.bounds.y)&&(t=(90===this.P?-M:C)/2),e.insertPointAt(p++,P,b+t)),e.insertPointAt(p++,P,k)}else M=Math.max(10,this.Bs[y.layer]),C=Math.max(10,this.ms[y.layer]),d?180===this.P?(e.insertPointAt(p++,P-M-Math.max(10,f),k),e.insertPointAt(p++,Math.min(P-M+f/2,P),k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,Math.max(P+C-f/2,P),k),e.insertPointAt(p++,P+C+f,k)):90===this.P?(e.insertPointAt(p++,P,k+C+Math.max(10,f)),e.insertPointAt(p++,P,Math.max(k+C-f/2,k)),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,Math.min(k-M+f/2,k)),e.insertPointAt(p++,P,k-M-f)):270===this.P?(e.insertPointAt(p++,P,k-M-Math.max(10,f)),e.insertPointAt(p++,P,Math.min(k-M+f/2,k)),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,Math.max(k+C-f/2,k)),e.insertPointAt(p++,P,k+C+f)):(e.insertPointAt(p++,P+C+Math.max(10,f),k),e.insertPointAt(p++,Math.max(P+C-f/2,P),k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,Math.min(P-M+f/2,P),k),e.insertPointAt(p++,P-M-f,k)):(180===this.P||90===this.P||this.P,e.insertPointAt(p++,P,k));c=y}if(null===a||h!==v.None||g)if(w=e.getPoint(p-1).x,b=e.getPoint(p-1).y,P=e.getPoint(p).x,k=e.getPoint(p).y,g){const i=this.ms[u.layer];let s=0;180===this.P||0===this.P?(s=b,s>=u.bounds.y&&s<=u.bounds.bottom&&(180===this.P?P>=u.bounds.x:P<=u.bounds.right)&&(t=u.centerX+(180===this.P?-i:i),s=s<u.bounds.y+u.bounds.height/2?u.bounds.y-this.ti/2:u.bounds.bottom+this.ti/2,e.insertPointAt(p++,t,b),e.insertPointAt(p++,t,s)),e.insertPointAt(p++,P,s),e.insertPointAt(p++,P,k)):(s=w,s>=u.bounds.x&&s<=u.bounds.right&&(270===this.P?k>=u.bounds.y:k<=u.bounds.bottom)&&(t=u.centerY+(270===this.P?-i:i),s=s<u.bounds.x+u.bounds.width/2?u.bounds.x-this.ti/2:u.bounds.right+this.ti/2,e.insertPointAt(p++,w,t),e.insertPointAt(p++,s,t)),e.insertPointAt(p++,s,k),e.insertPointAt(p++,P,k))}else if(d)M=Math.max(10,this.Bs[u.layer]),C=Math.max(10,this.ms[u.layer]),180===this.P&&P>=u.bounds.x?(t=u.bounds.x+u.bounds.width,e.setPointAt(p-2,t,b),e.setPointAt(p-1,t+C,b)):90===this.P&&k<=u.bounds.bottom?(t=u.bounds.y,e.setPointAt(p-2,w,t),e.setPointAt(p-1,w,t-M)):270===this.P&&k>=u.bounds.y?(t=u.bounds.y+u.bounds.height,e.setPointAt(p-2,w,t),e.setPointAt(p-1,w,t+C)):0===this.P&&P<=u.bounds.right&&(t=u.bounds.x,e.setPointAt(p-2,t,b),e.setPointAt(p-1,t-M,b));else{M=Math.max(10,this.Bs[u.layer]),C=Math.max(10,this.ms[u.layer]);let t=0;180===this.P||0===this.P?((180===this.P?P<=u.bounds.x:P>=u.bounds.right)&&(t=(0===this.P?C:-M)/2),e.insertPointAt(p++,P+t,b)):((270===this.P?k<=u.bounds.y:k>=u.bounds.bottom)&&(t=(90===this.P?C:-M)/2),e.insertPointAt(p++,w,k+t)),e.insertPointAt(p++,P,k)}}else{for(;null!==u&&u!==c;){y=null,x=null;const t=u.destinationEdges.iterator;for(;t.next();){const e=t.value;if(e.link===i.link&&(y=e.toVertex,x=e.fromVertex,null!==x.node&&(x=null),null===y.node))break}if(null===y)break;y!==c&&(w=e.getPoint(p-1).x,b=e.getPoint(p-1).y,P=y.centerX,k=y.centerY,g?180===this.P||0===this.P?(null!==x?x.centerY:b)!==k&&(S=this.Rt[y.layer]+this.cr.x,p===e.firstPickIndex+1&&(S=0===this.P?Math.max(S,w):Math.min(S,w)),e.insertPointAt(p++,S,b),e.insertPointAt(p++,S,k)):(null!==x?x.centerX:w)!==P&&(S=this.Rt[y.layer]+this.cr.y,p===e.firstPickIndex+1&&(S=90===this.P?Math.max(S,b):Math.min(S,b)),e.insertPointAt(p++,w,S),e.insertPointAt(p++,P,S)):(M=Math.max(10,this.Bs[y.layer]),C=Math.max(10,this.ms[y.layer]),d?180===this.P?(e.insertPointAt(p++,P+C+Math.max(10,f),k),e.insertPointAt(p++,Math.max(P+C-f/2,P),k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,Math.min(P-M+f/2,P),k),e.insertPointAt(p++,P-M-f,k)):90===this.P?(e.insertPointAt(p++,P,k-M-Math.max(10,f)),e.insertPointAt(p++,P,Math.min(k-M+f/2,k)),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,Math.max(k+C-f/2,k)),e.insertPointAt(p++,P,k+C+f)):270===this.P?(e.insertPointAt(p++,P,k+C+Math.max(10,f)),e.insertPointAt(p++,P,Math.max(k+C-f/2,k)),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,Math.min(k-M+f/2,k)),e.insertPointAt(p++,P,k-M-f)):(e.insertPointAt(p++,P-M-Math.max(10,f),k),e.insertPointAt(p++,Math.min(P-M+f/2,P),k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,P,k),e.insertPointAt(p++,Math.max(P+C-f/2,P),k),e.insertPointAt(p++,P+C+f,k)):180===this.P?(e.insertPointAt(p++,P+C,k),e.insertPointAt(p++,P-M,k)):90===this.P?(e.insertPointAt(p++,P,k-M),e.insertPointAt(p++,P,k+C)):270===this.P?(e.insertPointAt(p++,P,k+C),e.insertPointAt(p++,P,k-M)):(e.insertPointAt(p++,P-M,k),e.insertPointAt(p++,P+C,k)))),u=y}g&&(w=e.getPoint(p-1).x,b=e.getPoint(p-1).y,P=e.getPoint(p).x,k=e.getPoint(p).y,180===this.P||0===this.P?b!==k&&(S=0===this.P?Math.min(Math.max((P+w)/2,this.Rt[c.layer]+this.cr.x),P):Math.max(Math.min((P+w)/2,this.Rt[c.layer]+this.cr.x),P),e.insertPointAt(p++,S,b),e.insertPointAt(p++,S,k)):w!==P&&(S=90===this.P?Math.min(Math.max((k+b)/2,this.Rt[c.layer]+this.cr.y),k):Math.max(Math.min((k+b)/2,this.Rt[c.layer]+this.cr.y),k),e.insertPointAt(p++,w,S),e.insertPointAt(p++,P,S)))}if(null!==s&&d&&e.pointsCount>=4){if(null!==n&&null!==r&&s.bl(h)){const t=r.getDocumentPoint(v.Center);t.isReal()||t.setTo(n.actualBounds.centerX,n.actualBounds.centerY);const i=e.getPoint(3),s=e.getPoint(2);90===this.direction||270===this.direction?(e.setPointAt(1,i.x,(s.y+i.y)/2),e.setPointAt(2,i.x,(s.y+i.y)/2)):(e.setPointAt(1,(s.x+i.x)/2,i.y),e.setPointAt(2,(s.x+i.x)/2,i.y));const o=e.getLinkPointFromPoint(n,r,t,e.getPoint(1),!0);e.setPointAt(0,o.x,o.y)}if(null!==o&&null!==a&&s.bl(l)){const t=a.getDocumentPoint(v.Center);t.isReal()||t.setTo(o.actualBounds.centerX,o.actualBounds.centerY);const i=e.getPoint(e.pointsCount-4),s=e.getLinkPointFromPoint(o,a,t,i,!1),n=e.getPoint(e.pointsCount-3);90===this.direction||270===this.direction?(e.setPointAt(e.pointsCount-2,i.x,(n.y+s.y)/2),e.setPointAt(e.pointsCount-3,i.x,(n.y+s.y)/2)):(e.setPointAt(e.pointsCount-2,(n.x+s.x)/2,i.y),e.setPointAt(e.pointsCount-3,(n.x+s.x)/2,i.y));const r=e.getLinkPointFromPoint(o,a,t,e.getPoint(e.pointsCount-2),!1);e.setPointAt(e.pointsCount-1,r.x,r.y)}}e.commitRoute(),i.commit()}}S3(){this.Sw=-1,this.qg=0,this.Vs=0,this.gu=null;for(let t=0;t<this.zn.length;t++)this.zn[t]=null}ja(t){let e;const i=this.ie[t];if(i>=this.zn.length){const t=[];for(let e=0;e<this.zn.length;e++)t[e]=this.zn[e];this.zn=t}void 0===this.zn[i]||null===this.zn[i]?e=[]:(e=this.zn[i],this.zn[i]=null);const s=this.gu[t];for(let t=0;t<s.length;t++){const i=s[t];e[i.index]=i}return e}Wa(t,e){this.zn[this.ie[t]]=e}get layerSpacing(){return this.Us}set layerSpacing(t){this.Us!==t&&(e.s(t,"number",ui,"layerSpacing"),t>=0&&(this.Us=t,this.p()))}get columnSpacing(){return this.ti}set columnSpacing(t){this.ti!==t&&(e.s(t,"number",ui,"columnSpacing"),t>0&&(this.ti=t,this.p()))}get direction(){return this.P}set direction(t){this.P!==t&&(e.s(t,"number",ui,"direction"),0===t||90===t||180===t||270===t?(this.P=t,this.p()):e.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.hu}set cycleRemoveOption(t){this.hu!==t&&(1===t||0===t||2===t)&&(this.hu=t,this.p())}get layeringOption(){return this.cu}set layeringOption(t){this.cu!==t&&(10===t||11===t||12===t)&&(this.cu=t,this.p())}get initializeOption(){return this.fu}set initializeOption(t){this.fu!==t&&(20===t||21===t||22===t)&&(this.fu=t,this.p())}get iterations(){return this.gc}set iterations(t){this.gc!==t&&t>=0&&(this.gc=t,this.p())}get aggressiveOption(){return this.uu}set aggressiveOption(t){this.uu!==t&&(30===t||31===t||32===t)&&(this.uu=t,this.p())}get packOption(){return this.hr}set packOption(t){this.hr!==t&&(e.s(t,"number",ui,"packOption"),t>=0&&t<8&&(this.hr=t,this.p()))}get packIterations(){return this.du}set packIterations(t){this.du=t}get alignOption(){return this.Xn}set alignOption(t){this.Xn!==t&&(e.s(t,"number",ui,"align"),t>=0&&t<16&&(this.Xn=t,this.p()))}get centered(){return this.qa}set centered(t){this.centered!==t&&(e.s(t,"boolean",ui,"centered"),this.qa=t,this.p())}get setsPortSpots(){return this.Bn}set setsPortSpots(t){this.Bn!==t&&(e.s(t,"boolean",ui,"setsPortSpots"),this.Bn=t,this.p())}get maxLayer(){return this._}get maxIndex(){return this.Sw}get maxColumn(){return this.zt}get minIndexLayer(){return this.qg}get maxIndexLayer(){return this.Vs}static CycleDepthFirst=0;static CycleGreedy=1;static CycleFromLayers=2;static LayerOptimalLinkLength=10;static LayerLongestPathSink=11;static LayerLongestPathSource=12;static InitDepthFirstOut=20;static InitDepthFirstIn=21;static InitNaive=22;static AggressiveNone=30;static AggressiveLess=31;static AggressiveMore=32;static PackNone=0;static PackExpand=1;static PackStraighten=2;static PackMedian=4;static PackAll=15;static AlignNone=0;static AlignUpperLeft=1;static AlignUpperRight=2;static AlignLowerLeft=4;static AlignLowerRight=8;static AlignAll=15}class ci extends Ae{constructor(t){super(t)}createVertex(){const t=new di(this);return t.centered=this.layout.centered,t}createEdge(){return new gi(this)}}class di extends De{gl;pa;Tt;sP;nP;qa;ii;mu;_n;_k;$k;Zk;mc;Gn;NF;Ja;os;pu;mi;Yn;Lw=null;Aw=null;Tw=null;Dw=null;constructor(t){super(t),this.gl=-1,this.pa=-1,this.Tt=-1,this.sP=NaN,this.nP=null,this.qa=!0,this.ii=!1,this.mu=NaN,this._n=NaN,this._k=0,this.$k=null,this.Zk=null}static AF(t,e){return t.index-e.index}getProperSourceEdges(){if(!this.Tw){const t=[];for(const e of this.So){const i=e;i.valid&&t.push(i)}this.Tw=t}return this.Tw}getProperDestinationEdges(){if(!this.Dw){const t=[];for(const e of this.or){const i=e;i.valid&&t.push(i)}this.Dw=t}return this.Dw}getDestinationEdge(t){const i=this.getProperDestinationEdges();for(const e of i)if(e.toVertex===t)return e;e.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.Lw){const t=[];for(const e of this.So){const i=e;!i.valid||i.fromVertex.layer<=i.toVertex.layer||t.push(i.fromVertex)}t.sort(di.AF),this.Lw=t}return this.Lw}getProperDestinationVertexes(){if(!this.Aw){const t=[];for(const e of this.or){const i=e;!i.valid||i.fromVertex.layer<=i.toVertex.layer||t.push(i.toVertex)}t.sort(di.AF),this.Aw=t}return this.Aw}addSourceEdge(t){super.addSourceEdge(t),this.Lw=null,this.Tw=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.Lw=null,this.Tw=null}addDestinationEdge(t){super.addDestinationEdge(t),this.Aw=null,this.Dw=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.Aw=null,this.Dw=null}commit(){if(this.centered)super.commit();else{const t=this.node;if(null!==t){const e=this.network.layout;if(!e)return;180===e.direction||270===e.direction?t.moveTo(this.bounds.right-t.actualBounds.width,this.bounds.bottom-t.actualBounds.height):t.moveTo(this.bounds.x,this.bounds.y)}}}get layer(){return this.gl}set layer(t){this.gl=t}get column(){return this.pa}set column(t){this.pa=t}get index(){return this.Tt}set index(t){this.Tt=t}get component(){return this.sP}set component(t){this.sP!==t&&(e.s(t,"number",di,"component"),this.sP=t)}get near(){return this.nP}set near(t){this.nP!==t&&(this.nP=t)}get centered(){return this.qa}set centered(t){this.qa=t}}class gi extends Fe{ii;oP;rP;lP;aP;hP;cP;constructor(t){super(t),this.ii=!1,this.oP=!1,this.rP=!1,this.lP=NaN,this.aP=NaN,this.hP=0,this.cP=0}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(this.is=t)}get toVertex(){return this.ss}set toVertex(t){this.ss!==t&&(this.ss=t)}get valid(){return this.ii}set valid(t){this.ii!==t&&(e.s(t,"boolean",gi,"valid"),this.ii=t)}get rev(){return this.oP}set rev(t){this.oP!==t&&(e.s(t,"boolean",gi,"rev"),this.oP=t)}get forest(){return this.rP}set forest(t){this.rP!==t&&(e.s(t,"boolean",gi,"forest"),this.rP=t)}get portFromPos(){return this.lP}set portFromPos(t){this.lP!==t&&(e.s(t,"number",gi,"portFromPos"),this.lP=t)}get portToPos(){return this.aP}set portToPos(t){this.aP!==t&&(e.s(t,"number",gi,"portToPos"),this.aP=t)}get portFromColOffset(){return this.hP}set portFromColOffset(t){this.hP!==t&&(e.s(t,"number",gi,"portFromColOffset"),this.hP=t)}get portToColOffset(){return this.cP}set portToColOffset(t){this.cP!==t&&(e.s(t,"number",gi,"portToColOffset"),this.cP=t)}}var fi=(t=>(t[t.Default=0]="Default",t[t.Destination=1]="Destination",t[t.Source=2]="Source",t))(fi||{}),mi=(t=>(t[t.Forwards=10]="Forwards",t[t.Reverse=11]="Reverse",t[t.Ascending=12]="Ascending",t[t.Descending=13]="Descending",t))(mi||{}),pi=(t=>(t[t.CenterSubtrees=20]="CenterSubtrees",t[t.CenterChildren=21]="CenterChildren",t[t.Start=22]="Start",t[t.End=23]="End",t[t.Bus=24]="Bus",t[t.BusBranching=25]="BusBranching",t[t.TopLeftBus=26]="TopLeftBus",t[t.BottomRightBus=27]="BottomRightBus",t[t.Custom=28]="Custom",t))(pi||{}),yi=(t=>(t[t.None=30]="None",t[t.Block=31]="Block",t))(yi||{}),xi=(t=>(t[t.Layered=40]="Layered",t[t.LastParents=41]="LastParents",t[t.Alternating=42]="Alternating",t[t.RootOnly=43]="RootOnly",t))(xi||{}),wi=(t=>(t[t.Vertical=50]="Vertical",t[t.Horizontal=51]="Horizontal",t[t.FixedRoots=52]="FixedRoots",t))(wi||{}),bi=(t=>(t[t.Individual=60]="Individual",t[t.Siblings=61]="Siblings",t[t.Uniform=62]="Uniform",t))(bi||{});class vi extends Le{Ie;Fe;yu;$g;xL;zi;He;Es;V;B;fP;ws;constructor(t){super(),this.Ie=new u,this.Fe=0,this.ws=1,this.yu=40,this.$g=60,this.xL=[],this.zi=!0,this.He=50,this.Es=new x(10,10).k();const e=new Pi(this);this.V=new ki(e),this.B=new ki(e),this.fP=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Fe=this.Fe,t.yu=this.yu,t.$g=this.$g,t.zi=this.zi,t.He=this.He,t.Es.h(this.Es),t.V.copyInheritedPropertiesFrom(this.V),t.B.copyInheritedPropertiesFrom(this.B)}fe(t){t in pi?this.alignment=t:t in wi?this.arrangement=t:t in yi?this.compaction=t:t in fi?this.path=t:t in mi?this.sorting=t:t in xi?this.treeStyle=t:super.fe(t)}createNetwork(){return new Pi(this)}makeNetwork(t){const e=this.createNetwork(),i=t=>{if(t instanceof me)return!t.isLinkLabel&&"Comment"!==t.category;if(t instanceof be){const e=t.fromNode;if(null===e||e.isLinkLabel||"Comment"===e.category)return!1;const i=t.toNode;return!(null===i||i.isLinkLabel||"Comment"===i.category)}return!1};return t instanceof wt?(e.addParts(t.nodes,!0,i),e.addParts(t.links,!0,i)):t instanceof Ne?e.addParts(t.memberParts,!1,i):e.addParts(t.iterator,!1,i),e}doLayout(t){null===this.network&&(this.network=this.makeNetwork(t)),52!==this.arrangement&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let e=this.diagram;null===e&&t instanceof wt&&(e=t),0===this.path&&null!==e?this.ws=e.isTreePathToChildren?1:2:this.ws=0===this.path?1:this.path,this.network.vertexes.count>0&&(this.oU(),this.rU(),this.lU(),this.aU(),this.dL(),this.hU(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Ie=new u,this.isValidLayout=!0}oU(){if(null===this.network)return;this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;e.initialized=!1,e.level=0,e.parent=null,e.children=[]}if(this.Ie.count>0){const t=new u,e=this.Ie.iterator;for(;e.next();){const i=e.value;if(i instanceof me){const e=this.network.findVertex(i);null!==e&&t.add(e)}else i instanceof ki&&t.add(i)}this.Ie=t}0===this.Ie.count&&this.findRoots();const e=this.Ie.copy().iterator;for(;e.next();){const t=e.value;t.initialized||(t.initialized=!0,this.bL(t))}let i=this.network.vertexes,s=null;for(;s=this.cU(i),s.count>0;){const t=this.TF(s);null!==t&&(this.Ie.add(t),t.initialized=!0,this.bL(t)),i=s}}cU(t){const e=new u,i=t.iterator;for(;i.next();){const t=i.value;t.initialized||e.add(t)}return e}findRoots(){if(null===this.network)return;const t=this.network.vertexes,i=t.iterator;for(;i.next();){const t=i.value;switch(this.ws){case 1:0===t.sourceEdges.count&&this.Ie.add(t);break;case 2:0===t.destinationEdges.count&&this.Ie.add(t);break;default:e.o("Unhandled path value "+this.ws.toString())}}if(0===this.Ie.count){const e=this.TF(t);null!==e&&this.Ie.add(e)}}TF(t){let i=999999,s=null;const n=t.iterator;for(;n.next();){const t=n.value;switch(this.ws){case 1:t.sourceEdges.count<i&&(i=t.sourceEdges.count,s=t);break;case 2:t.destinationEdges.count<i&&(i=t.destinationEdges.count,s=t);break;default:e.o("Unhandled path value "+this.ws.toString())}}return s}bL(t){if(null===t)return;switch(this.ws){case 1:if(t.destinationEdges.count>0){const e=new h,i=t.destinationVertexes;for(;i.next();){const s=i.value;this.DF(t,s)&&e.add(s)}e.count>0&&(t.children=e.toArray())}break;case 2:if(t.sourceEdges.count>0){const e=new h,i=t.sourceVertexes;for(;i.next();){const s=i.value;this.DF(t,s)&&e.add(s)}e.count>0&&(t.children=e.toArray())}break;default:e.o("Unhandled path value"+this.ws.toString())}const i=t.children,s=i.length;for(let e=0;e<s;e++){const s=i[e];s.initialized=!0,s.level=t.level+1,s.parent=t,this.Ie.delete(s)}for(let t=0;t<s;t++){const e=i[t];this.bL(e)}}DF(t,e){return!e.initialized||!(this.fU(e,t)||e.level>t.level)&&(this.uU(e.parent,e),!0)}fU(t,e){if(null===e)return!1;let i=e.parent;for(;null!==i&&i!==t;)i=i.parent;return i===t}uU(t,e){if(null===t||null===e)return;const i=t.children;let s=0;for(let t=0;t<i.length;t++)i[t]===e&&s++;if(s>0){const n=new Array(i.length-s);let o=0;for(let t=0;t<i.length;t++)i[t]!==e&&(n[o++]=i[t]);t.children=n}}rU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ki&&this.vF(e)}}vF(t){if(null===t)return;this.initializeTreeVertexValues(t),25===t.alignment&&this.sortTreeVertexChildren(t);let e=0,i=t.childrenCount,s=0;const n=t.children,o=n.length;for(let t=0;t<o;t++){const o=n[t];this.vF(o),e+=o.descendantCount+1,i=Math.max(i,o.maxChildrenCount),s=Math.max(s,o.maxGenerationCount)}t.descendantCount=e,t.maxChildrenCount=i,t.maxGenerationCount=i>0?s+1:0}dU(t){switch(this.yu){default:case 40:return null!==t.parent?t.parent:this.V;case 43:return null===t.parent?this.V:null===t.parent.parent?this.B:t.parent;case 42:return null!==t.parent?null!==t.parent.parent?t.parent.parent:this.B:this.V;case 41:{let e=!0;if(0===t.childrenCount)e=!1;else{const i=t.children,s=i.length;for(let t=0;t<s;t++)if(i[t].childrenCount>0){e=!1;break}}return e&&null!==t.parent?this.B:null!==t.parent?t.parent:this.V}}}initializeTreeVertexValues(t){const e=this.dU(t);if(t.copyInheritedPropertiesFrom(e),null!==t.parent&&25===t.parent.alignment){let e=t.angle;const i=t.parent.children;let s=0;for(;s<i.length&&t!==i[s];)s++;s%2==0?s!==i.length-1&&(e=90===e?180:180===e?270:270===e?180:270):e=90===e?0:180===e?90:270===e?0:90,t.angle=e}t.initialized=!0}lU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ki&&this.FF(e)}}FF(t){if(null===t)return;this.assignTreeVertexValues(t);const e=t.children,i=e.length;for(let t=0;t<i;t++){const i=e[t];this.FF(i)}}assignTreeVertexValues(t){}aU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ki&&this.RF(e)}}RF(t){if(null===t)return;25!==t.alignment&&this.sortTreeVertexChildren(t);const e=t.children,i=e.length;for(let t=0;t<i;t++){const i=e[t];this.RF(i)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse()}}dL(){if(!this.comments||null===this.network)return;const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;this.addComments(e)}}addComments(t){const e=t.angle,i=t.parent;let s=0,n=21,o=!1;null!==i&&(s=i.angle,n=i.alignment,o=this.isBusAlignment(n));const r=90===e||270===e,a=90===s||270===s,h=0===t.childrenCount;let l=0,u=0,c=0;const d=t.commentSpacing;if(null!==t.node){const e=t.node.findNodesConnected();for(;e.next();){const i=e.value;if("Comment"!==i.category||!i.canLayout())continue;null===t.comments&&(t.comments=[]),t.comments.push(i),i.ensureBounds();const s=i.measuredBounds;r&&!h||!o&&!a&&h||o&&a&&h?(l=Math.max(l,s.width),u+=s.height+Math.abs(c)):(l+=s.width+Math.abs(c),u=Math.max(u,s.height)),c=d}}if(null!==t.comments){r&&!h||!o&&!a&&h||o&&a&&h?(l+=Math.abs(t.commentMargin),u=Math.max(0,u-t.height)):(u+=Math.abs(t.commentMargin),l=Math.max(0,l-t.width));const e=w.z(0,0,t.bounds.width+l,t.bounds.height+u);t.bounds=e,w.i(e)}}isBusAlignment(t){return 24===t||25===t||26===t||27===t}vw(t){return 24===t||25===t}kL(t){const e=t.parent;if(null!==e){const i=e.alignment;if(this.isBusAlignment(i)){if(this.vw(i)){const i=e.children;let s=0;for(;s<i.length&&t!==i[s];)s++;return s%2==0}return 26===i}}return!1}layoutComments(t){if(null!==t.comments){const e=t.node.measuredBounds,i=t.parent,s=t.angle;let n=0,o=21,r=!1;null!==i&&(n=i.angle,o=i.alignment,r=this.isBusAlignment(o));const a=90===s||270===s,h=90===n||270===n,l=0===t.childrenCount,u=this.kL(t);let c=0;const d=t.comments,g=d.length,f=y.l();for(let e=0;e<g;e++){const i=d[e],s=i.measuredBounds;if(a&&!l||!r&&!h&&l||r&&h&&l){if(n>135&&!r||h&&u)if(t.commentMargin>=0){f.e(t.bounds.x-t.commentMargin-s.width,t.bounds.y+c),i.move(f);const e=i.findLinksInto();for(;e.next();){const t=e.value;t.fromSpot=v.MiddleLeft,t.toSpot=v.MiddleRight}}else{f.e(t.bounds.x+2*t.focus.x-t.commentMargin,t.bounds.y+c),i.move(f);const e=i.findLinksInto();for(;e.next();){const t=e.value;t.fromSpot=v.MiddleRight,t.toSpot=v.MiddleLeft}}else if(t.commentMargin>=0){f.e(t.bounds.x+2*t.focus.x+t.commentMargin,t.bounds.y+c),i.move(f);const e=i.findLinksInto();for(;e.next();){const t=e.value;t.fromSpot=v.MiddleRight,t.toSpot=v.MiddleLeft}}else{f.e(t.bounds.x+t.commentMargin-s.width,t.bounds.y+c),i.move(f);const e=i.findLinksInto();for(;e.next();){const t=e.value;t.fromSpot=v.MiddleLeft,t.toSpot=v.MiddleRight}}t.commentSpacing>=0?c+=s.height+t.commentSpacing:c+=t.commentSpacing-s.height}else{if(n>135&&!r||!h&&u)if(t.commentMargin>=0){f.e(t.bounds.x+c,t.bounds.y-t.commentMargin-s.height),i.move(f);const e=i.findLinksInto();for(;e.next();){const t=e.value;t.fromSpot=v.MiddleTop,t.toSpot=v.MiddleBottom}}else{f.e(t.bounds.x+c,t.bounds.y+2*t.focus.y-t.commentMargin),i.move(f);const e=i.findLinksInto();for(;e.next();){const t=e.value;t.fromSpot=v.MiddleBottom,t.toSpot=v.MiddleTop}}else if(t.commentMargin>=0){f.e(t.bounds.x+c,t.bounds.y+2*t.focus.y+t.commentMargin),i.move(f);const e=i.findLinksInto();for(;e.next();){const t=e.value;t.fromSpot=v.MiddleBottom,t.toSpot=v.MiddleTop}}else{f.e(t.bounds.x+c,t.bounds.y+t.commentMargin-s.height),i.move(f);const e=i.findLinksInto();for(;e.next();){const t=e.value;t.fromSpot=v.MiddleTop,t.toSpot=v.MiddleBottom}}t.commentSpacing>=0?c+=s.width+t.commentSpacing:c+=t.commentSpacing-s.width}}y.i(f);const m=c-t.commentSpacing-(a?e.height:e.width);if(1===this.ws){const e=t.destinationEdges;for(;e.next();){const t=e.value.link;null!==t&&!t.isAvoiding&&(t.fromEndSegmentLength=m>0?m:NaN)}}else{const e=t.sourceEdges;for(;e.next();){const t=e.value.link;null!==t&&!t.isAvoiding&&(t.toEndSegmentLength=m>0?m:NaN)}}}}hU(){if(null===this.network)return;if(62===this.layerStyle){const t=[];let e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;let s=i.parent;null===s&&(s=i);const n=0===s.angle||180===s.angle;let o=t[i.level];void 0===o&&(o=0),t[i.level]=Math.max(o,n?i.width:i.height)}for(let e=0;e<t.length;e++)void 0===t[e]&&(t[e]=0);for(this.xL=t,e=this.network.vertexes.iterator;e.next();){const i=e.value;let s=i.parent;null===s&&(s=i),0===s.angle||180===s.angle?(180===s.angle&&(i.focusX+=t[i.level]-i.width),i.width=t[i.level]):(270===s.angle&&(i.focusY+=t[i.level]-i.height),i.height=t[i.level])}}else if(61===this.layerStyle){const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value,i=0===e.angle||180===e.angle;let s=-1;for(let t=0;t<e.children.length;t++){const n=e.children[t];s=Math.max(s,i?n.width:n.height)}if(s>=0)for(let t=0;t<e.children.length;t++){const n=e.children[t];i?(180===e.angle&&(n.focusX+=s-n.width),n.width=s):(270===e.angle&&(n.focusY+=s-n.height),n.height=s)}}}const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ki&&this.layoutTree(e)}}layoutTree(t){if(null===t)return;const e=t.children,i=e.length;for(let t=0;t<i;t++){const i=e[t];this.layoutTree(i)}if(30===t.compaction)this.OF(t);else 25===t.alignment?this.OF(t):this.gU(t)}OF(t){if(0===t.childrenCount){let e=!1,i=0,s=21;null!==t.parent&&(i=t.parent.angle,s=t.parent.alignment,e=this.isBusAlignment(s));const n=this.kL(t);return t.U.e(0,0),t.dt.e(t.width,t.height),void(null===t.parent||null===t.comments||(180!==i&&270!==i||e)&&!n?t.at.e(0,0):180===i&&!e||(90===i||270===i)&&n?t.at.e(t.width-2*t.focus.x,0):t.at.e(0,t.height-2*t.focus.y))}const e=this.orthoAngle(t),i=90===e||270===e;let s=0;const n=t.children,o=n.length;for(let t=0;t<o;t++){const e=n[t];s=Math.max(s,i?e.dt.width:e.dt.height)}const r=t.alignment,a=22===r,h=23===r,l=this.isBusAlignment(r),u=Math.max(0,t.breadthLimit),c=this.computeLayerSpacing(t),d=t.nodeSpacing,g=this.computeNodeIndent(t),f=a||h?0:g/2,m=t.rowSpacing;let p=0;(a||h)&&(p=Math.max(0,t.rowIndent));const y=t.width,x=t.height;let b=0,v=0,P=0,k=0,S=0,M=0,C=0,N=0,T=0,L=0;if(l&&!this.vw(r)&&e>135&&n.reverse(),this.vw(r))if(o>1)for(let t=0;t<o;t++){const e=n[t],s=e.dt;t%2==0&&t!==o-1?T=Math.max(T,(i?s.width:s.height)+this.computeBusNodeSpacing(e)-d):t%2!=0&&(L=Math.max(L,(i?s.width:s.height)+this.computeBusNodeSpacing(e)-d))}else 1===o&&(T=i?n[0].dt.width:n[0].dt.height);if(l)switch(r){case 24:case 25:const r=w.l();e<135?this.IF(t,n,T,L,b,v,r):this.EF(t,n,T,L,b,v,r),T=r.x,b=r.width,v=r.height,w.i(r);break;case 26:for(let t=0;t<o;t++){const e=n[t],o=e.dt,r=0===C?0:m;i?(e.U.e(s-o.width,S+r),b=Math.max(b,o.width),v=Math.max(v,S+r+o.height),S+=r+o.height):(e.U.e(k+r,s-o.height),b=Math.max(b,k+r+o.width),v=Math.max(v,o.height),k+=r+o.width),C++}break;case 27:for(let e=0;e<o;e++){const s=n[e],o=s.dt,r=0===C?0:m;i?(s.U.e(d/2+t.focus.x,S+r),b=Math.max(b,o.width),v=Math.max(v,S+r+o.height),S+=r+o.height):(s.U.e(k+r,d/2+t.focus.y),b=Math.max(b,k+r+o.width),v=Math.max(v,o.height),k+=r+o.width),C++}}else for(let a=0;a<o;a++){const o=n[a],h=o.dt;if(i){u>0&&C>0&&k+d+h.width>u&&(k<s&&this.pc(t,r,s-k,0,N,a-1),M++,C=0,N=a,P=v,k=0,S=e>135?-v-m:v+m);const i=0===C?f:d;this.uP(o,0,S),o.U.e(k+i,S),b=Math.max(b,k+i+h.width),v=Math.max(v,P+(0===M?0:m)+h.height),k+=i+h.width}else{u>0&&C>0&&S+d+h.height>u&&(S<s&&this.pc(t,r,0,s-S,N,a-1),M++,C=0,N=a,P=b,S=0,k=e>135?-b-m:b+m);const i=0===C?f:d;this.uP(o,k,0),o.U.e(k,S+i),v=Math.max(v,S+i+h.height),b=Math.max(b,P+(0===M?0:m)+h.width),S+=i+h.height}C++}M>0&&(i?(v+=Math.max(0,c),k<b&&this.pc(t,r,b-k,0,N,o-1),p>0&&(h||this.wu(t,p,0,0,o-1),b+=p)):(b+=Math.max(0,c),S<v&&this.pc(t,r,0,v-S,N,o-1),p>0&&(h||this.wu(t,0,p,0,o-1),v+=p)));let A=0,D=0;switch(r){case 20:i?A+=b/2-t.focus.x-g/2:D+=v/2-t.focus.y-g/2;break;default:case 21:if(M>0)i?A+=b/2-t.focus.x-g/2:D+=v/2-t.focus.y-g/2;else{const e=o;if(i){const i=n[0].U.x+n[0].at.x;A+=i+(n[e-1].U.x+n[e-1].at.x+2*n[e-1].focus.x-i)/2-t.focus.x-g/2}else{const i=n[0].U.y+n[0].at.y;D+=i+(n[e-1].U.y+n[e-1].at.y+2*n[e-1].focus.y-i)/2-t.focus.y-g/2}}break;case 22:i?(A-=g,b+=g):(D-=g,v+=g);break;case 23:i?(A+=b-t.width+g,b+=g):(D+=v-t.height+g,v+=g);break;case 24:case 25:i?A+=o>1?T+d/2-t.focus.x:n[0].focus.x-t.focus.x+n[0].at.x:D+=o>1?T+d/2-t.focus.y:n[0].focus.y-t.focus.y+n[0].at.y;break;case 26:i?A+=b+d/2-t.focus.x:D+=v+d/2-t.focus.y;break;case 27:break;case 28:const e=this.customAlignment(t,A,D,b,v);A=e[0],D=e[1],b=e[2],v=e[3]}for(let t=0;t<o;t++){const s=n[t];i?s.U.e(s.U.x+s.at.x-A,s.U.y+(e>135?(l?-v:-s.dt.height)+s.at.y-c:x+c+s.at.y)):s.U.e(s.U.x+(e>135?(l?-b:-s.dt.width)+s.at.x-c:y+c+s.at.x),s.U.y+s.at.y-D)}i?(b=this.PL(t,b,A),A<0&&(A=0),e>135&&(D+=v+c),v=Math.max(Math.max(v,x),v+x+c)):(e>135&&(A+=b+c),b=Math.max(Math.max(b,y),b+y+c),v=this.SL(t,v,D),D<0&&(D=0)),t.at.e(A,D),t.dt.e(b,v)}customAlignment(t,e,i,s,n){return[e,i,s,n]}IF(t,e,i,s,n,o,r){const a=e.length;if(0===a)return r.e(i,0,n,o),r;if(1===a){const t=e[0];return n=t.dt.width,o=t.dt.height,r.e(i,0,n,o),r}const h=t.nodeSpacing,l=t.rowSpacing,u=90===this.orthoAngle(t);let c=0,d=0,g=0;for(let t=0;t<a;t++){if(t%2!=0||a>1&&t===a-1)continue;const s=e[t],r=s.dt,f=0===c?0:l;if(u){const t=this.computeBusNodeSpacing(s)-h;s.U.e(i-(r.width+t),g+f),n=Math.max(n,r.width+t),o=Math.max(o,g+f+r.height),g+=f+r.height}else{const t=this.computeBusNodeSpacing(s)-h;s.U.e(d+f,i-(r.height+t)),o=Math.max(o,r.height+t),n=Math.max(n,d+f+r.width),d+=f+r.width}c++}c=0;const f=d,m=g;u?(d=i+h,g=0):(d=0,g=i+h);for(let t=0;t<a;t++){if(t%2==0)continue;const i=e[t],s=i.dt,r=0===c?0:l;if(u){const t=this.computeBusNodeSpacing(i)-h;i.U.e(d+t,g+r),n=Math.max(n,d+s.width+t),o=Math.max(o,g+r+s.height),g+=r+s.height}else{const t=this.computeBusNodeSpacing(i)-h;i.U.e(d+r,g+t),n=Math.max(n,d+r+s.width),o=Math.max(o,g+s.height+t),d+=r+s.width}c++}if(a>1&&a%2==1){const s=e[a-1],r=s.dt,l=this.computeBusLastRowSpacing(s,u?Math.max(Math.abs(m),Math.abs(g)):Math.max(Math.abs(f),Math.abs(d)));if(u){s.U.e(i+h/2-s.focus.x-s.at.x,o+l);const e=i+h/2-s.focus.x-s.at.x;n=Math.max(n,e+r.width),e<0&&(n-=e),o=Math.max(o,Math.max(m,g)+l+r.height),s.U.x<0&&(i=this.dP(t,s.U.x,!1,i,h))}else{s.U.e(n+l,i+h/2-s.focus.y-s.at.y),n=Math.max(n,Math.max(f,d)+l+r.width);const e=i+h/2-s.focus.y-s.at.y;o=Math.max(o,e+r.height),e<0&&(o-=e),s.U.y<0&&(i=this.dP(t,s.U.y,!0,i,h))}}return r.e(i,0,n,o),r}EF(t,e,i,s,n,o,r){const a=e.length;if(0===a)return r.e(i,0,n,o),r;if(1===a){const t=e[0];return n=t.dt.width,o=t.dt.height,r.e(i,0,n,o),r}const h=t.nodeSpacing,l=t.rowSpacing,u=270===this.orthoAngle(t);let c=0,d=0,g=0;for(let t=0;t<a;t++){if(t%2!=0||a>1&&t===a-1)continue;const s=e[t],r=s.dt,f=0===c?0:l;if(u){const t=this.computeBusNodeSpacing(s)-h;g-=f+r.height,s.U.e(i-(r.width+t),g),n=Math.max(n,r.width+t),o=Math.max(o,Math.abs(g))}else{const t=this.computeBusNodeSpacing(s)-h;d-=f+r.width,s.U.e(d,i-(r.height+t)),o=Math.max(o,r.height+t),n=Math.max(n,Math.abs(d))}c++}c=0;const f=d,m=g;u?(d=i+h,g=0):(d=0,g=i+h);for(let t=0;t<a;t++){if(t%2==0)continue;const i=e[t],s=i.dt,r=0===c?0:l;if(u){const t=this.computeBusNodeSpacing(i)-h;g-=r+s.height,i.U.e(d+t,g),n=Math.max(n,d+s.width+t),o=Math.max(o,Math.abs(g))}else{const t=this.computeBusNodeSpacing(i)-h;d-=r+s.width,i.U.e(d,g+t),o=Math.max(o,g+s.height+t),n=Math.max(n,Math.abs(d))}c++}if(a>1&&a%2==1){const s=e[a-1],r=s.dt,l=this.computeBusLastRowSpacing(s,u?Math.max(Math.abs(m),Math.abs(g)):Math.max(Math.abs(f),Math.abs(d)));if(u){s.U.e(i+h/2-s.focus.x-s.at.x,-o-r.height-l);const e=i+h/2-s.focus.x-s.at.x;n=Math.max(n,e+r.width),e<0&&(n-=e),o=Math.max(o,Math.abs(Math.min(m,g))+l+r.height),s.U.x<0&&(i=this.dP(t,s.U.x,!1,i,h))}else{s.U.e(-n-r.width-l,i+h/2-s.focus.y-s.at.y),n=Math.max(n,Math.abs(Math.min(f,d))+l+r.width);const e=i+h/2-s.focus.y-s.at.y;o=Math.max(o,e+r.height),e<0&&(o-=e),s.U.y<0&&(i=this.dP(t,s.U.y,!0,i,h))}}for(let t=0;t<a;t++){const i=e[t];u?i.U.e(i.U.x,i.U.y+o):i.U.e(i.U.x+n,i.U.y)}return r.e(i,0,n,o),r}computeBusNodeSpacing(t){return null===t.parent?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,e){return null===t.parent?0:t.parent.rowSpacing}dP(t,e,i,s,n){const o=t.children,r=o.length;for(let t=0;t<r;t++)i?o[t].U.e(o[t].U.x,o[t].U.y-e):o[t].U.e(o[t].U.x-e,o[t].U.y);const a=o[r-1];return Math.max(s,i?a.at.y+a.focus.y-n/2:a.at.x+a.focus.x-n/2)}PL(t,e,i){switch(t.alignment){case 21:case 20:let s=e;return i+t.width>s&&(s=i+t.width),i<0&&(s-=i),s;case 22:return t.width>e?t.width:e;case 23:return 2*t.focus.x>e?t.width:e+t.width-2*t.focus.x;case 24:case 25:const n=Math.min(0,i),o=Math.max(e,i+t.width);return Math.max(t.width,o-n);case 26:return t.width-t.focus.x+t.nodeSpacing/2+e;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+e);default:return e}}SL(t,e,i){switch(t.alignment){case 21:case 20:let s=e;return i+t.height>s&&(s=i+t.height),i<0&&(s-=i),s;case 22:return t.height>e?t.height:e;case 23:return 2*t.focus.y>e?t.height:e+t.height-2*t.focus.y;case 24:case 25:const n=Math.min(0,i),o=Math.max(e,i+t.height);return Math.max(t.height,o-n);case 26:return t.height-t.focus.y+t.nodeSpacing/2+e;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+e);default:return e}}ML(t,i,s){switch(t){case 20:case 21:i/=2,s/=2;break;case 22:i=0,s=0;break;case 23:break;default:e.o("Unhandled alignment value "+t.toString())}return new y(i,s)}pc(t,e,i,s,n,o){const r=this.ML(e,i,s);this.wu(t,r.x,r.y,n,o)}wu(t,e,i,s,n){if(0===e&&0===i)return;const o=t.children;for(let t=s;t<=n;t++){const s=o[t].U;s.x+=e,s.y+=i}}uP(t,i,s){const n=t.parent;switch(this.ws){case 1:{const e=t.sourceEdges;for(;e.next();){const t=e.value;t.fromVertex===n&&t.relativePoint.e(i,s)}break}case 2:{const e=t.destinationEdges;for(;e.next();){const t=e.value;t.toVertex===n&&t.relativePoint.e(i,s)}break}default:e.o("Unhandled path value "+this.ws.toString())}}gU(t){if(0===t.childrenCount){const e=t.parent;let i=!1,s=0,n=21;null!==e&&(s=e.angle,n=e.alignment,i=this.isBusAlignment(n));const o=this.kL(t);return t.U.e(0,0),t.dt.e(t.width,t.height),null===t.parent||null===t.comments||(180!==s&&270!==s||i)&&!o?t.at.e(0,0):180===s&&!i||(90===s||270===s)&&o?t.at.e(t.width-2*t.focus.x,0):t.at.e(0,t.height-2*t.focus.y),t.Zg=null,void(t.Qg=null)}const i=this.orthoAngle(t),s=90===i||270===i;let n=0;const o=t.children,r=o.length;for(let t=0;t<r;t++){const e=o[t];n=Math.max(n,s?e.dt.width:e.dt.height)}const a=t.alignment,h=22===a,l=23===a,u=this.isBusAlignment(a),c=Math.max(0,t.breadthLimit),d=this.computeLayerSpacing(t),g=t.nodeSpacing,f=this.computeNodeIndent(t),m=t.rowSpacing;let p=0;(h||l)&&(p=Math.max(0,t.rowIndent));const y=t.width,x=t.height;let b=0,v=0,P=0,k=null,S=null,M=0,C=0,N=0,T=0,L=0,A=0,D=0,F=0,O=0;if(u&&!this.vw(a)&&i>135&&o.reverse(),this.vw(a))if(r>1)for(let t=0;t<r;t++)t%2==0&&t!==r-1?F=Math.max(F,s?o[t].dt.width:o[t].dt.height):t%2!=0&&(O=Math.max(O,s?o[t].dt.width:o[t].dt.height));else 1===r&&(F=s?o[0].dt.width:o[0].dt.height);if(u){switch(a){case 24:const e=w.l();i<135?this.IF(t,o,F,O,b,v,e):this.EF(t,o,F,O,b,v,e),F=e.x,b=e.width,v=e.height,w.i(e);break;case 26:for(let t=0;t<r;t++){const e=o[t],i=e.dt,r=0===A?0:m;s?(e.U.e(n-i.width,T+r),b=Math.max(b,i.width),v=Math.max(v,T+r+i.height),T+=r+i.height):(e.U.e(N+r,n-i.height),b=Math.max(b,N+r+i.width),v=Math.max(v,i.height),N+=r+i.width),A++}break;case 27:for(let e=0;e<r;e++){const i=o[e],n=i.dt,r=0===A?0:m;s?(i.U.e(g/2+t.focus.x,T+r),b=Math.max(b,n.width),v=Math.max(v,T+r+n.height),T+=r+n.height):(i.U.e(N+r,g/2+t.focus.y),b=Math.max(b,N+r+n.width),v=Math.max(v,n.height),N+=r+n.width),A++}}k=this.pi(2),S=this.pi(2),s?(k[0].e(0,0),k[1].e(0,v),S[0].e(b,0),S[1].e(b,v)):(k[0].e(0,0),k[1].e(b,0),S[0].e(0,v),S[1].e(b,v))}else for(let h=0;h<r;h++){const r=o[h],l=r.dt;if(s){c>0&&A>0&&N+g+l.width>c&&(N<n&&this.pc(t,a,n-N,0,D,h-1),L++,A=0,D=h,P=v,N=0,T=i>135?-v-m:v+m),this.uP(r,0,T);let s=0;if(0===A)k=r.Zg,S=r.Qg,M=l.width,C=l.height,(null===k||null===S||i!==this.orthoAngle(r))&&(k=this.pi(2),S=this.pi(2),k[0].e(0,0),k[1].e(0,C),S[0].e(M,0),S[1].e(M,C));else{const i=e.nt(),n=w.l();this.UF(t,r,k,S,M,C,i,n),s=n.x,k=i[0],S=i[1],M=n.width,C=n.height,e.Z(i),N<l.width&&s<0&&(this.wu(t,-s,0,D,h-1),this.gP(k,-s,0),this.gP(S,-s,0),s=0),w.i(n)}r.U.e(s,T),b=Math.max(b,M),v=Math.max(v,P+(0===L?0:m)+l.height),N=M}else{c>0&&A>0&&T+g+l.height>c&&(T<n&&this.pc(t,a,0,n-T,D,h-1),L++,A=0,D=h,P=b,T=0,N=i>135?-b-m:b+m),this.uP(r,N,0);let s=0;if(0===A)k=r.Zg,S=r.Qg,M=l.width,C=l.height,(null===k||null===S||i!==this.orthoAngle(r))&&(k=this.pi(2),S=this.pi(2),k[0].e(0,0),k[1].e(M,0),S[0].e(0,C),S[1].e(M,C));else{const i=e.nt(),n=w.l();this.UF(t,r,k,S,M,C,i,n),s=n.x,k=i[0],S=i[1],M=n.width,C=n.height,e.Z(i),T<l.height&&s<0&&(this.wu(t,0,-s,D,h-1),this.gP(k,0,-s),this.gP(S,0,-s),s=0),w.i(n)}r.U.e(N,s),v=Math.max(v,C),b=Math.max(b,P+(0===L?0:m)+l.width),T=C}A++}L>0&&(s?(v+=Math.max(0,d),N<b&&this.pc(t,a,b-N,0,D,r-1),p>0&&(l||this.wu(t,p,0,0,r-1),b+=p)):(b+=Math.max(0,d),T<v&&this.pc(t,a,0,v-T,D,r-1),p>0&&(l||this.wu(t,0,p,0,r-1),v+=p)));let R=0,B=0;switch(a){case 20:s?R+=b/2-t.focus.x-f/2:B+=v/2-t.focus.y-f/2;break;default:case 21:if(L>0)s?R+=b/2-t.focus.x-f/2:B+=v/2-t.focus.y-f/2;else{const e=r;if(s){const i=o[0].U.x+o[0].at.x;R+=i+(o[e-1].U.x+o[e-1].at.x+2*o[e-1].focus.x-i)/2-t.focus.x-f/2}else{const i=o[0].U.y+o[0].at.y;B+=i+(o[e-1].U.y+o[e-1].at.y+2*o[e-1].focus.y-i)/2-t.focus.y-f/2}}break;case 22:s?(R-=f,b+=f):(B-=f,v+=f);break;case 23:s?(R+=b-t.width+f,b+=f):(B+=v-t.height+f,v+=f);break;case 24:s?R+=r>1?F+g/2-t.focus.x:o[0].focus.x-t.focus.x+o[0].at.x:B+=r>1?F+g/2-t.focus.y:o[0].focus.y-t.focus.y+o[0].at.y;break;case 26:s?R+=b+g/2-t.focus.x:B+=v+g/2-t.focus.y;break;case 27:break;case 28:const e=this.customAlignment(t,R,B,b,v);R=e[0],B=e[1],b=e[2],v=e[3]}for(let t=0;t<r;t++){const e=o[t];s?e.U.e(e.U.x+e.at.x-R,e.U.y+(i>135?(u?-v:-e.dt.height)+e.at.y-d:x+d+e.at.y)):e.U.e(e.U.x+(i>135?(u?-b:-e.dt.width)+e.at.x-d:y+d+e.at.x),e.U.y+e.at.y-B)}let E,I,V=0,z=0;if(u)s?(b=this.PL(t,b,R),R<0&&(R=0),i>135&&(B+=v+d),v+=x+d,27===a&&(V+=g/2+t.focus.x),z+=x+d):(i>135&&(R+=b+d),b+=y+d,v=this.SL(t,v,B),B<0&&(B=0),27===a&&(z+=g/2+t.focus.y),V+=y+d);else if(s){if(null===t.comments){if(y>b){const t=this.ML(a,y-b,0);V=t.x,z=t.y,b=y,R=0}}else b=this.PL(t,b,R);R<0&&(V-=R,R=0),i>135&&(B+=v+d),v=Math.max(Math.max(v,x),v+x+d),z+=x+d}else{if(i>135&&(R+=b+d),b=Math.max(Math.max(b,y),b+y+d),null===t.comments){if(x>v){const t=this.ML(a,0,x-v);V=t.x,z=t.y,v=x,B=0}}else v=this.SL(t,v,B);B<0&&(z-=B,B=0),V+=y+d}if(L>0)E=this.pi(4),I=this.pi(4),s?(E[2].e(0,x+d),E[3].e(E[2].x,v),I[2].e(b,E[2].y),I[3].e(I[2].x,E[3].y)):(E[2].e(y+d,0),E[3].e(b,E[2].y),I[2].e(E[2].x,v),I[3].e(E[3].x,I[2].y));else{E=this.pi(k.length+2),I=this.pi(S.length+2);for(let t=0;t<k.length;t++){const e=k[t];E[t+2].e(e.x+V,e.y+z)}for(let t=0;t<S.length;t++){const e=S[t];I[t+2].e(e.x+V,e.y+z)}}s?(E[0].e(R,0),E[1].e(E[0].x,x),E[2].y<E[1].y&&(E[2].x>E[0].x?E[2].h(E[1]):E[1].h(E[2])),E[3].y<E[2].y&&(E[3].x>E[0].x?E[3].h(E[2]):E[2].h(E[3])),I[0].e(R+y,0),I[1].e(I[0].x,x),I[2].y<I[1].y&&(I[2].x<I[0].x?I[2].h(I[1]):I[1].h(I[2])),I[3].y<I[2].y&&(I[3].x<I[0].x?I[3].h(I[2]):I[2].h(I[3])),E[2].y-=d/2,I[2].y-=d/2):(E[0].e(0,B),E[1].e(y,E[0].y),E[2].x<E[1].x&&(E[2].y>E[0].y?E[2].h(E[1]):E[1].h(E[2])),E[3].x<E[2].x&&(E[3].y>E[0].y?E[3].h(E[2]):E[2].h(E[3])),I[0].e(0,B+x),I[1].e(y,I[0].y),I[2].x<I[1].x&&(I[2].y<I[0].y?I[2].h(I[1]):I[1].h(I[2])),I[3].x<I[2].x&&(I[3].y<I[0].y?I[3].h(I[2]):I[2].h(I[3])),E[2].x-=d/2,I[2].x-=d/2),this.fn(k),this.fn(S),t.Zg=E,t.Qg=I,t.at.e(R,B),t.dt.e(b,v)}gP(t,e,i){for(let s=0;s<t.length;s++){const n=t[s];n.x+=e,n.y+=i}}UF(t,e,i,s,n,o,r,a){const h=this.orthoAngle(t),l=90===h||270===h,u=t.nodeSpacing,c=i,d=s,g=n,f=o;let m=e.Zg,p=e.Qg;const y=e.dt,x=l?Math.max(f,y.height):Math.max(g,y.width);if((null===m||h!==this.orthoAngle(e))&&(m=this.pi(2),p=this.pi(2),l?(m[0].e(0,0),m[1].e(0,y.height),p[0].e(y.width,0),p[1].e(p[0].x,m[1].y)):(m[0].e(0,0),m[1].e(y.width,0),p[0].e(0,y.height),p[1].e(m[1].x,p[0].y))),l){const t=g;let e=t-this.mU(d,m,t);return e+=u,i=this.pU(c,m,e),s=this.yU(d,p,e),n=Math.max(0,e)+y.width,o=x,this.fn(c),this.fn(m),this.fn(d),this.fn(p),r[0]=i,r[1]=s,a.e(e,0,n,o),a}{const t=f;let e=t-this.wU(d,m,t);return e+=u,i=this.xU(c,m,e),s=this.bU(d,p,e),n=x,o=Math.max(0,e)+y.height,this.fn(c),this.fn(m),this.fn(d),this.fn(p),r[0]=i,r[1]=s,a.e(e,0,n,o),a}}xU(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;o<e.length&&e[o].x<t[0].x;){const t=e[o++];s[r++].e(t.x,t.y+i)}for(;n<t.length;){const e=t[n++];s[r++].e(e.x,e.y)}const a=t[t.length-1].x;for(;o<e.length&&e[o].x<=a;)o++;for(;o<e.length&&e[o].x>a;){const t=e[o++];s[r++].e(t.x,t.y+i)}const h=this.pi(r);for(n=0;n<r;n++)h[n].h(s[n]);return this.fn(s),h}pU(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;o<e.length&&e[o].y<t[0].y;){const t=e[o++];s[r++].e(t.x+i,t.y)}for(;n<t.length;){const e=t[n++];s[r++].e(e.x,e.y)}const a=t[t.length-1].y;for(;o<e.length&&e[o].y<=a;)o++;for(;o<e.length&&e[o].y>a;){const t=e[o++];s[r++].e(t.x+i,t.y)}const h=this.pi(r);for(n=0;n<r;n++)h[n].h(s[n]);return this.fn(s),h}bU(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;n<t.length&&t[n].x<e[0].x;){const e=t[n++];s[r++].e(e.x,e.y)}for(;o<e.length;){const t=e[o++];s[r++].e(t.x,t.y+i)}const a=e[e.length-1].x;for(;n<t.length&&t[n].x<=a;)n++;for(;n<t.length&&t[n].x>a;){const e=t[n++];s[r++].e(e.x,e.y)}const h=this.pi(r);for(n=0;n<r;n++)h[n].h(s[n]);return this.fn(s),h}yU(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;n<t.length&&t[n].y<e[0].y;){const e=t[n++];s[r++].e(e.x,e.y)}for(;o<e.length;){const t=e[o++];s[r++].e(t.x+i,t.y)}const a=e[e.length-1].y;for(;n<t.length&&t[n].y<=a;)n++;for(;n<t.length&&t[n].y>a;){const e=t[n++];s[r++].e(e.x,e.y)}const h=this.pi(r);for(n=0;n<r;n++)h[n].h(s[n]);return this.fn(s),h}wU(t,e,i){let s=9999999;if(null===t||t.length<2||null===e||e.length<2)return s;let n=0,o=0;for(;n<t.length&&o<e.length;){const r=t[n],a=e[o],h=a.x;let l=a.y;l+=i;let u=r;n+1<t.length&&(u=t[n+1]);let c=a,d=c.x,g=c.y;o+1<e.length&&(c=e[o+1],d=c.x,g=c.y,g+=i);let f=s;r.x===h?f=l-r.y:r.x>h&&r.x<d?f=l+(r.x-h)/(d-h)*(g-l)-r.y:h>r.x&&h<u.x&&(f=l-(r.y+(h-r.x)/(u.x-r.x)*(u.y-r.y))),f<s&&(s=f),u.x<=r.x?n++:d<=h?o++:(u.x<=d&&n++,d<=u.x&&o++)}return s}mU(t,e,i){let s=9999999;if(null===t||t.length<2||null===e||e.length<2)return s;let n=0,o=0;for(;n<t.length&&o<e.length;){const r=t[n],a=e[o];let h=a.x;const l=a.y;h+=i;let u=r;n+1<t.length&&(u=t[n+1]);let c=a,d=c.x,g=c.y;o+1<e.length&&(c=e[o+1],d=c.x,g=c.y,d+=i);let f=s;r.y===l?f=h-r.x:r.y>l&&r.y<g?f=h+(r.y-l)/(g-l)*(d-h)-r.x:l>r.y&&l<u.y&&(f=h-(r.x+(l-r.y)/(u.y-r.y)*(u.x-r.x))),f<s&&(s=f),u.y<=r.y?n++:g<=l?o++:(u.y<=g&&n++,g<=u.y&&o++)}return s}pi(t){const e=this.fP[t];if(void 0!==e){const t=e.pop();if(void 0!==t)return t}const i=[];for(let e=0;e<t;e++)i[e]=new y;return i}fn(t){if(!t)return;const e=t.length;let i=this.fP[e];void 0===i&&(i=[],this.fP[e]=i),i.push(t)}arrangeTrees(){if(52===this.He){const t=this.Ie.iterator;for(;t.next();){const e=t.value;if(!(e instanceof ki))continue;const i=e.node;if(null===i)continue;const s=i.position;let n=s.x,o=s.y;isFinite(n)||(n=0),isFinite(o)||(o=0),this.NL(e,n,o)}}else{const t=[],e=this.Ie.iterator;for(;e.next();){const i=e.value;i instanceof ki&&t.push(i)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse()}const i=this.arrangementOrigin;let s=i.x,n=i.y;for(let e=0;e<t.length;e++){const i=t[e];if(50===(this.NL(i,s+i.at.x,n+i.at.y),this.He))n+=i.dt.height+this.Es.height;else s+=i.dt.width+this.Es.width}}}NL(t,e,i){if(null===t)return;t.x=e,t.y=i;const s=t.children,n=s.length;for(let t=0;t<n;t++){const n=s[t];this.NL(n,e+n.U.x,i+n.U.y)}}commitLayout(){this.Pw(),this.commitNodes(),this.wL(),this.isRouting&&this.commitLinks()}commitNodes(){if(null===this.network)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){const e=t.value;this.layoutComments(e)}}wL(){if(null===this.network||62!==this.layerStyle)return;const t=this.xL,e=[];let i;const s=this.network.vertexes.iterator;for(;s.next();){const t=s.value;void 0===i?i=t.bounds.copy():i.unionRect(t.bounds);let n=e[t.level];n=void 0===n?this.computeLayerSpacing(t):Math.max(n,this.computeLayerSpacing(t)),e[t.level]=n}if(!i)return;for(let t=0;t<e.length;t++)void 0===e[t]&&(e[t]=0);let n;90===this.angle||270===this.angle?(i.inflate(this.nodeSpacing/2,this.layerSpacing),n=new y(-this.nodeSpacing/2,-this.layerSpacing/2)):(i.inflate(this.layerSpacing,this.nodeSpacing/2),n=new y(-this.layerSpacing/2,-this.nodeSpacing/2));const o=[],r=90===this.angle||270===this.angle?i.width:i.height;let a=0;if(180===this.angle||270===this.angle)for(let i=0;i<t.length;i++)a+=t[i]+e[i];for(let i=0;i<t.length;i++){const s=t[i]+e[i];270===this.angle?(a-=s,o.push(new w(0,a,r,s))):90===this.angle?(o.push(new w(0,a,r,s)),a+=s):180===this.angle?(a-=s,o.push(new w(a,0,s,r))):(o.push(new w(a,0,s,r)),a+=s)}this.commitLayers(o,n)}commitLayers(t,e){}commitLinks(){if(null===this.network)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}Pw(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof ki&&this.VF(e)}}VF(t){if(null===t)return;this.setPortSpots(t);const e=t.children,i=e.length;for(let t=0;t<i;t++){const i=e[t];this.VF(i)}}setPortSpots(t){const e=t.alignment;if(this.isBusAlignment(e))this.kU(t,e);else{const e=this.orthoAngle(t);if(1===this.ws){const i=t.destinationEdges;for(;i.next();){const s=i.value.link;if(null!==s){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(e){case 0:s.fromSpot=v.MiddleRight;break;case 90:s.fromSpot=v.MiddleBottom;break;case 180:s.fromSpot=v.MiddleLeft;break;default:s.fromSpot=v.MiddleTop}else s.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(e){case 0:s.toSpot=v.MiddleLeft;break;case 90:s.toSpot=v.MiddleTop;break;case 180:s.toSpot=v.MiddleRight;break;default:s.toSpot=v.MiddleBottom}else s.toSpot=t.childPortSpot}}}else{const i=t.sourceEdges;for(;i.next();){const s=i.value.link;if(null!==s){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(e){case 0:s.toSpot=v.MiddleRight;break;case 90:s.toSpot=v.MiddleBottom;break;case 180:s.toSpot=v.MiddleLeft;break;default:s.toSpot=v.MiddleTop}else s.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(e){case 0:s.fromSpot=v.MiddleLeft;break;case 90:s.fromSpot=v.MiddleTop;break;case 180:s.fromSpot=v.MiddleRight;break;default:s.fromSpot=v.MiddleBottom}else s.fromSpot=t.childPortSpot}}}}}kU(t,e){const i=1===this.ws,s=this.orthoAngle(t);let n;switch(s){case 0:n=v.MiddleRight;break;case 90:n=v.MiddleBottom;break;case 180:n=v.MiddleLeft;break;default:n=v.MiddleTop}const o=t.children,r=o.length;switch(e){case 24:case 25:for(let e=0;e<r;e++){const a=o[e],h=(i?a.sourceEdges:a.destinationEdges).first();if(null===h)continue;const l=h.link;if(null!==l){let o=90===s||270===s?v.MiddleLeft:v.MiddleTop;if(1===r||e===r-1&&r%2==1)switch(s){case 0:o=v.MiddleLeft;break;case 90:o=v.MiddleTop;break;case 180:o=v.MiddleRight;break;default:o=v.MiddleBottom}else e%2==0&&(o=90===s||270===s?v.MiddleRight:v.MiddleBottom);i?(t.setsPortSpot&&(l.fromSpot=n),t.setsChildPortSpot&&(l.toSpot=o)):(t.setsPortSpot&&(l.fromSpot=o),t.setsChildPortSpot&&(l.toSpot=n))}}break;case 26:{const e=90===s||270===s?v.MiddleRight:v.MiddleBottom,o=i?t.destinationEdges:t.sourceEdges;for(;o.next();){const s=o.value.link;null!==s&&(i?(t.setsPortSpot&&(s.fromSpot=n),t.setsChildPortSpot&&(s.toSpot=e)):(t.setsPortSpot&&(s.fromSpot=e),t.setsChildPortSpot&&(s.toSpot=n)))}break}case 27:{const e=90===s||270===s?v.MiddleLeft:v.MiddleTop,o=i?t.destinationEdges:t.sourceEdges;for(;o.next();){const s=o.value.link;null!==s&&(i?(t.setsPortSpot&&(s.fromSpot=n),t.setsChildPortSpot&&(s.toSpot=e)):(t.setsPortSpot&&(s.fromSpot=e),t.setsChildPortSpot&&(s.toSpot=n)))}break}}}orthoAngle(t){const e=t.angle;return e<=45?0:e<=135?90:e<=225?180:e<=315?270:0}computeLayerSpacing(t){const e=this.orthoAngle(t),i=90===e||270===e;let s=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const e=Math.min(1,t.layerSpacingParentOverlap);s-=i?t.height*e:t.width*e}return s<(i?-t.height:-t.width)&&(s=i?-t.height:-t.width),s}computeNodeIndent(t){const e=this.orthoAngle(t),i=90===e||270===e;let s=t.nodeIndent;if(t.nodeIndentPastParent>0){const e=Math.min(1,t.nodeIndentPastParent);s+=i?t.width*e:t.height*e}return s=Math.max(0,s),s}get roots(){return this.Ie}set roots(t){this.Ie!==t&&(this.Ie=t,this.p())}get path(){return this.Fe}set path(t){this.Fe!==t&&(this.Fe=t,this.p())}get treeStyle(){return this.yu}set treeStyle(t){this.yu!==t&&(40===t||42===t||41===t||43===t)&&(this.yu=t,this.p())}get layerStyle(){return this.$g}set layerStyle(t){this.$g!==t&&(60===t||61===t||62===t)&&(this.$g=t,this.p())}get comments(){return this.zi}set comments(t){this.zi!==t&&(e.s(t,"boolean",vi,"comments"),this.zi=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(50===t||51===t||52===t)&&(this.He=t,this.p())}get arrangementSpacing(){return this.Es}set arrangementSpacing(t){this.Es.equals(t)||(this.Es.h(t),this.p())}get rootDefaults(){return this.V}set rootDefaults(t){this.V!==t&&(this.V=t,this.p())}get alternateDefaults(){return this.B}set alternateDefaults(t){this.B!==t&&(this.B=t,this.p())}get sorting(){return this.V.sorting}set sorting(t){this.V.sorting!==t&&(this.V.sorting=t,this.p())}get comparer(){return this.V.comparer}set comparer(t){this.V.comparer!==t&&(e.S(t,vi,"comparer"),this.V.comparer=t,this.p())}get angle(){return this.V.angle}set angle(t){this.V.angle!==t&&(e.s(t,"number",vi,"angle"),0===t||90===t||180===t||270===t?(this.V.angle=t,this.p()):e.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.V.alignment}set alignment(t){this.V.alignment!==t&&(this.V.alignment=t,this.p())}get nodeIndent(){return this.V.nodeIndent}set nodeIndent(t){this.V.nodeIndent!==t&&(e.s(t,"number",vi,"nodeIndent"),t>=0&&(this.V.nodeIndent=t,this.p()))}get nodeIndentPastParent(){return this.V.nodeIndentPastParent}set nodeIndentPastParent(t){this.V.nodeIndentPastParent!==t&&(e.s(t,"number",vi,"nodeIndentPastParent"),t>=0&&t<=1&&(this.V.nodeIndentPastParent=t,this.p()))}get nodeSpacing(){return this.V.nodeSpacing}set nodeSpacing(t){this.V.nodeSpacing!==t&&(e.s(t,"number",vi,"nodeSpacing"),this.V.nodeSpacing=t,this.p())}get layerSpacing(){return this.V.layerSpacing}set layerSpacing(t){this.V.layerSpacing!==t&&(e.s(t,"number",vi,"layerSpacing"),this.V.layerSpacing=t,this.p())}get layerSpacingParentOverlap(){return this.V.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.V.layerSpacingParentOverlap!==t&&(e.s(t,"number",vi,"layerSpacingParentOverlap"),t>=0&&t<=1&&(this.V.layerSpacingParentOverlap=t,this.p()))}get compaction(){return this.V.compaction}set compaction(t){this.V.compaction!==t&&(30===t||31===t)&&(this.V.compaction=t,this.p())}get breadthLimit(){return this.V.breadthLimit}set breadthLimit(t){this.V.breadthLimit!==t&&(e.s(t,"number",vi,"breadthLimit"),t>=0&&(this.V.breadthLimit=t,this.p()))}get rowSpacing(){return this.V.rowSpacing}set rowSpacing(t){this.V.rowSpacing!==t&&(e.s(t,"number",vi,"rowSpacing"),this.V.rowSpacing=t,this.p())}get rowIndent(){return this.V.rowIndent}set rowIndent(t){this.V.rowIndent!==t&&(e.s(t,"number",vi,"rowIndent"),t>=0&&(this.V.rowIndent=t,this.p()))}get commentSpacing(){return this.V.commentSpacing}set commentSpacing(t){this.V.commentSpacing!==t&&(e.s(t,"number",vi,"commentSpacing"),this.V.commentSpacing=t,this.p())}get commentMargin(){return this.V.commentMargin}set commentMargin(t){this.V.commentMargin!==t&&(e.s(t,"number",vi,"commentMargin"),this.V.commentMargin=t,this.p())}get setsPortSpot(){return this.V.setsPortSpot}set setsPortSpot(t){this.V.setsPortSpot!==t&&(e.s(t,"boolean",vi,"setsPortSpot"),this.V.setsPortSpot=t,this.p())}get portSpot(){return this.V.portSpot}set portSpot(t){this.V.portSpot.equals(t)||(this.V.portSpot=t,this.p())}get setsChildPortSpot(){return this.V.setsChildPortSpot}set setsChildPortSpot(t){this.V.setsChildPortSpot!==t&&(e.s(t,"boolean",vi,"setsChildPortSpot"),this.V.setsChildPortSpot=t,this.p())}get childPortSpot(){return this.V.childPortSpot}set childPortSpot(t){this.V.childPortSpot.equals(t)||(this.V.childPortSpot=t,this.p())}get alternateSorting(){return this.B.sorting}set alternateSorting(t){this.B.sorting!==t&&(this.B.sorting=t,this.p())}get alternateComparer(){return this.B.comparer}set alternateComparer(t){this.B.comparer!==t&&(e.S(t,vi,"alternateComparer"),this.B.comparer=t,this.p())}get alternateAngle(){return this.B.angle}set alternateAngle(t){this.B.angle!==t&&(e.s(t,"number",vi,"alternateAngle"),(0===t||90===t||180===t||270===t)&&(this.B.angle=t,this.p()))}get alternateAlignment(){return this.B.alignment}set alternateAlignment(t){this.B.alignment!==t&&(this.B.alignment=t,this.p())}get alternateNodeIndent(){return this.B.nodeIndent}set alternateNodeIndent(t){this.B.nodeIndent!==t&&(e.s(t,"number",vi,"alternateNodeIndent"),t>=0&&(this.B.nodeIndent=t,this.p()))}get alternateNodeIndentPastParent(){return this.B.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.B.nodeIndentPastParent!==t&&(e.s(t,"number",vi,"alternateNodeIndentPastParent"),t>=0&&t<=1&&(this.B.nodeIndentPastParent=t,this.p()))}get alternateNodeSpacing(){return this.B.nodeSpacing}set alternateNodeSpacing(t){this.B.nodeSpacing!==t&&(e.s(t,"number",vi,"alternateNodeSpacing"),this.B.nodeSpacing=t,this.p())}get alternateLayerSpacing(){return this.B.layerSpacing}set alternateLayerSpacing(t){this.B.layerSpacing!==t&&(e.s(t,"number",vi,"alternateLayerSpacing"),this.B.layerSpacing=t,this.p())}get alternateLayerSpacingParentOverlap(){return this.B.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.B.layerSpacingParentOverlap!==t&&(e.s(t,"number",vi,"alternateLayerSpacingParentOverlap"),t>=0&&t<=1&&(this.B.layerSpacingParentOverlap=t,this.p()))}get alternateCompaction(){return this.B.compaction}set alternateCompaction(t){this.B.compaction!==t&&(30===t||31===t)&&(this.B.compaction=t,this.p())}get alternateBreadthLimit(){return this.B.breadthLimit}set alternateBreadthLimit(t){this.B.breadthLimit!==t&&(e.s(t,"number",vi,"alternateBreadthLimit"),t>=0&&(this.B.breadthLimit=t,this.p()))}get alternateRowSpacing(){return this.B.rowSpacing}set alternateRowSpacing(t){this.B.rowSpacing!==t&&(e.s(t,"number",vi,"alternateRowSpacing"),this.B.rowSpacing=t,this.p())}get alternateRowIndent(){return this.B.rowIndent}set alternateRowIndent(t){this.B.rowIndent!==t&&(e.s(t,"number",vi,"alternateRowIndent"),t>=0&&(this.B.rowIndent=t,this.p()))}get alternateCommentSpacing(){return this.B.commentSpacing}set alternateCommentSpacing(t){this.B.commentSpacing!==t&&(e.s(t,"number",vi,"alternateCommentSpacing"),this.B.commentSpacing=t,this.p())}get alternateCommentMargin(){return this.B.commentMargin}set alternateCommentMargin(t){this.B.commentMargin!==t&&(e.s(t,"number",vi,"alternateCommentMargin"),this.B.commentMargin=t,this.p())}get alternateSetsPortSpot(){return this.B.setsPortSpot}set alternateSetsPortSpot(t){this.B.setsPortSpot!==t&&(e.s(t,"boolean",vi,"alternateSetsPortSpot"),this.B.setsPortSpot=t,this.p())}get alternatePortSpot(){return this.B.portSpot}set alternatePortSpot(t){this.B.portSpot.equals(t)||(this.B.portSpot=t,this.p())}get alternateSetsChildPortSpot(){return this.B.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.B.setsChildPortSpot!==t&&(e.s(t,"boolean",vi,"alternateSetsChildPortSpot"),this.B.setsChildPortSpot=t,this.p())}get alternateChildPortSpot(){return this.B.childPortSpot}set alternateChildPortSpot(t){this.B.childPortSpot.equals(t)||(this.B.childPortSpot=t,this.p())}static PathDefault=0;static PathDestination=1;static PathSource=2;static SortingForwards=10;static SortingReverse=11;static SortingAscending=12;static SortingDescending=13;static AlignmentCenterSubtrees=20;static AlignmentCenterChildren=21;static AlignmentStart=22;static AlignmentEnd=23;static AlignmentBus=24;static AlignmentBusBranching=25;static AlignmentTopLeftBus=26;static AlignmentBottomRightBus=27;static CompactionNone=30;static CompactionBlock=31;static StyleLayered=40;static StyleLastParents=41;static StyleAlternating=42;static StyleRootOnly=43;static ArrangementVertical=50;static ArrangementHorizontal=51;static ArrangementFixedRoots=52;static LayerIndividual=60;static LayerSiblings=61;static LayerUniform=62}class Pi extends Ae{constructor(t){super(t)}createVertex(){return new ki(this)}createEdge(){return new Si(this)}}class ki extends De{U;dt;at;mP;pP;yP;wP;xP;bP;kP;zi;Zg;Qg;Si;Mi;Xt;de;Fw;Rw;Ow;Us;Iw;Ew;Uw;Vw;Bw;zw;Xw;Gw;Yw;Kw;Hw;constructor(t){super(t),this.mP=!1,this.pP=null,this.yP=[],this.wP=0,this.xP=0,this.bP=0,this.kP=0,this.zi=null,this.U=new y(0,0),this.dt=new x(0,0),this.at=new y(0,0),this.Zg=null,this.Qg=null,this.Si=10,this.Mi=De.standardComparer,this.Xt=0,this.de=21,this.Fw=0,this.Rw=0,this.Ow=20,this.Us=50,this.Iw=0,this.Ew=31,this.Uw=0,this.Vw=25,this.Bw=10,this.zw=10,this.Xw=20,this.Gw=!0,this.Yw=v.Default,this.Kw=!0,this.Hw=v.Default}copyInheritedPropertiesFrom(t){null!==t&&(this.Si=t.sorting,this.Mi=t.comparer,this.Xt=t.angle,this.de=t.alignment,this.Fw=t.nodeIndent,this.Rw=t.nodeIndentPastParent,this.Ow=t.nodeSpacing,this.Us=t.layerSpacing,this.Iw=t.layerSpacingParentOverlap,this.Ew=t.compaction,this.Uw=t.breadthLimit,this.Vw=t.rowSpacing,this.Bw=t.rowIndent,this.zw=t.commentSpacing,this.Xw=t.commentMargin,this.Gw=t.setsPortSpot,this.Yw=t.portSpot,this.Kw=t.setsChildPortSpot,this.Hw=t.childPortSpot)}get initialized(){return this.mP}set initialized(t){this.mP!==t&&(e.s(t,"boolean",ki,"initialized"),this.mP=t)}get parent(){return this.pP}set parent(t){this.pP!==t&&(this.pP=t)}get children(){return this.yP}set children(t){if(this.yP!==t){if(null!==t&&!Array.isArray(t)&&e.si(t,"Array",ki,"children:value"),null!==t){const e=t.length;for(let i=0;i<e;i++){t[i]}}this.yP=t}}get level(){return this.wP}set level(t){this.wP!==t&&(e.s(t,"number",ki,"level"),this.wP=t)}get descendantCount(){return this.xP}set descendantCount(t){this.xP!==t&&(e.s(t,"number",ki,"descendantCount"),this.xP=t)}get maxChildrenCount(){return this.bP}set maxChildrenCount(t){this.bP!==t&&(e.s(t,"number",ki,"maxChildrenCount"),this.bP=t)}get maxGenerationCount(){return this.kP}set maxGenerationCount(t){this.kP!==t&&(e.s(t,"number",ki,"maxGenerationCount"),this.kP=t)}get comments(){return this.zi}set comments(t){if(this.zi!==t){if(null!==t&&!Array.isArray(t)&&e.si(t,"Array",ki,"comments:value"),null!==t){const e=t.length;for(let i=0;i<e;i++){t[i]}}this.zi=t}}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t)}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(e.S(t,ki,"comparer"),this.Mi=t)}get angle(){return this.Xt}set angle(t){this.Xt!==t&&(e.s(t,"number",ki,"angle"),this.Xt=t)}get alignment(){return this.de}set alignment(t){this.de!==t&&(this.de=t)}get nodeIndent(){return this.Fw}set nodeIndent(t){this.Fw!==t&&(e.s(t,"number",ki,"nodeIndent"),this.Fw=t)}get nodeIndentPastParent(){return this.Rw}set nodeIndentPastParent(t){this.Rw!==t&&(e.s(t,"number",ki,"nodeIndentPastParent"),this.Rw=t)}get nodeSpacing(){return this.Ow}set nodeSpacing(t){this.Ow!==t&&(e.s(t,"number",ki,"nodeSpacing"),this.Ow=t)}get layerSpacing(){return this.Us}set layerSpacing(t){this.Us!==t&&(e.s(t,"number",ki,"layerSpacing"),this.Us=t)}get layerSpacingParentOverlap(){return this.Iw}set layerSpacingParentOverlap(t){this.Iw!==t&&(e.s(t,"number",ki,"layerSpacingParentOverlap"),this.Iw=t)}get compaction(){return this.Ew}set compaction(t){this.Ew!==t&&(this.Ew=t)}get breadthLimit(){return this.Uw}set breadthLimit(t){this.Uw!==t&&(e.s(t,"number",ki,"breadthLimit"),this.Uw=t)}get rowSpacing(){return this.Vw}set rowSpacing(t){this.Vw!==t&&(e.s(t,"number",ki,"rowSpacing"),this.Vw=t)}get rowIndent(){return this.Bw}set rowIndent(t){this.Bw!==t&&(e.s(t,"number",ki,"rowIndent"),this.Bw=t)}get commentSpacing(){return this.zw}set commentSpacing(t){this.zw!==t&&(e.s(t,"number",ki,"commentSpacing"),this.zw=t)}get commentMargin(){return this.Xw}set commentMargin(t){this.Xw!==t&&(e.s(t,"number",ki,"commentMargin"),this.Xw=t)}get setsPortSpot(){return this.Gw}set setsPortSpot(t){this.Gw!==t&&(e.s(t,"boolean",ki,"setsPortSpot"),this.Gw=t)}get portSpot(){return this.Yw}set portSpot(t){this.Yw.equals(t)||(this.Yw=t)}get setsChildPortSpot(){return this.Kw}set setsChildPortSpot(t){this.Kw!==t&&(e.s(t,"boolean",ki,"setsChildPortSpot"),this.Kw=t)}get childPortSpot(){return this.Hw}set childPortSpot(t){this.Hw.equals(t)||(this.Hw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.U}set relativePosition(t){this.U.set(t)}get subtreeSize(){return this.dt}set subtreeSize(t){this.dt.set(t)}get subtreeOffset(){return this.at}set subtreeOffset(t){this.at.set(t)}}class Si extends Fe{PP;constructor(t){super(t),this.PP=new y(0,0)}commit(){const t=this.link;if(null===t||t.isAvoiding)return;const i=this.network.layout;let s=null,n=null;switch(i.ws){case 1:s=this.fromVertex,n=this.toVertex;break;case 2:s=this.toVertex,n=this.fromVertex;break;default:e.o("Unhandled path value "+i.ws.toString())}if(null===s||null===n)return;const o=this.PP;if(0===o.x&&0===o.y)return void this.PU(s,n);const r=s.bounds,a=i.orthoAngle(s),h=i.computeLayerSpacing(s),l=s.rowSpacing;t.updateRoute();const u=9===t.curve,c=t.isOrthogonal;let d,g,f=0;if(t.startRoute(),c||u){for(f=2;t.pointsCount>4;)t.removePoint(2);d=t.getPoint(1),g=t.getPoint(2)}else{for(f=1;t.pointsCount>3;)t.removePoint(1);d=t.getPoint(0),g=t.getPoint(t.pointsCount-1)}const m=t.getPoint(t.pointsCount-1);let p=0;0===a?(23===s.alignment?(p=r.bottom+o.y,0===o.y&&d.y>m.y+s.rowIndent&&(p=Math.min(p,Math.max(d.y,p-i.computeNodeIndent(s))))):22===s.alignment?(p=r.top+o.y,0===o.y&&d.y<m.y-s.rowIndent&&(p=Math.max(p,Math.min(d.y,p+i.computeNodeIndent(s))))):p=r.y+r.height/2+o.y,u?(t.insertPointAt(f,d.x,p),f++,t.insertPointAt(f,r.right+h,p),f++,t.insertPointAt(f,r.right+h+(o.x-l)/3,p),f++,t.insertPointAt(f,r.right+h+2*(o.x-l)/3,p),f++,t.insertPointAt(f,r.right+h+(o.x-l),p),f++,t.insertPointAt(f,g.x,p),f++):(c&&(t.insertPointAt(f,r.right+h/2,d.y),f++),t.insertPointAt(f,r.right+h/2,p),f++,t.insertPointAt(f,r.right+h+o.x-(c?l/2:l),p),f++,c&&(t.insertPointAt(f,t.getPoint(f-1).x,g.y),f++))):90===a?(23===s.alignment?(p=r.right+o.x,0===o.x&&d.x>m.x+s.rowIndent&&(p=Math.min(p,Math.max(d.x,p-i.computeNodeIndent(s))))):22===s.alignment?(p=r.left+o.x,0===o.x&&d.x<m.x-s.rowIndent&&(p=Math.max(p,Math.min(d.x,p+i.computeNodeIndent(s))))):p=r.x+r.width/2+o.x,u?(t.insertPointAt(f,p,d.y),f++,t.insertPointAt(f,p,r.bottom+h),f++,t.insertPointAt(f,p,r.bottom+h+(o.y-l)/3),f++,t.insertPointAt(f,p,r.bottom+h+2*(o.y-l)/3),f++,t.insertPointAt(f,p,r.bottom+h+(o.y-l)),f++,t.insertPointAt(f,p,g.y),f++):(c&&(t.insertPointAt(f,d.x,r.bottom+h/2),f++),t.insertPointAt(f,p,r.bottom+h/2),f++,t.insertPointAt(f,p,r.bottom+h+o.y-(c?l/2:l)),f++,c&&(t.insertPointAt(f,g.x,t.getPoint(f-1).y),f++))):180===a?(23===s.alignment?(p=r.bottom+o.y,0===o.y&&d.y>m.y+s.rowIndent&&(p=Math.min(p,Math.max(d.y,p-i.computeNodeIndent(s))))):22===s.alignment?(p=r.top+o.y,0===o.y&&d.y<m.y-s.rowIndent&&(p=Math.max(p,Math.min(d.y,p+i.computeNodeIndent(s))))):p=r.y+r.height/2+o.y,u?(t.insertPointAt(f,d.x,p),f++,t.insertPointAt(f,r.left-h,p),f++,t.insertPointAt(f,r.left-h+(o.x+l)/3,p),f++,t.insertPointAt(f,r.left-h+2*(o.x+l)/3,p),f++,t.insertPointAt(f,r.left-h+(o.x+l),p),f++,t.insertPointAt(f,g.x,p),f++):(c&&(t.insertPointAt(f,r.left-h/2,d.y),f++),t.insertPointAt(f,r.left-h/2,p),f++,t.insertPointAt(f,r.left-h+o.x+(c?l/2:l),p),f++,c&&(t.insertPointAt(f,t.getPoint(f-1).x,g.y),f++))):270===a?(23===s.alignment?(p=r.right+o.x,0===o.x&&d.x>m.x+s.rowIndent&&(p=Math.min(p,Math.max(d.x,p-i.computeNodeIndent(s))))):22===s.alignment?(p=r.left+o.x,0===o.x&&d.x<m.x-s.rowIndent&&(p=Math.max(p,Math.min(d.x,p+i.computeNodeIndent(s))))):p=r.x+r.width/2+o.x,u?(t.insertPointAt(f,p,d.y),f++,t.insertPointAt(f,p,r.top-h),f++,t.insertPointAt(f,p,r.top-h+(o.y+l)/3),f++,t.insertPointAt(f,p,r.top-h+2*(o.y+l)/3),f++,t.insertPointAt(f,p,r.top-h+(o.y+l)),f++,t.insertPointAt(f,p,g.y),f++):(c&&(t.insertPointAt(f,d.x,r.top-h/2),f++),t.insertPointAt(f,p,r.top-h/2),f++,t.insertPointAt(f,p,r.top-h+o.y+(c?l/2:l)),f++,c&&(t.insertPointAt(f,g.x,t.getPoint(f-1).y),f++))):e.o("Invalid angle "+a),t.commitRoute()}PU(t,e){const i=this.link;if(null===i)return;const s=this.network.layout,n=s.orthoAngle(t);if(n===s.orthoAngle(e))return;const o=s.computeLayerSpacing(t),r=t.bounds,a=e.bounds;if(0===n&&a.left-r.right<o+1||90===n&&a.top-r.bottom<o+1||180===n&&r.left-a.right<o+1||270===n&&r.top-a.bottom<o+1)return;i.updateRoute();const h=9===i.curve,l=i.isOrthogonal,u=this.fromVertex,c=s.isBusAlignment(u.alignment);if(i.startRoute(),0===n){const t=r.right+o/2;if(h){if(4===i.pointsCount){const e=i.getPoint(3).y;i.setPointAt(1,t-20,i.getPoint(1).y),i.insertPointAt(2,t-20,e),i.insertPointAt(3,t,e),i.insertPointAt(4,t+20,e),i.setPointAt(5,i.getPoint(5).x,e)}}else l?c?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,t,i.getPoint(2).y),i.setPointAt(3,t,i.getPoint(3).y)):4===i.pointsCount?i.insertPointAt(2,t,i.getPoint(2).y):3===i.pointsCount?i.setPointAt(1,t,i.getPoint(2).y):2===i.pointsCount&&i.insertPointAt(1,t,i.getPoint(1).y)}else if(90===n){const t=r.bottom+o/2;if(h){if(4===i.pointsCount){const e=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,t-20),i.insertPointAt(2,e,t-20),i.insertPointAt(3,e,t),i.insertPointAt(4,e,t+20),i.setPointAt(5,e,i.getPoint(5).y)}}else l?c?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,i.getPoint(2).x,t),i.setPointAt(3,i.getPoint(3).x,t)):4===i.pointsCount?i.insertPointAt(2,i.getPoint(2).x,t):3===i.pointsCount?i.setPointAt(1,i.getPoint(2).x,t):2===i.pointsCount&&i.insertPointAt(1,i.getPoint(1).x,t)}else if(180===n){const t=r.left-o/2;if(h){if(4===i.pointsCount){const e=i.getPoint(3).y;i.setPointAt(1,t+20,i.getPoint(1).y),i.insertPointAt(2,t+20,e),i.insertPointAt(3,t,e),i.insertPointAt(4,t-20,e),i.setPointAt(5,i.getPoint(5).x,e)}}else l?c?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,t,i.getPoint(2).y),i.setPointAt(3,t,i.getPoint(3).y)):4===i.pointsCount?i.insertPointAt(2,t,i.getPoint(2).y):3===i.pointsCount?i.setPointAt(1,t,i.getPoint(2).y):2===i.pointsCount&&i.insertPointAt(1,t,i.getPoint(1).y)}else if(270===n){const t=r.top-o/2;if(h){if(4===i.pointsCount){const e=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,t+20),i.insertPointAt(2,e,t+20),i.insertPointAt(3,e,t),i.insertPointAt(4,e,t-20),i.setPointAt(5,e,i.getPoint(5).y)}}else l?c?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):6===i.pointsCount&&(i.setPointAt(2,i.getPoint(2).x,t),i.setPointAt(3,i.getPoint(3).x,t)):4===i.pointsCount?i.insertPointAt(2,i.getPoint(2).x,t):3===i.pointsCount?i.setPointAt(1,i.getPoint(2).x,t):2===i.pointsCount&&i.insertPointAt(1,i.getPoint(1).x,t)}i.commitRoute()}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(this.is=t)}get toVertex(){return this.ss}set toVertex(t){this.ss!==t&&(this.ss=t)}get relativePoint(){return this.PP}set relativePoint(t){this.PP.set(t)}}class Mi{constructor(){}static Light={colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new b(5)},arrowheads:{toArrow:"Standard"}};static Dark={colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new b(5)},arrowheads:{toArrow:"Standard"}}}class Ci{hs=new Set;xu=new p;SP="light";MP="light";NP=!1;CL=!0;_g="light";BF=t=>{const e=t.matches?"dark":"light";e!==this._g&&(this._g=e,"system"===this.MP&&this.updateDiagrams())};constructor(e){e&&Object.assign(this,e),e?.themeMap||(this.xu.set("light",{colors:{...Mi.Light.colors},fonts:{...Mi.Light.fonts},numbers:{...Mi.Light.numbers},margins:{...Mi.Light.margins},arrowheads:{...Mi.Light.arrowheads}}),this.xu.set("dark",{colors:{...Mi.Dark.colors},fonts:{...Mi.Dark.fonts},numbers:{...Mi.Dark.numbers},margins:{...Mi.Dark.margins},arrowheads:{...Mi.Dark.arrowheads}})),t.matchMedia&&(this._g=t.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.xu}set themeMap(t){this.xu!==t&&(this.xu=t,this.updateDiagrams())}get defaultTheme(){return this.SP}set defaultTheme(t){this.SP!==t&&(e.s(t,"string",Ci,"defaultTheme"),this.SP=t,this.updateDiagrams())}get currentTheme(){return this.MP}set currentTheme(t){this.MP!==t&&(e.s(t,"string",Ci,"currentTheme"),this.MP=t,this.updateDiagrams())}get changesDivBackground(){return this.NP}set changesDivBackground(t){if(this.NP!==t&&(this.NP=t,t))for(const t of this.hs)t.setDivBackground(this.findValue("div","","fill")),t.T("ThemeChanged",this)}get readsCssVariables(){return this.CL}set readsCssVariables(t){this.CL!==t&&(this.CL=t,this.updateDiagrams())}get preferredColorScheme(){return this._g}addDiagram(t){return this.hs.add(t),this.LL(t),this}removeDiagram(t){return this.hs.delete(t),this.LL(t),this}eO(){0===this.hs.size&&t.matchMedia&&t.matchMedia("(prefers-color-scheme: dark)")?.addEventListener("change",this.BF)}iO(){0===this.hs.size&&t.matchMedia&&t.matchMedia("(prefers-color-scheme: dark)")?.removeEventListener("change",this.BF)}set(t,e){""===t&&(t=this.SP),"system"===t&&(t=this._g);let i=this.xu.get(t);return i=i?this.zF(i,e):e,this.xu.set(t,i),this.updateDiagrams(),this}findValue(t,e,i){return this.getValue(this.findTheme(this.currentTheme),t,e,i)||this.getValue(this.findTheme(this.defaultTheme),t,e,i)}getValue(t,e,i,s){if(!t)return;null==i&&(i="");let n=t;const o=t=>{if(void 0===n||""===t)return;if("number"==typeof t||!Array.isArray(t)&&!t.includes("."))return n[t];const e=Array.isArray(t)?t:t.split(".");for(let t=0;t<e.length;t++){const i=e[t];if(""!==i&&(n=n[i],void 0===n))return}return n},r=()=>{if(""===i||(n=o(i),void 0!==n))return n=Array.isArray(n)&&"number"==typeof e?n[e%n.length]:o(e),n};if(n=r(),void 0===n&&"string"==typeof s&&s.length>0){let e=t.targetPropertyMap?.get(s);if(e?n=t[e]:(e=Ci.SU.get(s),n=e?t[e]:t.colors),n=r(),void 0!==n)return n}return n}findTheme(t){return this.themeMap.get("system"===t?this._g:t)}updateDiagrams(){for(const t of this.hs)this.LL(t)}LL(t){const e=t.skipsUndoManager;t.skipsUndoManager=!0,t.updateAllThemeBindings(),this.NP&&t.setDivBackground(this.findValue("div","","fill")),t.skipsUndoManager=e,t.T("ThemeChanged",this)}zF(t,i){for(const s in i)if(e.qw(i,s))try{i[s]?.constructor===Object?t[s]=this.zF(t[s]??{},i[s]):t[s]=i[s]}catch{delete t[s]}return t}static SU=new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]])}class Ni{Pt;a;Be;Pl;constructor(){this.a=wt.Om(),this.Pt="",this.Be=!0,this.Pl=!0}get name(){return this.Pt}set name(t){this.Pt=t}get isEnabled(){return this.Be}set isEnabled(t){this.Be=t}get isRealtime(){return this.Pl}set isRealtime(t){this.Pl=t}get diagram(){return this.a}set diagram(t){this.a!==t&&(this.a=t,t.Fl=!0,t.requestUpdate())}invalidateRouter(){null!==this.a&&(this.a.Fl=!0,this.a.requestUpdate())}canRoute(t){if(!this.isEnabled)return!1;const e=this.diagram;return!(e&&(!this.isRealtime&&e.Ou||e.animationManager.isTicking))}isRoutable(t,e){return!0}routeLinks(t,e){}toString(){return""!==this.name?this.name+" Router":e.Kn(this.constructor)}}class Ti extends Ni{constructor(t){super(),this.name="AvoidsNodes",t&&Object.assign(this,t)}canRoute(t){return!!(t instanceof wt?t.lp:t.diagram?.lp)&&super.canRoute(t)}isRoutable(t,e){return!(!t.isAvoiding||t.containingGroup!==(e instanceof Ne?e:null)||null===t.toNode||null===t.fromNode||t.pointsCount<4)}routeLinks(t,e){const i=e instanceof wt?null:e,s=t.iterator,n=this.diagram.getPositions(!0,i,null);for(;s.next();){const t=s.value;if(!this.isRoutable(t,e))continue;t.startRoute();const i=t.pointsCount,o=t.getPoint(1),r=t.getPoint(i-2),a=t.fromNode.actualBounds.copy();a.inflate(be.Fa,be.Fa),a.unionPoint(t.getPoint(0));const h=t.toNode.actualBounds.copy();h.inflate(be.Fa,be.Fa),h.unionPoint(t.getPoint(i-1)),this.MU(t,a,h,n)&&this.NU(t,o,t.SC,r,t.MC,a,h,n),t.commitRoute()}}MU(t,e,i,s){const n=t.diagram,o=t.pointsCount;if(null===n||!t.fromNode||!t.toNode||t.fromNode===t.toNode||!t.layer||t.layer.isTemporary||e.containsPoint(t.getPoint(o-1))&&!t.toNode.isMemberOf(t.fromNode)||i.containsPoint(t.getPoint(0))&&!t.fromNode.isMemberOf(t.toNode)||!t.isOrthogonal)return!1;if(17===t.segmentIndex)return!0;const r=t.getPoint(1),a=t.getPoint(o-2),h=t.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,h.x),Math.min(r.y,h.y),Math.abs(r.x-h.x),Math.abs(r.y-h.y)))return!0;for(let e=2;e<o-3;e++){const i=t.getPoint(e),n=t.getPoint(e+1);if(!s.isUnoccupied(Math.min(i.x,n.x),Math.min(i.y,n.y),Math.abs(i.x-n.x),Math.abs(i.y-n.y)))return!0}const l=t.getPoint(o-3);return!s.isUnoccupied(Math.min(l.x,a.x),Math.min(l.y,a.y),Math.abs(l.x-a.x),Math.abs(l.y-a.y))}NU(t,e,i,s,n,o,r,a){const h=t.diagram;if(null===h)return;const l=e,u=s;let c=y.gn,d=y.gn;if(h.isVirtualized){const o=a.bounds.copy(),r=t.getPoint(2),h=t.getPoint(t.pointsCount-3);o.inflate(-a.cellWidth,-a.cellHeight);const l=y.l();a.ng(e.x,e.y)||(k.Cl(o.x,o.y,o.x+o.width,o.y+o.height,e.x,e.y,r.x,r.y,l)?(c=e=l.copy(),i=l.directionPoint(r)):k.Cl(o.x,o.y,o.x+o.width,o.y+o.height,r.x,r.y,h.x,h.y,l)?(c=e=l.copy(),i=l.directionPoint(h)):k.Cl(o.x,o.y,o.x+o.width,o.y+o.height,h.x,h.y,s.x,s.y,l)&&(c=e=l.copy(),i=l.directionPoint(s))),a.ng(s.x,s.y)||(k.Cl(o.x,o.y,o.x+o.width,o.y+o.height,s.x,s.y,h.x,h.y,l)?(d=s=l.copy(),n=h.directionPoint(l)):k.Cl(o.x,o.y,o.x+o.width,o.y+o.height,h.x,h.y,r.x,r.y,l)?(d=s=l.copy(),n=r.directionPoint(l)):k.Cl(o.x,o.y,o.x+o.width,o.y+o.height,r.x,r.y,e.x,e.y,l)&&(d=s=l.copy(),n=e.directionPoint(l))),y.i(l)}const g=o.copy().unionRect(r);g.inflate(a.cellWidth*a.af,a.cellHeight*a.af),a.wv(e,i,s,n,g,!0);let f=a.xo(s.x,s.y);if(!a.tw&&f>=Pe.sg&&(a.vT(),g.inflate(a.cellWidth*a.U2,a.cellHeight*a.V2),a.wv(e,i,s,n,g,!1),f=a.xo(s.x,s.y)),!a.tw&&f<Pe.sg&&!a.GE(s.x,s.y)){t.points.removeRange(2,t.pointsCount-3),this.AL(t,a,s.x,s.y,n,!0);const o=0,r=90,h=180,g=270,f=t.getPoint(2);if(t.pointsCount<4)i===o||i===h?(f.x=e.x,f.y=s.y):(f.x=s.x,f.y=e.y),t.setPointAt(2,f.x,f.y),t.insertPointAt(3,f.x,f.y);else{const s=t.getPoint(3);if(i===o||i===h)if(k.c(f.x,s.x)){const n=i===o?Math.max(f.x,e.x):Math.min(f.x,e.x);t.setPointAt(2,n,e.y),t.setPointAt(3,n,s.y)}else k.c(f.y,s.y)?(Math.abs(e.y-f.y)<=a.cellHeight/2&&(t.setPointAt(2,f.x,e.y),t.setPointAt(3,s.x,e.y)),t.insertPointAt(2,f.x,e.y)):t.setPointAt(2,e.x,f.y);else if(i===r||i===g)if(k.c(f.y,s.y)){const n=i===r?Math.max(f.y,e.y):Math.min(f.y,e.y);t.setPointAt(2,e.x,n),t.setPointAt(3,s.x,n)}else k.c(f.x,s.x)?(Math.abs(e.x-f.x)<=a.cellWidth/2&&(t.setPointAt(2,e.x,f.y),t.setPointAt(3,e.x,s.y)),t.insertPointAt(2,e.x,f.y)):t.setPointAt(2,f.x,e.y)}if(c.isReal()){const e=t.getPoint(1),s=t.getPoint(2);e.x!==s.x&&e.y!==s.y?i===o||i===h?t.insertPointAt(2,e.x,s.y):t.insertPointAt(2,s.x,e.y):i===o||i===h?t.insertPointAt(2,l.x,c.y):t.insertPointAt(2,c.x,l.y)}d.isReal()&&(n===o||n===h?t.insertPointAt(t.pointsCount-2,u.x,d.y):t.insertPointAt(t.pointsCount-2,d.x,u.y))}}AL(t,e,i,s,n,o){const r=e.cellWidth,a=e.cellHeight;let h=e.xo(i,s),l=i,u=s,c=l,d=u;for(0===n?c+=r:90===n?d+=a:180===n?c-=r:d-=a,t.vC&&h>Pe.sc&&e.xo(c,d)!==h-1&&(e.xo(l-r,u)===h-1?(n=180,c=l-r,d=u):e.xo(l+r,u)===h-1?(n=0,c=l+r,d=u):e.xo(l,u-a)===h-1?(n=270,c=l,d=u-a):e.xo(l,u+a)===h-1&&(n=90,c=l,d=u+a));h>Pe.sc&&e.xo(c,d)===h-1;)l=c,u=d,0===n?c+=r:90===n?d+=a:180===n?c-=r:d-=a,h-=1;if(o?h>Pe.sc&&(180===n||0===n?l=Math.floor(l/r)*r+r/2:(90===n||270===n)&&(u=Math.floor(u/a)*a+a/2)):(l=Math.floor(l/r)*r+r/2,u=Math.floor(u/a)*a+a/2),h>Pe.sc){let i=n,s=l,o=u;if(0===n?(i=90,o+=a):90===n?(i=180,s-=r):180===n?(i=270,o-=a):270===n&&(i=0,s+=r),e.xo(s,o)===h-1)this.AL(t,e,s,o,i,!1);else{let s=l,o=u;0===n?(i=270,o-=a):90===n?(i=0,s+=r):180===n?(i=90,o+=a):270===n&&(i=180,s-=r),e.xo(s,o)===h-1&&this.AL(t,e,s,o,i,!1)}}t.insertPointAt(t.pointsCount-2,l,u)}}X.prototype.initializeStandardTools=function(){return this.Jt("Action",new $,this.mouseDownTools),this.Jt("Relinking",new Y,this.mouseDownTools),this.Jt("LinkReshaping",new H,this.mouseDownTools),this.Jt("Rotating",new _,this.mouseDownTools),this.Jt("Resizing",new W,this.mouseDownTools),this.Jt("Linking",new K,this.mouseMoveTools),this.Jt("Dragging",new U,this.mouseMoveTools),this.Jt("DragSelecting",new Q,this.mouseMoveTools),this.Jt("Panning",new tt,this.mouseMoveTools),this.Jt("ContextMenu",new st,this.mouseUpTools),this.Jt("TextEditing",new at,this.mouseUpTools),this.Jt("ClickCreating",new Z,this.mouseUpTools),this.Jt("ClickSelecting",new J,this.mouseUpTools),this},wt.m2("GraphLinksModel",class extends Ie{v2(){const t=this.diagram.model;this.nw(t.nodeDataArray),this.Ov(t.linkDataArray)}nw(t){super.nw(t,!1);const e=this.links.iterator;for(;e.next();)e.value.Wd();this.diagram.c1(!1)}Ov(t){t.forEach((t=>{this.Iv(t)})),this.diagram.c1(!1)}Iv(t){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.findLinkForData(t))return null;const e=this.getLinkCategoryForData(t),i=this.findLinkTemplateForCategory(e);if(null!==i){i.It();const s=i.copy();if(null!==s){const i=this.diagram.wi;this.diagram.wi=!0,s.Qo=e,s.te=t;const n=this.diagram.model,o=n.Ak(t,!0);""!==o&&(s.fromPortId=o);const r=n.Vi(t,!0);if(void 0!==r){const t=this.findNodeForKey(r);t instanceof me&&(s.fromNode=t)}const a=n.Ak(t,!1);""!==a&&(s.toPortId=a);const h=n.Vi(t,!1);if(void 0!==h){const t=this.findNodeForKey(h);t instanceof me&&(s.toNode=t)}const l=n.getLabelKeysForLinkData(t);return Array.isArray(l)&&l.forEach((t=>{const e=this.findNodeForKey(t);null!==e&&(e.labeledLink=s)})),this.addsToTemporaryLayer&&(s.ul="Tool"),this.diagram.add(s),s.te=null,s.data=t,this.diagram.wi=i,s}}return null}Nv(){const t=this.diagram.model;this.Ev(t.linkDataArray),this.GC(t.nodeDataArray)}Ev(t){t.forEach((t=>{this.Ck(t)}))}getLinkCategoryForData(t){return this.diagram.model.getCategoryForLinkData(t)}setLinkCategoryForData(t,e){return this.diagram.model.setCategoryForLinkData(t,e)}setFromNodeForLink(t,e,i){const s=this.diagram.model,n=null!==e?e.data:null;s.setFromKeyForLinkData(t.data,s.getKeyForNodeData(n))}setToNodeForLink(t,e,i){const s=this.diagram.model,n=null!==e?e.data:null;s.setToKeyForLinkData(t.data,s.getKeyForNodeData(n))}TC(t){this.diagram.model.removeLinkData(t.data)}findPartForKey(t){const e=super.findPartForKey(t);if(null===e){const e=this.diagram.model.findLinkDataForKey(t);if(null!==e)return this.findLinkForData(e)}return e}findLinkForKey(t){if(null==t)return null;const e=this.diagram.model.findLinkDataForKey(t);return null!==e?this.findLinkForData(e):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const i=this.diagram;if(t.model!==i.model)return;const s=t.change;if(i.G){i.G=!1;try{const n=t.modelChange;if(""!==n){if(2===s){if("linkFromKey"===n){const e=t.object,i=this.findLinkForData(e);if(null!==i){const e=t.newValue,s=this.findNodeForKey(e);i.fromNode=s}}else if("linkToKey"===n){const e=t.object,i=this.findLinkForData(e);if(null!==i){const e=t.newValue,s=this.findNodeForKey(e);i.toNode=s}}else if("linkFromPortId"===n){const e=t.object,i=this.findLinkForData(e);if(null!==i){const e=t.newValue;"string"==typeof e&&(i.fromPortId=e)}}else if("linkToPortId"===n){const e=t.object,i=this.findLinkForData(e);if(null!==i){const e=t.newValue;"string"==typeof e&&(i.toPortId=e)}}else if("nodeGroupKey"===n){const e=t.object,i=this.findPartForData(e);if(null!==i){const e=t.newValue;if(void 0!==e){const t=this.findNodeForKey(e);i.containingGroup=t instanceof Ne?t:null}else i.containingGroup=null}}else if("linkLabelKeys"===n){const e=t.object,i=this.findLinkForData(e);if(null!==i){const e=t.oldValue,s=t.newValue;Array.isArray(e)&&e.forEach((t=>{if(s.indexOf(t)>=0)return;const e=this.findNodeForKey(t);null!==e&&(e.labeledLink=null)})),Array.isArray(s)&&s.forEach((t=>{const e=this.findNodeForKey(t);null!==e&&(e.labeledLink=i)}))}}else if("linkCategory"===n){const e=t.object,i=this.findLinkForData(e),s=t.newValue;null!==i&&"string"==typeof s&&(i.category=s)}else if("linkDataArray"===n){const e=t.oldValue;this.Ev(e);const i=t.newValue;this.Ov(i)}i.isModified=!0}else if(3===s){const s=t.newValue;if("linkDataArray"===n&&e.$(s))this.Iv(s);else if("linkLabelKeys"===n&&t.model.isKeyType(s)){const e=t.object,i=this.findLinkForData(e),n=this.findNodeForKey(s);null!==i&&null!==n&&(n.labeledLink=i)}i.isModified=!0}else if(4===s){const s=t.oldValue;if("linkDataArray"===n&&e.$(s))this.Ck(s);else if("linkLabelKeys"===n&&t.model.isKeyType(s)){const t=this.findNodeForKey(s);null!==t&&(t.labeledLink=null)}i.isModified=!0}}else if(2===s){const e=t.propertyName,s=t.object;s===i.model&&("linkFromKeyProperty"===e||"linkToKeyProperty"===e||"linkFromPortIdProperty"===e||"linkToPortIdProperty"===e||"linkLabelKeysProperty"===e||"nodeIsGroupProperty"===e||"nodeGroupKeyProperty"===e||"linkCategoryProperty"===e)&&(i.undoManager.isUndoingRedoing||this.rebuildParts()),i.isModified=!0}}finally{i.G=!0}}}Rv(){const t=this.diagram.model,e=new Set,i=t.linkDataArray;i.forEach((t=>{e.add(t)}));const s=[];this.links.each((t=>{null!==t.data&&!e.has(t.data)&&s.push(t.data)})),s.forEach((e=>{t.Uv(e,!1)})),i.forEach((e=>{null===this.findLinkForData(e)&&t.Vv(e,!1)}))}updateRelationshipsFromData(t){const e=t.data;if(null===e)return;const i=t.diagram;if(null===i)return;const s=i.model;if(t instanceof be){let n=s.Vi(e,!0),o=i.findNodeForKey(n);t.fromNode=o,n=s.Vi(e,!1),o=i.findNodeForKey(n),t.toNode=o;const r=s.getLabelKeysForLinkData(e);if(r.length>0||t.labelNodes.count>0){if(1===r.length&&1===t.labelNodes.count){const e=r[0],i=t.labelNodes.first();if(null!==i&&s.getKeyForNodeData(i.data)===e)return}const e=(new u).addAll(r),n=new u;t.labelNodes.each((t=>{if(null!==t.data){const e=s.getKeyForNodeData(t.data);void 0!==e&&n.add(e)}}));const o=n.copy();o.removeAll(e);const a=e.copy();if(a.removeAll(n),o.count>0||a.count>0){const e=t;o.each((t=>{const s=i.findNodeForKey(t);null!==s&&s.labeledLink===e&&(s.labeledLink=null)})),a.each((t=>{const s=i.findNodeForKey(t);null!==s&&s.labeledLink!==e&&(s.labeledLink=e)}))}}}else if(!(t instanceof ge)){const n=s.getGroupKeyForNodeData(e),o=i.findPartForKey(n);(null===o||o instanceof Ne)&&(t.containingGroup=o)}}Nk(t){const e=this.diagram.model,i=e.getKeyForNodeData(t);if(void 0!==i){const s=e.lw(i),n=this.findPartForData(t);if(null!==s&&null!==n){const t=s.iterator;for(;t.next();){const s=t.value;if(e.containsNodeData(s)){if(n instanceof Ne&&e.getGroupKeyForNodeData(s)===i){const t=this.findPartForData(s);null!==t&&(t.containingGroup=n)}}else{const t=this.findLinkForData(s);if(null!==t&&n instanceof me){e.Vi(s,!0)===i&&(t.fromNode=n),e.Vi(s,!1)===i&&(t.toNode=n);const o=e.getLabelKeysForLinkData(s);Array.isArray(o)&&o.some((e=>e===i&&(n.labeledLink=t,!0)))}}}e.ln(i)}const o=e.getGroupKeyForNodeData(t);if(void 0!==o){const t=this.findNodeForKey(o);null!==n&&t instanceof Ne&&(n.containingGroup=t)}}}YC(t){const e=this.diagram.model;if(t instanceof me){const i=e.getKeyForNodeData(t.data);if(void 0!==i){const s=t.linksConnected;for(;s.next();){const t=s.value;e.an(i,t.data)}if(t.isLinkLabel){const s=t.labeledLink;null!==s&&e.an(i,s.data)}if(t instanceof Ne){const s=t.memberParts;for(;s.next();){const t=s.value.data;e.containsNodeData(t)&&e.an(i,t)}}}}}qC(t,e){let i=super.qC(t,e);if(t instanceof be){const s=t.data;if(null!==s&&null!==e){const t=e.model,n=t.copyLinkData(s);t.addLinkData(n),i=e.findLinkForData(n)}else if(null!==i){const t=this.diagram;if(null!==s&&null!==t&&null!==t.commandHandler&&t.commandHandler.copiesClipboardData){const e=t.model.copyLinkData(s);i.data=e}}}return i}insertLink(t,i,s,n){const o=this.diagram,r=o.model,a=o.toolManager.findTool("Linking");let h="";null!==t&&(null===i&&(i=t),h=i.portId,null===h&&(h=""));let l="";null!==s&&(null===n&&(n=s),l=n.portId,null===l&&(l=""));const u=a.archetypeLinkData;if(u instanceof be){u.It();const e=u.copy();if(null!==e){e.fromNode=t,e.fromPortId=h,e.toNode=s,e.toPortId=l,o.add(e);const i=a.archetypeLabelNodeData;if(i instanceof me){i.It();const t=i.copy();null!==t&&(t.labeledLink=e,o.add(t))}return e}}else if(null!==u){const i=r.copyLinkData(u);if(e.$(i)){null!==t&&r.xg(i,r.getKeyForNodeData(t.data),!0),r.bg(i,h,!0),null!==s&&r.xg(i,r.getKeyForNodeData(s.data),!1),r.bg(i,l,!1),r.addLinkData(i);const e=a.archetypeLabelNodeData;if(null!==e&&!(e instanceof me)){const t=r.copyNodeData(e);r.addNodeData(t);const s=r.getKeyForNodeData(t);void 0!==s&&r.addLabelKeyForLinkData(i,s)}return o.findLinkForData(i)}}return null}}),wt.m2("TreeModel",class extends Ie{Ua=null;Tk(t,e){if(null===t||null===e||null!==e.findTreeParentLink())return;const i=this.diagram.toolManager.findTool("Linking");let s=t,n=e;if(this.diagram.isTreePathToChildren){if(null!==i&&i.Uu(s,n,null,!0))return}else if(s=e,n=t,null!==i&&i.Uu(s,n,null,!0))return;const o=this.getLinkCategoryForData(e.data),r=this.findLinkTemplateForCategory(o);if(null!==r){r.It();const t=r.copy();if(null!==t){const i=this.diagram.wi;this.diagram.wi=!0,t.Qo=o,t.te=e.data,t.fromNode=s,t.toNode=n,this.diagram.add(t),t.te=null,t.data=e.data,this.diagram.wi=i}}}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,e){this.diagram.model.setParentLinkCategoryForNodeData(t,e)}setFromNodeForLink(t,e,i){const s=this.diagram.model;void 0===i&&(i=null);const n=null!==e?e.data:null;if(this.diagram.isTreePathToChildren)s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n));else{const e=this.Ua;this.Ua=t,null!==i&&s.setParentKeyForNodeData(i.data,void 0);const o=null!==t.toNode?t.toNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(o)),this.Ua=e}}setToNodeForLink(t,e,i){const s=this.diagram.model;void 0===i&&(i=null);const n=null!==e?e.data:null;if(this.diagram.isTreePathToChildren){const e=this.Ua;this.Ua=t,null!==i&&s.setParentKeyForNodeData(i.data,void 0);const o=null!==t.fromNode?t.fromNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(o)),this.Ua=e}else s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n))}TC(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(null==t)return null;const e=this.diagram.model.findNodeDataForKey(t);return null!==e?this.findLinkForData(e):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const e=this.diagram;if(t.model!==e.model)return;const i=t.change;if(e.G){e.G=!1;try{const s=t.modelChange;if(""!==s){if(2===i){if("nodeParentKey"===s){const i=t.object,s=i?this.findNodeForData(i):null,n=t.newValue,o=this.findNodeForKey(n);if(i&&null!==this.Ua)null!==o&&(this.Ua.data=i,this.Ua.category=this.getLinkCategoryForData(i));else if(null!==s){const t=s.findTreeParentLink();null!==t?null===o?e.remove(t):e.isTreePathToChildren?t.fromNode=o:t.toNode=o:this.Tk(o,s)}}else if("parentLinkCategory"===s){const e=t.object,i=e?this.findNodeForData(e):null,s=t.newValue;if(null!==i&&"string"==typeof s){const t=i.findTreeParentLink();null!==t&&(t.category=s)}}e.isModified=!0}}else 2===i&&(t.object===e.model&&"nodeParentKeyProperty"===t.propertyName&&(e.undoManager.isUndoingRedoing||this.rebuildParts()),e.isModified=!0)}finally{e.G=!0}}}updateRelationshipsFromData(t){const e=t.data;if(null===e)return;const i=t.diagram;if(null===i)return;const s=i.model;if(t instanceof me){const n=s.getParentKeyForNodeData(e),o=i.findNodeForKey(n);if(o!==t.findTreeParentNode()){const e=t.findTreeParentLink();null!==o?null!==e?i.isTreePathToChildren?e.fromNode=o:e.toNode=o:this.Tk(o,t):null!==e&&i.A2(e,!1)}}}ow(t,e){if(super.ow(t,e),"string"==typeof e&&null!==this.findPartForData(t)){const i=this.findLinkForData(t);null!==i&&i.updateTargetBindings(e)}}Nk(t){const e=this.diagram.model,i=e.getKeyForNodeData(t);if(void 0!==i){const s=e.lw(i),n=this.findPartForData(t);if(null!==s&&null!==n){const t=s.iterator;for(;t.next();){const s=t.value;if(e.containsNodeData(s)&&n instanceof me&&e.getParentKeyForNodeData(s)===i){const t=this.findNodeForData(s);this.Tk(n,t)}}e.ln(i)}const o=e.getParentKeyForNodeData(t);if(void 0!==o&&n instanceof me){const t=this.findNodeForKey(o);this.Tk(t,n)}}}YC(t){const e=this.diagram.model;if(t instanceof me){const i=e.getKeyForNodeData(t.data),s=this.findLinkForData(t.data);if(null!==s){s.isSelected=!1,s.isHighlighted=!1;const t=s.layer;if(null!==t){const e=t.ri(-1,s,!1);e>=0&&this.diagram.raiseChangedEvent(4,"parts",t,s,null,e,null);const i=s.layerChanged;null!==i&&i(s,t,null)}}const n=this.diagram.isTreePathToChildren,o=t.linksConnected;for(;o.next();){const t=o.value,s=n?t.toNode:t.fromNode;if(null!==s){const t=s.data;e.containsNodeData(t)&&e.an(i,t)}}}}insertLink(t,e,i,s){const n=this.diagram.model;let o=t,r=i;if(this.diagram.isTreePathToChildren||(o=i,r=t),null!==o&&null!==r){const t=o.data,e=r.data;return n.setParentKeyForNodeData(e,n.getKeyForNodeData(t)),r.findTreeParentLink()}return null}});const Li=t.go,Ai={get version(){return wt.version},Group:Ne,List:h,Set:u,Map:p,Point:y,Size:x,Rect:w,Margin:b,Spot:v,Geometry:N,PathFigure:T,PathSegment:A,InputEvent:D,DiagramEvent:F,ChangedEvent:R,Model:Ue,GraphLinksModel:je,TreeModel:Ge,Binding:ze,ThemeBinding:Xe,Transaction:B,UndoManager:E,CommandHandler:Ct,Tool:I,DraggingTool:U,DraggingInfo:vt,DraggingOptions:kt,LinkingBaseTool:j,LinkingTool:K,RelinkingTool:Y,LinkReshapingTool:H,ResizingTool:W,RotatingTool:_,ClickSelectingTool:J,ActionTool:$,ClickCreatingTool:Z,HTMLInfo:et,ContextMenuTool:st,DragSelectingTool:Q,PanningTool:tt,TextEditingTool:at,ToolManager:X,Animation:ut,AnimationManager:lt,AnimationTrigger:gt,Layer:ft,Diagram:wt,Palette:class extends wt{constructor(i,s){let n;return void 0===i||"string"==typeof i||t.Element&&i instanceof Element?n=i:e.$(i)&&(s=i),super(n),this.VT(),s&&this.setProperties(s),this}VT(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=v.TopCenter,this.layout=new Ee}setupRouters(){}reset(){super.reset(),this.VT()}},Overview:St,Brush:Ut,GraphObject:At,Panel:Yt,RowColumnDefinition:Jt,Shape:$t,TextBlock:ie,Picture:re,Part:ce,Adornment:ge,Node:me,Link:be,Placeholder:Te,Layout:Le,LayoutNetwork:Ae,LayoutVertex:De,LayoutEdge:Fe,GridLayout:Ee,PanelLayout:jt,CircularLayout:We,CircularNetwork:Je,CircularVertex:$e,CircularEdge:Ze,ForceDirectedLayout:Qe,ForceDirectedNetwork:ti,ForceDirectedVertex:ei,ForceDirectedEdge:ii,LayeredDigraphLayout:ui,LayeredDigraphNetwork:ci,LayeredDigraphVertex:di,LayeredDigraphEdge:gi,TreeLayout:vi,TreeNetwork:Pi,TreeVertex:ki,TreeEdge:Si,Themes:Mi,ThemeManager:Ci,Router:Ni,AnimationStyle:ht,AutoScale:mt,CycleMode:pt,Flip:Lt,TextFormat:ee,ImageStretch:oe,LayoutConditions:ue,LinkAdjusting:ye,Curve:we,Routing:xe,Orientation:Tt,TextOverflow:te,PortSpreading:fe,ScrollMode:yt,CollapsePolicy:xt,Sizing:_t,TriggerStart:dt,Stretch:Nt,ViewboxStretch:Kt,Wrap:Qt,BrushType:Vt,ColorSpace:zt,GeometryStretch:C,GeometryType:M,SegmentType:L,BindingMode:Ve,ChangeType:O,CircularArrangement:Ke,CircularDirection:Ye,CircularNodeDiameterFormula:He,CircularSorting:qe,GridAlignment:Oe,GridArrangement:Re,GridSorting:Be,LayeredDigraphAggressive:ai,LayeredDigraphAlign:li,LayeredDigraphCycleRemove:ni,LayeredDigraphInit:ri,LayeredDigraphLayering:oi,LayeredDigraphPack:hi,TreeAlignment:pi,TreeArrangement:wi,TreeCompaction:yi,TreeLayerStyle:bi,TreePath:fi,TreeSorting:mi,TreeStyle:xi,GestureMode:z,LinkingDirection:G,ReshapingBehavior:q,TextEditingAccept:nt,TextEditingStarting:ot,TextEditingState:rt,WheelMode:V};for(const t in Ai){const i=Ai[t];e.st(i)&&i!==ee&&(i.className=t)}e.$(Li)&&Li.version&&e.ne("WARNING: a `go` object on the root object is already defined.  "+("Debug"in Li?"debug ":"")+"version: "+Li.version+", replaced with version: "+Ai.version),wt.prototype.go=Ai,t.go=Ai}(),"function"==typeof define&&define.amd&&define("undefined"!=typeof global?global.go:self.go),"undefined"!=typeof module&&"object"==typeof module.exports&&(module.exports="undefined"!=typeof global?global.go:self.go);
//# sourceMappingURL=/sm/438f29aced9fb59eaef12f9cf12bc891387348d68a5fe759ee7e9ab18ae0c479.map