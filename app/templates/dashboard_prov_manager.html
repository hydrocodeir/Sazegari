{% extends "base.html" %}
{% block page_title %}داشبورد مدیر استان{% endblock %}

{% block content %}
<div class="row g-3">
  <div class="col-12">
    <div class="card p-4 border-0 shadow-sm hover-lift">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
        <div>
          <div class="h5 mb-1">خوش آمدید، {{ user.full_name or user.username }}</div>
          <div class="text-muted">نمایش تجمیعی داده‌ها و فرم‌های ثبت‌شده در سطح استان</div>
        </div>
        <div class="d-flex gap-2">
          <a class="btn btn-outline-primary" href="/reports"><i class="bi bi-file-earmark-text me-1"></i>گزارش‌ها</a>
          <a class="btn btn-outline-secondary" href="/notifications"><i class="bi bi-bell me-1"></i>اعلان‌ها</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card p-3 border-0 shadow-sm hover-lift">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="text-muted small">اعلان‌های خوانده‌نشده</div>
          <div class="h4 m-0">{{ kpi.unread_notifications }}</div>
        </div>
        <div class="display-6 text-primary"><i class="bi bi-bell"></i></div>
      </div>
      <a class="small mt-2" href="/notifications">مشاهده اعلان‌ها</a>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card p-3 border-0 shadow-sm hover-lift">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="text-muted small">گزارش‌های در صف شما</div>
          <div class="h4 m-0">{{ kpi.my_queue }}</div>
        </div>
        <div class="display-6 text-primary"><i class="bi bi-inbox"></i></div>
      </div>
      <a class="small mt-2" href="/reports">رفتن به گزارش‌ها</a>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card p-3 border-0 shadow-sm hover-lift">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="text-muted small">کل گزارش‌ها (سازمان)</div>
          <div class="h4 m-0">{{ kpi.total_reports }}</div>
        </div>
        <div class="display-6 text-primary"><i class="bi bi-files"></i></div>
      </div>
    </div>
  </div>

  <div class="col-md-3">
    <div class="card p-3 border-0 shadow-sm hover-lift">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="text-muted small">کل ثبت داده‌ها (سازمان)</div>
          <div class="h4 m-0">{{ kpi.total_submissions }}</div>
        </div>
        <div class="display-6 text-primary"><i class="bi bi-ui-checks"></i></div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card p-3 border-0 shadow-sm hover-lift">
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2">
        <div>
          <div class="h6 m-0">نمایش داده‌ها و فرم‌های وارد شده</div>
          <div class="text-muted small">با انتخاب شهرستان، جدول‌ها به‌صورت خودکار به‌روزرسانی می‌شوند.</div>
        </div>

        <div class="d-flex align-items-center gap-2">
          <label class="small text-muted m-0" for="county_id">شهرستان:</label>
          <select
            id="county_id"
            name="county_id"
            class="form-select form-select-sm"
            style="min-width: 220px"
            hx-get="/dashboard/prov/tables"
            hx-target="#prov-tables"
            hx-swap="innerHTML"
            hx-trigger="load, change"
            hx-indicator="#prov-tables-loading"
          >
            <option value="" selected>همه</option>
            <option value="0">استان</option>
            {% for c in counties %}
              <option value="{{ c.id }}">{{ c.name }}</option>
            {% endfor %}
          </select>

          <div id="prov-tables-loading" class="htmx-indicator ms-2">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </div>
        </div>
      </div>

      <div id="prov-tables" class="mt-3">
        <div class="text-muted">در حال بارگذاری...</div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card p-3 border-0 shadow-sm hover-lift">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
          <div class="h6 m-0">پایش برنامه (گراف ستونی هدف/تحقق)</div>
          <div class="text-muted small">نمایش تجمیعی کل استان بر اساس تیپ فرم‌ها و ردیف/پروژه‌ها</div>
        </div>
        <div class="htmx-indicator" id="prov-program-loading">
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        </div>
      </div>

      <div
        id="prov-program-charts"
        hx-get="/dashboard/prov/program-charts"
        hx-trigger="load"
        hx-swap="innerHTML"
        hx-indicator="#prov-program-loading"
      >
        <div class="text-muted">در حال بارگذاری...</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
