<div class="d-flex justify-content-between align-items-start">
  <div>
    <h6 class="mb-1">اقدامات</h6>
    <div class="text-muted small">وضعیت فعلی: <b>{{ report.status_label }}</b></div>
  </div>
  <span class="badge text-bg-light">#{{ report.id }}</span>
</div>

{% if actions|length == 0 %}
  <div class="text-muted mt-2">این گزارش در صف شما نیست یا اقدامی برای این وضعیت ندارید.</div>
{% else %}
  <div class="mt-3 d-grid gap-2">
    {% for act in actions %}
      <form hx-post="/reports/{{ report.id }}/action" hx-target="#actionsBox" hx-swap="innerHTML" class="border rounded-4 p-3 bg-body-tertiary">
        <input type="hidden" name="action" value="{{ act }}">

        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="fw-semibold">
            {% if act == "submit_for_review" %}ارسال برای بررسی{% endif %}
            {% if act == "approve" %}تأیید و ارسال{% endif %}
            {% if act == "request_revision" %}برگشت برای اصلاح{% endif %}
            {% if act == "final_approve" %}تأیید نهایی{% endif %}
          </div>
          <span class="badge text-bg-secondary">{{ act }}</span>
        </div>

        {% if act != "final_approve" %}
          <label class="form-label small text-muted mb-1">ارسال به</label>
          <select name="recipient_id" class="form-select form-select-sm" required>
            <option value="">-- انتخاب گیرنده --</option>
            {% for u in (action_recipients.get(act) or []) %}
              <option value="{{ u.id }}">{{ u.full_name }} ({{ u.username }})</option>
            {% endfor %}
          </select>
        {% endif %}

        <label class="form-label small text-muted mt-2 mb-1">توضیح (اختیاری)</label>
        <input name="comment" class="form-control form-control-sm" placeholder="توضیح کوتاه...">

        <button type="submit" class="btn btn-sm btn-primary mt-2 w-100">
          انجام اقدام
        </button>
      </form>
    {% endfor %}
  </div>
{% endif %}
