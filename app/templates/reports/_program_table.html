{# Program monitoring comparative table (snapshot) #}

<div class="table-responsive">
  <table class="table table-sm table-bordered align-middle text-center mb-0">
    <thead class="table-light">
      <tr>
        <th style="min-width:60px">ردیف</th>
        <th style="min-width:220px">عنوان پروژه/ردیف</th>
        <th style="min-width:90px">واحد</th>
        <th style="min-width:90px">سال شروع</th>
        <th style="min-width:140px">سال پیش‌بینی خاتمه</th>
        <th style="min-width:160px">هدف تا سال پیش‌بینی خاتمه</th>
        {% for y in (data.year_cols or []) %}
          <th style="min-width:140px">عملکرد سال {{ y }}</th>
        {% endfor %}
        <th style="min-width:160px">{{ data.current_label }}</th>
        <th style="min-width:260px">اقدامات از ابتدای برنامه تا پایان {{ data.current_label }}</th>
        <th style="min-width:200px">عملکرد تجمعی تا پایان {{ data.current_label }}</th>
        <th style="min-width:150px">درصد پیشرفت کلی</th>
      </tr>
    </thead>
    <tbody>
      {% for r in (data.rows or []) %}
        <tr>
          <td>{{ r.row_no }}</td>
          <td class="text-start">{{ r.title }}</td>
          <td>{{ r.unit }}</td>
          <td>{{ r.start_year }}</td>
          <td>{{ r.end_year }}</td>
          <td>{{ r.target_value_display }}</td>
          {% for y in (data.year_cols or []) %}
            <td>{{ (r.annual or {}).get(y, '') }}</td>
          {% endfor %}
          <td>{{ r.current }}</td>
          <td class="text-start">{{ r.actions | safe }}</td>
          <td>{{ r.cumulative_display }}</td>
          <td>
            {% set p = (r.progress or 0) * 100 %}
            {{ "%.2f"|format(p) | replace('.00','') }}%
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
