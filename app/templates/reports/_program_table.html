{# Program monitoring comparative table (snapshot) #}

<div class="table-responsive">
  <table class="table table-sm table-bordered align-middle text-center mb-0">
    <thead class="table-light">
      <tr>
        <th style="min-width:60px">رديف</th>
        <th style="min-width:260px">نام پروژه</th>
        <th style="min-width:110px">سال شروع پروژه</th>
        <th style="min-width:140px">پیش‌بینی سال خاتمه</th>
        <th style="min-width:160px">{{ data.target_header or 'هدف' }}</th>
        {% for y in (data.year_cols or []) %}
          <th style="min-width:140px">عملکرد سال {{ y }}</th>
        {% endfor %}
        {% if data.current_cols %}
          {% for c in (data.current_cols or []) %}
            <th style="min-width:160px">{{ c.label }}</th>
          {% endfor %}
        {% else %}
          <th style="min-width:180px">{{ data.current_perf_label or data.current_label }}</th>
        {% endif %}
        <th style="min-width:180px">اقدامات از ابتدای برنامه</th>
        <th style="min-width:180px">درصد پیشرفت کلی برنامه</th>
      </tr>
    </thead>
    <tbody>
      {% for r in (data.rows or []) %}
        <tr>
          <td>{{ r.row_no }}</td>
          <td class="text-start">{{ r.title }}</td>
          <td>{{ r.start_year }}</td>
          <td>{{ r.end_year }}</td>
          <td>{{ r.target_value_display }}</td>
          {% for y in (data.year_cols or []) %}
            <td>{{ (r.annual or {}).get(y, '') }}</td>
          {% endfor %}
          {% if data.current_cols %}
            {% for c in (data.current_cols or []) %}
              {% set idx = loop.index0 %}
              <td>{{ (r.current_values[idx] if (r.current_values is defined and (r.current_values|length) > idx) else '') }}</td>
            {% endfor %}
          {% else %}
            <td>{{ r.current }}</td>
          {% endif %}
          <td>{{ r.cumulative_display }}</td>
          <td>
            {% set p = (r.progress or 0) * 100 %}
            {{ "%.2f"|format(p) | replace('.00','') }}%
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
